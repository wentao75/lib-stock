{"version":3,"file":"lib-stock.js","sources":["src/utils.js","src/transaction-engine.js","src/transaction.js","src/reports.js","src/simulator.js","src/search.js","src/rules/benchmark-basic.js","src/rules/momentum-breakthrough.js","src/rules/stoploss.js","src/rules/outsideday.js","src/rules/opensell.js","src/rules/smashday.js","src/indicators/ma.js","src/indicators/atr.js","src/indicators/keltner-channel.js","src/indicators/boll.js","src/indicators/mtm.js","src/indicators/ttmwave.js","src/indicators/squeeze.js","src/rules/squeeze.js","src/rules/swing.js","src/rules/holp.js","src/indicators/rsi.js","src/rules/rsi-panic.js","src/indicators/wvf.js","src/rules/vixfix.js","src/indicators/everyday.js","src/rules/Everyday.js","src/indicators/ao.js","src/indicators/ttmtrend.js","src/indicators/scalper.js","src/favorites.js","src/index.js"],"sourcesContent":["import _ from \"lodash\";\n\nconst ORGANIZED = Symbol(\"表示数据是否经过检查和整理\");\nconst ADJUSTED = Symbol(\"已经复权处理\");\n\n/**\n * 对交易数据按照结构进行检查，检查后需要满足\n * 1. 数组结构\n * 2. 交易日期按照时间升序排列，0为最早的数据\n * 3. 如果提供了赋权因子，进行前复权计算\n * 4. 设置ORGANIZED标记为true\n *\n * @param {*} data 交易数据（日线）\n */\nfunction checkTradeData(data, digits = 3) {\n    if (_.isEmpty(data) || data[ORGANIZED]) return data;\n    if (!_.isArray(data)) return data;\n\n    // 检查数据排序，如果是降序，则反过来\n    if (checkOrder(data)) {\n        data.reverse();\n    }\n\n    if (data[0] && data[0].prevadj_factor) {\n        calculatePrevAdjPrice(data, digits);\n    }\n\n    data[ORGANIZED] = true;\n    return data;\n}\n\n/**\n * 将日线数据中的历史价位根据复权因子全部处理为前复权结果，方便后续计算\n *\n * @param {*} dailyData 日线数据\n * @param {int} digits 保留位数\n */\nfunction calculatePrevAdjPrice(dailyData, digits = 3) {\n    if (dailyData && dailyData.length > 0 && !dailyData[ADJUSTED]) {\n        dailyData.forEach((item) => {\n            if (item.prevadj_factor && !item.origin) {\n                // console.log(\n                //     `复权前 ${item.trade_date}, ${item.open}, ${item.close}`\n                // );\n                item.origin = {\n                    open: item.open,\n                    close: item.close,\n                    high: item.high,\n                    low: item.low,\n                    pre_close: item.pre_close,\n                    change: item.change,\n                };\n                item.open = toFixed(item.open * item.prevadj_factor, digits);\n                item.close = toFixed(item.close * item.prevadj_factor, digits);\n                item.high = toFixed(item.high * item.prevadj_factor, digits);\n                item.low = toFixed(item.low * item.prevadj_factor, digits);\n                item.pre_close = toFixed(\n                    item.pre_close * item.prevadj_factor,\n                    digits\n                );\n                item.change = toFixed(\n                    item.change * item.prevadj_factor,\n                    digits\n                );\n                // console.log(\n                //     `复权后 ${item.trade_date}, ${item.open}, ${item.close}`\n                // );\n            }\n        });\n        dailyData[ADJUSTED] = true;\n    }\n}\n\nfunction readData(item, prop) {\n    if (_.isFunction(prop)) {\n        return prop(item);\n    } else if (_.isString(prop)) {\n        if (prop === \"tr\") {\n            return tr(item);\n        } else if (prop === \"ohlc\") {\n            return ohlc(item);\n        } else if (prop === \"hl\") {\n            return hl(item);\n        } else {\n            return item && item[prop];\n        }\n    }\n    return item;\n}\n\nfunction toFixed(num, digits = 3) {\n    return Number(num.toFixed(digits));\n}\n\nfunction checkOrder(array) {\n    return (\n        array &&\n        _.isArray(array) &&\n        array.length > 1 &&\n        _.isObject(array[0]) &&\n        _.has(array[0], \"trade_date\") &&\n        array[0].trade_date > array[array.length - 1].trade_date\n    );\n}\n\nfunction average(array, index, n, prop, digits = 3) {\n    if (\n        index >= 0 &&\n        array &&\n        Array.isArray(array) &&\n        array.length > index &&\n        n > 0\n    ) {\n        let desc = checkOrder(array);\n\n        let step = desc ? -1 : 1;\n        let lastIndex = index - step * n;\n        if (lastIndex < 0 || lastIndex >= array.length) {\n            return;\n        }\n\n        let i = index;\n        let count = 0;\n        let sum = 0;\n        while (i >= 0 && i < array.length && count < n) {\n            sum += readData(array[i], prop);\n            i -= step;\n            count++;\n        }\n        if (count === n) {\n            return toFixed(sum / n, digits);\n        }\n        // let calcArr = array.slice(index - n + 1, index + 1);\n        // return (\n        //     calcArr\n        //         .map((item, i, all) => {\n        //             return readData(item, prop);\n        //         })\n        //         .reduce((total, item) => {\n        //             return total + item;\n        //         }, 0) / n\n        // );\n    }\n}\n\nfunction highest(array, index, n, prop, digits = 3) {\n    if (\n        index >= 0 &&\n        array &&\n        Array.isArray(array) &&\n        array.length > index &&\n        n > 0\n    ) {\n        let lastIndex = index - n + 1;\n        if (lastIndex < 0 || lastIndex >= array.length) {\n            return;\n        }\n\n        let tmp = readData(array[index], prop);\n        for (let i = 1; i < n; i++) {\n            if (index - i < 0 || index - i >= array.length) continue;\n            tmp = Math.max(tmp, readData(array[index - i], prop));\n        }\n        return tmp;\n    }\n}\n\nfunction lowest(array, index, n, prop, digits = 3) {\n    if (\n        index >= 0 &&\n        array &&\n        Array.isArray(array) &&\n        array.length > index &&\n        n > 0\n    ) {\n        let lastIndex = index - n + 1;\n        if (lastIndex < 0 || lastIndex >= array.length) {\n            return;\n        }\n\n        let tmp = readData(array[index], prop);\n        for (let i = 1; i < n; i++) {\n            if (index - i < 0 || index - i >= array.length) continue;\n            tmp = Math.min(tmp, readData(array[index - i], prop));\n        }\n        return tmp;\n    }\n}\n\nfunction ma(array, n, prop, type, digits = 3) {\n    if (type === \"ma\") {\n        return sma(array, n, prop, digits);\n    } else {\n        return ema(array, n, prop, digits);\n    }\n}\n\nfunction sma(array, n, prop, digits = 3) {\n    if (array && Array.isArray(array) && array.length > 0 && n > 0) {\n        let desc = checkOrder(array);\n        let step = desc ? -1 : 1;\n        let i = desc ? array.length - 1 : 0;\n        let index = 0;\n        let ret = [];\n        while (i >= 0 && i < array.length) {\n            ret[index] = average(array, i, n, prop, digits);\n            index++;\n            i += step;\n        }\n        return ret;\n    }\n}\n\nfunction ema(array, n, prop, digits = 3) {\n    if (array && Array.isArray(array) && array.length > 0 && n > 0) {\n        let desc = checkOrder(array);\n        let step = desc ? -1 : 1;\n        let i = desc ? array.length - 1 : 0;\n        let index = 0;\n        let ret = [];\n        let tmp = 0;\n        while (i >= 0 && i < array.length) {\n            let val = readData(array[i], prop);\n            if (index === 0) {\n                // tmp = readData(array[i], prop);\n                tmp = val;\n            } else {\n                tmp = (2 * val + (n - 1) * tmp) / (n + 1);\n            }\n            ret[index] = toFixed(tmp, digits);\n            // console.log(\n            //     `debug ema[${n}][${array[i].trade_date}]: ${i} ${tmp}, ${val}`\n            // );\n            index++;\n            i += step;\n        }\n        return ret;\n    }\n}\n\n/**\n * 计算指定数据的TR值\n * @param {*} data 日线数据\n */\nfunction tr(data) {\n    if (data) {\n        return Math.max(\n            data.high - data.low,\n            Math.abs(data.high - data.pre_close),\n            Math.abs(data.pre_close - data.low)\n        );\n    }\n}\n\nfunction ohlc(data) {\n    if (data) {\n        return (data.open + data.high + data.low + data.close) / 4;\n    }\n}\n\nfunction hl(data) {\n    if (data) {\n        return (data.high + data.low) / 2;\n    }\n}\n\n/**\n * 用于计算数组数据的布林线结果，返回数组\n * @param {Array} array 数据数组\n * @param {number} n 均线周期\n * @param {number} multi 布林线偏差倍数\n * @param {number}} digits 保留小数位数\n */\nfunction boll(array, n = 20, multi = 2.0, prop = null, digits = 3) {\n    let ret = [];\n    let ma = sma(array, n, prop, digits);\n    if (!ma) return;\n\n    let std = stdev(array, n, prop, digits);\n    if (!std) return;\n\n    let up = [];\n    let down = [];\n    for (let i = 0; i < ma.length; i++) {\n        up[i] = toFixed(ma[i] + multi * std[i], digits);\n        down[i] = toFixed(ma[i] - multi * std[i], digits);\n\n        ret[i] = [ma[i], up[i], down[i], std[i]];\n    }\n\n    // return [ma, up, down, stdev];\n    return ret;\n}\n\n// function osc(array, prop = null, n = 14, digits = 3) {\n//     if (array && Array.isArray(array) && array.length > 0 && n > 0) {\n//         let ret = [];\n\n//         for (let i = 0; i < array.length; i++) {\n//             let ohc = highest(array, i, n, prop, digits);\n//             let olc = lowest(array, i, n, prop, digits);\n//             osc =\n//         }\n//     }\n// }\n\n/**\n *\n * @param {Array} array 数据数组\n * @param {number} n 平均天数\n * @param {*} prop 数据属性或转换方法\n * @param {string} type 偏差类型\n * @param {boolean} desc 数据数组是否降序\n * @param {number} digits 小数保留位数\n */\nfunction stdev(array, n, prop, digits = 3) {\n    if (array && Array.isArray(array) && array.length > 0 && n > 0) {\n        let desc = checkOrder(array);\n        let step = desc ? -1 : 1;\n        let i = desc ? array.length - 1 : 0;\n        let index = 0;\n        let ret = [];\n        while (i >= 0 && i < array.length) {\n            let ma = average(array, i, n, prop, digits);\n            let d;\n\n            if (ma) {\n                let sum = 0;\n                let j = i;\n                let count = 0;\n                while (j >= 0 && j < array.length && count < n) {\n                    let tmp = readData(array[j], prop);\n                    sum += (tmp - ma) ** 2;\n                    // console.log(\n                    //     `j=${j} - ${array[j].trade_date}, ohlc=${tmp}, sum=${sum}`\n                    // );\n                    count++;\n                    j -= step;\n                }\n                // d = toFixed(Math.sqrt(sum / (n - 1)), digits);\n                d = toFixed(Math.sqrt(sum / n), digits);\n                // console.log(\n                //     `stdev: ${i}, ${array[i].trade_date}, ma=${ma}, stdev=${d}`\n                // );\n            }\n\n            ret[index] = d;\n            index++;\n            i += step;\n        }\n        return ret;\n    }\n}\n\nfunction formatFxstr(num) {\n    return num.toLocaleString(\"zh-CN\"); //, { style: \"currency\", currency: \"CNY\" });\n}\n\n/**\n * 读取给定数组指定位置的数据，如果数据不存在则返回默认值\n * @param {Arry} array 数据数组\n * @param {Integer}} pos 读取位置索引\n * @param {*} defaultVal 默认值\n */\nfunction nz(array, pos, defaultVal = 0.0) {\n    if (_.isNil(array) && !_.isArray(array)) {\n        return defaultVal;\n    }\n\n    if (pos < 0 || pos > array.length - 1) {\n        return defaultVal;\n    }\n\n    return array[pos];\n}\n\n/**\n * 线性回归，使用最小二乘法计算，公式为：linreg = intercept+slope*(len-1)\n * 计算返回值为 [slope, average, intercept]\n * 计算当中的len以当前位置pos为基准向前取值 pos-index\n *\n * @param {Array} array 数据数组\n * @param {Integer}} pos 数据计算的开始位置\n * @param {*} prop 数据属性（读取使用）\n * @param {Integer} len 数据拟合使用的周期\n */\nfunction linreg(array, pos, prop, len) {\n    if (\n        _.isNil(array) ||\n        !_.isArray(array) ||\n        len <= 1 ||\n        pos < 0 ||\n        pos >= array.length ||\n        pos - len + 1 < 0\n    ) {\n        return [];\n    }\n\n    let sumX = 0.0;\n    let sumY = 0.0;\n    let sumXSqr = 0.0;\n    let sumXY = 0.0;\n    for (let i = 0; i < len; i++) {\n        let val = readData(array[pos - i], prop);\n        let per = i + 1.0;\n        sumX += per;\n        sumY += val;\n        sumXSqr += per * per;\n        sumXY += val * per;\n    }\n    let slope = (len * sumXY - sumX * sumY) / (len * sumXSqr - sumX * sumX);\n    let avg = sumY / len;\n    let intercept = avg - (slope * sumX) / len + slope;\n    return [slope, avg, intercept];\n}\n\nexport default {\n    formatFxstr,\n    average,\n    ma,\n    sma,\n    ema,\n    stdev,\n    tr,\n    ohlc,\n    hl,\n    readData,\n    toFixed,\n    checkTradeData,\n    boll,\n    highest,\n    lowest,\n    nz,\n    linreg,\n};\n","import _ from \"lodash\";\n// import { formatFxstr } from \"./util\";\nimport utils from \"./utils\";\nimport debugpkg from \"debug\";\n\n// import trans from \"./transaction\";\n\nconst debug = debugpkg(\"engine\");\n\n/**\n * 主处理过程\n * 1. 查看设置中的卖出模型列表，按序执行，如果成交，则直接清算\n * 2. 如果执行完卖出，仍然有持仓，检查配置是否许可买入\n * 3. 如果需要买入，查看设置的买入模型列表，按序执行，如果成交，则直接清算\n *\n * 2020.8.26 目前已经支持按照规则，非固定头寸方式下，可以在持仓下仍然买入\n *           持仓卖出按照每笔单独进行，不合并进行\n *\n * @param {*} index 当前日股票数据索引\n * @param {*} stockData 股票数据信息\n * @param {*} capitalData 账户信息\n * @param {*} options 算法参数\n */\nasync function executeTransaction(index, stockData, capitalData, options) {\n    let translog = null;\n    // 首先检查卖出\n    // 所有算法首先检查并处理止损\n    // 检查是否需要止损\n    let tradeDate = stockData[index].trade_date;\n    let stockInfo = capitalData.info;\n\n    let sellRules = options.rules && options.rules.sell;\n    let buyRules = options.rules && options.rules.buy;\n\n    // 目前的持仓情况\n    let stocks = capitalData && capitalData.stocks;\n    if (sellRules) {\n        // 每个买入持股单独处理\n        let stockId = 0;\n        while (stockId < stocks.length) {\n            let stock = stocks[stockId];\n            debug(`检查卖出股票信息: %o`, stock);\n\n            let sold = false;\n            for (let rule of sellRules) {\n                if (rule) {\n                    debug(\n                        `${rule.name} 卖出检查：${tradeDate}, %o`,\n                        stockData[index]\n                    );\n                    translog = rule.checkSellTransaction(\n                        stockInfo,\n                        stock,\n                        index,\n                        stockData,\n                        options\n                    );\n                    if (translog) translog.transeq = stock.transeq;\n                    if (\n                        executeCapitalSettlement(\n                            stockInfo,\n                            translog,\n                            capitalData,\n                            options\n                        )\n                    ) {\n                        debug(\n                            `${\n                                rule.name\n                            } 卖出：${tradeDate}，价格：${utils.formatFxstr(\n                                translog.price\n                            )}元，数量：${\n                                translog.count / 100\n                            }手，总价：${translog.total.toFixed(\n                                2\n                            )}元[佣金${translog.commission.toFixed(\n                                2\n                            )}元，过户费${translog.fee.toFixed(\n                                2\n                            )}，印花税${translog.duty.toFixed(2)}元], ${\n                                translog.memo\n                            }`\n                        );\n                        sold = true;\n                        break;\n                    }\n                }\n            }\n            if (!sold) {\n                // 没有卖出，需要查看下一条持股进行检查\n                stockId++;\n            }\n        }\n    }\n\n    // 如果非固定头寸，则检查是否有持仓，如果有不进行买入\n    if (!options.fixCash && capitalData.stocks.length > 0) return;\n    // if (capitalData && capitalData.stock && capitalData.stock.count > 0) return;\n\n    // 执行买入\n    // debug(\"执行买入检查\");\n    let cash = capitalData.balance;\n    if (options.fixCash) cash = options.initBalance;\n    if (buyRules) {\n        for (let rule of buyRules) {\n            translog = rule.checkBuyTransaction(\n                stockInfo,\n                cash,\n                index,\n                stockData,\n                options\n            );\n            if (translog) translog.transeq = capitalData._transeq++;\n            // debug(`买入结果：%o`, translog);\n            if (\n                executeCapitalSettlement(\n                    stockInfo,\n                    translog,\n                    capitalData,\n                    options\n                )\n            ) {\n                debug(\n                    `${\n                        rule.name\n                    } 买入交易：${tradeDate}，价格：${translog.price.toFixed(\n                        2\n                    )}元，数量：${\n                        translog.count / 100\n                    }手，总价：${translog.total.toFixed(\n                        2\n                    )}元[佣金${translog.commission.toFixed(\n                        2\n                    )}元，过户费${translog.fee.toFixed(\n                        2\n                    )}，印花税${translog.duty.toFixed(2)}元], ${translog.memo}`\n                );\n                // debug(`股票信息：%o`, stockInfo);\n                // debug(`账户信息：%o`, capitalData);\n                // return translog;\n            }\n        }\n    }\n}\n\n/**\n * 根据交易记录完成账户清算\n * @param {*} stockInfo 股票信息\n * @param {*} translog 交易记录\n * @param {*} capitalData 账户数据\n * @param {*} options 配置参数\n */\nfunction executeCapitalSettlement(stockInfo, translog, capitalData, options) {\n    // debug(`执行清算 %o`, translog);\n    if (_.isEmpty(translog)) return false;\n    // 如果非固定头寸，检查当前提供的交易余额是否可执行\n    if (!options.fixCash && translog.total + capitalData.balance < 0) {\n        debug(\n            `账户余额${capitalData.balance}不足(${\n                translog.total\n            })，无法完成清算，交易取消! 交易信息: ${\n                translog.type === \"buy\" ? \"买入\" : \"卖出\"\n            }${stockInfo.ts_code} ${translog.count}股，价格${\n                translog.price\n            }，共计${translog.total}元[含佣金${translog.commission}元，过户费${\n                translog.fee\n            }，印花税${translog.duty}元]`\n        );\n        return false;\n    }\n\n    // 处理交易信息\n    capitalData.balance += translog.total;\n    // 如果当前买入，stock中放置持股信息和买入交易日志，只有卖出发生时才合并生成一条交易记录，包含两个部分\n    if (translog.type === \"buy\") {\n        capitalData.stocks.push({\n            transeq: translog.transeq,\n            count: translog.count,\n            price: translog.price,\n            buy: translog,\n        });\n    } else {\n        let stock;\n        for (let i = 0; i < capitalData.stocks.length; i++) {\n            if (capitalData.stocks[i].transeq === translog.transeq) {\n                stock = capitalData.stocks[i];\n                capitalData.stocks.splice(i, 1);\n                break;\n            }\n        }\n        if (!stock) {\n            debug(\n                `没有找到要执行的交易序号：${translog.transeq}, %o`,\n                capitalData.stocks\n            );\n            return false;\n        }\n\n        let settledlog = {\n            transeq: stock.transeq,\n            tradeDate: translog.date,\n            profit: stock.buy.total + translog.total,\n            income: translog.count * translog.price - stock.count * stock.price,\n            buy: stock.buy,\n            sell: translog,\n        };\n        // capitalData.stock = {\n        //     //info: null,\n        //     count: 0,\n        //     price: 0,\n        // };\n        capitalData.transactions.push(settledlog);\n    }\n    // debug(\"完成清算！\");\n    return true;\n}\n\nexport default {\n    executeTransaction,\n    executeCapitalSettlement,\n};\n","import _ from \"lodash\";\nimport utils from \"./utils\";\n// import { formatFxstr } from \"./util\";\nimport debugpkg from \"debug\";\n\nconst debug = debugpkg(\"transaction\");\n\n/**\n * 创建指定日期和股票信息的卖出交易\n * @param {*} stockInfo\n * @param {*} tradeDate\n * @param {*} tradeDateIndex\n * @param {*} count\n * @param {*} price\n * @param {*} memo\n */\nfunction createSellTransaction(\n    stockInfo,\n    tradeDate,\n    tradeDateIndex,\n    count,\n    price,\n    methodType,\n    memo\n) {\n    // 计算费用\n    let total = calculateTransactionFee(false, stockInfo, count, price);\n    // 创建卖出交易记录\n    return {\n        date: tradeDate,\n        dateIndex: tradeDateIndex,\n        type: \"sell\",\n        count,\n        price,\n        total: total.total,\n        amount: total.amount,\n        fee: total.fee,\n        commission: total.commission,\n        duty: total.duty,\n        methodType,\n        memo,\n    };\n}\n\n/**\n * 构建买入交易信息\n * @param {*} stockInfo 股票信息\n * @param {*} tradeDate 交易日期\n * @param {*} tradeDateIndex 交易日期索引（方便用于计算交易日数）\n * @param {*} balance 可用余额\n * @param {*} price 买入价格\n * @param {*} memo 交易备注\n */\nfunction createBuyTransaction(\n    stockInfo,\n    tradeDate,\n    tradeDateIndex,\n    balance,\n    price,\n    methodType,\n    memo\n) {\n    // 计算费用\n    let count = parseInt(balance / price / 100) * 100;\n    // 最小交易单位为1手，资金不足放弃！\n    if (count < 100) return;\n    let total = calculateTransactionFee(true, stockInfo, count, price);\n    while (total.total + balance < 0) {\n        count -= 100;\n        if (count < 100) return;\n        total = calculateTransactionFee(true, stockInfo, count, price);\n    }\n    // 创建买入交易记录\n    return {\n        date: tradeDate,\n        dateIndex: tradeDateIndex,\n        type: \"buy\",\n        count: count,\n        price,\n        total: total.total,\n        amount: total.amount,\n        fee: total.fee,\n        commission: total.commission,\n        duty: total.duty,\n        methodType,\n        memo,\n    };\n}\n\n/**\n * 计算交易价格和费用\n * @param {boolean}} buy 买卖标记\n * @param {*} stockInfo 股票信息\n * @param {*} count 买卖数量\n * @param {*} price 买卖单价\n */\nfunction calculateTransactionFee(buy, stockInfo, count, price) {\n    let amount = count * price;\n    let commission = (amount * 0.25) / 1000;\n    let fee = 0.0;\n    let duty = 0.0;\n    if (stockInfo.exchange === \"SSE\") {\n        // 上海，过户费千分之0.2\n        fee += (amount * 0.02) / 1000;\n    } else if (stockInfo.exchange === \"SZSE\") {\n        // 深圳，无\n    }\n    // 印花税，仅对卖方收取\n    if (!buy) {\n        duty += (amount * 1) / 1000;\n    }\n\n    let total = 0.0;\n    if (buy) {\n        total = 0 - (amount + commission + fee + duty);\n    } else {\n        total = amount - commission - fee - duty;\n    }\n\n    return { total, amount, commission, fee, duty };\n}\n\nfunction parseCapitalReports(capitalData) {\n    if (_.isEmpty(capitalData)) return;\n    // 账户信息中主要需分析交易过程，正常都是为一次买入，一次卖出，这样作为一组交易，获得一次盈利结果\n    let count = capitalData.transactions.length;\n    let count_win = 0;\n    let total_win = 0;\n    let count_loss = 0;\n    let total_loss = 0;\n    let total_profit = 0;\n    let total_fee = 0;\n    let max_profit = 0;\n    let max_loss = 0;\n    let average_profit = 0;\n    let average_win = 0;\n    let average_loss = 0;\n    let max_wintimes = 0; // 连续盈利次数\n    let max_losstimes = 0; // 连续亏损次数\n    let max_windays = 0;\n    let max_lossdays = 0;\n    let average_windays = 0;\n    let average_lossdays = 0;\n    // {times: 总次数, win_times: 盈利次数, loss_times: 损失次数}\n    let selltypes = {};\n    //let selltype_times = {};\n\n    // 收益率：表示单位成本的收入比例\n    let ror_win = 0;\n    let ror_loss = 0;\n    let ror = 0;\n\n    let tmp_cost = 0;\n    let tmp_cost_win = 0;\n    let tmp_cost_loss = 0;\n\n    let currentType = 0;\n    let tmp_times = 0;\n    let tmp_windays = 0;\n    let tmp_lossdays = 0;\n    for (let log of capitalData.transactions) {\n        let days = log.sell.dateIndex - log.buy.dateIndex + 1;\n\n        let selltype = selltypes[log.sell.methodType];\n        if (!selltype) {\n            selltypes[log.sell.methodType] = {\n                times: 0,\n                win_times: 0,\n                loss_times: 0,\n            };\n        }\n        selltypes[log.sell.methodType].times += 1;\n\n        if (log.profit >= 0) {\n            count_win++;\n            total_win += log.profit;\n            tmp_cost_win += -log.buy.total;\n            if (max_profit < log.profit) max_profit = log.profit;\n\n            tmp_windays += days;\n            if (max_windays < days) max_windays = days;\n\n            // 连续计数\n            if (currentType === 1) {\n                tmp_times++;\n            } else {\n                if (currentType === -1) {\n                    if (max_losstimes < tmp_times) max_losstimes = tmp_times;\n                }\n                // 初始化\n                currentType = 1;\n                tmp_times = 1;\n            }\n\n            selltypes[log.sell.methodType].win_times += 1;\n        } else {\n            count_loss++;\n            total_loss += log.profit;\n            tmp_cost_loss += -log.buy.total;\n            if (max_loss > log.profit) max_loss = log.profit;\n\n            tmp_lossdays += days;\n            if (max_lossdays < days) max_lossdays = days;\n\n            // 连续计数\n            if (currentType === -1) {\n                tmp_times++;\n            } else {\n                if (currentType === 1) {\n                    if (max_wintimes < tmp_times) max_wintimes = tmp_times;\n                }\n                // 初始化\n                currentType = -1;\n                tmp_times = 1;\n            }\n\n            selltypes[log.sell.methodType].loss_times += 1;\n        }\n\n        total_profit += log.profit;\n        total_fee +=\n            log.buy.commission +\n            log.buy.fee +\n            log.buy.duty +\n            (log.sell.commission + log.sell.fee + log.sell.duty);\n        tmp_cost += -log.buy.total;\n    }\n\n    if (currentType === 1) {\n        if (max_wintimes < tmp_times) max_wintimes = tmp_times;\n    } else if (currentType === -1) {\n        if (max_losstimes < tmp_times) max_losstimes = tmp_times;\n    }\n\n    average_profit = total_profit / count;\n    average_win = total_win / count_win;\n    average_loss = -total_loss / count_loss;\n\n    average_windays = Number((tmp_windays / count_win).toFixed(1));\n    average_lossdays = Number((tmp_lossdays / count_loss).toFixed(1));\n\n    ror = total_profit / tmp_cost;\n    ror_win = total_win / tmp_cost_win;\n    ror_loss = total_loss / tmp_cost_loss;\n\n    return {\n        count,\n        total_profit,\n        total_fee,\n        count_win,\n        total_win,\n        count_loss,\n        total_loss,\n        max_profit,\n        max_loss,\n        average_profit,\n        average_win,\n        average_loss,\n        max_wintimes,\n        max_losstimes,\n        max_windays,\n        max_lossdays,\n        average_windays,\n        average_lossdays,\n        selltypes,\n\n        ror,\n        ror_win,\n        ror_loss,\n    };\n}\n\nfunction showCapitalReports(log, capitalData) {\n    log(\n        `******************************************************************************************`\n    );\n    // log(\n    //     \"*                                                                                                                      *\"\n    // );\n    if (capitalData.stocks && capitalData.stocks.length > 0) {\n        let stockvalue = 0;\n        for (let stock of capitalData.stocks) {\n            stockvalue += stock.count * stock.price;\n        }\n        log(\n            `  账户价值 ${utils.formatFxstr(\n                capitalData.balance + stockvalue\n            )}元  【余额 ${utils.formatFxstr(\n                capitalData.balance\n            )}元, 持股: ${utils.formatFxstr(stockvalue)}元】`\n        );\n    } else {\n        log(`  账户余额 ${utils.formatFxstr(capitalData.balance)}元`);\n    }\n\n    let capitalResult = parseCapitalReports(capitalData);\n    // log(``);\n    log(\n        `  总净利润：${utils.formatFxstr(\n            capitalResult.total_profit\n        )},  收益率 ${(capitalResult.ror * 100).toFixed(2)}%`\n    );\n    log(\n        `  毛利润： ${utils.formatFxstr(\n            capitalResult.total_win\n        )},  总亏损：${utils.formatFxstr(capitalResult.total_loss)}`\n    );\n    log(\n        `  盈利收益率： ${(capitalResult.ror_win * 100).toFixed(\n            2\n        )}%,  亏损收益率：${(capitalResult.ror_loss * 100).toFixed(2)}%`\n    );\n    log(\"\");\n    log(\n        `  总交易次数： ${capitalResult.count},  利润率：${(\n            (capitalResult.count_win * 100) /\n            capitalResult.count\n        ).toFixed(1)}%`\n    );\n    log(\n        `  总盈利次数： ${capitalResult.count_win},  总亏损次数：${capitalResult.count_loss}`\n    );\n    log(\"\");\n    log(\n        `  最大单笔盈利： ${utils.formatFxstr(\n            capitalResult.max_profit\n        )},  最大单笔亏损：${utils.formatFxstr(capitalResult.max_loss)}`\n    );\n    log(\n        `  平均盈利： ${utils.formatFxstr(\n            capitalResult.average_win\n        )},  平均亏损：${utils.formatFxstr(capitalResult.average_loss)}`\n    );\n    log(\n        `  平均盈利/平均亏损： ${(\n            capitalResult.average_win / capitalResult.average_loss\n        ).toFixed(2)},  平均每笔总盈利：${utils.formatFxstr(\n            capitalResult.average_profit\n        )}`\n    );\n    log(\"\");\n    log(\n        `  最多连续盈利次数： ${capitalResult.max_wintimes},  最多连续亏损次数：${capitalResult.max_losstimes}`\n    );\n    log(\n        `  盈利最多持有天数： ${capitalResult.max_windays},  亏损最多持有天数：${capitalResult.max_lossdays}`\n    );\n    log(\n        `  盈利平均持有天数： ${capitalResult.average_windays},  亏损平均持有天数：${capitalResult.average_lossdays}`\n    );\n\n    log(\"\");\n    for (let methodType in capitalResult.selltypes) {\n        let selltype = capitalResult.selltypes[methodType];\n        log(\n            `  卖出类型${methodType} 共${selltype.times}次,  盈利${selltype.win_times}次， 损失${selltype.loss_times}次`\n        );\n    }\n    // log(\n    //     \"*                                                                                                                      *\"\n    // );\n    log(\n        `******************************************************************************************`\n    );\n    log(\"\");\n}\n\nfunction showTransactions(log, capitalData) {\n    log(`  交易日志分析\n******************************************************************************************`);\n    for (let translog of capitalData.transactions) {\n        log(logTransaction(translog));\n    }\n    if (capitalData.stock && capitalData.stock.count > 0) {\n        let holdlog = { buy: capitalData.stock.buy };\n        log(logTransaction(holdlog));\n    }\n    log(\n        `******************************************************************************************`\n    );\n}\n\n// settledlog = {\n//     transeq: 交易序号\n//     tradeDate: translog.tradeDate,\n//     profit: capitalData.stock.buy.total + translog.total,\n//     income:\n//         translog.count * translog.price -\n//         capitalData.stock.count * capitalData.stock.price,\n//     buy: capitalData.stock.buy,\n//     sell: translog,\n// };\n// trans: {\n// date: tradeDate.format(\"YYYYMMDD\"),\n// dateIndex: tradeDateIndex,\n// type: \"sell\",\n// count,\n// price,\n// total: total.total,\n// amount: total.amount,\n// fee: total.fee,\n// commission: total.commission,\n// duty: total.duty,\n// methodType,\n// memo,\n// }\nfunction logTransaction(translog) {\n    if (!translog) return \"\";\n    let buy = translog.buy;\n    let sell = translog.sell;\n    if (sell) {\n        return `收入：${utils.formatFxstr(translog.profit)}, 持有 ${\n            sell.dateIndex - buy.dateIndex + 1\n        }天，盈利 ${(-(translog.profit * 100) / buy.total).toFixed(2)}%, ${\n            translog.transeq\n        }\n       [买入 ${buy.date}, ${utils.formatFxstr(buy.price)}, ${\n            buy.count\n        }, ${utils.formatFxstr(buy.total)}, ${buy.transeq}] \n       [卖出 ${sell.date}, ${utils.formatFxstr(sell.price)}, ${\n            sell.count\n        }, ${utils.formatFxstr(sell.total)}, ${sell.methodType}, ${\n            sell.memo\n        }, ${sell.transeq}]`;\n    } else {\n        // 持有未卖出\n        return `收入：---, 持有 ---天，盈利 ---\n       [买入 ${buy.date}, ${utils.formatFxstr(buy.price)}, ${\n            buy.count\n        }, ${utils.formatFxstr(buy.total)}]`;\n    }\n}\n\nexport default {\n    createSellTransaction,\n    createBuyTransaction,\n    calculateTransactionFee,\n    parseCapitalReports,\n    showCapitalReports,\n    showTransactions,\n};\n","import moment from \"moment\";\nimport CG from \"console-grid\";\nimport utils from \"./utils\";\n// import { formatFxstr } from \"./util\";\nimport debugpkg from \"debug\";\nconst debug = debugpkg(\"reports\");\n\nfunction parseWorkdayReports(transactions) {\n    if (!transactions || transactions.length <= 0) return;\n    // 报告包含5+1行信息，1-5对应周一到周五的信息，0表示汇总\n    // 每行信息包括：count(交易次数), win_ratio(盈利比例)，win(平均盈利金额)，\n    //      loss_ratio(亏损比例) ，loss（平均亏损金额），ratio_winloss(盈利亏损比),\n    //      average(平均交易规模), max_loss（最大亏损），profit(利润)\n    let results = [\n        {\n            day: \"\",\n            count: 0,\n            count_win: 0,\n            count_loss: 0,\n            win_ratio: 0,\n            win: 0,\n            loss_ratio: 0,\n            loss: 0,\n            ratio_winloss: 0,\n            average: 0,\n            max_win: 0,\n            max_loss: 0,\n            profit: 0,\n        },\n        {\n            day: \"周一\",\n            count: 0,\n            count_win: 0,\n            count_loss: 0,\n            win_ratio: 0,\n            win: 0,\n            loss_ratio: 0,\n            loss: 0,\n            ratio_winloss: 0,\n            average: 0,\n            max_win: 0,\n            max_loss: 0,\n            profit: 0,\n        },\n        {\n            day: \"周二\",\n            count: 0,\n            count_win: 0,\n            count_loss: 0,\n            win_ratio: 0,\n            win: 0,\n            loss_ratio: 0,\n            loss: 0,\n            ratio_winloss: 0,\n            average: 0,\n            max_win: 0,\n            max_loss: 0,\n            profit: 0,\n        },\n        {\n            day: \"周三\",\n            count: 0,\n            count_win: 0,\n            count_loss: 0,\n            win_ratio: 0,\n            win: 0,\n            loss_ratio: 0,\n            loss: 0,\n            ratio_winloss: 0,\n            average: 0,\n            max_win: 0,\n            max_loss: 0,\n            profit: 0,\n        },\n        {\n            day: \"周四\",\n            count: 0,\n            count_win: 0,\n            count_loss: 0,\n            win_ratio: 0,\n            win: 0,\n            loss_ratio: 0,\n            loss: 0,\n            ratio_winloss: 0,\n            average: 0,\n            max_win: 0,\n            max_loss: 0,\n            profit: 0,\n        },\n        {\n            day: \"周五\",\n            count: 0,\n            count_win: 0,\n            count_loss: 0,\n            win_ratio: 0,\n            win: 0,\n            loss_ratio: 0,\n            loss: 0,\n            ratio_winloss: 0,\n            average: 0,\n            max_win: 0,\n            max_loss: 0,\n            profit: 0,\n        },\n    ];\n\n    for (let trans of transactions) {\n        let buy = trans.buy;\n        // let sell = trans.sell;\n        let date = moment(buy.date, \"YYYYMMDD\");\n        let day = date.day();\n        if (day < 1 && day > 5) {\n            // 超出了周一～周五的范围，跳过这个日期\n            debug(`${buy.tradeDate}交易超出星期范围：${day}, %o`, trans);\n            continue;\n        }\n\n        let days = [0, day];\n        // console.log(`%o`, days);\n        // console.log(\n        //     `%o, ${buy.tradeDate}, ${date}, ${day}, %o %o`,\n        //     trans,\n        //     days,\n        //     results\n        // );\n        for (let index of days) {\n            let res = results[index];\n            res.count++;\n            res.profit += trans.profit;\n            if (trans.profit >= 0) {\n                res.count_win++;\n                res.win += trans.profit;\n                if (res.max_win < trans.profit) res.max_win = trans.profit;\n            } else {\n                res.count_loss++;\n                res.loss += trans.profit;\n                if (res.max_loss > trans.profit) res.max_loss = trans.profit;\n            }\n            // console.log(`${index}, %o`, res);\n        }\n    }\n    for (let res of results) {\n        res.win_ratio = res.count_win / res.count;\n        res.win = res.win / res.count_win;\n        res.loss_ratio = res.count_loss / res.count;\n        res.loss = res.loss / res.count_loss;\n        res.ratio_winloss = res.win / res.loss;\n        res.average = res.profit / res.count;\n    }\n    return results;\n}\n\nfunction showWorkdayReports(log, transactions) {\n    let reports = parseWorkdayReports(transactions);\n    // console.log(\"%o\", reports);\n\n    //     let days = [\"总计\", \"周一\", \"周二\", \"周三\", \"周四\", \"周五\"];\n    //     log(`\n    // 工作日    交易次数    盈利比例    平均盈利    亏损比例    平均亏损    盈亏比    平均利润    最大亏损    利润`);\n    //     for (let report of reports) {\n    //         log(\n    //             `${report.day}       ${report.count}          ${(\n    //                 report.win_ratio * 100\n    //             ).toFixed(1)}%    ${report.win.toFixed(2)}    ${(\n    //                 report.loss_ratio * 100\n    //             ).toFixed(1)}%    ${report.loss.toFixed(\n    //                 2\n    //             )}    ${report.ratio_winloss.toFixed(\n    //                 2\n    //             )}    ${report.average.toFixed(2)}    ${report.max_loss.toFixed(\n    //                 2\n    //             )}    ${report.profit.toFixed(2)}`\n    //         );\n    //     }\n\n    // 采用console-grid打印格式\n    let grid = new CG();\n    let CGS = CG.Style;\n    let columns = [\n        { id: \"workday\", name: \"日期\", type: \"string\", align: \"left\" },\n        { id: \"count\", name: \"交易次数\", type: \"number\", align: \"right\" },\n        { id: \"win_ratio\", name: \"盈利比例\", type: \"number\", align: \"right\" },\n        { id: \"win_average\", name: \"平均盈利\", type: \"number\", align: \"right\" },\n        { id: \"loss_ratio\", name: \"亏损比例\", type: \"number\", align: \"right\" },\n        {\n            id: \"loss_average\",\n            name: \"平均亏损\",\n            type: \"number\",\n            align: \"right\",\n        },\n        { id: \"ratio_winloss\", name: \"盈亏比\", type: \"number\", align: \"right\" },\n        {\n            id: \"profit_average\",\n            name: \"平均利润\",\n            type: \"number\",\n            align: \"right\",\n        },\n        { id: \"max_loss\", name: \"最大亏损\", type: \"number\", align: \"right\" },\n        { id: \"profit\", name: \"利润\", type: \"number\", align: \"right\" },\n    ];\n    let rows = [];\n    for (let report of reports) {\n        rows.push({\n            workday:\n                report.win_ratio > 0.5 && report.profit >= 0\n                    ? CGS.red(report.day)\n                    : report.day,\n            count: report.count,\n            win_ratio:\n                report.win_ratio >= 0.5\n                    ? CGS.red(`${(report.win_ratio * 100).toFixed(1)}%`)\n                    : `${(report.win_ratio * 100).toFixed(1)}%`, //CGS.green\n            win_average: `${utils.formatFxstr(report.win)}`,\n            loss_ratio:\n                report.loss_ratio >= 0.5\n                    ? CGS.green(`${(report.loss_ratio * 100).toFixed(1)}%`)\n                    : `${(report.loss_ratio * 100).toFixed(1)}%`,\n            loss_average: `${utils.formatFxstr(report.loss)}`,\n            ratio_winloss:\n                report.ratio_winloss < -1\n                    ? CGS.cyan(`${(-report.ratio_winloss).toFixed(2)}`)\n                    : `${(-report.ratio_winloss).toFixed(2)}`,\n            profit_average:\n                report.average >= 0\n                    ? CGS.red(`${utils.formatFxstr(report.average)}`)\n                    : CGS.green(`${utils.formatFxstr(report.average)}`),\n            max_loss: `${utils.formatFxstr(report.max_loss)}`,\n            profit:\n                report.profit >= 0\n                    ? CGS.red(`${report.profit.toFixed(2)}`)\n                    : CGS.green(`${report.profit.toFixed(2)}`),\n        });\n    }\n    let data = {\n        option: {},\n        columns,\n        rows,\n    };\n    grid.render(data);\n\n    // 采用console-table-printer库打印格式\n    // const p = new Table({\n    //     columns: [\n    //         { name: \"workday\", alignment: \"center\" },\n    //         { name: \"count\", alignment: \"right\" },\n    //         { name: \"win ratio\", alignment: \"right\" },\n    //         { name: \"win/trade\", alignment: \"right\" },\n    //         { name: \"loss ratio\", alignment: \"right\" },\n    //         { name: \"loss/trade\", alignment: \"right\" },\n    //         { name: \"ratio win/loss\", alignment: \"right\" },\n    //         { name: \"profit/trade\", alignment: \"right\" },\n    //         { name: \"max loss\", alignment: \"right\" },\n    //         { name: \"profit\", alignment: \"right\" },\n    //     ],\n    // });\n    // for (let report of reports) {\n    //     p.addRow(\n    //         {\n    //             workday: report.day,\n    //             count: report.count,\n    //             \"win ratio\": `${(report.win_ratio * 100).toFixed(1)}%`,\n    //             \"win/trade\": `${report.win.toFixed(2)}`,\n    //             \"loss ratio\": `${(report.loss_ratio * 100).toFixed(1)}%`,\n    //             \"loss/trade\": `${report.loss.toFixed(2)}`,\n    //             \"ratio win/loss\": `${(-report.ratio_winloss).toFixed(2)}`,\n    //             \"profit/trade\": `${report.average.toFixed(2)}`,\n    //             \"max loss\": `${report.max_loss.toFixed(2)}`,\n    //             profit: `${report.profit.toFixed(2)}`,\n    //         },\n    //         { color: report.win_ratio > 0.5 ? \"red\" : \"green\" }\n    //     );\n    // }\n    // p.printTable();\n}\n\nexport { parseWorkdayReports, showWorkdayReports };\n\n//\n// {\n//     transeq: stock.transeq,\n//     tradeDate: translog.tradeDate,\n//     profit: stock.buy.total + translog.total,\n//     income: translog.count * translog.price - stock.count * stock.price,\n//     buy: stock.buy,\n//     sell: translog,\n// }\n// transaction\n// {\n//     date: tradeDate,\n//     dateIndex: tradeDateIndex,\n//     type: \"buy\",\n//     count: count,\n//     price,\n//     total: total.total,\n//     amount: total.amount,\n//     fee: total.fee,\n//     commission: total.commission,\n//     duty: total.duty,\n//     methodType,\n//     memo,\n// }\n","import {\n    readStockList,\n    readStockData,\n    stockDataNames,\n} from \"@wt/lib-wtda-query\";\n\nimport moment from \"moment\";\nimport _ from \"lodash\";\nimport debugpkg from \"debug\";\n\nimport utils from \"./utils\";\n// import { formatFxstr, calculatePrevAdjPrice } from \"./util\";\n\n// import stoploss from \"./stoploss\";\n// import mmb from \"./momentum-breakthrough\";\nimport engine from \"./transaction-engine\";\nimport trans from \"./transaction\";\nimport * as reports from \"./reports\";\n\nconst log = console.log;\nconst debug = debugpkg(\"sim\");\n\nfunction showOptionsInfo(options) {\n    let buys = \"\";\n    let usedRules = {};\n    for (let rule of options.rules.buy) {\n        buys += `${rule.name}, `;\n        if (!(rule.label in usedRules)) {\n            usedRules[rule.label] = rule;\n        }\n    }\n\n    let sells = \"\";\n    for (let rule of options.rules.sell) {\n        sells += `${rule.name}, `;\n        if (!(rule.label in usedRules)) {\n            usedRules[rule.label] = rule;\n        }\n    }\n\n    let rules_desc = \"\";\n    for (let label in usedRules) {\n        rules_desc += usedRules[label].showOptions(options);\n    }\n\n    console.log(\n        `初始资金:        ${utils.formatFxstr(options.initBalance)}元 \n测试交易资金模式:  ${options.fixCash ? \"固定头寸\" : \"累计账户\"}\n测试数据周期: ${options.startDate}\n\n规则：\n买入模型：${buys}\n卖出模型：${sells}\n\n${rules_desc}\n`\n    );\n}\n\nasync function simulate(options) {\n    // 显示目前的配置模拟信息\n    showOptionsInfo(options);\n\n    // 首先根据设置获得列表，列表内容为需要进行算法计算的各个股票\n    //  TODO: 这里先读取全部的列表\n    let stockListData = await readStockList();\n    if (!stockListData || !stockListData.data) {\n        log(`没有读取到股票列表，无法处理日线数据`);\n        return;\n    }\n    let stockList = stockListData.data;\n    // 重新过滤可用的\n    stockList = await filterStockList(stockList, options);\n    log(`算法执行 ${stockList && stockList.length} 条数据`);\n    // data存放股票列表的基本信息：\n    // {\n    //      ts_code: '000001.SZ', symbol: '000001', name: '平安银行',\n    //      market: '主板', exchange: 'SZSE',\n    //      area: '深圳', industry: '银行', fullname: '平安银行股份有限公司',\n    //      enname: 'Ping An Bank Co., Ltd.', curr_type: 'CNY',\n    //      list_status: 'L', list_date: '19910403', delist_date: null, is_hs: 'S'\n    // }\n    // this.log(`%o`, stockList[0]);\n    // 后续的执行为列表的循环计算，这里的算法因为主要是CPU计算类型，只有输入和输出部分有I/O运算，因此不考虑\n\n    log(\"\");\n    // 下一步开始按照给出的数据循环进行处理\n    for (let stockItem of stockList) {\n        // this.log(`处理数据：%o`, stockItem);\n\n        // 首先读取日线信息\n        let stockData = await readStockData(\n            stockDataNames.daily,\n            stockItem.ts_code\n        );\n        // 准备资金账户数据\n        let capitalData = {\n            info: stockItem,\n            balance: options.fixCash ? 0 : options.initBalance, // 初始资金\n            stocks: [], // 持有的股票信息，每次买入单独一笔记录，分别进行处理，结构{ count: 0, price: 0, buy: transaction }, // 持有股票信息\n            transactions: [], // 交易记录 {tradeDate: 完成日期, profit: 利润, income: 收入, buy: transaction, sell: transaction}\n            //transaction { date: , count: 交易数量, price: 交易价格, total: 总金额, amount: 总价, fee: 交易费用, memo: 备注信息 }\n            _transeq: 0, // 当前交易序号，获取后要自己增加，对应一次股票的买卖使用同一个序号\n        };\n        if (stockData) {\n            log(\n                `[${stockItem.ts_code}]${\n                    stockItem.name\n                } 【数据更新时间：${moment(stockData.updateTime).format(\n                    \"YYYY-MM-DD HH:mm\"\n                )}】`\n            );\n            // 日线数据条数 ${\n            //     stockData.data && stockData.data.length\n            // }, 从${stockData.startDate}到${\n            //     stockData.endDate\n            // }，\n\n            // log(\n            //     `*** 01: ${stockData.data[440].trade_date}, ${stockData.data[440].open}`\n            // );\n            // 首先过滤历史数据，这里将日线数据调整为正常日期从历史到现在\n            stockData = await filterStockData(stockData, options);\n            // log(\n            //     `*** 02: ${stockData.data[0].trade_date}, ${stockData.data[0].open}`\n            // );\n\n            // 全部数据调整为前复权后再执行计算\n            // calculatePrevAdjPrice(stockData);\n\n            // 开始按照日期执行交易算法\n            let startDate = moment(options.startDate, \"YYYYMMDD\");\n            let currentDate = null;\n            for (let index = 0; index < stockData.data.length; index++) {\n                let daily = stockData.data[index];\n                let tradeDate = moment(daily.trade_date, \"YYYYMMDD\");\n                if (_.isEmpty(currentDate)) {\n                    if (startDate.isAfter(tradeDate)) {\n                        continue;\n                    }\n                    debug(\n                        `找到开始日期，开始执行算法！${index}, ${daily.trade_date}`\n                    );\n                } else {\n                    debug(`执行算法！${index}, ${daily.trade_date}`);\n                }\n                currentDate = tradeDate;\n                // this.log(`%o`, engine);\n                // let trans =\n                await engine.executeTransaction(\n                    index,\n                    stockData.data,\n                    capitalData,\n                    options\n                );\n            }\n\n            trans.showCapitalReports(log, capitalData);\n            if (options.showTrans) {\n                trans.showTransactions(log, capitalData);\n            }\n            if (options.showWorkdays) {\n                reports.showWorkdayReports(log, capitalData.transactions);\n            }\n        } else {\n            log(\n                `[${stockItem.ts_code}]${stockItem.name} 没有日线数据，请检查！`\n            );\n        }\n    }\n}\n\n// /**\n//  * 将日线数据中的历史价位根据复权因子全部处理为前复权结果，方便后续计算\n//  *\n//  * @param {*} dailyData 日线数据\n//  * @param {int} digits 保留位数\n//  */\n// function calculatePrevAdjPrice(dailyData, digits = 2) {\n//     if (dailyData && dailyData.data && dailyData.data.length > 0) {\n//         dailyData.data.forEach((item) => {\n//             if (item.prevadj_factor) {\n//                 item.open = Number(\n//                     (item.open * item.prevadj_factor).toFixed(digits)\n//                 );\n//                 item.close = Number(\n//                     (item.close * item.prevadj_factor).toFixed(digits)\n//                 );\n//                 item.high = Number(\n//                     (item.high * item.prevadj_factor).toFixed(digits)\n//                 );\n//                 item.low = Number(\n//                     (item.low * item.prevadj_factor).toFixed(digits)\n//                 );\n//                 item.pre_close = Number(\n//                     (item.pre_close * item.prevadj_factor).toFixed(digits)\n//                 );\n//                 item.change = Number(\n//                     (item.change * item.prevadj_factor).toFixed(digits)\n//                 );\n//             }\n//         });\n//     }\n// }\n\n/**\n * 这里定义一个过滤列表的接口方法，利用options来过滤后续使用的股票\n * 返回为一个符合条件的列表\n * 这里后续考虑调整一下接口定义，目前暂时简化处理\n */\nasync function filterStockList(stockList, options) {\n    // let retStockList = [];\n    return options.selectedStocks.map((tsCode) => {\n        let tmp = stockList.filter((item) => {\n            return item.ts_code === tsCode;\n        });\n        // console.log(`${tmp && tmp.length}, %o`, tmp[0]);\n        return tmp[0];\n    });\n}\n\n/**\n * 这里提供对单个数据的调整，主要应当是一些额外的数据计算添加，周期过滤等\n *\n * @param {*} stockData 股票日线数据对象\n * @param {*} options 数据过滤条件\n */\nasync function filterStockData(stockData, options) {\n    utils.checkTradeData(stockData && stockData.data);\n\n    debug(\n        `过滤数据范围：${options && options.startDate}, ${\n            stockData && stockData.data && stockData.data.length\n        }`\n    );\n    if (\n        options &&\n        options.startDate &&\n        stockData &&\n        stockData.data &&\n        stockData.data.length > 0\n    ) {\n        if (stockData.data[0].trade_date < options.startDate) {\n            let index = stockData.data.findIndex((data, i) => {\n                return data.trade_date >= options.startDate;\n            });\n\n            if (index) {\n                stockData.data = stockData.data.slice(index);\n            } else {\n                stockData.data = [];\n            }\n        }\n    }\n    debug(\n        `过滤后数据长度：${\n            stockData && stockData.data && stockData.data.length\n        }`\n    );\n\n    // stockData.data.reverse();\n    return stockData;\n}\n\nexport default simulate;\n","import {\n    getDataRoot,\n    readStockList,\n    readStockData,\n    stockDataNames,\n} from \"@wt/lib-wtda-query\";\n\nimport moment from \"moment\";\nimport _ from \"lodash\";\nimport debugpkg from \"debug\";\n\nimport utils from \"./utils\";\n\n// import { calculatePrevAdjPrice } from \"./util\";\n\n// import engine from \"./transaction-engine\";\n// import trans from \"./transaction\";\n\nconst path = require(\"path\");\nconst fs = require(\"fs\");\nconst fp = fs.promises;\n\nconst log = console.log;\nconst debug = debugpkg(\"search\");\n\nfunction showOptionsInfo(options) {\n    let rules = options && options.match && options.match.rules;\n    console.log(`测试数据周期: ${options.startDate}`);\n    console.log(\n        `${options && options.includeSell ? \"包含卖出\" : \"不包含卖出\"}`\n    );\n\n    for (let rule of rules) {\n        console.log(`${rule.showOptions(options)}`);\n    }\n}\n\nasync function search(options) {\n    // 显示目前的配置模拟信息\n    showOptionsInfo(options);\n\n    // 首先根据设置获得列表，列表内容为需要进行算法计算的各个股票\n    let stockListData = await readStockList();\n    if (!stockListData || !stockListData.data) {\n        log(`没有读取到股票列表，无法处理日线数据`);\n        return;\n    }\n    let stockList = stockListData.data;\n    // 重新过滤可用的\n    stockList = await filterStockList(stockList, options);\n    log(`算法执行 ${stockList && stockList.length} 条数据`);\n\n    log(\"\");\n\n    let allSignals = {};\n    // let foundSignals = {};\n    // 下一步开始按照给出的数据循环进行处理\n    for (let stockItem of stockList) {\n        // this.log(`处理数据：%o`, stockItem);\n        if (stockItem.name.match(\"ST\")) {\n            continue;\n        }\n\n        // 首先读取日线信息\n        let stockData = await readStockData(\n            stockDataNames.daily,\n            stockItem.ts_code\n        );\n\n        if (stockData) {\n            debug(\n                `[${stockItem.ts_code}]${\n                    stockItem.name\n                } 【数据更新时间：${moment(stockData.updateTime).format(\n                    \"YYYY-MM-DD HH:mm\"\n                )}】`\n            );\n\n            // 首先过滤历史数据，这里将日线数据调整为正常日期从历史到现在\n            stockData = await prepareStockData(stockData, options);\n\n            debug(`执行算法！${stockData.data.length - 1}`);\n\n            let rules = options && options.match && options.match.rules;\n            for (let rule of rules) {\n                let matched = rule.check(\n                    stockData.data.length - 1,\n                    stockData.data,\n                    options,\n                    stockItem.ts_code\n                );\n                // log(`ret: %o`, matched);\n                if (matched && matched.hasSignals) {\n                    let foundSignals = allSignals[rule.label];\n                    if (!foundSignals) {\n                        allSignals[rule.label] = {};\n                        foundSignals = allSignals[rule.label];\n                    }\n\n                    if (\n                        options &&\n                        !options.includeSell &&\n                        matched.tradeType === \"sell\"\n                    ) {\n                        continue;\n                    }\n                    log(\n                        `**  [${stockItem.ts_code}]${stockItem.name} 信号:${matched.tradeType} ${matched.memo}`\n                    );\n                    let signal = matched.signal;\n                    if (signal) {\n                        if (signal in foundSignals) {\n                            foundSignals[signal].push(matched);\n                        } else {\n                            foundSignals[signal] = [matched];\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    //let report = options && options.match && options.match.report;\n    let rules = options && options.match && options.match.rules;\n    let reports = {\n        updateTime: moment().toISOString(),\n        reports: [],\n    };\n\n    // 如果存在多个规则，符合多个规则的信号单独提取并显示\n    let dupList = {};\n    let needDupList = rules && rules.length > 1;\n    for (let rule of rules) {\n        let ruleData = await rule.createReports(\n            allSignals[rule.label],\n            options\n        );\n        if (ruleData && ruleData.length > 0) {\n            reports.reports.push({ label: rule.label, data: ruleData });\n\n            if (needDupList) {\n                // TODO:\n                for (let stateList of ruleData) {\n                    // let stateList = ruleData[state];\n                    // console.log(`stateList ${stateList.label}`);\n                    if (stateList && stateList.data.length > 0) {\n                        for (let codeList of stateList.data) {\n                            // console.log(`codeList ${codeList.label}`);\n                            if (codeList && codeList.data.length > 0) {\n                                for (let code of codeList.data) {\n                                    if (dupList[code]) {\n                                        dupList[code] = dupList[code] + 1;\n                                    } else {\n                                        dupList[code] = 1;\n                                    }\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n\n        // let ruleData = reports[rule.label];\n    }\n\n    if (needDupList) {\n        let dupReports = { label: \"多重信号\", data: [] };\n        for (let i = rules.length; i > 1; i--) {\n            let tmp = { label: \"重叠\" + i, data: [] };\n            for (let code in dupList) {\n                if (dupList[code] && dupList[code] === i) {\n                    tmp.data.push(code);\n                }\n            }\n            if (tmp.data.length > 0) {\n                dupReports.data.push(tmp);\n            }\n        }\n        if (dupReports.data.length > 0) {\n            log(`有发现重叠的重要报告！`);\n            reports.reports.unshift({ label: \"重要\", data: [dupReports] });\n        }\n    }\n\n    // let reports = await report.createReports(foundSignals, options);\n    await saveReports(reports);\n\n    log(` *** 报告存储完毕！ ***`);\n    // for (let item in foundSignals) {\n    //     let list = foundSignals[item];\n    //     log(`*** 信号类型：${item}，共发现${list && list.length} ***`);\n    //     // for (let code of list) {\n    //     //     log(`  \"${code}\",`);\n    //     // }\n    // }\n\n    // let buyList = reports && reports.squeeze && reports.squeeze.buyList;\n    // let readyList = reports && reports.squeeze && reports.squeeze.readyList;\n    // let boundaries = [\"1天\", \"2天\", \"3天\", \"5~8天\", \"8~13天\", \"超13天\"];\n    // for (let i = 0; i < boundaries.length; i++) {\n    //     log(\n    //         `** 买入信号【${boundaries[i]}】： ${buyList && buyList[i].length}`\n    //     );\n    // }\n    // for (let i = 0; i < boundaries.length; i++) {\n    //     log(\n    //         `** 准备信号【${boundaries[i]}】： ${\n    //             readyList && readyList[i].length\n    //         }`\n    //     );\n    // }\n}\n\nfunction getReportsFile() {\n    return path.join(getDataRoot(), \"reports.json\");\n}\n\nasync function saveReports(data) {\n    try {\n        let jsonStr = JSON.stringify(data);\n        let filePath = getReportsFile();\n\n        await fp.writeFile(filePath, jsonStr, { encoding: \"utf-8\" });\n    } catch (error) {\n        throw new Error(\"保存报告数据时出现错误，请检查后重新执行：\" + error);\n    }\n}\n\nasync function readReports() {\n    let retData = {\n        updateTime: null,\n    };\n\n    try {\n        let dataFile = getReportsFile();\n        try {\n            retData = JSON.parse(await fp.readFile(dataFile, \"utf-8\"));\n        } catch (error) {\n            // 文件不存在，不考虑其它错误\n            if (!(error && error.code === \"ENOENT\")) {\n                console.error(\n                    `读取报告文件${dataFile}时发生错误：${error}, %o`,\n                    error\n                );\n            } else {\n                console.error(`读取报告文件${dataFile}不存在，%o`, error);\n            }\n        }\n    } catch (error) {\n        console.error(`从本地读取报告数据发生错误 ${error}`);\n    }\n    return retData;\n}\n\n/**\n * 这里定义一个过滤列表的接口方法，利用options来过滤后续使用的股票\n * 返回为一个符合条件的列表\n * 这里后续考虑调整一下接口定义，目前暂时简化处理\n */\nasync function filterStockList(stockList, options) {\n    if (options.all) return stockList;\n    // let retStockList = [];\n    return options.selectedStocks.map((tsCode) => {\n        let tmp = stockList.filter((item) => {\n            return item.ts_code === tsCode;\n        });\n        // console.log(`${tmp && tmp.length}, %o`, tmp[0]);\n        return tmp[0];\n    });\n}\n\n/**\n * 这里提供对单个数据的调整，主要应当是一些额外的数据计算添加，周期过滤等\n *\n * @param {*} stockData 股票日线数据对象\n * @param {*} options 数据过滤条件\n */\nasync function prepareStockData(stockData, options) {\n    utils.checkTradeData(stockData && stockData.data);\n\n    if (stockData && stockData.data && stockData.data.length > 0) {\n        if (stockData.data[0].trade_date < options.startDate) {\n            let index = stockData.data.findIndex((data, i) => {\n                return data.trade_date >= options.startDate;\n            });\n\n            if (index) {\n                stockData.data = stockData.data.slice(index);\n            } else {\n                stockData.data = [];\n            }\n        }\n    }\n    // stockData.data.reverse();\n    return stockData;\n}\n\nexport default { search, readReports };\n","import _ from \"lodash\";\nimport engine from \"../transaction-engine\";\nimport trans from \"../transaction\";\n\nimport debugpkg from \"debug\";\nconst debug = debugpkg(\"rules:benchmark\");\n\n/**\n * 基准参数，用于测量正常买入卖出情况下的基准效果\n * 采用的买入策略为开盘买入，第二天收盘卖出；或者止损平仓\n */\nconst RULE_NAME = \"benchmark\";\n\n/**\n * 检查买入条件\n * @param {*} stockInfo 股票信息\n * @param {double} balance 账户余额\n * @param {int} index 交易日数据索引位置\n * @param {*} stockData 数据\n * @param {*} options 算法参数\n */\nfunction checkBuyTransaction(stockInfo, balance, index, stockData, options) {\n    if (balance <= 0) return;\n    // debug(`买入检查: ${balance}, ${tradeDate}, %o, ${index}`, stockData);\n\n    // let bmOptions = options && options[RULE_NAME];\n    let currentData = stockData[index];\n    // console.log(`跟踪信息： ${stockData.length}, ${index}`, currentData);\n    let targetPrice = currentData.open;\n    let tradeDate = stockData[index].trade_date;\n\n    debug(\n        `基准买入：[${tradeDate} price=${targetPrice} open=${currentData.open} close=${currentData.close}]`\n    );\n    return trans.createBuyTransaction(\n        stockInfo,\n        tradeDate,\n        index,\n        balance,\n        targetPrice,\n        RULE_NAME,\n        `基准买入 ${targetPrice.toFixed(2)}`\n    );\n}\n\n/**\n * 检查是否可以生成卖出交易，如果可以卖出，产生卖出交易记录\n *\n * @param {*} info 股票信息\n * @param {*} stock 持仓信息\n * @param {*} index 今日数据索引位置\n * @param {*} stockData 日线数据\n * @param {*} options 算法参数\n */\nfunction checkSellTransaction(stockInfo, stock, index, stockData, options) {\n    if (_.isEmpty(stock) || stock.count <= 0) return;\n\n    let currentData = stockData[index];\n    let tradeDate = currentData.trade_date;\n    let bmoptions = options && options[RULE_NAME];\n    let priceType = bmoptions.sellPrice;\n\n    if (priceType === \"open\") {\n        debug(\n            `基准卖出：[${tradeDate} price=${currentData.open} open=${currentData.open} close=${currentData.close}]`\n        );\n        return trans.createSellTransaction(\n            stockInfo,\n            tradeDate,\n            index,\n            stock.count,\n            currentData.open,\n            priceType,\n            `开盘卖出 ${currentData.open})`\n        );\n    } else if (priceType === \"close\") {\n        debug(\n            `基准卖出：[${tradeDate} price=${currentData.close} open=${currentData.open} close=${currentData.close}]`\n        );\n        return trans.createSellTransaction(\n            stockInfo,\n            tradeDate,\n            index,\n            stock.count,\n            currentData.open,\n            priceType,\n            `收盘卖出 ${currentData.close}`\n        );\n    }\n}\n\n/**\n * 返回参数配置的显示信息\n * @param {*}} opions 参数配置\n */\nfunction showOptions(options) {\n    return `\n模型 ${benchmark.name}[${benchmark.label}] 参数：\n卖出类型: ${options.benchmark.sellPrice}\n`;\n}\n\nlet benchmark = {\n    name: \"基准\",\n    label: RULE_NAME,\n    description: \"基准测试\",\n    methodTypes: {\n        open: \"开盘卖出\",\n        close: \"收盘卖出\",\n    },\n    checkBuyTransaction,\n    checkSellTransaction,\n    showOptions,\n};\n\nexport default benchmark;\n","import _ from \"lodash\";\nimport engine from \"../transaction-engine\";\nimport trans from \"../transaction\";\n\nimport debugpkg from \"debug\";\nconst debug = debugpkg(\"rules:mmb\");\n\nconst OPTIONS_NAME = \"mmb\";\n\n/**\n * 检查买入条件\n * @param {*} stockInfo 股票信息\n * @param {double} balance 账户余额\n * @param {*} tradeDate 交易日期\n * @param {int} index 交易日数据索引位置\n * @param {*} stockData 数据\n * @param {*} options 算法参数\n */\nfunction checkMMBBuyTransaction(stockInfo, balance, index, stockData, options) {\n    if (balance <= 0) return;\n    // debug(`买入检查: ${balance}, ${tradeDate}, %o, ${index}`, stockData);\n\n    let mmboptions = options && options[OPTIONS_NAME];\n    // 平均波幅的计算日数\n    let N = mmboptions.N;\n    // 波幅突破的百分比\n    let P = mmboptions.P;\n\n    let moment = 0;\n    for (let i = 0; i < N; i++) {\n        if (index - i - 1 >= 0) {\n            let tmp = stockData[index - i - 1];\n            if (mmboptions.mmbType === \"hl\") {\n                moment += tmp.high - tmp.low;\n            } else {\n                moment += tmp.high - tmp.close;\n            }\n        }\n    }\n    moment = moment / N;\n\n    let currentData = stockData[index];\n    // console.log(`跟踪信息： ${stockData.length}, ${index}`, currentData);\n    let targetPrice = currentData.open + moment * P;\n    let tradeDate = stockData[index].trade_date;\n\n    debug(\n        `买入条件检查${tradeDate}: ${targetPrice.toFixed(2)}=${\n            currentData.open\n        }+${moment.toFixed(2)}*${P} [o: ${currentData.open}, h: ${\n            currentData.high\n        }, l: ${currentData.low}, c: ${currentData.close}, d: ${\n            currentData.trade_date\n        }]`\n    );\n    if (currentData.high >= targetPrice && currentData.open <= targetPrice) {\n        // 执行买入交易\n        debug(`符合条件：${tradeDate}`);\n        return trans.createBuyTransaction(\n            stockInfo,\n            tradeDate,\n            index,\n            balance,\n            targetPrice,\n            \"mmb\",\n            `动能突破买入 ${targetPrice.toFixed(2)} (=${\n                currentData.open\n            }+${moment.toFixed(2)}*${(P * 100).toFixed(2)}%)`\n        );\n    }\n}\n\n/**\n * 检查是否可以生成卖出交易，如果可以卖出，产生卖出交易记录\n *\n * @param {*} info 股票信息\n * @param {*} stock 持仓信息\n * @param {*} index 今日数据索引位置\n * @param {*} stockData 日线数据\n * @param {*} options 算法参数\n */\nfunction checkMMBSellTransaction(stockInfo, stock, index, stockData, options) {\n    if (_.isEmpty(stock) || stock.count <= 0) return;\n\n    // 检查是否符合动能突破买入条件\n    // if (\n    //     !options.nommbsell &&\n    //     !_.isEmpty(\n    //         checkMMBBuyTransaction(\n    //             stockInfo,\n    //             options.initBalance,\n    //             index,\n    //             stockData,\n    //             options\n    //         )\n    //     )\n    // ) {\n    //     // 可以买入，那么当日保持\n    //     return;\n    // }\n\n    let currentData = stockData[index];\n    let tradeDate = currentData.trade_date;\n    let mmboptions = options && options[OPTIONS_NAME];\n\n    // 目前有持仓，检查是否达到盈利卖出条件\n    if (!mmboptions.nommb1 && currentData.open > stock.price) {\n        // 采用第二天开盘价盈利就卖出的策略\n        debug(\n            `开盘盈利策略符合：${currentData.open.toFixed(\n                2\n            )} (> ${stock.price.toFixed(2)})`\n        );\n        return engine.createSellTransaction(\n            stockInfo,\n            tradeDate,\n            index,\n            stock.count,\n            currentData.open,\n            \"mmb1\",\n            `开盘盈利卖出 ${currentData.open} (> ${stock.price.toFixed(2)})`\n        );\n    }\n\n    if (!mmboptions.nommb2) {\n        // 平均波幅的计算日数\n        let N = mmboptions.N;\n        // 止损使用的波幅下降百分比\n        let L = mmboptions.L;\n        // 有持仓，检查是否达到卖出条件\n        // 第一个卖出条件是买入后按照买入价格及波动数据的反向百分比设置\n        let moment = 0;\n        for (let i = 0; i < N; i++) {\n            if (index - i - 1 >= 0) {\n                let tmp = stockData[index - i - 1];\n                if (mmboptions.mmbType === \"hl\") {\n                    moment += tmp.high - tmp.low;\n                } else {\n                    moment += tmp.high - tmp.close;\n                }\n            }\n        }\n        moment = moment / N;\n\n        let targetPrice = currentData.open - moment * L;\n        if (targetPrice <= currentData.open && targetPrice >= currentData.low) {\n            // 执行波动卖出\n            return trans.createSellTransaction(\n                stockInfo,\n                tradeDate,\n                index,\n                stock.count,\n                targetPrice,\n                \"mmb2\",\n                `动能突破卖出：${targetPrice.toFixed(2)} (= ${\n                    currentData.open\n                }-${moment.toFixed(2)}*${L * 100}%)`\n            );\n        }\n    }\n}\n\n/**\n * 返回参数配置的显示信息\n * @param {*}} opions 参数配置\n */\nfunction showOptions(options) {\n    return `\n模型 ${mmb.name}[${mmb.label}] 参数：\n波幅类型 [${options.mmb.mmbType === \"hc\" ? \"最高-收盘\" : \"最高-最低\"}]\n动能平均天数: ${options.mmb.N}\n动能突破买入比例: ${options.mmb.P * 100}%\n动能突破卖出比例: ${options.mmb.L * 100}%\n规则：\n  1. [${options.mmb.nommb1 ? \"🚫\" : \"✅\"}] 开盘盈利锁定\n  2. [${options.mmb.nommb2 ? \"🚫\" : \"✅\"}] 动能向下突破卖出\n`;\n}\n\nlet mmb = {\n    name: \"MMB(动能穿透)\",\n    label: \"mmb\",\n    description: \"动能穿透\",\n    methodTypes: {\n        mmb: \"动能突破买入\",\n        mmb1: \"开盘盈利卖出\",\n        mmb2: \"动能突破卖出\",\n    },\n    checkBuyTransaction: checkMMBBuyTransaction,\n    checkSellTransaction: checkMMBSellTransaction,\n    showOptions,\n};\n\nexport default mmb;\n","// const _ = require(\"lodash\");\nimport _ from \"lodash\";\n// const engine = require(\"./transaction-engine\");\nimport engine from \"../transaction-engine\";\nimport trans from \"../transaction\";\nimport debugpkg from \"debug\";\nconst debug = debugpkg(\"rules:stoploss\");\n\nconst OPTIONS_NAME = \"stoploss\";\n\n/**\n * 检查是否需要执行止损\n * @param {*} stocks 持仓信息\n * @param {int} index 交易日索引位置\n * @param {*} stockData 日线数据\n */\nfunction checkStoplossTransaction(stockInfo, stock, index, stockData, options) {\n    if (_.isEmpty(stock) || stock.count <= 0) return;\n\n    let currentData = stockData[index];\n    // 止损最大损失比例\n    let S = options && options[OPTIONS_NAME].S;\n\n    // 这里检查纯粹的百分比止损\n    let tradeDate = currentData.trade_date;\n    let lossPrice = stock.price * (1 - S);\n    debug(\n        `止损检查${tradeDate}: ${currentData.low}] <= ${lossPrice.toFixed(\n            2\n        )} (=${stock.price.toFixed(2)}*(1-${(S * 100).toFixed(2)}%))`\n    );\n    if (currentData.low <= lossPrice) {\n        // 当日价格范围达到止损值\n        return trans.createSellTransaction(\n            stockInfo,\n            tradeDate,\n            index,\n            stock.count,\n            lossPrice,\n            \"stoploss\",\n            `止损 ${lossPrice.toFixed(2)} (=${stock.price.toFixed(2)}*(1-${\n                S * 100\n            }%))`\n        );\n    }\n}\n\n/**\n * 返回参数配置的显示信息\n * @param {*}} opions 参数配置\n */\nfunction showOptions(options) {\n    return `\n模型 ${stoploss.name}[${stoploss.label}] 参数：\n止损比例: ${options.stoploss.S * 100}%\n`;\n}\n\nlet stoploss = {\n    name: \"止损\",\n    label: \"stoploss\",\n    description: \"止损\",\n    methodTypes: {\n        stoploss: \"止损卖出\",\n    },\n    checkSellTransaction: checkStoplossTransaction,\n    showOptions,\n};\n\nexport default stoploss;\n","import _ from \"lodash\";\nimport engine from \"../transaction-engine\";\nimport trans from \"../transaction\";\n\nimport debugpkg from \"debug\";\nconst debug = debugpkg(\"outsideday\");\n\n/**\n * 外包日模式，主要针对买入定义\n */\nconst RULE_NAME = \"outsideday\";\n\n/**\n * 检查外包日买入条件\n * 1. 前一天为外包日结构，T-1， T-2两天的价格要求满足，T-1价格范围外包T-2，并且T-1收盘价低于T-2最低价\n * 2. 今日T日的开盘价低于T-1外包日收盘价以下\n *\n * 买入价格定为T-1日收盘价\n *\n * @param {*} stockInfo 股票信息\n * @param {double} balance 账户余额\n * @param {int} index 交易日数据索引位置\n * @param {*} stockData 数据\n * @param {*} options 算法参数\n */\nfunction checkBuyTransaction(stockInfo, balance, index, stockData, options) {\n    if (balance <= 0) return;\n    if (index < 2) return;\n    // debug(`外包日买入检查: ${balance}, ${tradeDate}, %o, ${index}`, stockData);\n\n    // let bmOptions = options && options[RULE_NAME];\n    let data2 = stockData[index - 2];\n    let data1 = stockData[index - 1];\n    let currentData = stockData[index];\n\n    // 外包日条件\n    if (data1.high < data2.high || data1.low > data2.low) return;\n    // 外包日收盘低于前一日最低\n    if (data1.close > data2.low) return;\n    // 今日开盘低于外包日收盘\n    if (currentData.open >= data1.close) return;\n\n    // console.log(`跟踪信息： ${stockData.length}, ${index}`, currentData);\n    let targetPrice = currentData.close; // data1.close;\n    let tradeDate = currentData.trade_date;\n\n    debug(`找到外包日模式：\n    [${tradeDate} open=${currentData.open}, close=${currentData.close}] \n    [${data1.trade_date}: high=${data1.high}, low=${data1.low}, close=${data1.close}]\n    [${data2.trade_date}: high=${data1.high}, low=${data1.low}]\n    `);\n    return trans.createBuyTransaction(\n        stockInfo,\n        tradeDate,\n        index,\n        balance,\n        targetPrice,\n        RULE_NAME,\n        `外包日买入 ${targetPrice.toFixed(2)}`\n    );\n}\n\n// /**\n//  * 检查是否可以生成卖出交易，如果可以卖出，产生卖出交易记录\n//  *\n//  * @param {*} info 股票信息\n//  * @param {*} stock 持仓信息\n//  * @param {*} index 今日数据索引位置\n//  * @param {*} stockData 日线数据\n//  * @param {*} options 算法参数\n//  */\n// function checkSellTransaction(stockInfo, stock, index, stockData, options) {\n//     if (_.isEmpty(stock) || stock.count <= 0) return;\n\n//     let currentData = stockData[index];\n//     let tradeDate = currentData.trade_date;\n//     let bmoptions = options && options[RULE_NAME];\n//     let priceType = bmoptions.sellPrice;\n\n//     if (priceType === \"open\") {\n//         return engine.createSellTransaction(\n//             stockInfo,\n//             tradeDate,\n//             index,\n//             stock.count,\n//             currentData.open,\n//             priceType,\n//             `开盘卖出 ${currentData.open})`\n//         );\n//     } else if (priceType === \"close\") {\n//         return engine.createSellTransaction(\n//             stockInfo,\n//             tradeDate,\n//             index,\n//             stock.count,\n//             currentData.open,\n//             priceType,\n//             `收盘卖出 ${currentData.close}`\n//         );\n//     }\n// }\n\n/**\n * 返回参数配置的显示信息\n * @param {*}} opions 参数配置\n */\nfunction showOptions(options) {\n    return `\n`;\n}\n\nlet outsideday = {\n    name: \"外包日\",\n    label: RULE_NAME,\n    description: \"外包日买入\",\n    methodTypes: {},\n    checkBuyTransaction,\n    // checkSellTransaction,\n    showOptions,\n};\n\nexport default outsideday;\n","import _ from \"lodash\";\nimport engine from \"../transaction-engine\";\nimport trans from \"../transaction\";\n\nimport debugpkg from \"debug\";\nconst debug = debugpkg(\"opensell\");\n\nconst OPTIONS_NAME = \"opensell\";\n\n/**\n * 开盘盈利卖出\n *\n * @param {*} info 股票信息\n * @param {*} stock 持仓信息\n * @param {*} index 今日数据索引位置\n * @param {*} stockData 日线数据\n * @param {*} options 算法参数\n */\nfunction checkSellTransaction(stockInfo, stock, index, stockData, options) {\n    if (_.isEmpty(stock) || stock.count <= 0) return;\n\n    let currentData = stockData[index];\n    let tradeDate = currentData.trade_date;\n\n    // 目前有持仓，检查是否达到开盘盈利卖出条件\n    if (currentData.open > stock.price) {\n        debug(\n            `开盘盈利策略符合：${currentData.open.toFixed(\n                2\n            )} (> ${stock.price.toFixed(2)})`\n        );\n        return trans.createSellTransaction(\n            stockInfo,\n            tradeDate,\n            index,\n            stock.count,\n            currentData.open,\n            OPTIONS_NAME,\n            `开盘盈利卖出 ${currentData.open} (> ${stock.price.toFixed(2)})`\n        );\n    }\n}\n\n/**\n * 返回参数配置的显示信息\n * @param {*}} opions 参数配置\n */\nfunction showOptions(options) {\n    return `\n`;\n}\n\nlet opensell = {\n    name: \"开盘盈利\",\n    label: OPTIONS_NAME,\n    description: \"开盘盈利卖出\",\n    methodTypes: {},\n    // checkBuyTransaction: checkMMBBuyTransaction,\n    checkSellTransaction,\n    showOptions,\n};\n\nexport default opensell;\n","import _ from \"lodash\";\nimport engine from \"../transaction-engine\";\nimport trans from \"../transaction\";\nimport debugpkg from \"debug\";\nconst debug = debugpkg(\"smashday\");\n\n/**\n * 攻击日模式\n */\nconst RULE_NAME = \"smashday\";\n\n/**\n * 检查指定序号的日期数据是否符合当前模型定义形态\n *\n * @param {int} index 日期序号\n * @param {*} stockData 数据\n * @param {*} options 参数配置\n */\nfunction check(index, stockData, options) {\n    if (index < 1) return;\n    let type = options && options.smashday.type;\n    let currentData = stockData[index];\n    let data1 = stockData[index - 1];\n    let tradeDate = currentData.trade_date;\n\n    if (type === \"smash1\" && currentData.close < data1.low) {\n        return {\n            dataIndex: index,\n            date: tradeDate,\n            tradeType: \"buy\",\n            type: \"smash1\",\n            targetPrice: currentData.high,\n            memo: `突出收盘买入 [${tradeDate} ${currentData.close} < ${data1.low}，小于前一日最低]，在达到今日最大为反转可买入 ${currentData.high}`,\n        };\n    } else if (type === \"smash1\" && currentData.close > data1.high) {\n        return {\n            dataIndex: index,\n            date: tradeDate,\n            tradeType: \"sell\",\n            type: \"smash1\",\n            targetPrice: currentData.low,\n            memo: `突出收盘卖出 [${tradeDate} ${currentData.close} > ${data1.high}，大于前一日最高]，在达到今日最低为反转可卖出 ${currentData.low}`,\n        };\n    } else if (\n        type === \"smash2\" &&\n        currentData.close > data1.close &&\n        (currentData.close - currentData.low) /\n            (currentData.high - currentData.low) <\n            0.25\n    ) {\n        return {\n            dataIndex: index,\n            date: tradeDate,\n            tradeType: \"buy\",\n            type: \"smash2\",\n            targetPrice: currentData.high,\n            memo: `隐藏攻击买入 [${tradeDate} ${currentData.close} > ${data1.close}，收盘上涨，且在今日价格下方25% (${currentData.high}, ${currentData.low})]，在达到今日最高可买入 ${currentData.high}`,\n        };\n    } else if (\n        type === \"smash2\" &&\n        currentData.close < data1.close &&\n        (currentData.close - currentData.low) /\n            (currentData.high - currentData.low) >\n            0.75\n    ) {\n        return {\n            dataIndex: index,\n            date: tradeDate,\n            tradeType: \"sell\",\n            type: \"smash2\",\n            targetPrice: currentData.low,\n            memo: `隐藏攻击卖出 [${tradeDate} ${currentData.close} < ${data1.close}，收盘下跌，且在今日价格上方25% (${currentData.high}, ${currentData.low})]，在达到今日最低可卖出 ${currentData.low}`,\n        };\n    }\n}\n\n/**\n * 检查买入条件\n * @param {*} stockInfo 股票信息\n * @param {double} balance 账户余额\n * @param {int} index 交易日数据索引位置\n * @param {*} stockData 数据\n * @param {*} options 算法参数\n */\nfunction checkBuyTransaction(stockInfo, balance, index, stockData, options) {\n    if (balance <= 0) return;\n    // debug(`买入检查: ${balance}, ${tradeDate}, %o, ${index}`, stockData);\n\n    let buy = options.smashday && options.smashday.buy;\n    let validDays = buy.validDays || 3;\n    for (let i = 0; i < validDays; i++) {\n        let matched = check(index - i, stockData, options);\n        let smashType = buy.type || \"smash1\";\n        let currentData = stockData[index];\n        let tradeDate = currentData.trade_date;\n        let targetPrice = matched.targetPrice;\n        if (matched && matched.trade_date === \"buy\") {\n            if (\n                matched.type === smashType &&\n                currentData.high >= matched.targetPrice\n            ) {\n                debug(\n                    `攻击日为[${matched.date}]，今日满足目标价位：${matched.targetPrice} [${currentData.low}, ${currentData.high}]`\n                );\n                return trans.createBuyTransaction(\n                    stockInfo,\n                    tradeDate,\n                    index,\n                    balance,\n                    targetPrice,\n                    RULE_NAME,\n                    `攻击日[${matched.type}]买入${targetPrice.toFixed(2)}`\n                );\n            }\n        }\n    }\n}\n\n/**\n * 检查是否可以生成卖出交易，如果可以卖出，产生卖出交易记录\n *\n * @param {*} info 股票信息\n * @param {*} stock 持仓信息\n * @param {*} index 今日数据索引位置\n * @param {*} stockData 日线数据\n * @param {*} options 算法参数\n */\nfunction checkSellTransaction(stockInfo, stock, index, stockData, options) {\n    if (_.isEmpty(stock) || stock.count <= 0) return;\n\n    let sell = options.smashday && options.smashday.sell;\n    let validDays = sell.validDays || 3;\n    for (let i = 0; i < validDays; i++) {\n        let matched = check(index - i, stockData, options);\n        let smashType = sell.type || \"smash1\";\n        let currentData = stockData[index];\n        let tradeDate = currentData.trade_date;\n        let targetPrice = matched.targetPrice;\n        if (matched && matched.trade_date === \"sell\") {\n            if (matched.type === smashType && currentData.low <= targetPrice) {\n                debug(\n                    `攻击日为[${matched.date}]，今日满足目标价位：${targetPrice} [${currentData.low}, ${currentData.high}]`\n                );\n                return trans.createSellTransaction(\n                    stockInfo,\n                    tradeDate,\n                    index,\n                    stock.count,\n                    targetPrice,\n                    RULE_NAME,\n                    `攻击日[${matched.type}]卖出${targetPrice.toFixed(2)}`\n                );\n            }\n        }\n    }\n}\n\n/**\n * 返回参数配置的显示信息\n * @param {*}} opions 参数配置\n */\nfunction showOptions(options) {\n    let buy = options && options.smashday && options.smashday.buy;\n    let sell = options && options.smashday && options.smashday.sell;\n    return `\n模型 ${smashday.name}[${smashday.label}] 参数：\n买入有效期: ${buy.validDays}\n买入类型: ${buy.type}, ${smashday.methodTypes[buy.type]}\n\n卖出有效期: ${sell.validDays}\n卖出类型: ${sell.type}, ${smashday.methodTypes[sell.type]}\n`;\n}\n\nlet smashday = {\n    name: \"攻击日\",\n    label: RULE_NAME,\n    description: \"攻击日模型\",\n    methodTypes: {\n        smash1: \"突出收盘价\",\n        smash2: \"隐藏攻击日\",\n    },\n    checkBuyTransaction,\n    checkSellTransaction,\n    check,\n    showOptions,\n};\n\nexport default smashday;\n","/**\n * 平均价\n *\n * 参数\n *  type：ma，算术平均； ema，指数移动平均\n *  source: close | ohlc\n */\nimport _ from \"lodash\";\nimport utils from \"../utils\";\n\n/**\n * 计算移动平均，返回ma数据\n * @param {*} tradeData 所有数据\n * @param {*} options 参数，n 平均周期, type 平均类型, digits 保留小数位数\n */\nfunction ma(tradeData, options) {\n    utils.checkTradeData(tradeData);\n\n    return utils.ma(\n        tradeData,\n        options && options.n,\n        (options && options.source) === \"ohlc\" ? utils.ohlc : \"close\",\n        options && options.type,\n        options && options.digits\n    );\n}\n\nexport default {\n    name: \"均值\",\n    label: \"MA\",\n    description: \"平均收盘价\",\n    calculate: ma,\n};\n","/**\n * ATR 指标，平均真实幅度\n *\n * 参数\n *  n: 表示平均天数\n *  type：表示均值类型，ma 算术平均，ema 指数移动平均\n *\n * TR = max[h-l, abs(h-cp), abs(l-cp)]\n * cp 表示昨日收盘\n *\n * ATR = Sum(TR, n)/n, 表示n天TR的算术平均\n */\n\nimport _ from \"lodash\";\nimport utils from \"../utils\";\n\n/**\n * 计算ATR指标\n * @param {Array} tradeData 数据数组\n * @param {*} options 参数配置，ATR包含n属性\n */\nfunction atr(tradeData, options) {\n    utils.checkTradeData(tradeData);\n\n    return utils.ma(\n        tradeData,\n        options.n,\n        utils.tr,\n        options && options.type,\n        options && options.digits\n    );\n}\n\nexport default {\n    name: \"ATR\",\n    label: \"平均真实波幅\",\n    description: \"表示在一定周期内价格的最大波动偏离幅度\",\n    calculate: atr,\n};\n","/**\n * Keltner Channel，肯特钠通道\n * 类似于布林带的带状指标，由上中下三条轨道组成\n *\n * 中轨：移动平均线，参数n\n * 上/下轨：移动平均线上下ATR*m距离\n *\n * 参数定义：\n *  n：移动平均天数，默认12，（Squeeze 为20）\n *  m：通道和中轨之间ATR值的倍数，默认1.5\n *  type1：价格移动平均类型，ma 简单移动平均，ema 指数移动平均，默认ema\n *  type2：atr移动平均类型，ma ｜ ema，默认 ma\n *  source: close | ohlc\n */\nimport _ from \"lodash\";\nimport MA from \"./ma\";\nimport ATR from \"./atr\";\nimport utils from \"../utils\";\n\nfunction keltner(tradeData, options) {\n    if (!tradeData || tradeData.length < 0) return;\n    utils.checkTradeData(tradeData);\n\n    let ma = MA.calculate(tradeData, {\n        n: options.n,\n        type: options.type1,\n        source: options.source,\n        digits: options.digits,\n    });\n    if (!ma) return;\n    let atr = ATR.calculate(tradeData, {\n        n: options.n,\n        type: options.type2,\n        digits: options.digits,\n    });\n    if (!atr) return;\n    let up = [];\n    let down = [];\n    for (let i = 0; i < ma.length; i++) {\n        up[i] = utils.toFixed(ma[i] + options.m * atr[i], options.digits);\n        down[i] = utils.toFixed(ma[i] - options.m * atr[i], options.digits);\n    }\n\n    return [ma, up, down, atr];\n}\n\nexport default {\n    name: \"科特钠通道\",\n    label: \"KC\",\n    description: \"科特钠通道\",\n    calculate: keltner,\n};\n","/**\n * 布林线指标\n *\n * 参数：\n *  n: 移动平均天数\n *  m: 上下轨到移动平均的标准差倍数\n *  source: close | ohlc\n *  ma: 移动平均类型，ma | ema\n *\n */\nimport utils from \"../utils\";\nimport MA from \"./ma\";\n\nfunction boll(tradeData, options) {\n    utils.checkTradeData(tradeData);\n\n    let ma = MA.calculate(tradeData, {\n        n: options.n,\n        type: options.ma,\n        source: options.source,\n        digits: options.digits,\n    });\n    if (!ma) return;\n    let stdev = utils.stdev(\n        tradeData,\n        options.n,\n        (options && options.source) === \"ohlc\" ? utils.ohlc : \"close\",\n        options.digits\n    );\n    if (!stdev) return;\n\n    let up = [];\n    let down = [];\n    for (let i = 0; i < ma.length; i++) {\n        up[i] = utils.toFixed(ma[i] + options.m * stdev[i], options.digits);\n        down[i] = utils.toFixed(ma[i] - options.m * stdev[i], options.digits);\n    }\n\n    return [ma, up, down, stdev];\n}\n\nexport default {\n    name: \"BOLL\",\n    label: \"布林线\",\n    description: \"布林线指标\",\n    calculate: boll,\n};\n","/**\n * 基本动量指标\n *\n * 参数：\n *  n: 动量周期\n *  m: 平均天数\n *  source: close, ohlc\n */\n\nimport _ from \"lodash\";\nimport utils from \"../utils\";\n\nfunction mtm(tradeData, options) {\n    utils.checkTradeData(tradeData);\n\n    if (\n        !_.isEmpty(tradeData) &&\n        _.isArray(tradeData) &&\n        tradeData.length > 0 &&\n        options &&\n        options.n > 1\n    ) {\n        let source = options && options.source === \"ohlc\" ? \"ohlc\" : \"close\";\n        let digits = options.digits || 3;\n        // let sd = utils.readData\n        // if (options && options.m && options.m > 1) {\n        //     ma = utils.ma(tradeData, options.m, source, \"ma\", digits);\n        // } else {\n        //     ma = utils.ma(tradeData, 1, source, \"ma\", digits);\n        // }\n\n        let momentum = tradeData.map((item, i, all) => {\n            if (i > options.n) {\n                let c = utils.readData(item, source);\n                let cl = utils.readData(tradeData[i - options.n], source);\n                return utils.toFixed((100.0 * (c - cl)) / cl);\n                // return utils.toFixed(\n                //     (100.0 * (ma[i] - ma[i - options.n])) / ma[i - options.n],\n                //     //utils.readData(item, source) - ma[i - options.n],\n                //     //utils.readData(all[i - options.n], source),\n                //     digits\n                // );\n            } else {\n                return 0;\n            }\n        });\n        // momentum = utils.ma(momentum, 6, undefined, \"ma\");\n        return momentum;\n    }\n}\n\nexport default {\n    name: \"MTM\",\n    label: \"动量指标\",\n    description: \"动量振荡器指标\",\n    calculate: mtm,\n};\n","/**\n * TTM Wave A & B & C\n *\n * 参数：\n *  n: wave 短周期平均\n *  ma: wave a 周期平均1\n *  la: wave a 周期平均2\n *  mb: wave b 周期平均1\n *  lb: wave b 周期平均2\n *  mc: wave c 周期平均1\n *  lc: wave c 周期平均2\n *\n *  useb: true\n *  usec: true\n *  source: close, ohlc\n */\n\nimport _ from \"lodash\";\nimport utils from \"../utils\";\n\nfunction subtract(array1, array2, digits) {\n    if (\n        _.isEmpty(array1) ||\n        _.isEmpty(array2) ||\n        array1.length !== array2.length\n    ) {\n        return;\n    }\n\n    return array1.map((item, i, all) => {\n        if (digits) {\n            return utils.toFixed(item - array2[i], digits);\n        } else {\n            return item - array2[i];\n        }\n    });\n}\n\nfunction ttmwave(\n    tradeData,\n    {\n        n = 8, // 5\n        ma = 34, // 21\n        la = 55, // 34\n        useb = true,\n        mb = 89, // 55\n        lb = 144, // 89\n        usec = true,\n        mc = 233, // 144\n        lc = 377, // 233\n        source = \"close\",\n        digits = 3,\n    } = {}\n) {\n    utils.checkTradeData(tradeData);\n\n    if (\n        _.isEmpty(tradeData) ||\n        !_.isArray(tradeData) ||\n        tradeData.length <= 0\n    ) {\n        return;\n    }\n\n    if (source === \"ohlc\") {\n        source = utils.ohlc;\n    } else {\n        source = \"close\";\n    }\n    // let source = (options && options.source) == \"ohlc\" ? utils.ohlc : \"close\";\n    // let digits = (options && options.digits) || 3;\n    // let n = (options && options.n) || 8;\n\n    // let ma = (options && options.ma) || 34;\n    // let la = (options && options.la) || 55;\n    // let mb = (options && options.mb) || 89;\n    // let lb = (options && options.lb) || 144;\n    // let mc = (options && options.mb) || 233;\n    // let lc = (options && options.lb) || 377;\n\n    // wave A\n    let fastMA1 = utils.ma(tradeData, n, source, \"ema\", digits);\n    let slowMA1 = utils.ma(tradeData, ma, source, \"ema\", digits);\n    let macd1 = subtract(fastMA1, slowMA1);\n    let signal1 = utils.ma(macd1, ma, null, \"ema\", digits);\n    let hist1 = subtract(macd1, signal1, digits);\n\n    let fastMA2 = utils.ma(tradeData, n, source, \"ema\", digits);\n    let slowMA2 = utils.ma(tradeData, la, source, \"ema\", digits);\n    let macd2 = subtract(fastMA2, slowMA2);\n    let signal2 = utils.ma(macd2, la, null, \"ema\", digits);\n    let hist2 = subtract(macd2, signal2, digits);\n\n    // wave B\n    let fastMA3 = useb ? utils.ma(tradeData, n, source, \"ema\", digits) : null;\n    let slowMA3 = useb ? utils.ma(tradeData, mb, source, \"ema\", digits) : null;\n    let macd3 = useb ? subtract(fastMA3, slowMA3) : null;\n    let signal3 = useb ? utils.ma(macd3, mb, null, \"ema\", digits) : null;\n    let hist3 = useb ? subtract(macd3, signal3, digits) : null;\n\n    let fastMA4 = useb ? utils.ma(tradeData, n, source, \"ema\", digits) : null;\n    let slowMA4 = useb ? utils.ma(tradeData, lb, source, \"ema\", digits) : null;\n    let macd4 = useb ? subtract(fastMA4, slowMA4) : null;\n    let signal4 = useb ? utils.ma(macd4, lb, null, \"ema\", digits) : null;\n    let hist4 = useb ? subtract(macd4, signal4, digits) : null;\n\n    // wave C\n    let fastMA5 = usec ? utils.ma(tradeData, n, source, \"ema\", digits) : null;\n    let slowMA5 = usec ? utils.ma(tradeData, mc, source, \"ema\", digits) : null;\n    let macd5 = usec ? subtract(fastMA5, slowMA5) : null;\n    let signal5 = usec ? utils.ma(macd5, mc, null, \"ema\", digits) : null;\n    let hist5 = usec ? subtract(macd5, signal5, digits) : null;\n\n    let fastMA6 = usec ? utils.ma(tradeData, n, source, \"ema\", digits) : null;\n    let slowMA6 = usec ? utils.ma(tradeData, lc, source, \"ema\", digits) : null;\n    let macd6 = usec ? subtract(fastMA6, slowMA6, digits) : null;\n    let signal6 = usec ? utils.ma(macd6, mc, null, \"ema\", digits) : null;\n    let hist6 = usec ? subtract(macd6, signal6, digits) : null;\n\n    return [hist1, hist2, hist3, hist4, hist5, macd6, hist6];\n}\n\nexport default {\n    name: \"TTM Wave\",\n    label: \"TTMWave\",\n    description: \"TTM 波浪A B C\",\n    calculate: ttmwave,\n};\n\n// function ttmwave_ol(tradeData, options) {\n//     utils.checkTradeData(tradeData);\n\n//     if (\n//         _.isEmpty(tradeData) ||\n//         !_.isArray(tradeData) ||\n//         tradeData.length <= 0\n//     ) {\n//         return;\n//     }\n\n//     let source = (options && options.source) == \"ohlc\" ? utils.ohlc : \"close\";\n//     let digits = (options && options.digits) || 3;\n//     let n = (options && options.n) || 8;\n//     // wave A\n//     let ma = (options && options.ma) || 34;\n//     let la = (options && options.la) || 55;\n//     // wave B\n//     let mb = (options && options.mb) || 89;\n//     let lb = (options && options.lb) || 144;\n//     // wave C\n//     let mc = (options && options.mb) || 233;\n//     let lc = (options && options.lb) || 377;\n\n//     // 优化方式下，从头开始，每天的数据一次性完成\n//     let ttmwaves = [];\n//     let last = [];\n//     for (let i = 0; i < tradeData.length; i++) {\n//         let tmp = [];\n//         if (i === 0) {\n//             // 第一天的特殊数据\n\n//         } else {\n//             // wave a\n//             // let fastma1 =\n//         }\n//     }\n// }\n","/**\n * 鸡排指标，Squeeze，From Mastering the Trade (3rd Ed)\n *\n * 参数：\n *  source: close | ohlc\n *  ma: ma | ema\n *  n: 20\n *  bm: 2\n *  km: 1.5\n *  mt: \"MTM\" || \"WAVE\"\n *  mn: 5\n *  mm: 12\n *\n *  ditis: 3\n *\n */\nimport _ from \"lodash\";\nimport KC from \"./keltner-channel\";\nimport BOLL from \"./boll\";\nimport MTM from \"./mtm\";\n// import AO from \"./ao\";\nimport TTMWave from \"./ttmwave\";\nimport utils from \"../utils\";\n\nconst READY = \"READY\";\nconst REST = \"--\";\nconst BUY = \"BUY\";\nconst SELL = \"SELL\";\n\nfunction squeeze(\n    tradeData,\n    {\n        source = \"close\",\n        mtsource = \"close\",\n        digits = 3,\n        ma = \"ema\",\n        n = 20,\n        km = 1.5,\n        bm = 2,\n        mt = \"MTM\",\n        mn = 12,\n        mm = 1,\n        tn = 5,\n        tm = 21,\n        tl = 34,\n    } = {}\n) {\n    utils.checkTradeData(tradeData);\n\n    // 2020.11.4 发现了类型值转换错误，造成后续计算没有使用ohlc\n    // if (source === \"ohlc\") {\n    //     source = utils.ohlc;\n    // } else {\n    //     source = \"close\";\n    // }\n    // let source = (options && options.source) || \"close\";\n    // let digits = (options && options.digits) || 3;\n    // let ma = (options && options.ma) || \"ema\";\n    // let n = (options && options.n) || 20;\n    // // kc边界倍数\n    // let km = (options && options.km) || 1.5;\n    // // boll边界倍数\n    // let bm = (options && options.bm) || 2;\n    // // 动量指标参数\n    // let mt = (options && options.mt) || \"MTM\";\n    // let mn = (options && options.mn) || 12;\n    // let mm = (options && options.mm) || 1;\n    // let mmsource = (options && options.mmsource) || \"hl\";\n\n    // // TTM Wave\n    // let tn = (options && options.tn) || 5;\n    // let tm = (options && options.tm) || 21;\n    // let tl = (options && options.tl) || 34;\n\n    // console.log(`squeeze param: ${source}, ${ma}`);\n    let kcData = KC.calculate(tradeData, {\n        n,\n        m: km,\n        type1: ma,\n        type2: ma,\n        source,\n        digits,\n    });\n    let bollData = BOLL.calculate(tradeData, {\n        n,\n        m: bm,\n        ma,\n        source,\n        digits,\n    });\n\n    let mtmData = MTM.calculate(tradeData, {\n        n: mn,\n        m: mm,\n        source: mtsource,\n        digits,\n    });\n\n    let waveData = TTMWave.calculate(tradeData, {\n        n: tn,\n        ma: tm,\n        la: tl,\n        source,\n        digits,\n        useb: false,\n        usec: false,\n    });\n\n    let mmData = mt === \"MTM\" ? mtmData : waveData && waveData[0];\n\n    // 下面根据轨道情况，判断状态，状态区分如下\n    // 1. boll进kc，启动警告状态：READY\n    // 2. boll出kc，进入交易状态：\n    //   2.1 mm>0，买入（多头）：BUY\n    //   2.2 mm<=0，卖出（空头）：SELL\n    // 3. mm 降低，交易结束：--\n    let currentState = REST;\n    let states = tradeData.map((item, i, all) => {\n        let ready =\n            bollData &&\n            kcData &&\n            bollData[1][i] &&\n            kcData[1][i] &&\n            bollData[1][i] <= kcData[1][i];\n\n        let mmUp = mmData && mmData[i] && mmData[i] >= 0;\n        // mt === \"MTM\"\n        //     ? mmData && mmData[i] && mmData[i] >= 0\n        //     : waveData && waveData[0] && waveData[0][i] >= 0;\n\n        let nextState = currentState;\n        if (currentState === REST) {\n            if (ready) {\n                nextState = READY;\n            }\n        } else if (currentState === READY) {\n            if (!ready) {\n                nextState = mmUp ? BUY : SELL;\n            }\n        } else if (currentState === BUY || currentState === SELL) {\n            if (ready) {\n                // 再次进入等待\n                nextState = READY;\n            } else {\n                // 检查是否出现动能减弱\n                if (\n                    mmData &&\n                    mmData[i] &&\n                    mmData[i - 1] &&\n                    ((currentState === BUY && mmData[i] < mmData[i - 1]) ||\n                        (currentState === SELL && mmData[i] > mmData[i - 1]))\n                ) {\n                    nextState = REST;\n                }\n            }\n        }\n        // console.log(\n        //     `${i}-${tradeData[i].trade_date}, ready=${ready}, cState=${currentState}, nState=${nextState}, ${bollData[1][i]}, ${kcData[1][i]}}`\n        // );\n        currentState = nextState;\n        return nextState;\n    });\n\n    return [\n        kcData && kcData[0],\n        bollData && bollData[1],\n        bollData && bollData[2],\n        kcData && kcData[1],\n        kcData && kcData[2],\n        mmData,\n        states,\n        mtmData,\n        waveData && waveData[0],\n        waveData && waveData[1],\n    ];\n}\n\nexport default {\n    name: \"SQUEEZE\",\n    label: \"鸡排\",\n    description: \"挤牌信号器指标\",\n    calculate: squeeze,\n    states: {\n        REST,\n        READY,\n        BUY,\n        SELL,\n    },\n};\n","import SQUEEZE from \"../indicators/squeeze\";\nimport TTMWave from \"../indicators/ttmwave\";\nimport _ from \"lodash\";\nimport moment from \"moment\";\nimport trans from \"../transaction\";\nimport debugpkg from \"debug\";\nimport { getDataRoot } from \"@wt/lib-wtda-query\";\n\nconst debug = debugpkg(\"rules:squeeze\");\n\nconst RULE_NAME = \"squeeze\";\nconst SQUEEZE_DATA = Symbol(\"SQUEEZE_DATA\");\nconst TTMWAVE_DATA = Symbol(\"TTMWAVE_DATA\");\n\nfunction checkTTM(index, ttmwave) {\n    // 检查TTM Wave ABC的趋势\n    let upTrend = 0;\n    let downTrend = 0;\n    let ups = 0;\n    let downs = 0;\n    if (index - 2 >= 0) {\n        for (let i = 0; i < 6; i++) {\n            if (ttmwave[i][index] >= 0) {\n                ups++;\n            } else {\n                downs++;\n            }\n            if (\n                ttmwave[i][index] > ttmwave[i][index - 1] &&\n                ttmwave[i][index - 1] > ttmwave[i][index - 2]\n            ) {\n                upTrend++;\n            } else {\n                downTrend++;\n            }\n        }\n    }\n    return [ups, downs, upTrend, downTrend];\n}\n\nfunction check(index, stockData, options, tsCode) {\n    let sdata = SQUEEZE.calculate(stockData, options.squeeze);\n\n    // 使用TTMWave同步进行检查\n    let ttmwave = TTMWave.calculate(stockData, options.ttmwave);\n    // 2020.10.10 增加一个针对Wave波浪趋势数量的参数，默认6个波浪至少有3个是对应的趋势发展，否则过滤掉\n    let need_condition_days = (options && options.needCond) || false;\n    let condition_days = (options && options.cond) || 3;\n\n    if (\n        stockData &&\n        _.isArray(stockData) &&\n        index < stockData.length &&\n        index >= 0\n    ) {\n        let tradeDate = stockData[index].trade_date;\n        let days = checkDays(index, sdata[6]);\n        let trends = checkTTM(index, ttmwave);\n        if (sdata[6][index] === SQUEEZE.states.READY) {\n            // 有信号\n            if (\n                !need_condition_days ||\n                (trends[0] >= condition_days && trends[2] >= condition_days)\n            ) {\n                return {\n                    tsCode,\n                    dataIndex: index,\n                    date: tradeDate,\n                    tradeType: \"signal\",\n                    hasSignals: true,\n                    signal: \"READY\",\n                    type: \"squeeze\",\n                    squeeze: {\n                        days,\n                        trends,\n                    },\n                    // targetPrice: stockData[index].close,\n                    memo: `挤牌信号，可考虑挤入 [${stockData[index].trade_date} ${sdata[6][index]}]`,\n                };\n            }\n        } else if (sdata[6][index] === SQUEEZE.states.BUY) {\n            // 检查Wave ABC的趋势变化\n            if (\n                !need_condition_days ||\n                (trends[0] >= condition_days && trends[2] >= condition_days)\n            ) {\n                return {\n                    tsCode,\n                    dataIndex: index,\n                    date: tradeDate,\n                    tradeType: \"buy\",\n                    hasSignals: true,\n                    signal: \"BUY\",\n                    type: \"squeeze\",\n                    squeeze: {\n                        days,\n                        trends,\n                    },\n                    // targetPrice: stockData[index].close,\n                    memo: `挤牌信号明确，买入 [${stockData[index].trade_date} ${sdata[6][index]}]`,\n                };\n            }\n        } else if (\n            sdata[6][index] === SQUEEZE.states.SELL &&\n            options.squeeze.needSell\n        ) {\n            if (\n                !need_condition_days ||\n                (trends[1] <= condition_days && trends[3] <= condition_days)\n            ) {\n                return {\n                    tsCode,\n                    dataIndex: index,\n                    date: tradeDate,\n                    hasSignals: true,\n                    tradeType: \"sell\",\n                    signal: \"SELL\",\n                    type: \"squeeze\",\n                    squeeze: {\n                        days,\n                        trends,\n                    },\n                    // targetPrice: stockData[index].close,\n                    memo: `挤牌信号明确，卖出 [${stockData[index].trade_date} ${sdata[6][index]}]`,\n                };\n            }\n        }\n    }\n}\n\nfunction checkDays(index, states) {\n    if (states[index] === SQUEEZE.states.REST) return [0, 0];\n    let trade_days = 0;\n    let state = states[index];\n    if (state === SQUEEZE.states.BUY || state === SQUEEZE.states.SELL) {\n        while (\n            index - trade_days >= 0 &&\n            states[index - trade_days] === state\n        ) {\n            trade_days++;\n        }\n    }\n    let ready_days = 0;\n    if (states[index - trade_days] === SQUEEZE.states.READY) {\n        while (\n            index - trade_days - ready_days >= 0 &&\n            states[index - trade_days - ready_days] === SQUEEZE.states.READY\n        ) {\n            ready_days++;\n        }\n    }\n    return [ready_days, trade_days];\n}\n\nfunction calculateSqueeze(stockData, options) {\n    if (_.isNil(stockData)) return;\n    // debug(\n    //     `squeeze? ${_.isNil(stockData[SQUEEZE_DATA])} ${_.isNil(\n    //         stockData[TTMWAVE_DATA]\n    //     )}`\n    // );\n    if (_.isNil(stockData[SQUEEZE_DATA])) {\n        stockData[SQUEEZE_DATA] = SQUEEZE.calculate(stockData, options.squeeze);\n    }\n    if (_.isNil(stockData[TTMWAVE_DATA])) {\n        stockData[TTMWAVE_DATA] = TTMWave.calculate(stockData, options.ttmwave);\n    }\n}\n\nfunction checkBuyTransaction(stockInfo, balance, index, stockData, options) {\n    debug(`检查挤牌买入：${index}, ${balance}`);\n    if (balance <= 0) return;\n    calculateSqueeze(stockData, options);\n\n    if (index < 1) return;\n    // 检查今天index的条件\n    let squeeze = stockData[SQUEEZE_DATA];\n    // debug(`%o`, squeeze);\n    let squeeze_today = squeeze && squeeze[6] && squeeze[6][index];\n    let squeeze_lday = squeeze && squeeze[6] && squeeze[6][index - 1];\n    // if (_.isNil(squeeze_today)) {\n    //     debug(`意外退出...`);\n    //     return;\n    // }\n    debug(`检查买入规则：${squeeze_today}, ${squeeze_lday}`);\n    if (\n        squeeze_today === SQUEEZE.states.BUY &&\n        squeeze_lday === SQUEEZE.states.READY\n    ) {\n        let currentData = stockData[index];\n        let tradeDate = currentData.trade_date;\n        let targetPrice = currentData.close;\n        return trans.createBuyTransaction(\n            stockInfo,\n            tradeDate,\n            index,\n            balance,\n            targetPrice,\n            RULE_NAME,\n            `挤牌买入 ${targetPrice.toFixed(2)}`\n        );\n    }\n}\n\nfunction checkSellTransaction(stockInfo, stock, index, stockData, options) {\n    if (_.isNil(stock) || stock.count <= 0) return;\n    calculateSqueeze(stockData, options);\n\n    if (index < 1) return;\n    // 检查今天index的条件\n    let squeeze = stockData[SQUEEZE_DATA];\n    let squeeze_today = squeeze && squeeze[6] && squeeze[6][index];\n    let squeeze_lday = squeeze && squeeze[6] && squeeze[6][index - 1];\n    // if (_.isNil(squeeze_today)) {\n    //     return;\n    // }\n    if (\n        squeeze_today === SQUEEZE.states.REST &&\n        squeeze_lday === SQUEEZE.states.BUY\n    ) {\n        let currentData = stockData[index];\n        let tradeDate = currentData.trade_date;\n        let targetPrice = currentData.close;\n        return trans.createSellTransaction(\n            stockInfo,\n            tradeDate,\n            index,\n            stock.count,\n            targetPrice,\n            RULE_NAME,\n            `挤牌卖出 ${targetPrice.toFixed(2)}`\n        );\n    }\n}\n\n/**\n * 返回参数配置的显示信息\n * @param {*}} opions 参数配置\n */\nfunction showOptions(options) {\n    let opt = options && options.squeeze;\n    // let buy = opt && options.squeeze.buy;\n    // let sell = opt && options.squeeze.sell;\n    return `\n模型 ${squeeze.name}[${squeeze.label}] 参数：\nsource: ${opt.source}\n均值类型: ${opt.ma},    平均天数: ${opt.n}\n布林线倍率: ${opt.bm}   Keltner通道倍率: ${opt.km}\n动量类型:  ${opt.mt}\n动量平均天数：  ${opt.mn},     动量天数：${opt.mm}\n价格类型: ${opt.source}\n\n`;\n}\n\n/**\n * 将搜索得到的列表生成分析报表\n *\n * @param {*} results 搜索的匹配列表\n * @param {*} options 匹配使用的参数\n */\nasync function createReports(results, options) {\n    if (_.isNil(results)) return;\n\n    let reports = [];\n    // results 当中按照signal进行了分组\n    // 下面主要分析signal===\"READY\"情况下，时间的分布\n    let readyList = results && results[SQUEEZE.states.READY];\n    // 1, 2, 3, 5, 8, 13\n    // let boundaries = [1, 2, 3, 5, 8, 13, _];\n    let days = [\n        { label: \"1天\", data: [] },\n        { label: \"2天\", data: [] },\n        { label: \"3天\", data: [] },\n        { label: \"4~5天\", data: [] },\n        { label: \"6~8天\", data: [] },\n        { label: \"8~13天\", data: [] },\n        { label: \"多于13天\", data: [] },\n    ];\n    if (!_.isEmpty(readyList)) {\n        for (let item of readyList) {\n            let ready_days =\n                item.squeeze && item.squeeze.days && item.squeeze.days[0];\n            let i = 0;\n            if (ready_days === 1) i = 0;\n            else if (ready_days === 2) i = 1;\n            else if (ready_days === 3) i = 2;\n            else if (ready_days > 3 && ready_days <= 5) i = 3;\n            else if (ready_days > 5 && ready_days <= 8) i = 4;\n            else if (ready_days > 8 && ready_days <= 13) i = 5;\n            else i = 6;\n\n            days[i].data.push(item.tsCode);\n        }\n        let i = 0;\n        while (i < days.length) {\n            if (days[i] && days[i].data && days[i].data.length > 0) {\n                i++;\n            } else {\n                days.splice(i, 1);\n            }\n        }\n        reports.push({ label: SQUEEZE.states.READY, data: days });\n    }\n\n    let buyList = results && results[SQUEEZE.states.BUY];\n    let bdays = [\n        { label: \"1天\", data: [] },\n        { label: \"2天\", data: [] },\n        { label: \"3天\", data: [] },\n        { label: \"4~5天\", data: [] },\n        { label: \"6~8天\", data: [] },\n        { label: \"8~13天\", data: [] },\n        { label: \"多于13天\", data: [] },\n    ];\n    if (!_.isEmpty(buyList)) {\n        for (let item of buyList) {\n            let buy_days =\n                item.squeeze && item.squeeze.days && item.squeeze.days[1];\n            let i = 0;\n            if (buy_days === 1) i = 0;\n            else if (buy_days === 2) i = 1;\n            else if (buy_days === 3) i = 2;\n            else if (buy_days > 3 && buy_days <= 5) i = 3;\n            else if (buy_days > 5 && buy_days <= 8) i = 4;\n            else if (buy_days > 8 && buy_days <= 13) i = 5;\n            else i = 7;\n\n            bdays[i].data.push(item.tsCode);\n            // if (bdays[i]) {\n            // } else {\n            //     bdays[i] = [item.tsCode];\n            // }\n        }\n        let i = 0;\n        while (i < bdays.length) {\n            if (bdays[i] && bdays[i].data && bdays[i].data.length > 0) {\n                i++;\n            } else {\n                bdays.splice(i, 1);\n            }\n        }\n        reports.push({ label: SQUEEZE.states.BUY, data: bdays });\n    }\n\n    // let reports = {\n    //     // updateTime: moment().toISOString(),\n    //     // squeeze: {\n    //     [SQUEEZE.states.READY]: days,\n    //     [SQUEEZE.states.BUY]: bdays,\n    //     // },\n    // };\n\n    return reports;\n}\n\nconst squeeze = {\n    name: \"挤牌\",\n    label: RULE_NAME,\n\n    description: \"挤牌模型\",\n    methodTypes: {},\n    checkBuyTransaction,\n    checkSellTransaction,\n    check,\n    showOptions,\n    createReports,\n};\n\nexport default squeeze;\n","/**\n * 推进器交易，波段\n *\n */\nimport _ from \"lodash\";\nimport moment from \"moment\";\nimport utils from \"../utils\";\nimport trans from \"../transaction\";\nimport debugpkg from \"debug\";\nimport { getDataRoot } from \"@wt/lib-wtda-query\";\n\nimport MA from \"../indicators/ma\";\n\nconst debug = debugpkg(\"rules:swing\");\n\nconst RULE_NAME = \"swing\";\nconst SWING_DATA = Symbol(\"SWING_DATA\");\nconst SWING_CONTEXT = Symbol(\"SWING_CONTEXT\");\n\nfunction calculateSwing(\n    stockData,\n    {\n        n = 8,\n        m = 21,\n        l = 50,\n        earn1 = 0.04,\n        earn2 = 0.08,\n        loss = 0.04,\n        digits = 3,\n    } = {}\n) {\n    if (_.isNil(stockData)) return;\n    let type = \"ema\";\n    let source = \"close\";\n    debug(`swing options: n=${n} m=${m} l=${l}`);\n    if (_.isNil(stockData[SWING_DATA])) {\n        let ma1 = MA.calculate(stockData, {\n            n,\n            source,\n            type,\n            digits,\n        });\n        debug(`%o`, ma1);\n        let ma2 = MA.calculate(stockData, {\n            n: m,\n            source,\n            type,\n            digits,\n        });\n        debug(`%o`, ma2);\n        let ma3 = MA.calculate(stockData, {\n            n: l,\n            source,\n            type,\n            digits,\n        });\n\n        let swingData = [];\n        let started = false;\n        let currentState;\n        for (let index = 0; index < stockData.length; index++) {\n            // 从第一天开始检查\n\n            // 响应的状态持续值\n            let state = -1;\n            let lossState = 0;\n            let target = 0;\n            let ruleTarget = 0;\n            let lossTarget = 0;\n            let trans = [];\n            let ready_days = 0;\n            let pullback_days = 0;\n            let times = (currentState && currentState.times) || 0;\n            let data = stockData[index];\n\n            if (index === 0 || index < Math.max(n, m) || !started) {\n                // 第一天为特殊定义，确认初始值，内容为状态定义，为后续下一天判断提供依据\n                // newState = {\n                //     state: -1, // 状态，-1 反向状态；0 区间等待回撤；1 回撤已交易，等待目标或止损；9 止损/初始，等待重新进入正常等待回撤区间（超过ma1）\n                //     lossState: -1, // 止损状态，1 指定止损，交易后，按照交易价格 min(止损比例，ma2）；2 跟随止损（ma2）\n                //     targets: [], // [0] 目标价格 [1] 止损价格 [2] 止损规则价格\n                //     trans: [], // 交易，{type: BUY|SELL, price}\n                //     days: [], // [0] 进入非-1的持续天数, [1] 上一次回撤后的持续天数\n                //     times, // 交易发生次数\n                // };\n                // 这里要找到适当的ma1穿过ma2的时间点才能启动\n                if (\n                    index > 0 &&\n                    index >= Math.max(n, m) - 1 &&\n                    ma1[index] &&\n                    ma2[index] &&\n                    ma1[index] < ma2[index]\n                ) {\n                    started = true;\n                }\n            } else {\n                if (ma1[index] >= ma2[index]) {\n                    // 在ma1 >= ma2正确的曲线范围内\n                    state = currentState.state;\n                    lossState = currentState.lossState;\n                    [target, lossTarget, ruleTarget] = currentState.targets;\n                    [ready_days, pullback_days] = currentState.days;\n                    if (pullback_days > 0) {\n                        pullback_days++;\n                    }\n                    if (ready_days > 0) {\n                        ready_days++;\n                    }\n                    times = currentState.times;\n\n                    // 今日穿墙\n                    if (currentState.state === -1) {\n                        // 当前非符合条件状态，查看今天\n                        if (data.open >= ma1[index]) {\n                            debug(`** ${data.trade_date} 进入等待回调区间`);\n                            state = 0;\n                        } else {\n                            debug(\n                                `** ${data.trade_date} 进入初始状态，等待进入多头区间`\n                            );\n                            state = 9;\n                        }\n                        lossState = 0;\n                        ready_days = 1;\n                        pullback_days = 0;\n                        times = 0;\n\n                        target = 0;\n                        lossTarget = 0;\n                        ruleTarget = 0;\n                    }\n\n                    // 止损/初始后等待进入正常回调区间\n                    if (currentState.state === 9) {\n                        if (data.high >= ma1[index]) {\n                            debug(` ** ${data.trade_date} 进入等待回调区间`);\n                            state = 0;\n                        }\n                    }\n\n                    // 交易跟踪，检查止损目标是否需要调整\n                    if (\n                        lossState === 1 &&\n                        (currentState.state === 1 || state === 1) &&\n                        data.high >= ruleTarget\n                    ) {\n                        debug(` ** ${data.trade_date} 达到目标1，调整止损策略`);\n                        lossState = 2;\n                    }\n\n                    // 交易跟踪，止损\n                    if (\n                        currentState.state === 1 &&\n                        ((lossState === 1 && data.low <= lossTarget) ||\n                            (lossState === 2 && data.low <= ma2[index]))\n                    ) {\n                        // 达到止损\n                        state = 9;\n                        // 根据当前止损类型确定止损价格，需要注意当天价格是否在范围内\n                        let price = lossState === 1 ? lossTarget : ma2[index];\n                        price = Math.min(price, data.high);\n                        trans.push({ type: \"SELL\", price });\n                        debug(\n                            `** ${data.trade_date} 达到止损价位，交易: ${price}`\n                        );\n\n                        lossTarget = 0;\n                        target = 0;\n                        ruleTarget = 0;\n                    } else if (\n                        currentState.state === 1 &&\n                        data.high >= target &&\n                        target > 0\n                    ) {\n                        // 交易跟踪，到达预期价位成交\n                        // 目标价位达到\n                        let price = currentState.targets[0];\n                        price = Math.max(data.low, price);\n                        trans.push({ type: \"SELL\", price });\n\n                        lossState = 0;\n                        lossTarget = 0;\n                        target = 0;\n                        ruleTarget = 0;\n                        state = 0;\n                        debug(\n                            `** ${data.trade_date} 达到目标价位，交易: ${price}`\n                        );\n                    }\n\n                    // 等待回调\n                    if (currentState.state === 0 || state === 0) {\n                        // 检查是否回调到ma1\n                        if (ma1[index] >= data.low) {\n                            state = 1;\n                            let price = ma1[index];\n                            trans.push({ type: \"BUY\", price });\n                            times++;\n                            lossState = 1;\n                            lossTarget = Math.min(\n                                price * (1 - loss),\n                                ma2[index]\n                            );\n\n                            target = price * (1 + earn2);\n                            ruleTarget = price * (1 + earn1);\n                            pullback_days = 1;\n                            debug(\n                                `** ${data.trade_date} 回调发生，交易：${price}, 目标 ${target}, 止损 ${lossTarget}, ${ruleTarget}; [${ma1[index]} ,${ma2[index]}, ${data.open}, ${data.high}, ${data.low}, ${data.close}]`\n                            );\n                        }\n                    }\n\n                    // 对于今日调整到初始状态的，最后检查是否进入回调等待阶段\n                    if (state === 9) {\n                        if (data.close >= ma1[index]) {\n                            debug(\n                                ` ** ${data.trade_date} 收盘进入等待回调区间`\n                            );\n                            state = 0;\n                        }\n                    }\n                } else {\n                    debug(` ** ${data.trade_date} 进入空头阶段，检查平仓`);\n                    // 价格已经走出交易区间，如果有头寸，平仓结束\n                    if (currentState.state === 1) {\n                        state = -1;\n                        let price = data.close;\n                        trans.push({ type: \"SELL\", price });\n                        debug(\n                            `** ${data.trade_date} 进入空头，完成平仓： ${price}`\n                        );\n                    }\n\n                    state = -1;\n                    ready_days = 0;\n                    pullback_days = 0;\n                }\n            }\n\n            swingData[index] = {\n                state,\n                lossState,\n                targets: [target, lossTarget, ruleTarget],\n                trans,\n                days: [ready_days, pullback_days],\n                times,\n            };\n            currentState = swingData[index];\n        }\n\n        stockData[SWING_DATA] = [swingData, ma1, ma2, ma3];\n    }\n}\n\nfunction checkSwing(index, stockData, options, tsCode) {\n    let opt = options && options.swing;\n    calculateSwing(stockData, opt);\n\n    let swingData = stockData[SWING_DATA][0];\n    if (\n        swingData &&\n        _.isArray(swingData) &&\n        index < swingData.length &&\n        index >= 0\n    ) {\n        let data = swingData[index];\n        if (data.state >= 0) {\n            let state = data.state;\n            let memo;\n            if (state === 0) {\n                memo = `波段：等待回调，目标 ¥${utils.toFixed(\n                    data.targets[0],\n                    2\n                )}，持续${data.days[0]}天`;\n            } else if (state === 1) {\n                memo = `波段：已买入，目标价位 ¥${utils.toFixed(\n                    data.targets[0],\n                    2\n                )}， ${\n                    data.lossState === 1 ? \"初始止损\" : \"跟随止损\"\n                } ¥${utils.toFixed(data.targets[1], 2)}}`;\n            } else if (state === 9) {\n                memo = `波段：发生止损，等待下一次回调，目标 ${utils.toFixed(\n                    data.targets[0],\n                    2\n                )}`;\n            }\n\n            return {\n                tsCode,\n                dataIndex: index,\n                date: stockData[index].trade_date,\n                tradeType: \"signal\",\n                hasSignals: true,\n                signal:\n                    state === 0\n                        ? \"READY\"\n                        : state === 1\n                        ? \"BUY\"\n                        : state === 9\n                        ? \"PULLBACK\"\n                        : \"NA\",\n                type: \"swing\",\n                swing: {\n                    days: data.days,\n                    times: data.times,\n                    state: data.state,\n                    lossState: data.lossState,\n                    targets: data.targets,\n                },\n                memo,\n            };\n        }\n    }\n\n    // let range = (opt && opt.range) || 8;\n    // let earn1 = (opt && opt.earn1) || 0.04;\n    // let earn2 = (opt && opt.earn2) || 0.08;\n    // let loss = (opt && opt.loss) || 0.04;\n\n    // if (\n    //     stockData &&\n    //     _.isArray(stockData) &&\n    //     index < stockData.length &&\n    //     index >= 0\n    // ) {\n    //     let tradeDate = stockData[index].trade_date;\n    //     // 找到ma1<=ma2 && ma1>ma2的交叉日，这是READY状态；注意READY状态不能太远，考虑仅查找最多8天\n    //     // READY后，如果 ma1 >= daily.low，则发生“回撤”，进入BUY状态，设定目标\n    //     let ma1 = data[0];\n    //     let ma2 = data[1];\n    //     if (ma1[index] <= ma2[index]) return;\n\n    //     let start = index;\n    //     let ready_days = 1;\n    //     for (let i = 0; i < range; i++) {\n    //         if (ma1[index - i - 1] <= ma2[index - i - 1]) {\n    //             // index-i 是交叉发生点\n    //             start = index - i;\n    //             ready_days = i + 1;\n    //             break;\n    //         }\n    //     }\n\n    //     let pullback_days = 0;\n    //     let times = 0;\n    //     let state = 0;\n    //     let lossState = 0;\n\n    //     let target = 0;\n    //     let ruleTarget = 0;\n    //     let maxLoss = 0;\n    //     for (let i = index - ready_days + 1; i <= index; i++) {\n    //         // 当天开始是交易状态，首先完成交易\n    //         if (state === 1) {\n    //             // 交易过程状态，等待止损或者改变条件\n    //             if (\n    //                 (lossState === 1 && maxLoss >= tradeDate[i].high) ||\n    //                 (lossState === 2 && ma2[i] >= tradeDate[i].high)\n    //             ) {\n    //                 // 触发止损\n    //                 state = 9;\n    //             } else if (lossState === 1 && ruleTarget <= tradeDate[i].high) {\n    //                 // 止损规则目标达成，这时调整止损规则到跟随ma2\n    //                 lossState = 2;\n    //             } else if (target <= tradeDate[i].high) {\n    //                 // 达到\n    //                 state = 0;\n    //             }\n    //         }\n\n    //         // 状态为等待回调，确定是否可以交易，每次交易表示一个周期增加\n    //         if (state === 0 && ma1[i] >= tradeDate[i].low) {\n    //             // 等待机会并且触发\n    //             // 触发回调\n    //             target1 = ma1[i] * (1 + earn1);\n    //             target2 = ma1[i] * (1 + earn2);\n\n    //             // 止损初期采用固定比例和ma2价格低的那个\n    //             maxLoss = Math.min(ma1[i] * (1 - loss), ma2[i]);\n    //             lossState = 1;\n\n    //             if (pullback_days <= 0) {\n    //                 pullback_days = i + 1;\n    //             }\n\n    //             times++;\n    //             state = 1;\n    //             pullback_days = index - i + 1;\n    //         }\n\n    //         if (state === 9 && tradeDate[i].close > ma1[i]) {\n    //             // 价格重新进入等待回调状态\n    //             state = 0;\n    //         }\n    //     }\n\n    //     let signal = state === 0 ? \"READY\" : state === 1 ? \"BUY\" : \"LOSS\";\n    //     let memo = \"\";\n    //     let targets = [\"--\", \"--\"];\n    //     if (state === 1) {\n    //         targets[0] = utils.toFixed(target1, 2);\n    //         if (lossState === 1) {\n    //             targets[1] = utils.toFixed(maxLoss, 2);\n    //         } else if (lossState === 2) {\n    //             target[1] = utils.toFixed(ma2[index], 2);\n    //         }\n    //     } else if (state === 0 || state === 9) {\n    //         targets[0] = utils.toFixed(ma1[index], 2);\n    //     }\n\n    //     if (state === 0) {\n    //         memo = `波段：等待回调，目标 ¥${targets[0]}，持续${ready_days}天`;\n    //     } else if (state === 1) {\n    //         memo = `波段：已买入，目标价位 ¥${targets[0]}， ${\n    //             lossState === 1 ? \"初始止损\" : \"跟随止损\"\n    //         } ¥${targets[1]}}`;\n    //     } else if (state === 9) {\n    //         memo = `波段：发生止损，等待下一次回调，目标 ${targets[0]}`;\n    //     }\n\n    //     return {\n    //         tsCode,\n    //         dataIndex: index,\n    //         date: tradeDate,\n    //         tradeType: \"signal\",\n    //         hasSignals: true,\n    //         signal,\n    //         type: \"swing\",\n    //         swing: {\n    //             days: [ready_days, pullback_days],\n    //             times,\n    //             state,\n    //             lossState,\n    //             targets,\n    //         },\n    //         memo,\n    //     };\n    // }\n}\n\nfunction check(index, stockData, options, tsCode) {\n    let ret = checkSwing(index, stockData, options, tsCode);\n    // console.log(`检查${index}波段结果：%o`, ret);\n    if (!ret) return;\n    // 只有等待回调的阶段需要进入返回列表\n    if (ret.swing && (ret.swing.state === 0 || ret.swing.state === 9)) {\n        return ret;\n    }\n}\n\n// function readContext(index, stockData) {\n//     if (!stockData || !_.isArray(stockData)) return;\n//     if (index < stockData.length && index >= 0) {\n//         let contexts = stockData[SWING_CONTEXT];\n//         if (contexts && _.isArray(contexts)) {\n//             return contexts[index];\n//         }\n//     }\n// }\n\n// function saveContext(index, context, stockData) {\n//     if (!stockData && !_.isArray(stockData)) {\n//         return;\n//     }\n//     if (index < stockData.length && index >= 0) {\n//         let contexts = stockData[SWING_CONTEXT];\n//         if (!contexts) {\n//             stockData[SWING_CONTEXT] = [];\n//             contexts = stockData[SWING_CONTEXT];\n//         }\n//         contexts[index] = context;\n//     }\n// }\n\nfunction checkBuyTransaction(stockInfo, balance, index, stockData, options) {\n    debug(`检查波段买入：${index}, ${balance}`);\n    if (balance <= 0) return;\n\n    calculateSwing(stockData, options && options.swing);\n\n    let swingData = stockData[SWING_DATA] && stockData[SWING_DATA][0];\n    if (\n        swingData &&\n        _.isArray(swingData) &&\n        index < swingData.length &&\n        index >= 0\n    ) {\n        let data = swingData[index];\n        debug(`swing data 买入检查: ${index}, %o`, data);\n        if (!_.isEmpty(data.trans)) {\n            let currentData = stockData[index];\n            let tradeDate = currentData.trade_date;\n            for (let tran of data.trans) {\n                if (tran.type === \"BUY\") {\n                    let targetPrice = tran.price;\n                    return trans.createBuyTransaction(\n                        stockInfo,\n                        tradeDate,\n                        index,\n                        balance,\n                        targetPrice,\n                        RULE_NAME,\n                        `波段买入 ${targetPrice.toFixed(2)}`\n                    );\n                }\n            }\n        }\n    }\n}\n\nfunction checkSellTransaction(stockInfo, stock, index, stockData, options) {\n    debug(`检查波段卖出：${index}, ${stock.count}`);\n    if (_.isNil(stock) || stock.count <= 0) return;\n\n    calculateSwing(stockData, options && options.swing);\n\n    let swingData = stockData[SWING_DATA] && stockData[SWING_DATA][0];\n    if (\n        swingData &&\n        _.isArray(swingData) &&\n        index < swingData.length &&\n        index >= 0\n    ) {\n        let data = swingData[index];\n        debug(`swing data 卖出检查: ${index}, %o`, data);\n        if (!_.isEmpty(data.trans)) {\n            let currentData = stockData[index];\n            let tradeDate = currentData.trade_date;\n            for (let tran of data.trans) {\n                if (tran.type === \"SELL\") {\n                    let targetPrice = tran.price;\n                    return trans.createSellTransaction(\n                        stockInfo,\n                        tradeDate,\n                        index,\n                        stock.count,\n                        targetPrice,\n                        RULE_NAME,\n                        `波段卖出 ${targetPrice.toFixed(2)}`\n                    );\n                }\n            }\n        }\n    }\n}\n\n/**\n * 返回参数配置的显示信息\n * @param {*}} opions 参数配置\n */\nfunction showOptions(options) {\n    let opt = options && options.swing;\n    return `\n模型 ${swing.name}[${swing.label}] 参数：\n均线1: ${opt.n},  均线2: ${opt.m}\n目标价位：${opt.earn2 * 100}%\n止损价位：${opt.loss * 100}%\n止损条件价位：${opt.earn1 * 100}%\n`;\n}\n\nasync function createReports(results, options) {\n    if (_.isNil(results)) return;\n\n    let reports = [];\n\n    let readyList = results && results[\"READY\"];\n    let days = [{ label: \"全部\", data: [] }];\n    if (!_.isEmpty(readyList)) {\n        for (let item of readyList) {\n            days[0].data.push(item.tsCode);\n        }\n        reports.push({ label: \"READY\", data: days });\n    }\n\n    let buyList = results && results[\"PULLBACK\"];\n    let bdays = [{ label: \"全部\", data: [] }];\n    if (!_.isEmpty(buyList)) {\n        for (let item of buyList) {\n            bdays[0].data.push(item.tsCode);\n        }\n        reports.push({ label: \"PULLBACK\", data: bdays });\n    }\n\n    // let reports = {\n    //     READY: days,\n    //     PULLBACK: bdays,\n    // };\n\n    return reports;\n}\n\nconst swing = {\n    name: \"波段交易\",\n    label: RULE_NAME,\n\n    description: \"波段选择\",\n    methodTypes: {},\n    checkBuyTransaction,\n    checkSellTransaction,\n    check,\n    showOptions,\n    createReports,\n};\n\nexport default swing;\n","/**\n * HOLP: High of Low Period\n *\n * 这是一个反转操作方式，需要严格执行规则\n *  1. 首先是启动点为近25天（周期）的价格新低，最少是17天（周期）\n *     这应该是一个下跌趋势，可以考虑通过检查最近20天内的阶段高点和阶段地点，然后看中间的间隔\n *  2. 最近的最低价K线位置确定，记录最高价（突破启动价位）和最低价（初始止损）\n *  3. 进入交易后，如果交易执行超过3天（周期），则初始止损调整为2根K线跟进止损（前面第二根K线最低价止损）\n *  4. 如果过程中发生回调，假如当日没有发生止损，但是2K线跟进止损会触发，则保持止损价位不变，看走势止损或者可以恢复2K线止损继续\n */\n\nimport _ from \"lodash\";\nimport moment from \"moment\";\nimport engine from \"../transaction-engine\";\nimport trans from \"../transaction\";\n\nimport debugpkg from \"debug\";\nconst debug = debugpkg(\"rules:holp\");\n\n/**\n * 基准参数，用于测量正常买入卖出情况下的基准效果\n * 采用的买入策略为开盘买入，第二天收盘卖出；或者止损平仓\n */\nconst RULE_NAME = \"HOLP\";\n\nfunction check(index, stockData, options, tsCode) {\n    // 从index位置查找前面25个数据中的最大和最小位置，确定趋势\n    if (\n        _.isNil(stockData) ||\n        _.isEmpty(stockData) ||\n        stockData.length < 20 ||\n        index < 20\n    ) {\n        return;\n    }\n\n    let min = stockData[index].low;\n    let minIndex = index;\n    let max = stockData[index].high;\n    let maxIndex = index;\n    for (let i = 0; i < 25; i++) {\n        if (index - i - 1 < 0) break;\n        if (stockData[index - i - 1].low <= min) {\n            min = stockData[index].low;\n            minIndex = index - i - 1;\n        }\n        if (stockData[index - i - 1].high >= max) {\n            max = stockData[index - i - 1].high;\n            maxIndex = index - i - 1;\n        }\n    }\n    debug(`最低 ${min} - ${minIndex}, 最高 ${max} - ${maxIndex}`);\n\n    let tradeDate = stockData[index].trade_date;\n    debug(`${tradeDate} 之前新低位置 ${stockData[minIndex].trade_date}`);\n    if (index - minIndex <= 3 && minIndex - maxIndex >= 17) {\n        // 符合初步条件，下面验证是否已经触发交易\n        let readyIndex = minIndex;\n        let data = stockData[readyIndex];\n        let state = 0;\n        let lossState = 0;\n        let startPrice = data.high;\n        let lossTarget = data.low;\n        let startDate;\n        let startIndex = -1;\n        let tranPrice;\n\n        for (let i = readyIndex + 1; i <= index; i++) {\n            let daily = stockData[i];\n            if (state === 0 && daily.high >= startPrice) {\n                // 记录启动日\n                state = 1;\n                lossState = 0;\n                startDate = daily.trade_date;\n                startIndex = i;\n                tranPrice = daily.close;\n            } else if (state === 1) {\n                // 检查是否调整止损状态\n            }\n        }\n        let days = [\n            index - readyIndex + 1,\n            state === 0 ? 0 : index - startIndex + 1,\n        ];\n\n        let stateMemo;\n        if (state === 0) {\n            stateMemo = `还未突破目标价格${startPrice}，等待交易`;\n        } else if (state === 1) {\n            stateMemo = `已经进入交易${startDate}，交易持续${days[1]}天`;\n        }\n        return {\n            tsCode,\n            dataIndex: index,\n            date: tradeDate,\n            tradeType: \"signal\",\n            hasSignals: true,\n            signal: state === 0 ? \"READY\" : \"BUY\",\n            type: \"holp\",\n            holp: {\n                state,\n                lossState,\n                days,\n                targets: [startPrice, lossTarget],\n                tran: [startDate, tranPrice],\n            },\n            memo: `HOLP信号，[${data.trade_date}最低点，持续${days[0]}天，${stateMemo}]`,\n        };\n    }\n}\n\nfunction checkBuyTransaction(stockInfo, balance, index, stockData, options) {\n    debug(`检查HOLP买入：${index}, ${balance}`);\n    if (balance <= 0) return;\n}\n\nfunction checkSellTransaction(stockInfo, stock, index, stockData, options) {\n    if (_.isNil(stock) || stock.count <= 0) return;\n}\n\n/**\n * 返回参数配置的显示信息\n * @param {*}} opions 参数配置\n */\nfunction showOptions(options) {\n    let opt = options && options.holp;\n    // let buy = opt && options.squeeze.buy;\n    // let sell = opt && options.squeeze.sell;\n    return `\n模型 ${holp.name}[${holp.label}] 参数：无\n`;\n}\n\nasync function createReports(results, options) {\n    if (_.isNil(results)) return;\n\n    let reports = [];\n    let readyList = results && results[\"READY\"];\n    let days = [{ label: \"全部\", data: [] }];\n    if (!_.isEmpty(readyList)) {\n        for (let item of readyList) {\n            days[0].data.push(item.tsCode);\n        }\n        reports.push({ label: \"READY\", data: days });\n    }\n\n    let buyList = results && results[\"BUY\"];\n    let bdays = [{ label: \"全部\", data: [] }];\n    if (!_.isEmpty(buyList)) {\n        for (let item of buyList) {\n            bdays[0].data.push(item.tsCode);\n        }\n        reports.push({ label: \"BUY\", data: bdays });\n    }\n\n    // let reports = {\n    //     READY: days,\n    //     BUY: bdays,\n    // };\n\n    return reports;\n}\n\nconst holp = {\n    name: \"低点反转\",\n    label: RULE_NAME,\n\n    description: \"HOLP低点反转\",\n    methodTypes: {},\n    checkBuyTransaction,\n    checkSellTransaction,\n    check,\n    showOptions,\n    createReports,\n};\n\nexport default holp;\n","/**\n * RSI 指标，相对强弱指标\n *\n * 参数\n *  n: 表示平均天数\n *  digits: 保留小数位数\n *\n * RSI = 100-[1/1+（avg(gain)/avg(loss)]\n */\n\nimport _ from \"lodash\";\nimport utils from \"../utils\";\n\n/**\n * 计算RSI指标\n * @param {Array} tradeData 数据数组\n * @param {*} options 参数配置，RSI包含n属性\n */\nfunction rsi(tradeData, { n = 4, digits = 3 } = {}) {\n    utils.checkTradeData(tradeData);\n\n    if (\n        _.isEmpty(tradeData) ||\n        !_.isArray(tradeData) ||\n        tradeData.length <= 0\n    ) {\n        return;\n    }\n\n    let change;\n    // let gain = [];\n    // let loss = [];\n    let avgGain = [];\n    let avgLoss = [];\n    let ret = [];\n    if (!_.isNil(tradeData) && !_.isEmpty(tradeData)) {\n        let a = 1.0 / n;\n        let sumGain = 0;\n        let sumLoss = 0;\n        for (let i = 0; i < tradeData.length; i++) {\n            if (i <= n) {\n                avgGain[i] = 0;\n                avgLoss[i] = 0;\n            }\n            change = tradeData[i].close - tradeData[i].pre_close;\n            let gain = change >= 0 ? change : 0.0;\n            let loss = change <= 0 ? -change : 0.0;\n\n            if (i <= n - 1) {\n                sumGain += gain;\n                sumLoss += loss;\n                if (i === n - 1) {\n                    avgGain[i] = sumGain / n;\n                    avgLoss[i] = sumLoss / n;\n                    ret[i] = 100 - 100 / (1 + avgGain[i] / avgLoss[i]);\n                }\n            } else {\n                avgGain[i] = a * gain + a * (n - 1) * avgGain[i - 1];\n                avgLoss[i] = a * loss + a * (n - 1) * avgLoss[i - 1];\n                ret[i] = 100 - 100 / (1 + avgGain[i] / avgLoss[i]);\n            }\n\n            // console.log(\n            //     `${tradeData[i].trade_date}, ${tradeData[i].close}, ${\n            //         avgGain[i]\n            //     }, ${avgLoss[i]}, ${ret[i] && ret[i].toFixed(2)}`\n            // );\n        }\n        // let avgGain = utils.ma(gain, n, null, \"ma\", digits);\n        // let avgLoss = utils.ma(loss, n, null, \"ma\", digits);\n\n        // return avgLoss.map((loss, index) => {\n        //     let ret = 0;\n        //     if (avgLoss[index] === 0) {\n        //         ret = 100.0;\n        //     } else {\n        //         ret = 100 - 100 / (1 + avgGain[index] / avgLoss[index]);\n        //     }\n        //     console.log(\n        //         `${tradeData[index].trade_date}, ${tradeData[index].close}, ${avgGain[index]}, ${avgLoss[index]}`\n        //     );\n        //     return ret;\n        // });\n    }\n    return ret;\n}\n\nexport default {\n    name: \"RSI\",\n    label: \"相对强弱指标\",\n    description: \"用于表达价格的超买超卖情况\",\n    calculate: rsi,\n};\n","import _ from \"lodash\";\nimport engine from \"../transaction-engine\";\nimport trans from \"../transaction\";\nimport RSI from \"../indicators/rsi\";\nimport MA from \"../indicators/ma\";\n\nimport debugpkg from \"debug\";\nconst debug = debugpkg(\"rules:rsi\");\n\nconst OPTIONS_NAME = \"rsi\";\nconst RULE_NAME = \"rsi\";\nconst RSI_DATA = Symbol(\"RSI_DATA\");\nconst MA_DATA = Symbol(\"MA_DATA\");\n\nfunction calculateData(stockData, options) {\n    if (_.isNil(stockData)) return;\n\n    if (_.isNil(stockData[RSI_DATA])) {\n        stockData[RSI_DATA] = RSI.calculate(stockData, {\n            n: options.rsi.n,\n            digits: options.rsi.digits,\n        });\n    }\n    if (_.isNil(stockData[MA_DATA])) {\n        stockData[MA_DATA] = MA.calculate(stockData, {\n            n: options.rsi.ma,\n            source: \"close\",\n            digits: options.rsi.digits,\n            type: \"ma\",\n        });\n    }\n}\n\nfunction check(index, stockData, options, tsCode) {\n    // let sdata = RSI.calculate(stockData, options.rsi);\n    calculateData(stockData, options);\n\n    if (\n        stockData &&\n        _.isArray(stockData) &&\n        index < stockData.length &&\n        index >= 0\n    ) {\n        let tradeDate = stockData[index].trade_date;\n        let rsiData = stockData[RSI_DATA];\n\n        if (checkBuyCondition(index, stockData, options)) {\n            // 买入信号\n            return {\n                tsCode,\n                dataIndex: index,\n                date: tradeDate,\n                tradeType: \"buy\",\n                hasSignals: true,\n                signal: \"BUY\",\n                type: \"rsi\",\n                memo: `RSI恐慌突破，买入 [${\n                    stockData[index].trade_date\n                }] ${rsiData[index].toFixed(2)}`,\n            };\n        }\n\n        if (checkSellCondition(index, stockData, options)) {\n            // 卖出信号\n            return {\n                tsCode,\n                dataIndex: index,\n                date: tradeDate,\n                hasSignals: true,\n                tradeType: \"sell\",\n                signal: \"SELL\",\n                type: \"rsi\",\n                memo: `RSI恐慌上穿，卖出 [${\n                    stockData[index].trade_date\n                }] ${rsiData[index].toFixed(2)}`,\n            };\n        }\n    }\n}\n\nfunction checkBuyCondition(index, stockData, options) {\n    let rsioptions = options && options[OPTIONS_NAME];\n    // 平均的计算日数\n    let n = rsioptions && rsioptions.n;\n\n    if (n < 1 || n - 1 > index) return false;\n    let rsiData = stockData[RSI_DATA];\n    let maData = stockData[MA_DATA];\n    let currentData = stockData[index];\n\n    // 首先需要ma日均线低于当前价格，说明走势趋向正确\n    if (maData && maData[index] && maData[index] > currentData.close)\n        return false;\n\n    // 判断rsi下穿\n    let long = rsioptions && rsioptions.long;\n    return (\n        rsiData &&\n        rsiData[index - 1] &&\n        rsiData[index] &&\n        rsiData[index - 1] >= long &&\n        rsiData[index] < long\n    );\n}\n\n/**\n * 检查买入条件\n * @param {*} stockInfo 股票信息\n * @param {double} balance 账户余额\n * @param {*} tradeDate 交易日期\n * @param {int} index 交易日数据索引位置\n * @param {*} stockData 数据\n * @param {*} options 算法参数\n */\nfunction checkBuyTransaction(stockInfo, balance, index, stockData, options) {\n    if (balance <= 0) return;\n    calculateData(stockData, options);\n    // debug(`买入检查: ${balance}, ${tradeDate}, %o, ${index}`, stockData);\n\n    let rsioptions = options && options[OPTIONS_NAME];\n    let long = rsioptions && rsioptions.long;\n    let currentData = stockData[index];\n    let targetPrice = currentData.close;\n    let tradeDate = stockData[index].trade_date;\n    let rsiData = stockData[RSI_DATA];\n    if (checkBuyCondition(index, stockData, options)) {\n        debug(\n            `买入条件检查${tradeDate}: ${targetPrice.toFixed(2)}[昨日 rsi: ${\n                rsiData[index - 1]\n            }, 今日rsi : ${rsiData[index]}, 穿越 ${long.toFixed(2)}\n            }]`\n        );\n        return trans.createBuyTransaction(\n            stockInfo,\n            tradeDate,\n            index,\n            balance,\n            targetPrice,\n            \"rsi\",\n            `RSI恐慌突破买入 ${targetPrice.toFixed(2)}, ${rsiData[\n                index\n            ].toFixed(2)}`\n        );\n    }\n\n    // let rsioptions = options && options[OPTIONS_NAME];\n    // // 平均的计算日数\n    // let n = rsioptions && rsioptions.n;\n\n    // if (n < 1 || n - 1 > index) return;\n    // let rsiData = stockData[RSI_DATA];\n    // let maData = stockData[MA_DATA];\n    // let currentData = stockData[index];\n    // let tradeDate = stockData[index].trade_date;\n\n    // // 首先需要ma日均线低于当前价格，说明走势趋向正确\n    // if (maData && maData[index] && maData[index] > currentData.close) return;\n\n    // // 判断rsi下穿\n    // let long = rsioptions && rsioptions.long;\n    // let targetPrice = currentData.close;\n    // if (\n    //     rsiData &&\n    //     rsiData[index - 1] &&\n    //     rsiData[index] &&\n    //     rsiData[index - 1] >= long &&\n    //     rsiData[index] < long\n    // ) {\n    // }\n}\n\nfunction checkSellCondition(index, stockData, options) {\n    let rsioptions = options && options[OPTIONS_NAME];\n    // 平均的计算日数\n    let n = rsioptions && rsioptions.n;\n\n    if (n < 1 || n - 1 > index) return false;\n    let rsiData = stockData[RSI_DATA];\n    let maData = stockData[MA_DATA];\n    let currentData = stockData[index];\n\n    // 首先需要ma日均线低于当前价格，说明走势趋向正确\n    if (maData && maData[index] && maData[index] > currentData.close)\n        return false;\n\n    // 判断rsi下穿\n    let short = rsioptions && rsioptions.short;\n    return (\n        rsiData &&\n        rsiData[index - 1] &&\n        rsiData[index] &&\n        rsiData[index - 1] <= short &&\n        rsiData[index] > short\n    );\n}\n\n/**\n * 检查是否可以生成卖出交易，如果可以卖出，产生卖出交易记录\n *\n * @param {*} info 股票信息\n * @param {*} stock 持仓信息\n * @param {*} index 今日数据索引位置\n * @param {*} stockData 日线数据\n * @param {*} options 算法参数\n */\nfunction checkSellTransaction(stockInfo, stock, index, stockData, options) {\n    if (_.isEmpty(stock) || stock.count <= 0) return;\n\n    let rsioptions = options && options[OPTIONS_NAME];\n    let short = rsioptions && rsioptions.short;\n    let currentData = stockData[index];\n    let tradeDate = currentData.trade_date;\n    let targetPrice = currentData.close;\n    let rsiData = stockData[RSI_DATA];\n\n    if (checkSellCondition(index, stockData, options)) {\n        debug(\n            `卖出条件检查${tradeDate}: ${targetPrice.toFixed(2)}[昨日 rsi: ${\n                rsiData[index - 1]\n            }, 今日rsi : ${rsiData[index]}, 上穿 ${short.toFixed(2)}\n            }]`\n        );\n        return trans.createSellTransaction(\n            stockInfo,\n            tradeDate,\n            index,\n            stock.count,\n            targetPrice,\n            \"rsi\",\n            `RSI恐慌卖出 ${targetPrice.toFixed(2)}, ${rsiData[index].toFixed(\n                2\n            )}`\n        );\n    }\n\n    // let rsioptions = options && options[OPTIONS_NAME];\n    // // 平均的计算日数\n    // let n = rsioptions && rsioptions.n;\n\n    // // 判断rsi下穿\n    // let short = rsioptions && rsioptions.short;\n    // let targetPrice = currentData.close;\n    // if (\n    //     rsiData &&\n    //     rsiData[index - 1] &&\n    //     rsiData[index] &&\n    //     rsiData[index - 1] <= short &&\n    //     rsiData[index] > short\n    // ) {\n    //     debug(\n    //         `卖出条件检查${tradeDate}: ${targetPrice.toFixed(2)}[昨日 rsi: ${\n    //             rsiData[index - 1]\n    //         }, 今日rsi : ${rsiData[index]}, 上穿 ${short.toFixed(2)}\n    //         }]`\n    //     );\n    //     return engine.createSellTransaction(\n    //         stockInfo,\n    //         tradeDate,\n    //         index,\n    //         stock.count,\n    //         targetPrice,\n    //         \"rsi\",\n    //         `RSI恐慌卖出 ${targetPrice.toFixed(2)}`\n    //     );\n    // }\n}\n\n/**\n * 将搜索得到的列表生成分析报表\n *\n * @param {*} results 搜索的匹配列表\n * @param {*} options 匹配使用的参数\n */\nasync function createReports(results, options) {\n    if (_.isNil(results)) return;\n\n    let reports = [];\n\n    let buyList = results && results[\"BUY\"];\n    let bdays = [{ label: \"全部\", data: [] }];\n    if (!_.isEmpty(buyList)) {\n        for (let item of buyList) {\n            bdays[0].data.push(item.tsCode);\n        }\n        reports.push({ label: \"买入\", data: bdays });\n    }\n\n    let sellList = results && results[\"SELL\"];\n    let sdays = [{ label: \"全部\", data: [] }];\n    if (!_.isEmpty(sellList)) {\n        for (let item of sellList) {\n            sdays[0].data.push(item.tsCode);\n        }\n        reports.push({ label: \"卖出\", data: sdays });\n    }\n\n    return reports;\n}\n\n/**\n * 返回参数配置的显示信息\n * @param {*}} opions 参数配置\n */\nfunction showOptions(options) {\n    return `\n模型 ${RSI_PANIC.name}[${RSI_PANIC.label}] 参数：\nRSI平均周期 [${options.rsi.n}]\n价格上涨均线天数 [${options.rsi.ma}]\n\nRSI突破买入下限: ${options.rsi.long}%\nRSI突破卖出上限: ${options.rsi.short}%\n`;\n}\n\nconst RSI_PANIC = {\n    name: \"RSI恐慌\",\n    label: RULE_NAME,\n\n    description: \"RSI恐慌买卖\",\n    methodTypes: {},\n    checkBuyTransaction,\n    checkSellTransaction,\n    check,\n    showOptions,\n    createReports,\n};\n\nexport default RSI_PANIC;\n","/**\n * WVF指标，Williams VIX Fix\n *\n * 参数\n *  n: 表示回看天数\n *  digits: 保留小数位数\n *\n * RSI = 100-[1/1+（avg(gain)/avg(loss)]\n */\n\nimport _ from \"lodash\";\nimport utils from \"../utils\";\n\n/**\n * 计算WVF指标\n * @param {Array} tradeData 数据数组\n * @param {*} options 参数配置，RSI包含n属性\n */\nfunction wvf(tradeData, { n = 4, digits = 3 } = {}) {\n    utils.checkTradeData(tradeData);\n\n    if (\n        _.isEmpty(tradeData) ||\n        !_.isArray(tradeData) ||\n        tradeData.length <= 0\n    ) {\n        return;\n    }\n\n    // wvf = ((highest(close, n)-low)/(highest(close, n)))*100\n    let wvf = [];\n    if (!_.isNil(tradeData) && !_.isEmpty(tradeData)) {\n        let highest = 0.0;\n        for (let i = 0; i < tradeData.length; i++) {\n            if (i < n - 1) {\n                continue;\n            }\n\n            highest = 0.0;\n            for (let j = 0; j < n; j++) {\n                let close = tradeData[i - j].close;\n                highest = highest >= close ? highest : close;\n            }\n            wvf[i] = (100.0 * (highest - tradeData[i].low)) / highest;\n        }\n    }\n    return wvf;\n}\n\nexport default {\n    name: \"WVF\",\n    label: \"VIX Fix\",\n    description: \"用于计算市场恐慌程度\",\n    calculate: wvf,\n};\n","import _ from \"lodash\";\nimport trans from \"../transaction\";\nimport WVF from \"../indicators/wvf\";\n\nimport debugpkg from \"debug\";\nimport utils from \"../utils\";\nconst debug = debugpkg(\"rules:vixfix\");\n\nconst OPTIONS_NAME = \"vixfix\";\nconst RULE_NAME = \"vixfix\";\nconst WVF_DATA = Symbol(\"WVF_DATA\");\n// const MA_DATA = Symbol(\"MA_DATA\");\n\n/**\n * VIX Fix中需要计算WVF，对应的布林带，对应的\n * @param {*} stockData\n * @param {*} options 配置参数\n */\nfunction calculateData(stockData, options) {\n    if (_.isNil(stockData)) return;\n\n    if (_.isNil(stockData[WVF_DATA])) {\n        let wvf = WVF.calculate(stockData, {\n            n: options.vixfix.n,\n            digits: options.vixfix.digits,\n        });\n\n        let boll = utils.boll(\n            wvf,\n            options.vixfix.bn,\n            options.vixfix.multi,\n            null,\n            options.vixfix.digits\n        );\n\n        stockData[WVF_DATA] = [wvf, boll];\n    }\n}\n\nfunction check(index, stockData, options, tsCode) {\n    calculateData(stockData, options);\n\n    if (\n        stockData &&\n        _.isArray(stockData) &&\n        index < stockData.length &&\n        index >= 0\n    ) {\n        let tradeDate = stockData[index].trade_date;\n        let [wvfData, bollData] = stockData[WVF_DATA];\n\n        if (checkBuyCondition(index, stockData, options)) {\n            // 买入信号\n            return {\n                tsCode,\n                dataIndex: index,\n                date: tradeDate,\n                tradeType: \"buy\",\n                hasSignals: true,\n                signal: \"BUY\",\n                type: \"WVF\",\n                memo: `WVF恐慌买入 [${stockData[index].trade_date}] ${wvfData[\n                    index\n                ].toFixed(2)}`,\n            };\n        }\n\n        if (checkSellCondition(index, stockData, options)) {\n            // 卖出信号\n            return {\n                tsCode,\n                dataIndex: index,\n                date: tradeDate,\n                hasSignals: true,\n                tradeType: \"sell\",\n                signal: \"SELL\",\n                type: \"WVF\",\n                memo: `WVF恐慌卖出 [${stockData[index].trade_date}] ${wvfData[\n                    index\n                ].toFixed(2)}`,\n            };\n        }\n    }\n}\n\nfunction checkBuyCondition(index, stockData, options) {\n    let wvfoptions = options && options[OPTIONS_NAME];\n    // 检查WVF最大值的回看天数\n    let lbn = (wvfoptions && wvfoptions.lbn) || 50;\n    let ph = (wvfoptions && wvfoptions.ph) || 0.9; // 默认90%\n\n    if (lbn < 1 || lbn > index) return false;\n    let [wvfData, bollData] = stockData[WVF_DATA];\n\n    // let currentData = stockData[index];\n\n    // 买入条件主要是 wvf 超过 boll上限；或者wvf超过最近一段时间最高wvf的ph倍\n    if (wvfData[index] >= bollData[index][1]) return true;\n    let rangeHigh = utils.highest(wvfData, index, lbn + 1, null) * ph;\n    if (wvfData[index] >= rangeHigh) return true;\n\n    return false;\n}\n\n/**\n * 检查买入条件\n * @param {*} stockInfo 股票信息\n * @param {double} balance 账户余额\n * @param {*} tradeDate 交易日期\n * @param {int} index 交易日数据索引位置\n * @param {*} stockData 数据\n * @param {*} options 算法参数\n */\nfunction checkBuyTransaction(stockInfo, balance, index, stockData, options) {\n    if (balance <= 0) return;\n    calculateData(stockData, options);\n    // debug(`买入检查: ${balance}, ${tradeDate}, %o, ${index}`, stockData);\n\n    // let wvfoptions = options && options[OPTIONS_NAME];\n    let currentData = stockData[index];\n    let targetPrice = currentData.close;\n    let tradeDate = stockData[index].trade_date;\n    let [wvfData, bollData] = stockData[WVF_DATA];\n    if (checkBuyCondition(index, stockData, options)) {\n        debug(\n            `买入条件检查${tradeDate}: ${targetPrice.toFixed(\n                2\n            )} [WVF: ${wvfData[index].toFixed(2)}, boll上限 ${bollData[\n                index\n            ][1].toFixed(2)}]`\n        );\n        return trans.createBuyTransaction(\n            stockInfo,\n            tradeDate,\n            index,\n            balance,\n            targetPrice,\n            \"WVF\",\n            `WVF恐慌买入 ${targetPrice.toFixed(2)}, ${wvfData[index].toFixed(\n                2\n            )}`\n        );\n    }\n}\n\nfunction checkSellCondition(index, stockData, options) {\n    return false;\n}\n\n/**\n * 检查是否可以生成卖出交易，如果可以卖出，产生卖出交易记录\n *\n * @param {*} info 股票信息\n * @param {*} stock 持仓信息\n * @param {*} index 今日数据索引位置\n * @param {*} stockData 日线数据\n * @param {*} options 算法参数\n */\nfunction checkSellTransaction(stockInfo, stock, index, stockData, options) {\n    // if (_.isEmpty(stock) || stock.count <= 0) return;\n    // if (checkSellCondition(index, stockData, options)) {\n    //     debug(\n    //         `卖出条件检查${tradeDate}: ${targetPrice.toFixed(2)}[昨日 rsi: ${\n    //             rsiData[index - 1]\n    //         }, 今日rsi : ${rsiData[index]}, 上穿 ${short.toFixed(2)}\n    //         }]`\n    //     );\n    //     return trans.createSellTransaction(\n    //         stockInfo,\n    //         tradeDate,\n    //         index,\n    //         stock.count,\n    //         targetPrice,\n    //         \"WVF\",\n    //         `WVF恐慌卖出 ${targetPrice.toFixed(2)}, ${rsiData[index].toFixed(\n    //             2\n    //         )}`\n    //     );\n    // }\n}\n\n/**\n * 将搜索得到的列表生成分析报表\n *\n * @param {*} results 搜索的匹配列表\n * @param {*} options 匹配使用的参数\n */\nasync function createReports(results, options) {\n    if (_.isNil(results)) return;\n\n    let reports = [];\n\n    let buyList = results && results[\"BUY\"];\n    let bdays = [{ label: \"全部\", data: [] }];\n    if (!_.isEmpty(buyList)) {\n        for (let item of buyList) {\n            bdays[0].data.push(item.tsCode);\n        }\n        reports.push({ label: \"买入\", data: bdays });\n    }\n\n    return reports;\n}\n\n/**\n * 返回参数配置的显示信息\n * @param {*}} opions 参数配置\n */\nfunction showOptions(options) {\n    return `\n模型 ${WVF_PANIC.name}[${WVF_PANIC.label}] 参数：\nWVF计算周期 [${options.vixfix.n}]\n\nWVF布林带参数 [天数: ${options.vixfix.bn}, 倍数: ${options.vixfix.multi} ]\n\nWVF交易值检查 [周期: ${options.vixfix.lbn}, 最大值倍数: ${\n        options.vixfix.ph * 100\n    }%]\n`;\n}\n\nconst WVF_PANIC = {\n    name: \"WVF恐慌\",\n    label: RULE_NAME,\n\n    description: \"WVF恐慌买卖\",\n    methodTypes: {},\n    checkBuyTransaction,\n    checkSellTransaction,\n    check,\n    showOptions,\n    createReports,\n};\n\nexport default WVF_PANIC;\n","/**\n * 每日指标，Everyday，这里将几个指标组合用于选股和展示\n * 指标包括：\n * 1. TTM\n * 2. Squeeze\n * 3. WVF（Boll and OSC）\n *\n * 参数：\n *  1. 趋势配置\n *    limit: 0.0\n *    trendLB: 3\n *    usewb: false\n *    sqzLongLevel: 2\n *    longLevel: 2\n *    shortLevel: 2\n *    minTotoalTrend: 2\n *  2. Squeeze参数\n *    source: ohlc | close\n *    useTR: true\n *    ma: ma | ema\n *    sqzLength: 20\n *    multBB: 2\n *    multKC: 1.5\n *    mtmLen: 12\n *    mtmSmooth: 1\n *  3. WVF\n *    pd: 22\n *    bbl: 20\n *    mult: 2.0\n *    lb: 50\n *    ph: 0.85\n *    oscn: 14\n *    oscup: 85.0\n *    oscdn: 20.0\n *    oscSmooth: 5\n *  ditis: 3\n *\n */\nimport _ from \"lodash\";\nimport MA from \"./ma\";\nimport BOLL from \"./boll\";\nimport MTM from \"./mtm\";\nimport KC from \"./keltner-channel\";\nimport WVF from \"./wvf\";\nimport utils from \"../utils\";\n\nconst BUY = \"BUY\";\nconst SELL = \"SELL\";\nconst UP = \"UP\";\nconst DOWN = \"DOWN\";\n\nfunction subtract(array1, array2, digits) {\n    if (\n        _.isEmpty(array1) ||\n        _.isEmpty(array2) ||\n        array1.length !== array2.length\n    ) {\n        return;\n    }\n\n    return array1.map((item, i, all) => {\n        if (digits) {\n            return utils.toFixed(item - array2[i], digits);\n        } else {\n            return item - array2[i];\n        }\n    });\n}\n\nfunction everyday(\n    tradeData,\n    {\n        limit = 0.0,\n        trendLB = 3,\n        usewb = false,\n        sqzLongLevel = 2,\n        longLevel = 2,\n        shortLevel = 2,\n        minTotalTrend = 2,\n\n        source = \"ohlc\",\n        //useTR = true,\n        ma = \"ma\",\n        sqzLength = 20,\n        multBB = 2,\n        multKC = 1.5,\n        mtmLen = 12,\n        mtmSmooth = 1,\n\n        pd = 22,\n        bbl = 20,\n        mult = 2.0,\n        lb = 50,\n        ph = 0.85,\n        oscn = 14,\n        oscup = 85.0,\n        oscdn = 20.0,\n        oscSmooth = 5,\n\n        digits = 3,\n    } = {}\n) {\n    utils.checkTradeData(tradeData);\n\n    // TTMWave\n    // wave A\n    // let n = 8;\n    let fastMA = utils.ma(tradeData, 8, \"close\", \"ema\", digits + 5);\n\n    let slowMA1 = utils.ma(tradeData, 34, \"close\", \"ema\", digits + 5);\n    let macd1 = subtract(fastMA, slowMA1);\n    let signal1 = utils.ma(macd1, 34, null, \"ema\", digits + 5);\n    let hist1 = subtract(macd1, signal1, digits);\n\n    // let fastMA2 = utils.ma(tradeData, 8, \"close\", \"ema\", digits);\n    let slowMA2 = utils.ma(tradeData, 55, \"close\", \"ema\", digits + 5);\n    let macd2 = subtract(fastMA, slowMA2);\n    let signal2 = utils.ma(macd2, 55, null, \"ema\", digits + 5);\n    let hist2 = subtract(macd2, signal2, digits);\n\n    // wave B\n    // let fastMA3 = utils.ma(tradeData, 8, \"close\", \"ema\", digits);\n    let slowMA3 = utils.ma(tradeData, 89, \"close\", \"ema\", digits + 5);\n    let macd3 = subtract(fastMA, slowMA3);\n    let signal3 = utils.ma(macd3, 89, null, \"ema\", digits + 5);\n    let hist3 = subtract(macd3, signal3, digits);\n\n    // let fastMA4 = utils.ma(tradeData, 8, \"close\", \"ema\", digits);\n    let slowMA4 = utils.ma(tradeData, 144, \"close\", \"ema\", digits + 5);\n    let macd4 = subtract(fastMA, slowMA4);\n    let signal4 = utils.ma(macd4, 144, null, \"ema\", digits + 5);\n    let hist4 = subtract(macd4, signal4, digits);\n\n    // wave C\n    // let fastMA5 = utils.ma(tradeData, 8, \"close\", \"ema\", digits);\n    let slowMA5 = utils.ma(tradeData, 233, \"close\", \"ema\", digits + 5);\n    let macd5 = subtract(fastMA, slowMA5);\n    let signal5 = utils.ma(macd5, 233, null, \"ema\", digits + 5);\n    let hist5 = subtract(macd5, signal5, digits);\n\n    // let fastMA6 = utils.ma(tradeData, 8, \"close\", \"ema\", digits);\n    let slowMA6 = utils.ma(tradeData, 377, \"close\", \"ema\", digits + 5);\n    let macd6 = subtract(fastMA, slowMA6, digits);\n    // let signal6 =  utils.ma(macd6, 377, null, \"ema\", digits);\n    // let hist6 =  subtract(macd6, signal6, digits) ;\n\n    // TODO\n    // 利用TTMWave，需要计算 sTrend, mTrend, lTrend，以及组合的trendSignal和ttmTrend，共5个指标\n    // 期中 trendSignal(sTrend, mTrend, lTrend)主要由趋势进行判断；而ttmTrend主要由取值是否为正判断\n    let sTrend = [];\n    let mTrend = [];\n    let lTrend = [];\n    let trendSignal = [];\n    let ttmTrend = [];\n\n    // Squeeze\n    let bollData = BOLL.calculate(tradeData, {\n        n: sqzLength,\n        m: multBB,\n        ma,\n        source,\n        digits,\n    });\n    let kcData = KC.calculate(tradeData, {\n        n: sqzLength,\n        m: multKC,\n        type1: ma,\n        type2: ma,\n        source,\n        digits,\n    });\n\n    let mtmData = MTM.calculate(tradeData, {\n        n: mtmLen,\n        m: 1,\n        source: \"close\",\n        digits,\n    });\n    let mtmVal = utils.ma(mtmData, mtmSmooth, null, \"ma\", digits);\n    let sqzState = [];\n    let mtmState = [];\n\n    let sqzBuySignal = [];\n    let sqzSellSignal = [];\n    for (let i = 0; i < tradeData.length; i++) {\n        // TTM 趋势计算\n        let h1t = hist1[i] - utils.nz(hist1, i - 1) >= 0;\n        let h1tl = hist1[i] - utils.nz(hist1, i - 1) >= limit;\n        let h2t = hist2[i] - utils.nz(hist2, i - 1) >= 0;\n        let h2tl = hist2[i] - utils.nz(hist2, i - 1) >= limit;\n        let shortTrend = h1t && h2t ? 2 : h1tl || h2tl ? 1 : 0;\n\n        let h1tLB = hist1[i] - utils.nz(hist1, i - trendLB) >= 0;\n        let h1tlLB = hist1[i] - utils.nz(hist1, i - trendLB) >= limit;\n        let h2tLB = hist2[i] - utils.nz(hist2, i - trendLB) >= 0;\n        let h2tlLB = hist2[i] - utils.nz(hist2, i - trendLB) >= limit;\n        let shortTrendLB = h1tLB && h2tLB ? 2 : h1tlLB || h2tlLB ? 1 : 0;\n\n        sTrend[i] =\n            shortTrend != 0 && shortTrendLB != 0 ? 2 : shortTrend != 0 ? 1 : 0;\n\n        let h3t = hist3[i] - utils.nz(hist3, i - 1) >= 0;\n        let h3tl = hist3[i] - utils.nz(hist3, i - 1) >= limit;\n        let h4t = hist4[i] - utils.nz(hist4, i - 1) >= 0;\n        let h4tl = hist4[i] - utils.nz(hist4, i - 1) >= limit;\n        let middleTrend = h3t && h4t ? 2 : h3tl || h4tl ? 1 : 0;\n\n        let h3tLB = hist3[i] - utils.nz(hist3, i - trendLB) >= 0;\n        let h3tlLB = hist3[i] - utils.nz(hist3, i - trendLB) >= limit;\n        let h4tLB = hist4[i] - utils.nz(hist4, i - trendLB) >= 0;\n        let h4tlLB = hist4[i] - utils.nz(hist4, i - trendLB) >= limit;\n        let middleTrendLB = h3tLB && h4tLB ? 2 : h3tlLB || h4tlLB ? 1 : 0;\n\n        mTrend[i] =\n            middleTrend != 0 && middleTrendLB != 0\n                ? 2\n                : middleTrend != 0 || middleTrendLB != 0\n                ? 1\n                : 0;\n\n        let h5t = hist5[i] - utils.nz(hist5, i - 1) >= 0;\n        let h5tl = hist5[i] - utils.nz(hist5, i - 1) >= limit;\n        let h6t = macd6[i] - utils.nz(macd6, i - 1) >= 0;\n        let h6tl = macd6[i] - utils.nz(macd6, i - 1) >= limit;\n        let longTrend = h5t && h6t ? 2 : h5tl || h6tl ? 1 : 0;\n\n        let h5tLB = hist5[i] - utils.nz(hist5, i - trendLB) >= 0;\n        let h5tlLB = hist5[i] - utils.nz(hist5, i - trendLB) >= limit;\n        let h6tLB = macd6[i] - utils.nz(macd6, i - trendLB) >= 0;\n        let h6tlLB = macd6[i] - utils.nz(macd6, i - trendLB) >= limit;\n        let longTrendLB = h5tLB && h6tLB ? 2 : h5tlLB || h6tlLB ? 1 : 0;\n\n        lTrend[i] =\n            longTrend != 0 && longTrendLB != 0\n                ? 2\n                : longTrend != 0 || longTrendLB != 0\n                ? 1\n                : 0;\n\n        trendSignal[i] = sTrend[i] + (usewb ? mTrend[i] : lTrend[i]);\n        // 中长期趋势，主要表达进入上升还是下降阶段\n        ttmTrend[i] =\n            (hist3[i] && hist3[i] >= 0 ? 1 : 0) +\n            (hist4[i] && hist4[i] >= 0 ? 1 : 0) +\n            (hist5[i] && hist5[i] >= 0 ? 1 : 0) +\n            (macd6[i] && macd6[i] >= 0 ? 1 : 0);\n\n        // squeeze状态\n        let upperBB = bollData && bollData[1] && bollData[1][i];\n        let upperKC = kcData && kcData[1] && kcData[1][i];\n        let sqzOn = upperBB && upperKC && upperBB < upperKC;\n        // let sqzOff = upperBB && upperKC && upperBB >= upperKC;\n        // let noSqz = sqzOn == false && sqzOff == false;\n        sqzState[i] = sqzOn ? 1 : 0;\n        mtmState[i] =\n            mtmVal && mtmVal[i] && mtmVal[i] > 0\n                ? i > 0 &&\n                  mtmVal &&\n                  mtmVal[i] &&\n                  mtmVal[i - 1] &&\n                  mtmVal[i] > mtmVal[i - 1]\n                    ? 1\n                    : 2\n                : i > 0 &&\n                  mtmVal &&\n                  mtmVal[i] &&\n                  mtmVal[i - 1] &&\n                  mtmVal[i] < mtmVal[i - 1]\n                ? -1\n                : -2;\n\n        sqzBuySignal[i] =\n            i > 0 &&\n            sqzState[i] === 0 &&\n            sqzState[i - 1] === 1 &&\n            mtmVal[i] >= 0 &&\n            mtmVal[i] > utils.nz(mtmVal, i - 1) &&\n            trendSignal[i] >= longLevel\n                ? 2\n                : sqzState[i] === 1 &&\n                  mtmVal[i] >= 0 &&\n                  mtmVal[i] > utils.nz(mtmVal, i - 1) &&\n                  trendSignal[i] >= sqzLongLevel\n                ? 1\n                : 0;\n\n        sqzSellSignal[i] =\n            sqzState[i] === 0 &&\n            utils.nz(sqzState, i - 1) === 1 &&\n            !(mtmVal[i] >= 0 && mtmVal[i] >= utils.nz(mtmVal, i - 1))\n                ? 2\n                : sqzState[i] === 1 && (shortTrend === 0 || shortTrendLB === 0)\n                ? 1\n                : 0;\n    }\n\n    // WVF\n    let wvf = WVF.calculate(tradeData, { n: pd, digits });\n    let wvfma = MA.calculate(wvf, {\n        n: bbl,\n        type: \"ma\",\n        source: null,\n        digits,\n    });\n    let rangeHigh = [];\n\n    let ohc = [];\n    let olc = [];\n    let osc = [];\n    let oscMA = [];\n\n    let wvfStdev = utils.stdev(wvf, bbl, null, digits);\n    let wvfup = [];\n    let wvfdown = [];\n    let wvfSignal1 = [];\n    let wvfSignal2 = [];\n    let wvfSignal = [];\n    let oscSignal1 = [];\n    let oscSignal2 = [];\n    let oscSignal = [];\n    let oscFilter = [];\n\n    let wvfBuySignal = [];\n    let longCondition = [];\n    let shortCondition = [];\n    for (let i = 0; i < wvfma.length; i++) {\n        rangeHigh[i] = utils.highest(wvf, i, lb, null, digits);\n        ohc[i] = utils.highest(wvf, i, oscn, null, digits);\n        olc[i] = utils.lowest(wvf, i, oscn, null, digits);\n        wvfup[i] = utils.toFixed(wvfma[i] + mult * wvfStdev[i], digits);\n        wvfdown[i] = utils.toFixed(wvfma[i] - mult * wvfStdev[i], digits);\n\n        rangeHigh[i] =\n            rangeHigh && rangeHigh[i] ? rangeHigh[i] * ph : rangeHigh[i];\n\n        osc[i] =\n            wvf[i] && olc[i] && ohc[i] && ohc[i] - olc[i] != 0\n                ? (100.0 * (wvf[i] - olc[i])) / (ohc[i] - olc[i])\n                : 0;\n        [, , oscMA[i]] = utils.linreg(osc, i, null, oscSmooth);\n\n        wvfSignal1[i] = wvf[i] >= wvfup[i] || wvf[i] >= rangeHigh[i] ? 1 : 0;\n        wvfSignal2[i] =\n            (utils.nz(wvf, i - 1) >= utils.nz(wvfup, i - 1) ||\n                utils.nz(wvf, i - 1) >= utils.nz(rangeHigh, i - 1)) &&\n            wvf[i] < wvfup[i] &&\n            wvf[i] < rangeHigh[i]\n                ? 1\n                : 0;\n        wvfSignal[i] = wvfSignal2[i];\n\n        oscSignal1[i] =\n            osc[i] && osc[i] > oscup ? 1 : osc[i] && osc[i] < oscdn ? -1 : 0;\n        oscSignal2[i] =\n            oscMA[i] && oscMA[i] > oscup\n                ? 1\n                : oscMA[i] && oscMA[i] < oscdn\n                ? -1\n                : 0;\n        oscFilter[i] = oscSignal1[i] === 1 || oscSignal2[i] === 1;\n        oscSignal[i] =\n            oscFilter[i] === false && utils.nz(oscFilter, i - 1, false) === true\n                ? 1\n                : 0;\n\n        wvfBuySignal[i] =\n            oscSignal[i] === 1 && wvfSignal[i] === 1\n                ? 2\n                : oscSignal[i] === 1 || wvfSignal[i] === 1\n                ? 1\n                : 0;\n        longCondition[i] =\n            trendSignal[i] >= longLevel &&\n            wvfBuySignal[i] !== 0 &&\n            sqzBuySignal[i] != 0 &&\n            ttmTrend[i] >= minTotalTrend\n                ? 2\n                : ((trendSignal[i] >= longLevel && wvfBuySignal[i] !== 0) ||\n                      sqzBuySignal[i] !== 0) &&\n                  ttmTrend[i] >= minTotalTrend\n                ? 1\n                : 0;\n\n        let mlTrend = usewb ? mTrend[i] : lTrend[i];\n        shortCondition[i] = sTrend[i] === 0 && mlTrend < shortLevel ? 1 : 0;\n    }\n\n    let len = tradeData.length;\n    // console.log(\n    //     `数据检查：${tradeData[len - 1].open}, ${rangeHigh[len - 1]}, ${\n    //         ohc[len - 1]\n    //     }, ${olc[len - 1]}, ${wvf[len - 1]}, ${osc[len - 1]}, ${\n    //         oscMA[len - 1]\n    //     }, ${oscMA[len - 2]}`\n    // );\n    // console.log(\n    //     `数据检查：${tradeData[len - 1].close}, ${\n    //         tradeData[len - 1 - 12].close\n    //     }, ${bollData[1][len - 1]}, ${kcData[1][len - 1]}, ${\n    //         sqzState[len - 1]\n    //     }, ${sqzState[len - 10]},${sqzState[len - 11]},${mtmState[len - 1]}, ${\n    //         mtmState[len - 2]\n    //     }, ${mtmState[len - 7]},${mtmState[len - 8]},  ${mtmVal[len - 1]}, ${\n    //         mtmVal[len - 2]\n    //     }`\n    // );\n    // console.log(\n    //     `数据检查：[${len}] ${\n    //         tradeData[len - 1] && tradeData[len - 1].trade_date\n    //     }, ${tradeData[len - 1] && tradeData[len - 1].close}, ${\n    //         tradeData[len - 1 - 89] && tradeData[len - 1 - 89].trade_date\n    //     }, ${tradeData[len - 1 - 89] && tradeData[len - 1 - 89].close}, ${\n    //         tradeData[len - 1 - 233] && tradeData[len - 1 - 233].trade_date\n    //     }, ${tradeData[len - 1 - 233] && tradeData[len - 1 - 233].close}, f=${\n    //         fastMA[len - 1]\n    //     }, sm3=${slowMA3[len - 1]}, m3=${macd3[len - 1]}, s3=${\n    //         signal3[len - 1]\n    //     }, h3=${hist3[len - 1]}, sm5=${slowMA5[len - 1]}, m5=${\n    //         macd5[len - 1]\n    //     }, s5=${signal5[len - 1]}, h5=${hist5[len - 1]}`\n    // );\n\n    return [\n        longCondition, // 0\n        shortCondition, // 1\n        trendSignal, // 2\n        ttmTrend, // 3\n        sqzBuySignal, // 4\n        sqzSellSignal, // 5\n        wvfBuySignal, // 6\n        oscSignal, // 7\n        undefined, // 8\n        undefined, // 9\n        undefined, // 10\n\n        // 11 开始放置TTM相关信息\n        sTrend, // 11\n        mTrend, // 12\n        lTrend, // 13\n        wvfSignal1, // 14\n        wvfSignal2, // 15\n        oscSignal1, // 16\n        oscSignal2, // 17\n        undefined, // 18\n        undefined, // 19\n        undefined, // 20\n\n        // 21开始放置TTM波数值\n        hist1, // 21\n        hist2, // 22\n        hist3, // 23\n        hist4, // 24\n        hist5, // 25\n        macd6, // 26\n        undefined, // 27\n        undefined, // 28\n        undefined, // 29\n        undefined, // 30\n\n        // 31 开始放置鸡排数据\n        sqzState, // 31\n        mtmState, // 32\n        mtmVal, // 33\n        undefined, // 34\n        undefined, // 35\n        undefined, // 36\n        undefined, // 37\n        undefined, // 38\n        undefined, // 39\n        undefined, // 40\n\n        // 41 开始放置WVF数据\n        wvf, // 41\n        wvfma, // 42\n        wvfup, // 43\n        wvfdown, // 44\n        osc, // 45\n        oscMA, // 46\n    ];\n}\n\nexport default {\n    name: \"EVERYDAY\",\n    label: \"每日\",\n    description: \"每日指标\",\n    calculate: everyday,\n    states: {},\n};\n","import EVERYDAY from \"../indicators/everyday\";\nimport _ from \"lodash\";\nimport trans from \"../transaction\";\nimport debugpkg from \"debug\";\n\nconst debug = debugpkg(\"rules:everyday\");\n\nconst RULE_NAME = \"everyday\";\nconst EVERYDAY_DATA = Symbol(\"EVERYDAY_DATA\");\n\nfunction check(index, stockData, options, tsCode) {\n    let sdata = EVERYDAY.calculate(stockData, options.everyday);\n\n    if (\n        stockData &&\n        _.isArray(stockData) &&\n        index < stockData.length &&\n        index >= 0\n    ) {\n        let tradeDate = stockData[index].trade_date;\n        let longCond = sdata[0];\n        let shortCond = sdata[1];\n\n        //         console.log(`\n        // ${tsCode}: [${tradeDate}] 买入条件=${longCond[index]}，卖出条件=${shortCond[index]}\n        //     TTM: trendSignal=${sdata[2][index]}, ttmTrend=${sdata[3][index]},\n        //     Signal: sqzBuy=${sdata[4][index]}, sqzSell=${sdata[5][index]}, wvfBuy=${sdata[6][index]}, osc=${sdata[7][index]}\n\n        //     Wave: hist1=${sdata[21][index]} hist2=${sdata[22][index]} hist3=${sdata[23][index]} hist4=${sdata[24][index]} hist5=${sdata[25][index]} hist6=${sdata[26][index]}\n        //     SQZ: state=${sdata[31][index]} mtm=${sdata[32][index]} mtmVal=${sdata[33][index]}\n        //     WVF: wvf=${sdata[41][index]} osc=${sdata[45][index]}\n        //         `);\n\n        if (longCond[index] != 0) {\n            // 有信号\n            return {\n                tsCode,\n                dataIndex: index,\n                date: tradeDate,\n                tradeType: \"buy\",\n                hasSignals: true,\n                signal: \"BUY\",\n                type: \"everyday\",\n                everyday: {},\n                memo: `每日规则买入 [${stockData[index].trade_date} ${longCond[index]}]`,\n            };\n        } else if (shortCond[index] != 0) {\n            return {\n                tsCode,\n                dataIndex: index,\n                date: tradeDate,\n                hasSignals: true,\n                tradeType: \"sell\",\n                signal: \"SELL\",\n                type: \"everyday\",\n                everyday: {},\n                memo: `每日规则卖出 [${stockData[index].trade_date} ${shortCond[index]}]`,\n            };\n        }\n    }\n}\n\nfunction calculateData(stockData, options) {\n    if (_.isNil(stockData)) return;\n\n    let len =\n        stockData &&\n        stockData[EVERYDAY_DATA] &&\n        stockData[EVERYDAY_DATA][0] &&\n        stockData[EVERYDAY_DATA][0].length;\n    if (_.isNil(stockData[EVERYDAY_DATA]) || stockData.length != len) {\n        stockData[EVERYDAY_DATA] = EVERYDAY.calculate(\n            stockData,\n            options.squeeze\n        );\n    }\n}\n\nfunction checkBuyTransaction(stockInfo, balance, index, stockData, options) {\n    debug(`检查每日买入：${index}, ${balance}`);\n    if (balance <= 0) return;\n    calculateData(stockData, options);\n\n    if (index < 1) return;\n    // 检查今天index的条件\n    let sdata = stockData[EVERYDAY_DATA];\n    let longCond = sdata[0];\n\n    // debug(`%o`, squeeze);\n    // debug(`检查买入规则：${squeeze_today}, ${squeeze_lday}`);\n    if (longCond[index] != 0) {\n        let currentData = stockData[index];\n        let tradeDate = currentData.trade_date;\n        let targetPrice = currentData.close;\n        return trans.createBuyTransaction(\n            stockInfo,\n            tradeDate,\n            index,\n            balance,\n            targetPrice,\n            RULE_NAME,\n            `每日规则买入 ${targetPrice.toFixed(2)}`\n        );\n    }\n}\n\nfunction checkSellTransaction(stockInfo, stock, index, stockData, options) {\n    if (_.isNil(stock) || stock.count <= 0) return;\n    calculateData(stockData, options);\n\n    if (index < 1) return;\n    // 检查今天index的条件\n    let sdata = stockData[EVERYDAY_DATA];\n    let shortCond = sdata[1];\n    if (shortCond && shortCond[index] != 0) {\n        let currentData = stockData[index];\n        let tradeDate = currentData.trade_date;\n        let targetPrice = currentData.close;\n        return trans.createSellTransaction(\n            stockInfo,\n            tradeDate,\n            index,\n            stock.count,\n            targetPrice,\n            RULE_NAME,\n            `每日规则卖出 ${targetPrice.toFixed(2)}`\n        );\n    }\n}\n\n/**\n * 返回参数配置的显示信息\n * @param {*}} opions 参数配置\n */\nfunction showOptions(options) {\n    let opt = options && options.everyday;\n    return `\n模型 ${everyday.name}[${everyday.label}] 参数：目前使用默认参数\n\n`;\n}\n\n/**\n * 将搜索得到的列表生成分析报表\n *\n * @param {*} results 搜索的匹配列表\n * @param {*} options 匹配使用的参数\n */\nasync function createReports(results, options) {\n    if (_.isNil(results)) return;\n\n    let reports = [];\n    // results 当中按照signal进行了分组\n    // 下面主要分析signal===\"READY\"情况下，时间的分布\n    let buyList = results && results[\"BUY\"];\n    let sellList = results && results[\"SELL\"];\n\n    let types = [{ label: \"全部\", data: [] }];\n    if (!_.isEmpty(buyList)) {\n        for (let item of buyList) {\n            types[0].data.push(item.tsCode);\n        }\n        reports.push({ label: \"BUY\", data: types });\n    }\n\n    types = [{ label: \"全部\", data: [] }];\n    if (!_.isEmpty(sellList)) {\n        for (let item of sellList) {\n            types[0].data.push(item.tsCode);\n        }\n        reports.push({ label: \"SELL\", data: types });\n    }\n\n    return reports;\n}\n\nconst everyday = {\n    name: \"每日规则\",\n    label: RULE_NAME,\n\n    description: \"每日规则模型模型\",\n    methodTypes: {},\n    checkBuyTransaction,\n    checkSellTransaction,\n    check,\n    showOptions,\n    createReports,\n};\n\nexport default everyday;\n","/**\n * 基本动量指标\n *\n * 参数：\n *  n: 短期平均天数\n *  m: 长期平均天数\n *  source: hl, ohlc\n */\n\nimport _ from \"lodash\";\nimport utils from \"../utils\";\n\nfunction ao(tradeData, options) {\n    utils.checkTradeData(tradeData);\n\n    if (\n        !_.isEmpty(tradeData) &&\n        _.isArray(tradeData) &&\n        tradeData.length > 0 &&\n        options &&\n        options.n >= 1 &&\n        options.m >= 1\n    ) {\n        let source =\n            options && options.source === \"ohlc\" ? utils.ohlc : utils.hl;\n        let digits = options.digits || 3;\n\n        let ma1 = utils.ma(tradeData, options.n, source, \"ma\", digits);\n        let ma2 = utils.ma(tradeData, options.m, source, \"ma\", digits);\n\n        let momentum = tradeData.map((item, i, all) => {\n            if (i >= options.n && i > options.m) {\n                return utils.toFixed(ma1[i] - ma2[i], digits);\n            } else {\n                return 0;\n            }\n        });\n        return momentum;\n    }\n}\n\nexport default {\n    name: \"AO\",\n    label: \"动量震动指标\",\n    description: \"比尔威廉姆斯动量振荡器指标\",\n    calculate: ao,\n};\n","/**\n * TTM Trend\n * 暂未完成，这个部分书上的描述并不清晰，对于如何比较前六个柱价格和当前柱的关系无法准确确定\n *\n * 摘抄：\n * 这项技术将前6根柱状线价格做平均。如果前面6根柱状线的平均价格位于交易区间的上半部分，\n * 则把当前柱状线涂成蓝色，代表偏向看涨和稳定的买方压力。然而，如果前面6根柱状线的平均\n * 价格位于交易区间的下半部分，那么当前柱状线将被涂成红色，代表偏向看跌和稳定的卖方压力。\n *\n * 参数\n *  n: 6 过去的天数\n *  type: TTM | HA\n */\nimport _ from \"lodash\";\nimport utils from \"../utils\";\n\nconst HADATA = Symbol(\"HADATA\");\n\n// 这里需要预先计算好HA的4个价格，并且进行记录，主要是open价格和前一日的HA开盘及收盘相关\nfunction calculateHA(tradeData) {\n    if (_.isNil(tradeData)) return;\n    if (\n        _.isNil(tradeData[HADATA]) ||\n        (tradeData && tradeData.length != tradeData[HADATA].length)\n    ) {\n        // 计算\n        let hadata = [];\n        for (let i = 0; i < tradeData.length; i++) {\n            if (i === 0) {\n                let ho = tradeData[i].open;\n                hadata[i] = {\n                    open: tradeData[i].open,\n                    high: tradeData[i].high,\n                    low: tradeData[i].low,\n                    close: tradeData[i].close,\n                };\n            } else {\n                hadata[i] = {\n                    open: (hadata[i - 1].open + hadata[i - 1].close) / 2,\n                    high: tradeData[i].high,\n                    low: tradeData[i].low,\n                    close:\n                        (tradeData[i].open +\n                            tradeData[i].high +\n                            tradeData[i].low +\n                            tradeData[i].close) /\n                        4,\n                };\n                hadata[i].high = Math.max(\n                    hadata[i].high,\n                    hadata[i].open,\n                    hadata[i].close\n                );\n                hadata[i].low = Math.min(\n                    hadata[i].low,\n                    hadata[i].open,\n                    hadata[i].close\n                );\n            }\n        }\n        tradeData[HADATA] = hadata;\n    }\n}\n\n/**\n * 计算每日的趋势情况，返回值设置为涨或跌，用1和0表示\n * @param {*} tradeData 所有数据\n * @param {*} options 参数，n 平均周期, type 平均类型, digits 保留小数位数\n */\nfunction ttmtrend(tradeData, { n = 6, type = \"TTM\" } = {}) {\n    utils.checkTradeData(tradeData);\n    calculateHA(tradeData);\n\n    let trends = [];\n    // TTM暂未实现，只能给出HA结果！\n    type = \"HA\";\n    if (!_.isNil(tradeData) && !_.isEmpty(tradeData)) {\n        for (let i = 0; i < tradeData.length; i++) {\n            let data = tradeData[i];\n            let up = data.close >= data.open;\n\n            let trend;\n            if (type === \"TTM\") {\n                if (i === 0) {\n                    trend =\n                        (tradeData[0].open + tradeData[0].close) / 2 >=\n                        (tradeData[0].high + tradeData[0].low) / 2\n                            ? 1\n                            : 0;\n                } else {\n                    // let hl = (data.high + data.low) / 2;\n                    let avg = 0;\n                    let high = 0;\n                    let low = Number.MAX_VALUE;\n                    let len = 0;\n                    for (let j = 0; j < n; j++) {\n                        if (i - j - 1 >= 0) {\n                            let ld = tradeData[i - j - 1];\n                            avg += (ld.open + ld.close) / 2;\n                            high = Math.max(high, ld.high);\n                            low = Math.min(low, ld.low);\n                            len++;\n                        } else {\n                            break;\n                        }\n                    }\n                    avg = avg / len / 2;\n                    let hl = (high + low) / 2;\n                    trend = hl >= avg;\n                }\n            } else if (type === \"HA\") {\n                // HA pattern\n                if (i > 0) {\n                    // let o =\n                    //     (tradeData[i - 1].open + tradeData[i - 1].close) / 2;\n                    // let c =\n                    //     (tradeData[i].open +\n                    //         tradeData[i].high +\n                    //         tradeData[i].low +\n                    //         tradeData[i].close) /\n                    //     4;\n                    let hadata = tradeData[HADATA];\n                    // if (!(hadata && hadata[i]) && i > 0) {\n                    //     hadata[i] = {\n                    //         open:\n                    //             (hadata[i - 1].open + hadata[i - 1].close) / 2,\n                    //         high: tradeData[i].high,\n                    //         low: tradeData[i].low,\n                    //         close:\n                    //             (tradeData[i].open +\n                    //                 tradeData[i].high +\n                    //                 tradeData[i].low +\n                    //                 tradeData[i].close) /\n                    //             4,\n                    //     };\n                    //     hadata[i].high = Math.max(\n                    //         hadata[i].high,\n                    //         hadata[i].open,\n                    //         hadata[i].close\n                    //     );\n                    //     hadata[i].low = Math.min(\n                    //         hadata[i].low,\n                    //         hadata[i].open,\n                    //         hadata[i].close\n                    //     );\n                    // }\n                    let o = hadata[i].open;\n                    let c = hadata[i].close;\n                    //up = c >= o;\n                    // 1/0表示正常升降，3/2表示修改升降\n                    trend = c >= o;\n                }\n                //trends[i] = up;\n            }\n\n            if (up) {\n                trends[i] = trend ? 1 : 2;\n            } else {\n                trends[i] = trend ? 3 : 0;\n            }\n        }\n    }\n\n    return trends;\n}\n\nexport default {\n    name: \"TTM趋势\",\n    label: \"TTMTrend\",\n    description: \"将前几日的市场情况纳入到对今日趋势的判断中\",\n    calculate: ttmtrend,\n};\n","/**\n * 抢帽子警报，内容非常简单，连续三个收盘价涨/跌作为警报，警报放在第一根线（3个连续的第一个）\n */\n\nimport _ from \"lodash\";\n\nconst REST = \"--\";\nconst BUY_READY = \"BUY_READY\";\nconst SELL_READY = \"SELL_READY\";\nconst BUY = \"BUY\";\nconst SELL = \"SELL\";\n\nfunction scalper(tradeData) {\n    let retData = [];\n    if (!_.isNil(tradeData) && !_.isEmpty(tradeData)) {\n        let currentState = REST;\n        for (let i = 0; i < tradeData.length; i++) {\n            if (i < 2) {\n                retData[i] = [\n                    tradeData[i].trade_date,\n                    REST,\n                    tradeData[i].close,\n                ];\n            } else {\n                let data = tradeData[i];\n                let data1 = tradeData[i - 1];\n                let data2 = tradeData[i - 2];\n                if (\n                    currentState !== BUY &&\n                    data.close > data1.close &&\n                    data1.close > data2.close\n                ) {\n                    // UP\n                    retData[i - 2] = [data2.trade_date, BUY_READY, data2.low];\n                    retData[i - 1] = [data1.trade_date, BUY, data2.close];\n                    retData[i] = [data.trade_date, BUY, data.close];\n                    currentState = BUY;\n                } else if (\n                    currentState !== SELL &&\n                    data.close < data1.close &&\n                    data1.close < data2.close\n                ) {\n                    retData[i - 2] = [data2.trade_date, SELL_READY, data2.high];\n                    retData[i - 1] = [data1.trade_date, SELL, data2.close];\n                    retData[i] = [data.trade_date, SELL, data.close];\n                    currentState = SELL;\n                } else {\n                    retData[i] = [data.trade_date, currentState, data.close];\n                }\n            }\n        }\n    }\n\n    return retData;\n}\n\nexport default {\n    name: \"Scalper\",\n    label: \"抢帽子\",\n    description: \"抢帽子警报\",\n    calculate: scalper,\n    states: {\n        REST,\n        BUY_READY,\n        SELL_READY,\n        BUY,\n        SELL,\n    },\n};\n","/**\n * 自选列表\n */\nconst { getDataRoot } = require(\"@wt/lib-wtda-query\");\nconst _ = require(\"lodash\");\nconst moment = require(\"moment\");\n\nconst path = require(\"path\");\nconst fs = require(\"fs\");\nconst fp = fs.promises;\n\nasync function readFavorites() {\n    let retData = {\n        updateTime: null,\n        favorites: [],\n        // 下面考虑放个字段说明\n    };\n\n    try {\n        let dataFile = getFavoritesFile();\n        try {\n            retData = JSON.parse(await fp.readFile(dataFile, \"utf-8\"));\n        } catch (error) {\n            // 文件不存在，不考虑其它错误\n            if (!(error && error.code === \"ENOENT\")) {\n                console.error(\n                    `读取自选文件${dataFile}时发生错误：${error}, %o`,\n                    error\n                );\n            } else {\n                console.error(`读取自选文件${dataFile}不存在，%o`, error);\n            }\n        }\n    } catch (error) {\n        console.error(`从本地读取自选数据发生错误 ${error}`);\n    }\n    return retData;\n}\n\nfunction getFavoritesFile() {\n    return path.join(getDataRoot(), \"favorites.json\");\n}\n\nasync function removeFavorites(tsCodes) {\n    let retData = await readFavorites();\n    if (_.isEmpty(tsCodes)) return retData;\n\n    let newCodes = [];\n    if (_.isArray(tsCodes)) {\n        if (tsCodes.length <= 0) return retData;\n        newCodes = tsCodes;\n    } else {\n        newCodes.push(tsCodes);\n    }\n\n    if (_.isEmpty(retData)) {\n        retData = { updateTime: null, favorites: [] };\n    }\n\n    if (_.isEmpty(retData.favorites) || !_.isArray(retData.favorites)) {\n        retData.favorites = [];\n    }\n\n    for (let newCode of newCodes) {\n        for (let i in retData.favorites) {\n            if (retData.favorites[i] === newCode) {\n                retData.favorites.splice(i, 1);\n                break;\n            }\n        }\n    }\n\n    retData.updateTime = moment().toISOString();\n    await saveFavorites(retData);\n    return retData;\n}\n\nasync function addFavorites(tsCodes) {\n    let retData = await readFavorites();\n    if (_.isEmpty(tsCodes)) return retData;\n\n    let newCodes = [];\n    if (_.isArray(tsCodes)) {\n        if (tsCodes.length <= 0) return retData;\n        newCodes = tsCodes;\n    } else {\n        newCodes.push(tsCodes);\n    }\n\n    if (_.isEmpty(retData)) {\n        retData = { updateTime: null, favorites: [] };\n    }\n\n    if (_.isEmpty(retData.favorites) || !_.isArray(retData.favorites)) {\n        retData.favorites = [];\n    }\n\n    for (let newCode of newCodes) {\n        let found = false;\n        for (let code of retData.favorites) {\n            if (code === newCode) {\n                found = true;\n                break;\n            }\n        }\n        if (!found) retData.favorites.push(newCode);\n    }\n\n    retData.updateTime = moment().toISOString();\n    await saveFavorites(retData);\n    return retData;\n}\n\nasync function saveFavorites(data) {\n    try {\n        let jsonStr = JSON.stringify(data);\n        let favoritesPath = getFavoritesFile();\n\n        await fp.writeFile(favoritesPath, jsonStr, { encoding: \"utf-8\" });\n    } catch (error) {\n        throw new Error(\"保存列表数据时出现错误，请检查后重新执行：\" + error);\n    }\n}\n\nexport default { addFavorites, removeFavorites, readFavorites };\n","// const simulate = require(\"./simulator\");\nimport simulate from \"./simulator\";\nimport search from \"./search\";\nimport engine from \"./transaction-engine\";\nimport * as reports from \"./reports\";\n\nimport benchmark from \"./rules/benchmark-basic\";\nimport mmb from \"./rules/momentum-breakthrough\";\nimport stoploss from \"./rules/stoploss\";\nimport outsideday from \"./rules/outsideday\";\nimport opensell from \"./rules/opensell\";\nimport smashday from \"./rules/smashday\";\nimport squeeze from \"./rules/squeeze\";\nimport swing from \"./rules/swing\";\nimport holp from \"./rules/holp\";\nimport rsi from \"./rules/rsi-panic\";\nimport vixfix from \"./rules/vixfix\";\nimport everyday from \"./rules/Everyday\";\n\nimport MA from \"./indicators/ma\";\nimport ATR from \"./indicators/atr\";\nimport KC from \"./indicators/keltner-channel\";\nimport BOLL from \"./indicators/boll\";\nimport MTM from \"./indicators/mtm\";\nimport AO from \"./indicators/ao\";\nimport SQUEEZE from \"./indicators/squeeze\";\nimport TTMWave from \"./indicators/ttmwave\";\nimport TTMTrend from \"./indicators/ttmtrend\";\nimport Scalper from \"./indicators/scalper\";\nimport RSI from \"./indicators/rsi\";\nimport WVF from \"./indicators/wvf\";\nimport EVERYDAY from \"./indicators/everyday\";\nimport utils from \"./utils\";\n\nimport favorites from \"./favorites\";\n\nconst indicators = {\n    MA,\n    ATR,\n    KC,\n    BOLL,\n    MTM,\n    AO,\n    SQUEEZE,\n    TTMWave,\n    TTMTrend,\n    Scalper,\n    RSI,\n    WVF,\n    EVERYDAY,\n};\n\nconst rules = {\n    mmb,\n    stoploss,\n    benchmark,\n    outsideday,\n    opensell,\n    smashday,\n    squeeze,\n    swing,\n    holp,\n    rsi,\n    vixfix,\n    everyday,\n};\n\nexport {\n    simulate,\n    search,\n    engine,\n    rules,\n    reports,\n    indicators,\n    utils,\n    favorites,\n};\n"],"names":["ORGANIZED","Symbol","ADJUSTED","checkTradeData","data","digits","_","isEmpty","isArray","checkOrder","reverse","prevadj_factor","calculatePrevAdjPrice","dailyData","length","forEach","item","origin","open","close","high","low","pre_close","change","toFixed","readData","prop","isFunction","isString","tr","ohlc","hl","num","Number","array","isObject","has","trade_date","average","index","n","Array","desc","step","lastIndex","i","count","sum","highest","tmp","Math","max","lowest","min","ma","type","sma","ema","ret","val","abs","boll","multi","std","stdev","up","down","d","j","sqrt","formatFxstr","toLocaleString","nz","pos","defaultVal","isNil","linreg","len","sumX","sumY","sumXSqr","sumXY","per","slope","avg","intercept","debug","debugpkg","executeTransaction","stockData","capitalData","options","translog","tradeDate","stockInfo","info","sellRules","rules","sell","buyRules","buy","stocks","stockId","stock","sold","rule","name","checkSellTransaction","transeq","executeCapitalSettlement","utils","price","total","commission","fee","duty","memo","fixCash","cash","balance","initBalance","checkBuyTransaction","_transeq","ts_code","push","splice","settledlog","date","profit","income","transactions","createSellTransaction","tradeDateIndex","methodType","calculateTransactionFee","dateIndex","amount","createBuyTransaction","parseInt","exchange","parseCapitalReports","count_win","total_win","count_loss","total_loss","total_profit","total_fee","max_profit","max_loss","average_profit","average_win","average_loss","max_wintimes","max_losstimes","max_windays","max_lossdays","average_windays","average_lossdays","selltypes","ror_win","ror_loss","ror","tmp_cost","tmp_cost_win","tmp_cost_loss","currentType","tmp_times","tmp_windays","tmp_lossdays","log","days","selltype","times","win_times","loss_times","showCapitalReports","stockvalue","capitalResult","showTransactions","logTransaction","holdlog","parseWorkdayReports","results","day","win_ratio","win","loss_ratio","loss","ratio_winloss","max_win","trans","moment","res","showWorkdayReports","reports","grid","CG","CGS","Style","columns","id","align","rows","report","workday","red","win_average","green","loss_average","cyan","profit_average","option","render","console","showOptionsInfo","buys","usedRules","label","sells","rules_desc","showOptions","startDate","simulate","stockListData","readStockList","stockList","filterStockList","stockItem","readStockData","stockDataNames","daily","updateTime","format","filterStockData","currentDate","isAfter","engine","showTrans","showWorkdays","selectedStocks","map","tsCode","filter","findIndex","slice","path","require","fs","fp","promises","match","includeSell","search","allSignals","prepareStockData","matched","check","hasSignals","foundSignals","tradeType","signal","toISOString","dupList","needDupList","ruleData","createReports","stateList","codeList","code","dupReports","unshift","saveReports","getReportsFile","join","getDataRoot","jsonStr","JSON","stringify","filePath","writeFile","encoding","error","Error","readReports","retData","dataFile","parse","readFile","all","RULE_NAME","currentData","targetPrice","bmoptions","priceType","sellPrice","benchmark","description","methodTypes","OPTIONS_NAME","checkMMBBuyTransaction","mmboptions","N","P","mmbType","checkMMBSellTransaction","nommb1","nommb2","L","mmb","mmb1","mmb2","checkStoplossTransaction","S","lossPrice","stoploss","data2","data1","outsideday","opensell","smashday","dataIndex","validDays","smashType","smash1","smash2","tradeData","source","calculate","atr","keltner","MA","type1","ATR","type2","m","mtm","momentum","c","cl","subtract","array1","array2","ttmwave","la","useb","mb","lb","usec","mc","lc","fastMA1","slowMA1","macd1","signal1","hist1","fastMA2","slowMA2","macd2","signal2","hist2","fastMA3","slowMA3","macd3","signal3","hist3","fastMA4","slowMA4","macd4","signal4","hist4","fastMA5","slowMA5","macd5","signal5","hist5","fastMA6","slowMA6","macd6","signal6","hist6","READY","REST","BUY","SELL","squeeze","mtsource","km","bm","mt","mn","mm","tn","tm","tl","kcData","KC","bollData","BOLL","mtmData","MTM","waveData","TTMWave","mmData","currentState","states","ready","mmUp","nextState","SQUEEZE_DATA","TTMWAVE_DATA","checkTTM","upTrend","downTrend","ups","downs","sdata","SQUEEZE","need_condition_days","needCond","condition_days","cond","checkDays","trends","needSell","trade_days","state","ready_days","calculateSqueeze","squeeze_today","squeeze_lday","opt","readyList","buyList","bdays","buy_days","SWING_DATA","calculateSwing","l","earn1","earn2","ma1","ma2","ma3","swingData","started","lossState","target","ruleTarget","lossTarget","pullback_days","targets","checkSwing","swing","tran","minIndex","maxIndex","readyIndex","startPrice","startIndex","tranPrice","stateMemo","holp","rsi","avgGain","avgLoss","a","sumGain","sumLoss","gain","RSI_DATA","MA_DATA","calculateData","RSI","rsiData","checkBuyCondition","checkSellCondition","rsioptions","maData","long","short","sellList","sdays","RSI_PANIC","wvf","WVF_DATA","WVF","vixfix","bn","wvfData","wvfoptions","lbn","ph","rangeHigh","WVF_PANIC","everyday","limit","trendLB","usewb","sqzLongLevel","longLevel","shortLevel","minTotalTrend","sqzLength","multBB","multKC","mtmLen","mtmSmooth","pd","bbl","mult","oscn","oscup","oscdn","oscSmooth","fastMA","sTrend","mTrend","lTrend","trendSignal","ttmTrend","mtmVal","sqzState","mtmState","sqzBuySignal","sqzSellSignal","h1t","h1tl","h2t","h2tl","shortTrend","h1tLB","h1tlLB","h2tLB","h2tlLB","shortTrendLB","h3t","h3tl","h4t","h4tl","middleTrend","h3tLB","h3tlLB","h4tLB","h4tlLB","middleTrendLB","h5t","h5tl","h6t","h6tl","longTrend","h5tLB","h5tlLB","h6tLB","h6tlLB","longTrendLB","upperBB","upperKC","sqzOn","wvfma","ohc","olc","osc","oscMA","wvfStdev","wvfup","wvfdown","wvfSignal1","wvfSignal2","wvfSignal","oscSignal1","oscSignal2","oscSignal","oscFilter","wvfBuySignal","longCondition","shortCondition","mlTrend","undefined","EVERYDAY_DATA","EVERYDAY","longCond","shortCond","types","ao","HADATA","calculateHA","hadata","ho","ttmtrend","trend","MAX_VALUE","ld","o","BUY_READY","SELL_READY","scalper","readFavorites","favorites","getFavoritesFile","removeFavorites","tsCodes","newCodes","newCode","saveFavorites","addFavorites","found","favoritesPath","indicators","AO","TTMTrend","Scalper"],"mappings":"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fJ;IAsBH9U,QAAAA;IAtBG,OAAP;IAwBH;IACJ,GA3DkD;IA8DnD;IACA;IACA;IAEA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IAEA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IAEA;IACA;IACA;IACA;IAEA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IAEA;IACA;IACA;IACA;IACA;IACA;IAEA;IACA;IACA;IAEA;IACA;IACA;IAEA;IACA;IACA;IACA;IAEA;IACA;IACA;IACA;IACA;IAEA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IAEA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IAEA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;;IACH;;IAED,SAAS4I,OAAT,CAAezN,KAAf,EAAsBkD,SAAtB,EAAiCE,OAAjC,EAA0CsJ,MAA1C,EAAkD;IAC9C,MAAIvL,GAAG,GAAGyY,UAAU,CAAC5Z,KAAD,EAAQkD,SAAR,EAAmBE,OAAnB,EAA4BsJ,MAA5B,CAApB,CAD8C;;IAG9C,MAAI,CAACvL,GAAL,EAAU,OAHoC;;IAK9C,MAAIA,GAAG,CAAC0Y,KAAJ,KAAc1Y,GAAG,CAAC0Y,KAAJ,CAAU3B,KAAV,KAAoB,CAApB,IAAyB/W,GAAG,CAAC0Y,KAAJ,CAAU3B,KAAV,KAAoB,CAA3D,CAAJ,EAAmE;IAC/D,WAAO/W,GAAP;IACH;IACJ;IAGD;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IAEA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;;;IAEA,SAAS+D,qBAAT,CAA6B3B,SAA7B,EAAwCyB,OAAxC,EAAiDhF,KAAjD,EAAwDkD,SAAxD,EAAmEE,OAAnE,EAA4E;IACxEL,EAAAA,OAAK,CAAE,UAAS/C,KAAM,KAAIgF,OAAQ,EAA7B,CAAL;IACA,MAAIA,OAAO,IAAI,CAAf,EAAkB;IAElB6T,EAAAA,cAAc,CAAC3V,SAAD,EAAYE,OAAO,IAAIA,OAAO,CAACyW,KAA/B,CAAd;IAEA,MAAIT,SAAS,GAAGlW,SAAS,CAAC0V,UAAD,CAAT,IAAyB1V,SAAS,CAAC0V,UAAD,CAAT,CAAsB,CAAtB,CAAzC;;IACA,MACIQ,SAAS,IACTrb,qBAAC,CAACE,OAAF,CAAUmb,SAAV,CADA,IAEApZ,KAAK,GAAGoZ,SAAS,CAAC7a,MAFlB,IAGAyB,KAAK,IAAI,CAJb,EAKE;IACE,QAAInC,IAAI,GAAGub,SAAS,CAACpZ,KAAD,CAApB;IACA+C,IAAAA,OAAK,CAAE,oBAAmB/C,KAAM,MAA3B,EAAkCnC,IAAlC,CAAL;;IACA,QAAI,CAACE,qBAAC,CAACC,OAAF,CAAUH,IAAI,CAAC0L,KAAf,CAAL,EAA4B;IACxB,UAAIoG,WAAW,GAAGzM,SAAS,CAAClD,KAAD,CAA3B;IACA,UAAIsD,SAAS,GAAGqM,WAAW,CAAC7P,UAA5B;;IACA,WAAK,IAAIga,IAAT,IAAiBjc,IAAI,CAAC0L,KAAtB,EAA6B;IACzB,YAAIuQ,IAAI,CAAC9Y,IAAL,KAAc,KAAlB,EAAyB;IACrB,cAAI4O,WAAW,GAAGkK,IAAI,CAACtV,KAAvB;IACA,iBAAO+E,KAAK,CAACrD,oBAAN,CACH3C,SADG,EAEHD,SAFG,EAGHtD,KAHG,EAIHgF,OAJG,EAKH4K,WALG,EAMHF,WANG,EAOF,QAAOE,WAAW,CAAC3Q,OAAZ,CAAoB,CAApB,CAAuB,EAP5B,CAAP;IASH;IACJ;IACJ;IACJ;IACJ;;IAED,SAASmF,sBAAT,CAA8Bb,SAA9B,EAAyCS,KAAzC,EAAgDhE,KAAhD,EAAuDkD,SAAvD,EAAkEE,OAAlE,EAA2E;IACvEL,EAAAA,OAAK,CAAE,UAAS/C,KAAM,KAAIgE,KAAK,CAACzD,KAAM,EAAjC,CAAL;IACA,MAAIxC,qBAAC,CAACqE,KAAF,CAAQ4B,KAAR,KAAkBA,KAAK,CAACzD,KAAN,IAAe,CAArC,EAAwC;IAExCsY,EAAAA,cAAc,CAAC3V,SAAD,EAAYE,OAAO,IAAIA,OAAO,CAACyW,KAA/B,CAAd;IAEA,MAAIT,SAAS,GAAGlW,SAAS,CAAC0V,UAAD,CAAT,IAAyB1V,SAAS,CAAC0V,UAAD,CAAT,CAAsB,CAAtB,CAAzC;;IACA,MACIQ,SAAS,IACTrb,qBAAC,CAACE,OAAF,CAAUmb,SAAV,CADA,IAEApZ,KAAK,GAAGoZ,SAAS,CAAC7a,MAFlB,IAGAyB,KAAK,IAAI,CAJb,EAKE;IACE,QAAInC,IAAI,GAAGub,SAAS,CAACpZ,KAAD,CAApB;IACA+C,IAAAA,OAAK,CAAE,oBAAmB/C,KAAM,MAA3B,EAAkCnC,IAAlC,CAAL;;IACA,QAAI,CAACE,qBAAC,CAACC,OAAF,CAAUH,IAAI,CAAC0L,KAAf,CAAL,EAA4B;IACxB,UAAIoG,WAAW,GAAGzM,SAAS,CAAClD,KAAD,CAA3B;IACA,UAAIsD,SAAS,GAAGqM,WAAW,CAAC7P,UAA5B;;IACA,WAAK,IAAIga,IAAT,IAAiBjc,IAAI,CAAC0L,KAAtB,EAA6B;IACzB,YAAIuQ,IAAI,CAAC9Y,IAAL,KAAc,MAAlB,EAA0B;IACtB,cAAI4O,WAAW,GAAGkK,IAAI,CAACtV,KAAvB;IACA,iBAAO+E,KAAK,CAAC3D,qBAAN,CACHrC,SADG,EAEHD,SAFG,EAGHtD,KAHG,EAIHgE,KAAK,CAACzD,KAJH,EAKHqP,WALG,EAMHF,WANG,EAOF,QAAOE,WAAW,CAAC3Q,OAAZ,CAAoB,CAApB,CAAuB,EAP5B,CAAP;IASH;IACJ;IACJ;IACJ;IACJ;IAED;;;;;;IAIA,SAASoM,aAAT,CAAqBjI,OAArB,EAA8B;IAC1B,MAAImV,GAAG,GAAGnV,OAAO,IAAIA,OAAO,CAACyW,KAA7B;IACA,SAAQ;KACPA,KAAK,CAAC1V,IAAK,IAAG0V,KAAK,CAAC3O,KAAM;OACxBqN,GAAG,CAACtY,CAAE,WAAUsY,GAAG,CAAChG,CAAE;OACtBgG,GAAG,CAACS,KAAJ,GAAY,GAAI;OAChBT,GAAG,CAACnP,IAAJ,GAAW,GAAI;SACbmP,GAAG,CAACQ,KAAJ,GAAY,GAAI;CALrB;IAOH;;IAED,eAAe7K,eAAf,CAA6BnF,OAA7B,EAAsC3F,OAAtC,EAA+C;IAC3C,MAAIrF,qBAAC,CAACqE,KAAF,CAAQ2G,OAAR,CAAJ,EAAsB;IAEtB,MAAIY,OAAO,GAAG,EAAd;IAEA,MAAI6O,SAAS,GAAGzP,OAAO,IAAIA,OAAO,CAAC,OAAD,CAAlC;IACA,MAAIZ,IAAI,GAAG,CAAC;IAAE+C,IAAAA,KAAK,EAAE,IAAT;IAAerN,IAAAA,IAAI,EAAE;IAArB,GAAD,CAAX;;IACA,MAAI,CAACE,qBAAC,CAACC,OAAF,CAAUwa,SAAV,CAAL,EAA2B;IACvB,SAAK,IAAI/Z,IAAT,IAAiB+Z,SAAjB,EAA4B;IACxBrQ,MAAAA,IAAI,CAAC,CAAD,CAAJ,CAAQtK,IAAR,CAAawH,IAAb,CAAkB5G,IAAI,CAACiO,MAAvB;IACH;;IACD/C,IAAAA,OAAO,CAACtE,IAAR,CAAa;IAAE6F,MAAAA,KAAK,EAAE,OAAT;IAAkBrN,MAAAA,IAAI,EAAEsK;IAAxB,KAAb;IACH;;IAED,MAAIsQ,OAAO,GAAG1P,OAAO,IAAIA,OAAO,CAAC,UAAD,CAAhC;IACA,MAAI2P,KAAK,GAAG,CAAC;IAAExN,IAAAA,KAAK,EAAE,IAAT;IAAerN,IAAAA,IAAI,EAAE;IAArB,GAAD,CAAZ;;IACA,MAAI,CAACE,qBAAC,CAACC,OAAF,CAAUya,OAAV,CAAL,EAAyB;IACrB,SAAK,IAAIha,IAAT,IAAiBga,OAAjB,EAA0B;IACtBC,MAAAA,KAAK,CAAC,CAAD,CAAL,CAAS7a,IAAT,CAAcwH,IAAd,CAAmB5G,IAAI,CAACiO,MAAxB;IACH;;IACD/C,IAAAA,OAAO,CAACtE,IAAR,CAAa;IAAE6F,MAAAA,KAAK,EAAE,UAAT;IAAqBrN,MAAAA,IAAI,EAAE6a;IAA3B,KAAb;IACH,GArB0C;IAwB3C;IACA;IACA;;;IAEA,SAAO/O,OAAP;IACH;;IAED,MAAMkQ,KAAK,GAAG;IACV1V,EAAAA,IAAI,EAAE,MADI;IAEV+G,EAAAA,KAAK,EAAEwE,WAFG;IAIVO,EAAAA,WAAW,EAAE,MAJH;IAKVC,EAAAA,WAAW,EAAE,EALH;IAMVhL,uBAAAA,qBANU;IAOVd,wBAAAA,sBAPU;IAQVqJ,SAAAA,OARU;IASVpC,eAAAA,aATU;IAUV6C,iBAAAA;IAVU,CAAd;;ICllBA;;;;;;;;;;IAiBA,MAAMnL,OAAK,GAAGC,4BAAQ,CAAC,YAAD,CAAtB;IAEA;;;;;IAIA,MAAM0M,WAAS,GAAG,MAAlB;;IAEA,SAASjC,OAAT,CAAezN,KAAf,EAAsBkD,SAAtB,EAAiCE,OAAjC,EAA0CsJ,MAA1C,EAAkD;IAC9C;IACA,MACI3O,qBAAC,CAACqE,KAAF,CAAQc,SAAR,KACAnF,qBAAC,CAACC,OAAF,CAAUkF,SAAV,CADA,IAEAA,SAAS,CAAC3E,MAAV,GAAmB,EAFnB,IAGAyB,KAAK,GAAG,EAJZ,EAKE;IACE;IACH;;IAED,MAAIc,GAAG,GAAGoC,SAAS,CAAClD,KAAD,CAAT,CAAiBlB,GAA3B;IACA,MAAIib,QAAQ,GAAG/Z,KAAf;IACA,MAAIY,GAAG,GAAGsC,SAAS,CAAClD,KAAD,CAAT,CAAiBnB,IAA3B;IACA,MAAImb,QAAQ,GAAGha,KAAf;;IACA,OAAK,IAAIM,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,EAApB,EAAwBA,CAAC,EAAzB,EAA6B;IACzB,QAAIN,KAAK,GAAGM,CAAR,GAAY,CAAZ,GAAgB,CAApB,EAAuB;;IACvB,QAAI4C,SAAS,CAAClD,KAAK,GAAGM,CAAR,GAAY,CAAb,CAAT,CAAyBxB,GAAzB,IAAgCgC,GAApC,EAAyC;IACrCA,MAAAA,GAAG,GAAGoC,SAAS,CAAClD,KAAD,CAAT,CAAiBlB,GAAvB;IACAib,MAAAA,QAAQ,GAAG/Z,KAAK,GAAGM,CAAR,GAAY,CAAvB;IACH;;IACD,QAAI4C,SAAS,CAAClD,KAAK,GAAGM,CAAR,GAAY,CAAb,CAAT,CAAyBzB,IAAzB,IAAiC+B,GAArC,EAA0C;IACtCA,MAAAA,GAAG,GAAGsC,SAAS,CAAClD,KAAK,GAAGM,CAAR,GAAY,CAAb,CAAT,CAAyBzB,IAA/B;IACAmb,MAAAA,QAAQ,GAAGha,KAAK,GAAGM,CAAR,GAAY,CAAvB;IACH;IACJ;;IACDyC,EAAAA,OAAK,CAAE,MAAKjC,GAAI,MAAKiZ,QAAS,QAAOnZ,GAAI,MAAKoZ,QAAS,EAAlD,CAAL;IAEA,MAAI1W,SAAS,GAAGJ,SAAS,CAAClD,KAAD,CAAT,CAAiBF,UAAjC;IACAiD,EAAAA,OAAK,CAAE,GAAEO,SAAU,WAAUJ,SAAS,CAAC6W,QAAD,CAAT,CAAoBja,UAAW,EAAvD,CAAL;;IACA,MAAIE,KAAK,GAAG+Z,QAAR,IAAoB,CAApB,IAAyBA,QAAQ,GAAGC,QAAX,IAAuB,EAApD,EAAwD;IACpD;IACA,QAAIC,UAAU,GAAGF,QAAjB;IACA,QAAIlc,IAAI,GAAGqF,SAAS,CAAC+W,UAAD,CAApB;IACA,QAAI/B,KAAK,GAAG,CAAZ;IACA,QAAIoB,SAAS,GAAG,CAAhB;IACA,QAAIY,UAAU,GAAGrc,IAAI,CAACgB,IAAtB;IACA,QAAI4a,UAAU,GAAG5b,IAAI,CAACiB,GAAtB;IACA,QAAIwM,SAAJ;IACA,QAAI6O,UAAU,GAAG,CAAC,CAAlB;IACA,QAAIC,SAAJ;;IAEA,SAAK,IAAI9Z,CAAC,GAAG2Z,UAAU,GAAG,CAA1B,EAA6B3Z,CAAC,IAAIN,KAAlC,EAAyCM,CAAC,EAA1C,EAA8C;IAC1C,UAAIyL,KAAK,GAAG7I,SAAS,CAAC5C,CAAD,CAArB;;IACA,UAAI4X,KAAK,KAAK,CAAV,IAAenM,KAAK,CAAClN,IAAN,IAAcqb,UAAjC,EAA6C;IACzC;IACAhC,QAAAA,KAAK,GAAG,CAAR;IACAoB,QAAAA,SAAS,GAAG,CAAZ;IACAhO,QAAAA,SAAS,GAAGS,KAAK,CAACjM,UAAlB;IACAqa,QAAAA,UAAU,GAAG7Z,CAAb;IACA8Z,QAAAA,SAAS,GAAGrO,KAAK,CAACnN,KAAlB;IACH;IAGJ;;IACD,QAAIuJ,IAAI,GAAG,CACPnI,KAAK,GAAGia,UAAR,GAAqB,CADd,EAEP/B,KAAK,KAAK,CAAV,GAAc,CAAd,GAAkBlY,KAAK,GAAGma,UAAR,GAAqB,CAFhC,CAAX;IAKA,QAAIE,SAAJ;;IACA,QAAInC,KAAK,KAAK,CAAd,EAAiB;IACbmC,MAAAA,SAAS,GAAI,WAAUH,UAAW,OAAlC;IACH,KAFD,MAEO,IAAIhC,KAAK,KAAK,CAAd,EAAiB;IACpBmC,MAAAA,SAAS,GAAI,SAAQ/O,SAAU,QAAOnD,IAAI,CAAC,CAAD,CAAI,GAA9C;IACH;;IACD,WAAO;IACHuE,MAAAA,MADG;IAEH+E,MAAAA,SAAS,EAAEzR,KAFR;IAGHwF,MAAAA,IAAI,EAAElC,SAHH;IAIHsK,MAAAA,SAAS,EAAE,QAJR;IAKHF,MAAAA,UAAU,EAAE,IALT;IAMHG,MAAAA,MAAM,EAAEqK,KAAK,KAAK,CAAV,GAAc,OAAd,GAAwB,KAN7B;IAOHlX,MAAAA,IAAI,EAAE,MAPH;IAQHsZ,MAAAA,IAAI,EAAE;IACFpC,QAAAA,KADE;IAEFoB,QAAAA,SAFE;IAGFnR,QAAAA,IAHE;IAIFwR,QAAAA,OAAO,EAAE,CAACO,UAAD,EAAaT,UAAb,CAJP;IAKFK,QAAAA,IAAI,EAAE,CAACxO,SAAD,EAAY8O,SAAZ;IALJ,OARH;IAeHvV,MAAAA,IAAI,EAAG,WAAUhH,IAAI,CAACiC,UAAW,SAAQqI,IAAI,CAAC,CAAD,CAAI,KAAIkS,SAAU;IAf5D,KAAP;IAiBH;IACJ;;IAED,SAASnV,qBAAT,CAA6B3B,SAA7B,EAAwCyB,OAAxC,EAAiDhF,KAAjD,EAAwDkD,SAAxD,EAAmEE,OAAnE,EAA4E;IACxEL,EAAAA,OAAK,CAAE,YAAW/C,KAAM,KAAIgF,OAAQ,EAA/B,CAAL;IACA,MAAIA,OAAO,IAAI,CAAf,EAAkB;IACrB;;IAED,SAASZ,sBAAT,CAA8Bb,SAA9B,EAAyCS,KAAzC,EAAgDhE,KAAhD,EAAuDkD,SAAvD,EAAkEE,OAAlE,EAA2E;IACvE,MAAIrF,qBAAC,CAACqE,KAAF,CAAQ4B,KAAR,KAAkBA,KAAK,CAACzD,KAAN,IAAe,CAArC,EAAwC;IAC3C;IAED;;;;;;IAIA,SAAS8K,aAAT,CAAqBjI,OAArB,EAA8B;IAC1B,MAAImV,GAAG,GAAGnV,OAAO,IAAIA,OAAO,CAACkX,IAA7B,CAD0B;IAG1B;;IACA,SAAQ;KACPA,IAAI,CAACnW,IAAK,IAAGmW,IAAI,CAACpP,KAAM;CADzB;IAGH;;IAED,eAAegD,eAAf,CAA6BnF,OAA7B,EAAsC3F,OAAtC,EAA+C;IAC3C,MAAIrF,qBAAC,CAACqE,KAAF,CAAQ2G,OAAR,CAAJ,EAAsB;IAEtB,MAAIY,OAAO,GAAG,EAAd;IACA,MAAI6O,SAAS,GAAGzP,OAAO,IAAIA,OAAO,CAAC,OAAD,CAAlC;IACA,MAAIZ,IAAI,GAAG,CAAC;IAAE+C,IAAAA,KAAK,EAAE,IAAT;IAAerN,IAAAA,IAAI,EAAE;IAArB,GAAD,CAAX;;IACA,MAAI,CAACE,qBAAC,CAACC,OAAF,CAAUwa,SAAV,CAAL,EAA2B;IACvB,SAAK,IAAI/Z,IAAT,IAAiB+Z,SAAjB,EAA4B;IACxBrQ,MAAAA,IAAI,CAAC,CAAD,CAAJ,CAAQtK,IAAR,CAAawH,IAAb,CAAkB5G,IAAI,CAACiO,MAAvB;IACH;;IACD/C,IAAAA,OAAO,CAACtE,IAAR,CAAa;IAAE6F,MAAAA,KAAK,EAAE,OAAT;IAAkBrN,MAAAA,IAAI,EAAEsK;IAAxB,KAAb;IACH;;IAED,MAAIsQ,OAAO,GAAG1P,OAAO,IAAIA,OAAO,CAAC,KAAD,CAAhC;IACA,MAAI2P,KAAK,GAAG,CAAC;IAAExN,IAAAA,KAAK,EAAE,IAAT;IAAerN,IAAAA,IAAI,EAAE;IAArB,GAAD,CAAZ;;IACA,MAAI,CAACE,qBAAC,CAACC,OAAF,CAAUya,OAAV,CAAL,EAAyB;IACrB,SAAK,IAAIha,IAAT,IAAiBga,OAAjB,EAA0B;IACtBC,MAAAA,KAAK,CAAC,CAAD,CAAL,CAAS7a,IAAT,CAAcwH,IAAd,CAAmB5G,IAAI,CAACiO,MAAxB;IACH;;IACD/C,IAAAA,OAAO,CAACtE,IAAR,CAAa;IAAE6F,MAAAA,KAAK,EAAE,KAAT;IAAgBrN,MAAAA,IAAI,EAAE6a;IAAtB,KAAb;IACH,GApB0C;IAuB3C;IACA;IACA;;;IAEA,SAAO/O,OAAP;IACH;;IAED,MAAM2Q,IAAI,GAAG;IACTnW,EAAAA,IAAI,EAAE,MADG;IAET+G,EAAAA,KAAK,EAAEwE,WAFE;IAITO,EAAAA,WAAW,EAAE,UAJJ;IAKTC,EAAAA,WAAW,EAAE,EALJ;IAMThL,uBAAAA,qBANS;IAOTd,wBAAAA,sBAPS;IAQTqJ,SAAAA,OARS;IASTpC,eAAAA,aATS;IAUT6C,iBAAAA;IAVS,CAAb;;ICnKA;;;;;;;;;IAaA;;;;;;IAKA,SAASqM,GAAT,CAAazI,SAAb,EAAwB;IAAE7R,EAAAA,CAAC,GAAG,CAAN;IAASnC,EAAAA,MAAM,GAAG;IAAlB,IAAwB,EAAhD,EAAoD;IAChDyG,EAAAA,KAAK,CAAC3G,cAAN,CAAqBkU,SAArB;;IAEA,MACI/T,qBAAC,CAACC,OAAF,CAAU8T,SAAV,KACA,CAAC/T,qBAAC,CAACE,OAAF,CAAU6T,SAAV,CADD,IAEAA,SAAS,CAACvT,MAAV,IAAoB,CAHxB,EAIE;IACE;IACH;;IAED,MAAIS,MAAJ,CAXgD;IAahD;;IACA,MAAIwb,OAAO,GAAG,EAAd;IACA,MAAIC,OAAO,GAAG,EAAd;IACA,MAAItZ,GAAG,GAAG,EAAV;;IACA,MAAI,CAACpD,qBAAC,CAACqE,KAAF,CAAQ0P,SAAR,CAAD,IAAuB,CAAC/T,qBAAC,CAACC,OAAF,CAAU8T,SAAV,CAA5B,EAAkD;IAC9C,QAAI4I,CAAC,GAAG,MAAMza,CAAd;IACA,QAAI0a,OAAO,GAAG,CAAd;IACA,QAAIC,OAAO,GAAG,CAAd;;IACA,SAAK,IAAIta,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGwR,SAAS,CAACvT,MAA9B,EAAsC+B,CAAC,EAAvC,EAA2C;IACvC,UAAIA,CAAC,IAAIL,CAAT,EAAY;IACRua,QAAAA,OAAO,CAACla,CAAD,CAAP,GAAa,CAAb;IACAma,QAAAA,OAAO,CAACna,CAAD,CAAP,GAAa,CAAb;IACH;;IACDtB,MAAAA,MAAM,GAAG8S,SAAS,CAACxR,CAAD,CAAT,CAAa1B,KAAb,GAAqBkT,SAAS,CAACxR,CAAD,CAAT,CAAavB,SAA3C;IACA,UAAI8b,IAAI,GAAG7b,MAAM,IAAI,CAAV,GAAcA,MAAd,GAAuB,GAAlC;IACA,UAAIoK,IAAI,GAAGpK,MAAM,IAAI,CAAV,GAAc,CAACA,MAAf,GAAwB,GAAnC;;IAEA,UAAIsB,CAAC,IAAIL,CAAC,GAAG,CAAb,EAAgB;IACZ0a,QAAAA,OAAO,IAAIE,IAAX;IACAD,QAAAA,OAAO,IAAIxR,IAAX;;IACA,YAAI9I,CAAC,KAAKL,CAAC,GAAG,CAAd,EAAiB;IACbua,UAAAA,OAAO,CAACla,CAAD,CAAP,GAAaqa,OAAO,GAAG1a,CAAvB;IACAwa,UAAAA,OAAO,CAACna,CAAD,CAAP,GAAasa,OAAO,GAAG3a,CAAvB;IACAkB,UAAAA,GAAG,CAACb,CAAD,CAAH,GAAS,MAAM,OAAO,IAAIka,OAAO,CAACla,CAAD,CAAP,GAAama,OAAO,CAACna,CAAD,CAA/B,CAAf;IACH;IACJ,OARD,MAQO;IACHka,QAAAA,OAAO,CAACla,CAAD,CAAP,GAAaoa,CAAC,GAAGG,IAAJ,GAAWH,CAAC,IAAIza,CAAC,GAAG,CAAR,CAAD,GAAcua,OAAO,CAACla,CAAC,GAAG,CAAL,CAA7C;IACAma,QAAAA,OAAO,CAACna,CAAD,CAAP,GAAaoa,CAAC,GAAGtR,IAAJ,GAAWsR,CAAC,IAAIza,CAAC,GAAG,CAAR,CAAD,GAAcwa,OAAO,CAACna,CAAC,GAAG,CAAL,CAA7C;IACAa,QAAAA,GAAG,CAACb,CAAD,CAAH,GAAS,MAAM,OAAO,IAAIka,OAAO,CAACla,CAAD,CAAP,GAAama,OAAO,CAACna,CAAD,CAA/B,CAAf;IACH,OArBsC;IAwBvC;IACA;IACA;IACA;;IACH,KAhC6C;IAkC9C;IAEA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;;IACH;;IACD,SAAOa,GAAP;IACH;;AAED,cAAe;IACXgD,EAAAA,IAAI,EAAE,KADK;IAEX+G,EAAAA,KAAK,EAAE,QAFI;IAGX+E,EAAAA,WAAW,EAAE,eAHF;IAIX+B,EAAAA,SAAS,EAAEuI;IAJA,CAAf;;IChFA,MAAMxX,OAAK,GAAGC,4BAAQ,CAAC,WAAD,CAAtB;IAEA,MAAMmN,cAAY,GAAG,KAArB;IACA,MAAMT,WAAS,GAAG,KAAlB;IACA,MAAMoL,QAAQ,GAAGpd,MAAM,CAAC,UAAD,CAAvB;IACA,MAAMqd,OAAO,GAAGrd,MAAM,CAAC,SAAD,CAAtB;;IAEA,SAASsd,aAAT,CAAuB9X,SAAvB,EAAkCE,OAAlC,EAA2C;IACvC,MAAIrF,qBAAC,CAACqE,KAAF,CAAQc,SAAR,CAAJ,EAAwB;;IAExB,MAAInF,qBAAC,CAACqE,KAAF,CAAQc,SAAS,CAAC4X,QAAD,CAAjB,CAAJ,EAAkC;IAC9B5X,IAAAA,SAAS,CAAC4X,QAAD,CAAT,GAAsBG,GAAG,CAACjJ,SAAJ,CAAc9O,SAAd,EAAyB;IAC3CjD,MAAAA,CAAC,EAAEmD,OAAO,CAACmX,GAAR,CAAYta,CAD4B;IAE3CnC,MAAAA,MAAM,EAAEsF,OAAO,CAACmX,GAAR,CAAYzc;IAFuB,KAAzB,CAAtB;IAIH;;IACD,MAAIC,qBAAC,CAACqE,KAAF,CAAQc,SAAS,CAAC6X,OAAD,CAAjB,CAAJ,EAAiC;IAC7B7X,IAAAA,SAAS,CAAC6X,OAAD,CAAT,GAAqB5I,EAAE,CAACH,SAAH,CAAa9O,SAAb,EAAwB;IACzCjD,MAAAA,CAAC,EAAEmD,OAAO,CAACmX,GAAR,CAAYxZ,EAD0B;IAEzCgR,MAAAA,MAAM,EAAE,OAFiC;IAGzCjU,MAAAA,MAAM,EAAEsF,OAAO,CAACmX,GAAR,CAAYzc,MAHqB;IAIzCkD,MAAAA,IAAI,EAAE;IAJmC,KAAxB,CAArB;IAMH;IACJ;;IAED,SAASyM,OAAT,CAAezN,KAAf,EAAsBkD,SAAtB,EAAiCE,OAAjC,EAA0CsJ,MAA1C,EAAkD;IAC9C;IACAsO,EAAAA,aAAa,CAAC9X,SAAD,EAAYE,OAAZ,CAAb;;IAEA,MACIF,SAAS,IACTnF,qBAAC,CAACE,OAAF,CAAUiF,SAAV,CADA,IAEAlD,KAAK,GAAGkD,SAAS,CAAC3E,MAFlB,IAGAyB,KAAK,IAAI,CAJb,EAKE;IACE,QAAIsD,SAAS,GAAGJ,SAAS,CAAClD,KAAD,CAAT,CAAiBF,UAAjC;IACA,QAAIob,OAAO,GAAGhY,SAAS,CAAC4X,QAAD,CAAvB;;IAEA,QAAIK,iBAAiB,CAACnb,KAAD,EAAQkD,SAAR,EAAmBE,OAAnB,CAArB,EAAkD;IAC9C;IACA,aAAO;IACHsJ,QAAAA,MADG;IAEH+E,QAAAA,SAAS,EAAEzR,KAFR;IAGHwF,QAAAA,IAAI,EAAElC,SAHH;IAIHsK,QAAAA,SAAS,EAAE,KAJR;IAKHF,QAAAA,UAAU,EAAE,IALT;IAMHG,QAAAA,MAAM,EAAE,KANL;IAOH7M,QAAAA,IAAI,EAAE,KAPH;IAQH6D,QAAAA,IAAI,EAAG,eACH3B,SAAS,CAAClD,KAAD,CAAT,CAAiBF,UACpB,KAAIob,OAAO,CAAClb,KAAD,CAAP,CAAef,OAAf,CAAuB,CAAvB,CAA0B;IAV5B,OAAP;IAYH;;IAED,QAAImc,kBAAkB,CAACpb,KAAD,EAAQkD,SAAR,EAAmBE,OAAnB,CAAtB,EAAmD;IAC/C;IACA,aAAO;IACHsJ,QAAAA,MADG;IAEH+E,QAAAA,SAAS,EAAEzR,KAFR;IAGHwF,QAAAA,IAAI,EAAElC,SAHH;IAIHoK,QAAAA,UAAU,EAAE,IAJT;IAKHE,QAAAA,SAAS,EAAE,MALR;IAMHC,QAAAA,MAAM,EAAE,MANL;IAOH7M,QAAAA,IAAI,EAAE,KAPH;IAQH6D,QAAAA,IAAI,EAAG,eACH3B,SAAS,CAAClD,KAAD,CAAT,CAAiBF,UACpB,KAAIob,OAAO,CAAClb,KAAD,CAAP,CAAef,OAAf,CAAuB,CAAvB,CAA0B;IAV5B,OAAP;IAYH;IACJ;IACJ;;IAED,SAASkc,iBAAT,CAA2Bnb,KAA3B,EAAkCkD,SAAlC,EAA6CE,OAA7C,EAAsD;IAClD,MAAIiY,UAAU,GAAGjY,OAAO,IAAIA,OAAO,CAAC+M,cAAD,CAAnC,CADkD;;IAGlD,MAAIlQ,CAAC,GAAGob,UAAU,IAAIA,UAAU,CAACpb,CAAjC;IAEA,MAAIA,CAAC,GAAG,CAAJ,IAASA,CAAC,GAAG,CAAJ,GAAQD,KAArB,EAA4B,OAAO,KAAP;IAC5B,MAAIkb,OAAO,GAAGhY,SAAS,CAAC4X,QAAD,CAAvB;IACA,MAAIQ,MAAM,GAAGpY,SAAS,CAAC6X,OAAD,CAAtB;IACA,MAAIpL,WAAW,GAAGzM,SAAS,CAAClD,KAAD,CAA3B,CARkD;;IAWlD,MAAIsb,MAAM,IAAIA,MAAM,CAACtb,KAAD,CAAhB,IAA2Bsb,MAAM,CAACtb,KAAD,CAAN,GAAgB2P,WAAW,CAAC/Q,KAA3D,EACI,OAAO,KAAP,CAZ8C;;IAelD,MAAI2c,IAAI,GAAGF,UAAU,IAAIA,UAAU,CAACE,IAApC;IACA,SACIL,OAAO,IACPA,OAAO,CAAClb,KAAK,GAAG,CAAT,CADP,IAEAkb,OAAO,CAAClb,KAAD,CAFP,IAGAkb,OAAO,CAAClb,KAAK,GAAG,CAAT,CAAP,IAAsBub,IAHtB,IAIAL,OAAO,CAAClb,KAAD,CAAP,GAAiBub,IALrB;IAOH;IAED;;;;;;;;;;;IASA,SAASrW,qBAAT,CAA6B3B,SAA7B,EAAwCyB,OAAxC,EAAiDhF,KAAjD,EAAwDkD,SAAxD,EAAmEE,OAAnE,EAA4E;IACxE,MAAI4B,OAAO,IAAI,CAAf,EAAkB;IAClBgW,EAAAA,aAAa,CAAC9X,SAAD,EAAYE,OAAZ,CAAb,CAFwE;;IAKxE,MAAIiY,UAAU,GAAGjY,OAAO,IAAIA,OAAO,CAAC+M,cAAD,CAAnC;IACA,MAAIoL,IAAI,GAAGF,UAAU,IAAIA,UAAU,CAACE,IAApC;IACA,MAAI5L,WAAW,GAAGzM,SAAS,CAAClD,KAAD,CAA3B;IACA,MAAI4P,WAAW,GAAGD,WAAW,CAAC/Q,KAA9B;IACA,MAAI0E,SAAS,GAAGJ,SAAS,CAAClD,KAAD,CAAT,CAAiBF,UAAjC;IACA,MAAIob,OAAO,GAAGhY,SAAS,CAAC4X,QAAD,CAAvB;;IACA,MAAIK,iBAAiB,CAACnb,KAAD,EAAQkD,SAAR,EAAmBE,OAAnB,CAArB,EAAkD;IAC9CL,IAAAA,OAAK,CACA,SAAQO,SAAU,KAAIsM,WAAW,CAAC3Q,OAAZ,CAAoB,CAApB,CAAuB,YAC1Cic,OAAO,CAAClb,KAAK,GAAG,CAAT,CACV,aAAYkb,OAAO,CAAClb,KAAD,CAAQ,QAAOub,IAAI,CAACtc,OAAL,CAAa,CAAb,CAAgB;eAHlD,CAAL;IAMA,WAAOsK,KAAK,CAACrD,oBAAN,CACH3C,SADG,EAEHD,SAFG,EAGHtD,KAHG,EAIHgF,OAJG,EAKH4K,WALG,EAMH,KANG,EAOF,aAAYA,WAAW,CAAC3Q,OAAZ,CAAoB,CAApB,CAAuB,KAAIic,OAAO,CAC3Clb,KAD2C,CAAP,CAEtCf,OAFsC,CAE9B,CAF8B,CAE3B,EATV,CAAP;IAWH,GA7BuE;IAgCxE;IACA;IAEA;IACA;IACA;IACA;IACA;IAEA;IACA;IAEA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;;IACH;;IAED,SAASmc,kBAAT,CAA4Bpb,KAA5B,EAAmCkD,SAAnC,EAA8CE,OAA9C,EAAuD;IACnD,MAAIiY,UAAU,GAAGjY,OAAO,IAAIA,OAAO,CAAC+M,cAAD,CAAnC,CADmD;;IAGnD,MAAIlQ,CAAC,GAAGob,UAAU,IAAIA,UAAU,CAACpb,CAAjC;IAEA,MAAIA,CAAC,GAAG,CAAJ,IAASA,CAAC,GAAG,CAAJ,GAAQD,KAArB,EAA4B,OAAO,KAAP;IAC5B,MAAIkb,OAAO,GAAGhY,SAAS,CAAC4X,QAAD,CAAvB;IACA,MAAIQ,MAAM,GAAGpY,SAAS,CAAC6X,OAAD,CAAtB;IACA,MAAIpL,WAAW,GAAGzM,SAAS,CAAClD,KAAD,CAA3B,CARmD;;IAWnD,MAAIsb,MAAM,IAAIA,MAAM,CAACtb,KAAD,CAAhB,IAA2Bsb,MAAM,CAACtb,KAAD,CAAN,GAAgB2P,WAAW,CAAC/Q,KAA3D,EACI,OAAO,KAAP,CAZ+C;;IAenD,MAAI4c,KAAK,GAAGH,UAAU,IAAIA,UAAU,CAACG,KAArC;IACA,SACIN,OAAO,IACPA,OAAO,CAAClb,KAAK,GAAG,CAAT,CADP,IAEAkb,OAAO,CAAClb,KAAD,CAFP,IAGAkb,OAAO,CAAClb,KAAK,GAAG,CAAT,CAAP,IAAsBwb,KAHtB,IAIAN,OAAO,CAAClb,KAAD,CAAP,GAAiBwb,KALrB;IAOH;IAED;;;;;;;;;;;IASA,SAASpX,sBAAT,CAA8Bb,SAA9B,EAAyCS,KAAzC,EAAgDhE,KAAhD,EAAuDkD,SAAvD,EAAkEE,OAAlE,EAA2E;IACvE,MAAIrF,qBAAC,CAACC,OAAF,CAAUgG,KAAV,KAAoBA,KAAK,CAACzD,KAAN,IAAe,CAAvC,EAA0C;IAE1C,MAAI8a,UAAU,GAAGjY,OAAO,IAAIA,OAAO,CAAC+M,cAAD,CAAnC;IACA,MAAIqL,KAAK,GAAGH,UAAU,IAAIA,UAAU,CAACG,KAArC;IACA,MAAI7L,WAAW,GAAGzM,SAAS,CAAClD,KAAD,CAA3B;IACA,MAAIsD,SAAS,GAAGqM,WAAW,CAAC7P,UAA5B;IACA,MAAI8P,WAAW,GAAGD,WAAW,CAAC/Q,KAA9B;IACA,MAAIsc,OAAO,GAAGhY,SAAS,CAAC4X,QAAD,CAAvB;;IAEA,MAAIM,kBAAkB,CAACpb,KAAD,EAAQkD,SAAR,EAAmBE,OAAnB,CAAtB,EAAmD;IAC/CL,IAAAA,OAAK,CACA,SAAQO,SAAU,KAAIsM,WAAW,CAAC3Q,OAAZ,CAAoB,CAApB,CAAuB,YAC1Cic,OAAO,CAAClb,KAAK,GAAG,CAAT,CACV,aAAYkb,OAAO,CAAClb,KAAD,CAAQ,QAAOwb,KAAK,CAACvc,OAAN,CAAc,CAAd,CAAiB;eAHnD,CAAL;IAMA,WAAOsK,KAAK,CAAC3D,qBAAN,CACHrC,SADG,EAEHD,SAFG,EAGHtD,KAHG,EAIHgE,KAAK,CAACzD,KAJH,EAKHqP,WALG,EAMH,KANG,EAOF,WAAUA,WAAW,CAAC3Q,OAAZ,CAAoB,CAApB,CAAuB,KAAIic,OAAO,CAAClb,KAAD,CAAP,CAAef,OAAf,CAClC,CADkC,CAEpC,EATC,CAAP;IAWH,GA5BsE;IA+BvE;IACA;IAEA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;;IACH;IAED;;;;;;;;IAMA,eAAeiP,eAAf,CAA6BnF,OAA7B,EAAsC3F,OAAtC,EAA+C;IAC3C,MAAIrF,qBAAC,CAACqE,KAAF,CAAQ2G,OAAR,CAAJ,EAAsB;IAEtB,MAAIY,OAAO,GAAG,EAAd;IAEA,MAAI8O,OAAO,GAAG1P,OAAO,IAAIA,OAAO,CAAC,KAAD,CAAhC;IACA,MAAI2P,KAAK,GAAG,CAAC;IAAExN,IAAAA,KAAK,EAAE,IAAT;IAAerN,IAAAA,IAAI,EAAE;IAArB,GAAD,CAAZ;;IACA,MAAI,CAACE,qBAAC,CAACC,OAAF,CAAUya,OAAV,CAAL,EAAyB;IACrB,SAAK,IAAIha,IAAT,IAAiBga,OAAjB,EAA0B;IACtBC,MAAAA,KAAK,CAAC,CAAD,CAAL,CAAS7a,IAAT,CAAcwH,IAAd,CAAmB5G,IAAI,CAACiO,MAAxB;IACH;;IACD/C,IAAAA,OAAO,CAACtE,IAAR,CAAa;IAAE6F,MAAAA,KAAK,EAAE,IAAT;IAAerN,MAAAA,IAAI,EAAE6a;IAArB,KAAb;IACH;;IAED,MAAI+C,QAAQ,GAAG1S,OAAO,IAAIA,OAAO,CAAC,MAAD,CAAjC;IACA,MAAI2S,KAAK,GAAG,CAAC;IAAExQ,IAAAA,KAAK,EAAE,IAAT;IAAerN,IAAAA,IAAI,EAAE;IAArB,GAAD,CAAZ;;IACA,MAAI,CAACE,qBAAC,CAACC,OAAF,CAAUyd,QAAV,CAAL,EAA0B;IACtB,SAAK,IAAIhd,IAAT,IAAiBgd,QAAjB,EAA2B;IACvBC,MAAAA,KAAK,CAAC,CAAD,CAAL,CAAS7d,IAAT,CAAcwH,IAAd,CAAmB5G,IAAI,CAACiO,MAAxB;IACH;;IACD/C,IAAAA,OAAO,CAACtE,IAAR,CAAa;IAAE6F,MAAAA,KAAK,EAAE,IAAT;IAAerN,MAAAA,IAAI,EAAE6d;IAArB,KAAb;IACH;;IAED,SAAO/R,OAAP;IACH;IAED;;;;;;IAIA,SAAS0B,aAAT,CAAqBjI,OAArB,EAA8B;IAC1B,SAAQ;KACPuY,SAAS,CAACxX,IAAK,IAAGwX,SAAS,CAACzQ,KAAM;WAC5B9H,OAAO,CAACmX,GAAR,CAAYta,CAAE;YACbmD,OAAO,CAACmX,GAAR,CAAYxZ,EAAG;;aAEdqC,OAAO,CAACmX,GAAR,CAAYgB,IAAK;aACjBnY,OAAO,CAACmX,GAAR,CAAYiB,KAAM;CAN3B;IAQH;;IAED,MAAMG,SAAS,GAAG;IACdxX,EAAAA,IAAI,EAAE,OADQ;IAEd+G,EAAAA,KAAK,EAAEwE,WAFO;IAIdO,EAAAA,WAAW,EAAE,SAJC;IAKdC,EAAAA,WAAW,EAAE,EALC;IAMdhL,uBAAAA,qBANc;IAOdd,wBAAAA,sBAPc;IAQdqJ,SAAAA,OARc;IASdpC,eAAAA,aATc;IAUd6C,iBAAAA;IAVc,CAAlB;;IC1TA;;;;;;;;;IAaA;;;;;;IAKA,SAAS0N,GAAT,CAAa9J,SAAb,EAAwB;IAAE7R,EAAAA,CAAC,GAAG,CAAN;IAASnC,EAAAA,MAAM,GAAG;IAAlB,IAAwB,EAAhD,EAAoD;IAChDyG,EAAAA,KAAK,CAAC3G,cAAN,CAAqBkU,SAArB;;IAEA,MACI/T,qBAAC,CAACC,OAAF,CAAU8T,SAAV,KACA,CAAC/T,qBAAC,CAACE,OAAF,CAAU6T,SAAV,CADD,IAEAA,SAAS,CAACvT,MAAV,IAAoB,CAHxB,EAIE;IACE;IACH,GAT+C;;;IAYhD,MAAIqd,GAAG,GAAG,EAAV;;IACA,MAAI,CAAC7d,qBAAC,CAACqE,KAAF,CAAQ0P,SAAR,CAAD,IAAuB,CAAC/T,qBAAC,CAACC,OAAF,CAAU8T,SAAV,CAA5B,EAAkD;IAC9C,QAAIrR,OAAO,GAAG,GAAd;;IACA,SAAK,IAAIH,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGwR,SAAS,CAACvT,MAA9B,EAAsC+B,CAAC,EAAvC,EAA2C;IACvC,UAAIA,CAAC,GAAGL,CAAC,GAAG,CAAZ,EAAe;IACX;IACH;;IAEDQ,MAAAA,OAAO,GAAG,GAAV;;IACA,WAAK,IAAIoB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG5B,CAApB,EAAuB4B,CAAC,EAAxB,EAA4B;IACxB,YAAIjD,KAAK,GAAGkT,SAAS,CAACxR,CAAC,GAAGuB,CAAL,CAAT,CAAiBjD,KAA7B;IACA6B,QAAAA,OAAO,GAAGA,OAAO,IAAI7B,KAAX,GAAmB6B,OAAnB,GAA6B7B,KAAvC;IACH;;IACDgd,MAAAA,GAAG,CAACtb,CAAD,CAAH,GAAU,SAASG,OAAO,GAAGqR,SAAS,CAACxR,CAAD,CAAT,CAAaxB,GAAhC,CAAD,GAAyC2B,OAAlD;IACH;IACJ;;IACD,SAAOmb,GAAP;IACH;;AAED,cAAe;IACXzX,EAAAA,IAAI,EAAE,KADK;IAEX+G,EAAAA,KAAK,EAAE,SAFI;IAGX+E,EAAAA,WAAW,EAAE,YAHF;IAIX+B,EAAAA,SAAS,EAAE4J;IAJA,CAAf;;IC3CA,MAAM7Y,OAAK,GAAGC,4BAAQ,CAAC,cAAD,CAAtB;IAEA,MAAMmN,cAAY,GAAG,QAArB;IACA,MAAMT,WAAS,GAAG,QAAlB;IACA,MAAMmM,QAAQ,GAAGne,MAAM,CAAC,UAAD,CAAvB;;IAGA;;;;;;IAKA,SAASsd,eAAT,CAAuB9X,SAAvB,EAAkCE,OAAlC,EAA2C;IACvC,MAAIrF,qBAAC,CAACqE,KAAF,CAAQc,SAAR,CAAJ,EAAwB;;IAExB,MAAInF,qBAAC,CAACqE,KAAF,CAAQc,SAAS,CAAC2Y,QAAD,CAAjB,CAAJ,EAAkC;IAC9B,QAAID,GAAG,GAAGE,GAAG,CAAC9J,SAAJ,CAAc9O,SAAd,EAAyB;IAC/BjD,MAAAA,CAAC,EAAEmD,OAAO,CAAC2Y,MAAR,CAAe9b,CADa;IAE/BnC,MAAAA,MAAM,EAAEsF,OAAO,CAAC2Y,MAAR,CAAeje;IAFQ,KAAzB,CAAV;IAKA,QAAIwD,IAAI,GAAGiD,KAAK,CAACjD,IAAN,CACPsa,GADO,EAEPxY,OAAO,CAAC2Y,MAAR,CAAeC,EAFR,EAGP5Y,OAAO,CAAC2Y,MAAR,CAAexa,KAHR,EAIP,IAJO,EAKP6B,OAAO,CAAC2Y,MAAR,CAAeje,MALR,CAAX;IAQAoF,IAAAA,SAAS,CAAC2Y,QAAD,CAAT,GAAsB,CAACD,GAAD,EAAMta,IAAN,CAAtB;IACH;IACJ;;IAED,SAASmM,OAAT,CAAezN,KAAf,EAAsBkD,SAAtB,EAAiCE,OAAjC,EAA0CsJ,MAA1C,EAAkD;IAC9CsO,EAAAA,eAAa,CAAC9X,SAAD,EAAYE,OAAZ,CAAb;;IAEA,MACIF,SAAS,IACTnF,qBAAC,CAACE,OAAF,CAAUiF,SAAV,CADA,IAEAlD,KAAK,GAAGkD,SAAS,CAAC3E,MAFlB,IAGAyB,KAAK,IAAI,CAJb,EAKE;IACE,QAAIsD,SAAS,GAAGJ,SAAS,CAAClD,KAAD,CAAT,CAAiBF,UAAjC;IACA,QAAI,CAACmc,OAAD,EAAU5F,QAAV,IAAsBnT,SAAS,CAAC2Y,QAAD,CAAnC;;IAEA,QAAIV,mBAAiB,CAACnb,KAAD,EAAQkD,SAAR,EAAmBE,OAAnB,CAArB,EAAkD;IAC9C;IACA,aAAO;IACHsJ,QAAAA,MADG;IAEH+E,QAAAA,SAAS,EAAEzR,KAFR;IAGHwF,QAAAA,IAAI,EAAElC,SAHH;IAIHsK,QAAAA,SAAS,EAAE,KAJR;IAKHF,QAAAA,UAAU,EAAE,IALT;IAMHG,QAAAA,MAAM,EAAE,KANL;IAOH7M,QAAAA,IAAI,EAAE,KAPH;IAQH6D,QAAAA,IAAI,EAAG,YAAW3B,SAAS,CAAClD,KAAD,CAAT,CAAiBF,UAAW,KAAImc,OAAO,CACrDjc,KADqD,CAAP,CAEhDf,OAFgD,CAExC,CAFwC,CAErC;IAVV,OAAP;IAYH;IAiBJ;IACJ;;IAED,SAASkc,mBAAT,CAA2Bnb,KAA3B,EAAkCkD,SAAlC,EAA6CE,OAA7C,EAAsD;IAClD,MAAI8Y,UAAU,GAAG9Y,OAAO,IAAIA,OAAO,CAAC+M,cAAD,CAAnC,CADkD;;IAGlD,MAAIgM,GAAG,GAAID,UAAU,IAAIA,UAAU,CAACC,GAA1B,IAAkC,EAA5C;IACA,MAAIC,EAAE,GAAIF,UAAU,IAAIA,UAAU,CAACE,EAA1B,IAAiC,GAA1C,CAJkD;;IAMlD,MAAID,GAAG,GAAG,CAAN,IAAWA,GAAG,GAAGnc,KAArB,EAA4B,OAAO,KAAP;IAC5B,MAAI,CAACic,OAAD,EAAU5F,QAAV,IAAsBnT,SAAS,CAAC2Y,QAAD,CAAnC,CAPkD;IAWlD;;IACA,MAAII,OAAO,CAACjc,KAAD,CAAP,IAAkBqW,QAAQ,CAACrW,KAAD,CAAR,CAAgB,CAAhB,CAAtB,EAA0C,OAAO,IAAP;IAC1C,MAAIqc,SAAS,GAAG9X,KAAK,CAAC9D,OAAN,CAAcwb,OAAd,EAAuBjc,KAAvB,EAA8Bmc,GAAG,GAAG,CAApC,EAAuC,IAAvC,IAA+CC,EAA/D;IACA,MAAIH,OAAO,CAACjc,KAAD,CAAP,IAAkBqc,SAAtB,EAAiC,OAAO,IAAP;IAEjC,SAAO,KAAP;IACH;IAED;;;;;;;;;;;IASA,SAASnX,qBAAT,CAA6B3B,SAA7B,EAAwCyB,OAAxC,EAAiDhF,KAAjD,EAAwDkD,SAAxD,EAAmEE,OAAnE,EAA4E;IACxE,MAAI4B,OAAO,IAAI,CAAf,EAAkB;IAClBgW,EAAAA,eAAa,CAAC9X,SAAD,EAAYE,OAAZ,CAAb,CAFwE;IAKxE;;IACA,MAAIuM,WAAW,GAAGzM,SAAS,CAAClD,KAAD,CAA3B;IACA,MAAI4P,WAAW,GAAGD,WAAW,CAAC/Q,KAA9B;IACA,MAAI0E,SAAS,GAAGJ,SAAS,CAAClD,KAAD,CAAT,CAAiBF,UAAjC;IACA,MAAI,CAACmc,OAAD,EAAU5F,QAAV,IAAsBnT,SAAS,CAAC2Y,QAAD,CAAnC;;IACA,MAAIV,mBAAiB,CAACnb,KAAD,EAAQkD,SAAR,EAAmBE,OAAnB,CAArB,EAAkD;IAC9CL,IAAAA,OAAK,CACA,SAAQO,SAAU,KAAIsM,WAAW,CAAC3Q,OAAZ,CACnB,CADmB,CAErB,UAASgd,OAAO,CAACjc,KAAD,CAAP,CAAef,OAAf,CAAuB,CAAvB,CAA0B,YAAWoX,QAAQ,CACpDrW,KADoD,CAAR,CAE9C,CAF8C,EAE3Cf,OAF2C,CAEnC,CAFmC,CAEhC,GALf,CAAL;IAOA,WAAOsK,KAAK,CAACrD,oBAAN,CACH3C,SADG,EAEHD,SAFG,EAGHtD,KAHG,EAIHgF,OAJG,EAKH4K,WALG,EAMH,KANG,EAOF,WAAUA,WAAW,CAAC3Q,OAAZ,CAAoB,CAApB,CAAuB,KAAIgd,OAAO,CAACjc,KAAD,CAAP,CAAef,OAAf,CAClC,CADkC,CAEpC,EATC,CAAP;IAWH;IACJ;IAMD;;;;;;;;;;;IASA,SAASmF,sBAAT,CAA8Bb,SAA9B,EAAyCS,KAAzC,EAAgDhE,KAAhD,EAAuDkD,SAAvD,EAAkEE,OAAlE,EAA2E;IAEvE;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACH;IAED;;;;;;;;IAMA,eAAe8K,eAAf,CAA6BnF,OAA7B,EAAsC3F,OAAtC,EAA+C;IAC3C,MAAIrF,qBAAC,CAACqE,KAAF,CAAQ2G,OAAR,CAAJ,EAAsB;IAEtB,MAAIY,OAAO,GAAG,EAAd;IAEA,MAAI8O,OAAO,GAAG1P,OAAO,IAAIA,OAAO,CAAC,KAAD,CAAhC;IACA,MAAI2P,KAAK,GAAG,CAAC;IAAExN,IAAAA,KAAK,EAAE,IAAT;IAAerN,IAAAA,IAAI,EAAE;IAArB,GAAD,CAAZ;;IACA,MAAI,CAACE,qBAAC,CAACC,OAAF,CAAUya,OAAV,CAAL,EAAyB;IACrB,SAAK,IAAIha,IAAT,IAAiBga,OAAjB,EAA0B;IACtBC,MAAAA,KAAK,CAAC,CAAD,CAAL,CAAS7a,IAAT,CAAcwH,IAAd,CAAmB5G,IAAI,CAACiO,MAAxB;IACH;;IACD/C,IAAAA,OAAO,CAACtE,IAAR,CAAa;IAAE6F,MAAAA,KAAK,EAAE,IAAT;IAAerN,MAAAA,IAAI,EAAE6a;IAArB,KAAb;IACH;;IAED,SAAO/O,OAAP;IACH;IAED;;;;;;IAIA,SAAS0B,aAAT,CAAqBjI,OAArB,EAA8B;IAC1B,SAAQ;KACPkZ,SAAS,CAACnY,IAAK,IAAGmY,SAAS,CAACpR,KAAM;WAC5B9H,OAAO,CAAC2Y,MAAR,CAAe9b,CAAE;;gBAEZmD,OAAO,CAAC2Y,MAAR,CAAeC,EAAG,SAAQ5Y,OAAO,CAAC2Y,MAAR,CAAexa,KAAM;;gBAE/C6B,OAAO,CAAC2Y,MAAR,CAAeI,GAAI,YAC3B/Y,OAAO,CAAC2Y,MAAR,CAAeK,EAAf,GAAoB,GACvB;CARD;IAUH;;IAED,MAAME,SAAS,GAAG;IACdnY,EAAAA,IAAI,EAAE,OADQ;IAEd+G,EAAAA,KAAK,EAAEwE,WAFO;IAIdO,EAAAA,WAAW,EAAE,SAJC;IAKdC,EAAAA,WAAW,EAAE,EALC;IAMdhL,uBAAAA,qBANc;IAOdd,wBAAAA,sBAPc;IAQdqJ,SAAAA,OARc;IASdpC,eAAAA,aATc;IAUd6C,iBAAAA;IAVc,CAAlB;;IC7NA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAmDA,SAAS0E,UAAT,CAAkBC,MAAlB,EAA0BC,MAA1B,EAAkChV,MAAlC,EAA0C;IACtC,MACIC,qBAAC,CAACC,OAAF,CAAU6U,MAAV,KACA9U,qBAAC,CAACC,OAAF,CAAU8U,MAAV,CADA,IAEAD,MAAM,CAACtU,MAAP,KAAkBuU,MAAM,CAACvU,MAH7B,EAIE;IACE;IACH;;IAED,SAAOsU,MAAM,CAACpG,GAAP,CAAW,CAAChO,IAAD,EAAO6B,CAAP,EAAUmP,GAAV,KAAkB;IAChC,QAAI3R,MAAJ,EAAY;IACR,aAAOyG,KAAK,CAACtF,OAAN,CAAcR,IAAI,GAAGqU,MAAM,CAACxS,CAAD,CAA3B,EAAgCxC,MAAhC,CAAP;IACH,KAFD,MAEO;IACH,aAAOW,IAAI,GAAGqU,MAAM,CAACxS,CAAD,CAApB;IACH;IACJ,GANM,CAAP;IAOH;;IAED,SAASic,QAAT,CACIzK,SADJ,EAEI;IACI0K,EAAAA,KAAK,GAAG,GADZ;IAEIC,EAAAA,OAAO,GAAG,CAFd;IAGIC,EAAAA,KAAK,GAAG,KAHZ;IAIIC,EAAAA,YAAY,GAAG,CAJnB;IAKIC,EAAAA,SAAS,GAAG,CALhB;IAMIC,EAAAA,UAAU,GAAG,CANjB;IAOIC,EAAAA,aAAa,GAAG,CAPpB;IASI/K,EAAAA,MAAM,GAAG,MATb;IAUI;IACAhR,EAAAA,EAAE,GAAG,IAXT;IAYIgc,EAAAA,SAAS,GAAG,EAZhB;IAaIC,EAAAA,MAAM,GAAG,CAbb;IAcIC,EAAAA,MAAM,GAAG,GAdb;IAeIC,EAAAA,MAAM,GAAG,EAfb;IAgBIC,EAAAA,SAAS,GAAG,CAhBhB;IAkBIC,EAAAA,EAAE,GAAG,EAlBT;IAmBIC,EAAAA,GAAG,GAAG,EAnBV;IAoBIC,EAAAA,IAAI,GAAG,GApBX;IAqBInK,EAAAA,EAAE,GAAG,EArBT;IAsBIiJ,EAAAA,EAAE,GAAG,IAtBT;IAuBImB,EAAAA,IAAI,GAAG,EAvBX;IAwBIC,EAAAA,KAAK,GAAG,IAxBZ;IAyBIC,EAAAA,KAAK,GAAG,IAzBZ;IA0BIC,EAAAA,SAAS,GAAG,CA1BhB;IA4BI5f,EAAAA,MAAM,GAAG;IA5Bb,IA6BI,EA/BR,EAgCE;IACEyG,EAAAA,KAAK,CAAC3G,cAAN,CAAqBkU,SAArB,EADF;IAIE;IACA;;IACA,MAAI6L,MAAM,GAAGpZ,KAAK,CAACxD,EAAN,CAAS+Q,SAAT,EAAoB,CAApB,EAAuB,OAAvB,EAAgC,KAAhC,EAAuChU,MAAM,GAAG,CAAhD,CAAb;IAEA,MAAI0V,OAAO,GAAGjP,KAAK,CAACxD,EAAN,CAAS+Q,SAAT,EAAoB,EAApB,EAAwB,OAAxB,EAAiC,KAAjC,EAAwChU,MAAM,GAAG,CAAjD,CAAd;IACA,MAAI2V,KAAK,GAAGb,UAAQ,CAAC+K,MAAD,EAASnK,OAAT,CAApB;IACA,MAAIE,OAAO,GAAGnP,KAAK,CAACxD,EAAN,CAAS0S,KAAT,EAAgB,EAAhB,EAAoB,IAApB,EAA0B,KAA1B,EAAiC3V,MAAM,GAAG,CAA1C,CAAd;IACA,MAAI6V,KAAK,GAAGf,UAAQ,CAACa,KAAD,EAAQC,OAAR,EAAiB5V,MAAjB,CAApB,CAXF;;IAcE,MAAI+V,OAAO,GAAGtP,KAAK,CAACxD,EAAN,CAAS+Q,SAAT,EAAoB,EAApB,EAAwB,OAAxB,EAAiC,KAAjC,EAAwChU,MAAM,GAAG,CAAjD,CAAd;IACA,MAAIgW,KAAK,GAAGlB,UAAQ,CAAC+K,MAAD,EAAS9J,OAAT,CAApB;IACA,MAAIE,OAAO,GAAGxP,KAAK,CAACxD,EAAN,CAAS+S,KAAT,EAAgB,EAAhB,EAAoB,IAApB,EAA0B,KAA1B,EAAiChW,MAAM,GAAG,CAA1C,CAAd;IACA,MAAIkW,KAAK,GAAGpB,UAAQ,CAACkB,KAAD,EAAQC,OAAR,EAAiBjW,MAAjB,CAApB,CAjBF;IAoBE;;IACA,MAAIoW,OAAO,GAAG3P,KAAK,CAACxD,EAAN,CAAS+Q,SAAT,EAAoB,EAApB,EAAwB,OAAxB,EAAiC,KAAjC,EAAwChU,MAAM,GAAG,CAAjD,CAAd;IACA,MAAIqW,KAAK,GAAGvB,UAAQ,CAAC+K,MAAD,EAASzJ,OAAT,CAApB;IACA,MAAIE,OAAO,GAAG7P,KAAK,CAACxD,EAAN,CAASoT,KAAT,EAAgB,EAAhB,EAAoB,IAApB,EAA0B,KAA1B,EAAiCrW,MAAM,GAAG,CAA1C,CAAd;IACA,MAAIuW,KAAK,GAAGzB,UAAQ,CAACuB,KAAD,EAAQC,OAAR,EAAiBtW,MAAjB,CAApB,CAxBF;;IA2BE,MAAIyW,OAAO,GAAGhQ,KAAK,CAACxD,EAAN,CAAS+Q,SAAT,EAAoB,GAApB,EAAyB,OAAzB,EAAkC,KAAlC,EAAyChU,MAAM,GAAG,CAAlD,CAAd;IACA,MAAI0W,KAAK,GAAG5B,UAAQ,CAAC+K,MAAD,EAASpJ,OAAT,CAApB;IACA,MAAIE,OAAO,GAAGlQ,KAAK,CAACxD,EAAN,CAASyT,KAAT,EAAgB,GAAhB,EAAqB,IAArB,EAA2B,KAA3B,EAAkC1W,MAAM,GAAG,CAA3C,CAAd;IACA,MAAI4W,KAAK,GAAG9B,UAAQ,CAAC4B,KAAD,EAAQC,OAAR,EAAiB3W,MAAjB,CAApB,CA9BF;IAiCE;;IACA,MAAI8W,OAAO,GAAGrQ,KAAK,CAACxD,EAAN,CAAS+Q,SAAT,EAAoB,GAApB,EAAyB,OAAzB,EAAkC,KAAlC,EAAyChU,MAAM,GAAG,CAAlD,CAAd;IACA,MAAI+W,KAAK,GAAGjC,UAAQ,CAAC+K,MAAD,EAAS/I,OAAT,CAApB;IACA,MAAIE,OAAO,GAAGvQ,KAAK,CAACxD,EAAN,CAAS8T,KAAT,EAAgB,GAAhB,EAAqB,IAArB,EAA2B,KAA3B,EAAkC/W,MAAM,GAAG,CAA3C,CAAd;IACA,MAAIiX,KAAK,GAAGnC,UAAQ,CAACiC,KAAD,EAAQC,OAAR,EAAiBhX,MAAjB,CAApB,CArCF;;IAwCE,MAAImX,OAAO,GAAG1Q,KAAK,CAACxD,EAAN,CAAS+Q,SAAT,EAAoB,GAApB,EAAyB,OAAzB,EAAkC,KAAlC,EAAyChU,MAAM,GAAG,CAAlD,CAAd;IACA,MAAIoX,KAAK,GAAGtC,UAAQ,CAAC+K,MAAD,EAAS1I,OAAT,EAAkBnX,MAAlB,CAApB,CAzCF;IA2CE;IAEA;IACA;IACA;;IACA,MAAI8f,MAAM,GAAG,EAAb;IACA,MAAIC,MAAM,GAAG,EAAb;IACA,MAAIC,MAAM,GAAG,EAAb;IACA,MAAIC,WAAW,GAAG,EAAlB;IACA,MAAIC,QAAQ,GAAG,EAAf,CApDF;;IAuDE,MAAI3H,QAAQ,GAAGC,IAAI,CAACtE,SAAL,CAAeF,SAAf,EAA0B;IACrC7R,IAAAA,CAAC,EAAE8c,SADkC;IAErCxK,IAAAA,CAAC,EAAEyK,MAFkC;IAGrCjc,IAAAA,EAHqC;IAIrCgR,IAAAA,MAJqC;IAKrCjU,IAAAA;IALqC,GAA1B,CAAf;IAOA,MAAIqY,MAAM,GAAGC,EAAE,CAACpE,SAAH,CAAaF,SAAb,EAAwB;IACjC7R,IAAAA,CAAC,EAAE8c,SAD8B;IAEjCxK,IAAAA,CAAC,EAAE0K,MAF8B;IAGjC7K,IAAAA,KAAK,EAAErR,EAH0B;IAIjCuR,IAAAA,KAAK,EAAEvR,EAJ0B;IAKjCgR,IAAAA,MALiC;IAMjCjU,IAAAA;IANiC,GAAxB,CAAb;IASA,MAAIyY,OAAO,GAAGC,GAAG,CAACxE,SAAJ,CAAcF,SAAd,EAAyB;IACnC7R,IAAAA,CAAC,EAAEid,MADgC;IAEnC3K,IAAAA,CAAC,EAAE,CAFgC;IAGnCR,IAAAA,MAAM,EAAE,OAH2B;IAInCjU,IAAAA;IAJmC,GAAzB,CAAd;IAMA,MAAImgB,MAAM,GAAG1Z,KAAK,CAACxD,EAAN,CAASwV,OAAT,EAAkB4G,SAAlB,EAA6B,IAA7B,EAAmC,IAAnC,EAAyCrf,MAAzC,CAAb;IACA,MAAIogB,QAAQ,GAAG,EAAf;IACA,MAAIC,QAAQ,GAAG,EAAf;IAEA,MAAIC,YAAY,GAAG,EAAnB;IACA,MAAIC,aAAa,GAAG,EAApB;;IACA,OAAK,IAAI/d,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGwR,SAAS,CAACvT,MAA9B,EAAsC+B,CAAC,EAAvC,EAA2C;IACvC;IACA,QAAIge,GAAG,GAAG3K,KAAK,CAACrT,CAAD,CAAL,GAAWiE,KAAK,CAACtC,EAAN,CAAS0R,KAAT,EAAgBrT,CAAC,GAAG,CAApB,CAAX,IAAqC,CAA/C;IACA,QAAIie,IAAI,GAAG5K,KAAK,CAACrT,CAAD,CAAL,GAAWiE,KAAK,CAACtC,EAAN,CAAS0R,KAAT,EAAgBrT,CAAC,GAAG,CAApB,CAAX,IAAqCkc,KAAhD;IACA,QAAIgC,GAAG,GAAGxK,KAAK,CAAC1T,CAAD,CAAL,GAAWiE,KAAK,CAACtC,EAAN,CAAS+R,KAAT,EAAgB1T,CAAC,GAAG,CAApB,CAAX,IAAqC,CAA/C;IACA,QAAIme,IAAI,GAAGzK,KAAK,CAAC1T,CAAD,CAAL,GAAWiE,KAAK,CAACtC,EAAN,CAAS+R,KAAT,EAAgB1T,CAAC,GAAG,CAApB,CAAX,IAAqCkc,KAAhD;IACA,QAAIkC,UAAU,GAAGJ,GAAG,IAAIE,GAAP,GAAa,CAAb,GAAiBD,IAAI,IAAIE,IAAR,GAAe,CAAf,GAAmB,CAArD;IAEA,QAAIE,KAAK,GAAGhL,KAAK,CAACrT,CAAD,CAAL,GAAWiE,KAAK,CAACtC,EAAN,CAAS0R,KAAT,EAAgBrT,CAAC,GAAGmc,OAApB,CAAX,IAA2C,CAAvD;IACA,QAAImC,MAAM,GAAGjL,KAAK,CAACrT,CAAD,CAAL,GAAWiE,KAAK,CAACtC,EAAN,CAAS0R,KAAT,EAAgBrT,CAAC,GAAGmc,OAApB,CAAX,IAA2CD,KAAxD;IACA,QAAIqC,KAAK,GAAG7K,KAAK,CAAC1T,CAAD,CAAL,GAAWiE,KAAK,CAACtC,EAAN,CAAS+R,KAAT,EAAgB1T,CAAC,GAAGmc,OAApB,CAAX,IAA2C,CAAvD;IACA,QAAIqC,MAAM,GAAG9K,KAAK,CAAC1T,CAAD,CAAL,GAAWiE,KAAK,CAACtC,EAAN,CAAS+R,KAAT,EAAgB1T,CAAC,GAAGmc,OAApB,CAAX,IAA2CD,KAAxD;IACA,QAAIuC,YAAY,GAAGJ,KAAK,IAAIE,KAAT,GAAiB,CAAjB,GAAqBD,MAAM,IAAIE,MAAV,GAAmB,CAAnB,GAAuB,CAA/D;IAEAlB,IAAAA,MAAM,CAACtd,CAAD,CAAN,GACIoe,UAAU,IAAI,CAAd,IAAmBK,YAAY,IAAI,CAAnC,GAAuC,CAAvC,GAA2CL,UAAU,IAAI,CAAd,GAAkB,CAAlB,GAAsB,CADrE;IAGA,QAAIM,GAAG,GAAG3K,KAAK,CAAC/T,CAAD,CAAL,GAAWiE,KAAK,CAACtC,EAAN,CAASoS,KAAT,EAAgB/T,CAAC,GAAG,CAApB,CAAX,IAAqC,CAA/C;IACA,QAAI2e,IAAI,GAAG5K,KAAK,CAAC/T,CAAD,CAAL,GAAWiE,KAAK,CAACtC,EAAN,CAASoS,KAAT,EAAgB/T,CAAC,GAAG,CAApB,CAAX,IAAqCkc,KAAhD;IACA,QAAI0C,GAAG,GAAGxK,KAAK,CAACpU,CAAD,CAAL,GAAWiE,KAAK,CAACtC,EAAN,CAASyS,KAAT,EAAgBpU,CAAC,GAAG,CAApB,CAAX,IAAqC,CAA/C;IACA,QAAI6e,IAAI,GAAGzK,KAAK,CAACpU,CAAD,CAAL,GAAWiE,KAAK,CAACtC,EAAN,CAASyS,KAAT,EAAgBpU,CAAC,GAAG,CAApB,CAAX,IAAqCkc,KAAhD;IACA,QAAI4C,WAAW,GAAGJ,GAAG,IAAIE,GAAP,GAAa,CAAb,GAAiBD,IAAI,IAAIE,IAAR,GAAe,CAAf,GAAmB,CAAtD;IAEA,QAAIE,KAAK,GAAGhL,KAAK,CAAC/T,CAAD,CAAL,GAAWiE,KAAK,CAACtC,EAAN,CAASoS,KAAT,EAAgB/T,CAAC,GAAGmc,OAApB,CAAX,IAA2C,CAAvD;IACA,QAAI6C,MAAM,GAAGjL,KAAK,CAAC/T,CAAD,CAAL,GAAWiE,KAAK,CAACtC,EAAN,CAASoS,KAAT,EAAgB/T,CAAC,GAAGmc,OAApB,CAAX,IAA2CD,KAAxD;IACA,QAAI+C,KAAK,GAAG7K,KAAK,CAACpU,CAAD,CAAL,GAAWiE,KAAK,CAACtC,EAAN,CAASyS,KAAT,EAAgBpU,CAAC,GAAGmc,OAApB,CAAX,IAA2C,CAAvD;IACA,QAAI+C,MAAM,GAAG9K,KAAK,CAACpU,CAAD,CAAL,GAAWiE,KAAK,CAACtC,EAAN,CAASyS,KAAT,EAAgBpU,CAAC,GAAGmc,OAApB,CAAX,IAA2CD,KAAxD;IACA,QAAIiD,aAAa,GAAGJ,KAAK,IAAIE,KAAT,GAAiB,CAAjB,GAAqBD,MAAM,IAAIE,MAAV,GAAmB,CAAnB,GAAuB,CAAhE;IAEA3B,IAAAA,MAAM,CAACvd,CAAD,CAAN,GACI8e,WAAW,IAAI,CAAf,IAAoBK,aAAa,IAAI,CAArC,GACM,CADN,GAEML,WAAW,IAAI,CAAf,IAAoBK,aAAa,IAAI,CAArC,GACA,CADA,GAEA,CALV;IAOA,QAAIC,GAAG,GAAG3K,KAAK,CAACzU,CAAD,CAAL,GAAWiE,KAAK,CAACtC,EAAN,CAAS8S,KAAT,EAAgBzU,CAAC,GAAG,CAApB,CAAX,IAAqC,CAA/C;IACA,QAAIqf,IAAI,GAAG5K,KAAK,CAACzU,CAAD,CAAL,GAAWiE,KAAK,CAACtC,EAAN,CAAS8S,KAAT,EAAgBzU,CAAC,GAAG,CAApB,CAAX,IAAqCkc,KAAhD;IACA,QAAIoD,GAAG,GAAG1K,KAAK,CAAC5U,CAAD,CAAL,GAAWiE,KAAK,CAACtC,EAAN,CAASiT,KAAT,EAAgB5U,CAAC,GAAG,CAApB,CAAX,IAAqC,CAA/C;IACA,QAAIuf,IAAI,GAAG3K,KAAK,CAAC5U,CAAD,CAAL,GAAWiE,KAAK,CAACtC,EAAN,CAASiT,KAAT,EAAgB5U,CAAC,GAAG,CAApB,CAAX,IAAqCkc,KAAhD;IACA,QAAIsD,SAAS,GAAGJ,GAAG,IAAIE,GAAP,GAAa,CAAb,GAAiBD,IAAI,IAAIE,IAAR,GAAe,CAAf,GAAmB,CAApD;IAEA,QAAIE,KAAK,GAAGhL,KAAK,CAACzU,CAAD,CAAL,GAAWiE,KAAK,CAACtC,EAAN,CAAS8S,KAAT,EAAgBzU,CAAC,GAAGmc,OAApB,CAAX,IAA2C,CAAvD;IACA,QAAIuD,MAAM,GAAGjL,KAAK,CAACzU,CAAD,CAAL,GAAWiE,KAAK,CAACtC,EAAN,CAAS8S,KAAT,EAAgBzU,CAAC,GAAGmc,OAApB,CAAX,IAA2CD,KAAxD;IACA,QAAIyD,KAAK,GAAG/K,KAAK,CAAC5U,CAAD,CAAL,GAAWiE,KAAK,CAACtC,EAAN,CAASiT,KAAT,EAAgB5U,CAAC,GAAGmc,OAApB,CAAX,IAA2C,CAAvD;IACA,QAAIyD,MAAM,GAAGhL,KAAK,CAAC5U,CAAD,CAAL,GAAWiE,KAAK,CAACtC,EAAN,CAASiT,KAAT,EAAgB5U,CAAC,GAAGmc,OAApB,CAAX,IAA2CD,KAAxD;IACA,QAAI2D,WAAW,GAAGJ,KAAK,IAAIE,KAAT,GAAiB,CAAjB,GAAqBD,MAAM,IAAIE,MAAV,GAAmB,CAAnB,GAAuB,CAA9D;IAEApC,IAAAA,MAAM,CAACxd,CAAD,CAAN,GACIwf,SAAS,IAAI,CAAb,IAAkBK,WAAW,IAAI,CAAjC,GACM,CADN,GAEML,SAAS,IAAI,CAAb,IAAkBK,WAAW,IAAI,CAAjC,GACA,CADA,GAEA,CALV;IAOApC,IAAAA,WAAW,CAACzd,CAAD,CAAX,GAAiBsd,MAAM,CAACtd,CAAD,CAAN,IAAaoc,KAAK,GAAGmB,MAAM,CAACvd,CAAD,CAAT,GAAewd,MAAM,CAACxd,CAAD,CAAvC,CAAjB,CAvDuC;;IAyDvC0d,IAAAA,QAAQ,CAAC1d,CAAD,CAAR,GACI,CAAC+T,KAAK,CAAC/T,CAAD,CAAL,IAAY+T,KAAK,CAAC/T,CAAD,CAAL,IAAY,CAAxB,GAA4B,CAA5B,GAAgC,CAAjC,KACCoU,KAAK,CAACpU,CAAD,CAAL,IAAYoU,KAAK,CAACpU,CAAD,CAAL,IAAY,CAAxB,GAA4B,CAA5B,GAAgC,CADjC,KAECyU,KAAK,CAACzU,CAAD,CAAL,IAAYyU,KAAK,CAACzU,CAAD,CAAL,IAAY,CAAxB,GAA4B,CAA5B,GAAgC,CAFjC,KAGC4U,KAAK,CAAC5U,CAAD,CAAL,IAAY4U,KAAK,CAAC5U,CAAD,CAAL,IAAY,CAAxB,GAA4B,CAA5B,GAAgC,CAHjC,CADJ,CAzDuC;;IAgEvC,QAAI8f,OAAO,GAAG/J,QAAQ,IAAIA,QAAQ,CAAC,CAAD,CAApB,IAA2BA,QAAQ,CAAC,CAAD,CAAR,CAAY/V,CAAZ,CAAzC;IACA,QAAI+f,OAAO,GAAGlK,MAAM,IAAIA,MAAM,CAAC,CAAD,CAAhB,IAAuBA,MAAM,CAAC,CAAD,CAAN,CAAU7V,CAAV,CAArC;IACA,QAAIggB,KAAK,GAAGF,OAAO,IAAIC,OAAX,IAAsBD,OAAO,GAAGC,OAA5C,CAlEuC;IAoEvC;;IACAnC,IAAAA,QAAQ,CAAC5d,CAAD,CAAR,GAAcggB,KAAK,GAAG,CAAH,GAAO,CAA1B;IACAnC,IAAAA,QAAQ,CAAC7d,CAAD,CAAR,GACI2d,MAAM,IAAIA,MAAM,CAAC3d,CAAD,CAAhB,IAAuB2d,MAAM,CAAC3d,CAAD,CAAN,GAAY,CAAnC,GACMA,CAAC,GAAG,CAAJ,IACA2d,MADA,IAEAA,MAAM,CAAC3d,CAAD,CAFN,IAGA2d,MAAM,CAAC3d,CAAC,GAAG,CAAL,CAHN,IAIA2d,MAAM,CAAC3d,CAAD,CAAN,GAAY2d,MAAM,CAAC3d,CAAC,GAAG,CAAL,CAJlB,GAKI,CALJ,GAMI,CAPV,GAQMA,CAAC,GAAG,CAAJ,IACA2d,MADA,IAEAA,MAAM,CAAC3d,CAAD,CAFN,IAGA2d,MAAM,CAAC3d,CAAC,GAAG,CAAL,CAHN,IAIA2d,MAAM,CAAC3d,CAAD,CAAN,GAAY2d,MAAM,CAAC3d,CAAC,GAAG,CAAL,CAJlB,GAKA,CAAC,CALD,GAMA,CAAC,CAfX;IAiBA8d,IAAAA,YAAY,CAAC9d,CAAD,CAAZ,GACIA,CAAC,GAAG,CAAJ,IACA4d,QAAQ,CAAC5d,CAAD,CAAR,KAAgB,CADhB,IAEA4d,QAAQ,CAAC5d,CAAC,GAAG,CAAL,CAAR,KAAoB,CAFpB,IAGA2d,MAAM,CAAC3d,CAAD,CAAN,IAAa,CAHb,IAIA2d,MAAM,CAAC3d,CAAD,CAAN,GAAYiE,KAAK,CAACtC,EAAN,CAASgc,MAAT,EAAiB3d,CAAC,GAAG,CAArB,CAJZ,IAKAyd,WAAW,CAACzd,CAAD,CAAX,IAAkBsc,SALlB,GAMM,CANN,GAOMsB,QAAQ,CAAC5d,CAAD,CAAR,KAAgB,CAAhB,IACA2d,MAAM,CAAC3d,CAAD,CAAN,IAAa,CADb,IAEA2d,MAAM,CAAC3d,CAAD,CAAN,GAAYiE,KAAK,CAACtC,EAAN,CAASgc,MAAT,EAAiB3d,CAAC,GAAG,CAArB,CAFZ,IAGAyd,WAAW,CAACzd,CAAD,CAAX,IAAkBqc,YAHlB,GAIA,CAJA,GAKA,CAbV;IAeA0B,IAAAA,aAAa,CAAC/d,CAAD,CAAb,GACI4d,QAAQ,CAAC5d,CAAD,CAAR,KAAgB,CAAhB,IACAiE,KAAK,CAACtC,EAAN,CAASic,QAAT,EAAmB5d,CAAC,GAAG,CAAvB,MAA8B,CAD9B,IAEA,EAAE2d,MAAM,CAAC3d,CAAD,CAAN,IAAa,CAAb,IAAkB2d,MAAM,CAAC3d,CAAD,CAAN,IAAaiE,KAAK,CAACtC,EAAN,CAASgc,MAAT,EAAiB3d,CAAC,GAAG,CAArB,CAAjC,CAFA,GAGM,CAHN,GAIM4d,QAAQ,CAAC5d,CAAD,CAAR,KAAgB,CAAhB,KAAsBoe,UAAU,KAAK,CAAf,IAAoBK,YAAY,KAAK,CAA3D,IACA,CADA,GAEA,CAPV;IAQH,GAjMH;;;IAoME,MAAInD,GAAG,GAAGE,GAAG,CAAC9J,SAAJ,CAAcF,SAAd,EAAyB;IAAE7R,IAAAA,CAAC,EAAEmd,EAAL;IAAStf,IAAAA;IAAT,GAAzB,CAAV;IACA,MAAIyiB,KAAK,GAAGpO,EAAE,CAACH,SAAH,CAAa4J,GAAb,EAAkB;IAC1B3b,IAAAA,CAAC,EAAEod,GADuB;IAE1Brc,IAAAA,IAAI,EAAE,IAFoB;IAG1B+Q,IAAAA,MAAM,EAAE,IAHkB;IAI1BjU,IAAAA;IAJ0B,GAAlB,CAAZ;IAMA,MAAIue,SAAS,GAAG,EAAhB;IAEA,MAAImE,GAAG,GAAG,EAAV;IACA,MAAIC,GAAG,GAAG,EAAV;IACA,MAAIC,GAAG,GAAG,EAAV;IACA,MAAIC,KAAK,GAAG,EAAZ;IAEA,MAAIC,QAAQ,GAAGrc,KAAK,CAAC9C,KAAN,CAAYma,GAAZ,EAAiByB,GAAjB,EAAsB,IAAtB,EAA4Bvf,MAA5B,CAAf;IACA,MAAI+iB,KAAK,GAAG,EAAZ;IACA,MAAIC,OAAO,GAAG,EAAd;IACA,MAAIC,UAAU,GAAG,EAAjB;IACA,MAAIC,UAAU,GAAG,EAAjB;IACA,MAAIC,SAAS,GAAG,EAAhB;IACA,MAAIC,UAAU,GAAG,EAAjB;IACA,MAAIC,UAAU,GAAG,EAAjB;IACA,MAAIC,SAAS,GAAG,EAAhB;IACA,MAAIC,SAAS,GAAG,EAAhB;IAEA,MAAIC,YAAY,GAAG,EAAnB;IACA,MAAIC,aAAa,GAAG,EAApB;IACA,MAAIC,cAAc,GAAG,EAArB;;IACA,OAAK,IAAIlhB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGigB,KAAK,CAAChiB,MAA1B,EAAkC+B,CAAC,EAAnC,EAAuC;IACnC+b,IAAAA,SAAS,CAAC/b,CAAD,CAAT,GAAeiE,KAAK,CAAC9D,OAAN,CAAcmb,GAAd,EAAmBtb,CAAnB,EAAsB6S,EAAtB,EAA0B,IAA1B,EAAgCrV,MAAhC,CAAf;IACA0iB,IAAAA,GAAG,CAAClgB,CAAD,CAAH,GAASiE,KAAK,CAAC9D,OAAN,CAAcmb,GAAd,EAAmBtb,CAAnB,EAAsBid,IAAtB,EAA4B,IAA5B,EAAkCzf,MAAlC,CAAT;IACA2iB,IAAAA,GAAG,CAACngB,CAAD,CAAH,GAASiE,KAAK,CAAC1D,MAAN,CAAa+a,GAAb,EAAkBtb,CAAlB,EAAqBid,IAArB,EAA2B,IAA3B,EAAiCzf,MAAjC,CAAT;IACA+iB,IAAAA,KAAK,CAACvgB,CAAD,CAAL,GAAWiE,KAAK,CAACtF,OAAN,CAAcshB,KAAK,CAACjgB,CAAD,CAAL,GAAWgd,IAAI,GAAGsD,QAAQ,CAACtgB,CAAD,CAAxC,EAA6CxC,MAA7C,CAAX;IACAgjB,IAAAA,OAAO,CAACxgB,CAAD,CAAP,GAAaiE,KAAK,CAACtF,OAAN,CAAcshB,KAAK,CAACjgB,CAAD,CAAL,GAAWgd,IAAI,GAAGsD,QAAQ,CAACtgB,CAAD,CAAxC,EAA6CxC,MAA7C,CAAb;IAEAue,IAAAA,SAAS,CAAC/b,CAAD,CAAT,GACI+b,SAAS,IAAIA,SAAS,CAAC/b,CAAD,CAAtB,GAA4B+b,SAAS,CAAC/b,CAAD,CAAT,GAAe8b,EAA3C,GAAgDC,SAAS,CAAC/b,CAAD,CAD7D;IAGAogB,IAAAA,GAAG,CAACpgB,CAAD,CAAH,GACIsb,GAAG,CAACtb,CAAD,CAAH,IAAUmgB,GAAG,CAACngB,CAAD,CAAb,IAAoBkgB,GAAG,CAAClgB,CAAD,CAAvB,IAA8BkgB,GAAG,CAAClgB,CAAD,CAAH,GAASmgB,GAAG,CAACngB,CAAD,CAAZ,IAAmB,CAAjD,GACO,SAASsb,GAAG,CAACtb,CAAD,CAAH,GAASmgB,GAAG,CAACngB,CAAD,CAArB,CAAD,IAA+BkgB,GAAG,CAAClgB,CAAD,CAAH,GAASmgB,GAAG,CAACngB,CAAD,CAA3C,CADN,GAEM,CAHV;IAIA,QAAKqgB,KAAK,CAACrgB,CAAD,CAAV,IAAiBiE,KAAK,CAAClC,MAAN,CAAaqe,GAAb,EAAkBpgB,CAAlB,EAAqB,IAArB,EAA2Bod,SAA3B,CAAjB;IAEAqD,IAAAA,UAAU,CAACzgB,CAAD,CAAV,GAAgBsb,GAAG,CAACtb,CAAD,CAAH,IAAUugB,KAAK,CAACvgB,CAAD,CAAf,IAAsBsb,GAAG,CAACtb,CAAD,CAAH,IAAU+b,SAAS,CAAC/b,CAAD,CAAzC,GAA+C,CAA/C,GAAmD,CAAnE;IACA0gB,IAAAA,UAAU,CAAC1gB,CAAD,CAAV,GACI,CAACiE,KAAK,CAACtC,EAAN,CAAS2Z,GAAT,EAActb,CAAC,GAAG,CAAlB,KAAwBiE,KAAK,CAACtC,EAAN,CAAS4e,KAAT,EAAgBvgB,CAAC,GAAG,CAApB,CAAxB,IACGiE,KAAK,CAACtC,EAAN,CAAS2Z,GAAT,EAActb,CAAC,GAAG,CAAlB,KAAwBiE,KAAK,CAACtC,EAAN,CAASoa,SAAT,EAAoB/b,CAAC,GAAG,CAAxB,CAD5B,KAEAsb,GAAG,CAACtb,CAAD,CAAH,GAASugB,KAAK,CAACvgB,CAAD,CAFd,IAGAsb,GAAG,CAACtb,CAAD,CAAH,GAAS+b,SAAS,CAAC/b,CAAD,CAHlB,GAIM,CAJN,GAKM,CANV;IAOA2gB,IAAAA,SAAS,CAAC3gB,CAAD,CAAT,GAAe0gB,UAAU,CAAC1gB,CAAD,CAAzB;IAEA4gB,IAAAA,UAAU,CAAC5gB,CAAD,CAAV,GACIogB,GAAG,CAACpgB,CAAD,CAAH,IAAUogB,GAAG,CAACpgB,CAAD,CAAH,GAASkd,KAAnB,GAA2B,CAA3B,GAA+BkD,GAAG,CAACpgB,CAAD,CAAH,IAAUogB,GAAG,CAACpgB,CAAD,CAAH,GAASmd,KAAnB,GAA2B,CAAC,CAA5B,GAAgC,CADnE;IAEA0D,IAAAA,UAAU,CAAC7gB,CAAD,CAAV,GACIqgB,KAAK,CAACrgB,CAAD,CAAL,IAAYqgB,KAAK,CAACrgB,CAAD,CAAL,GAAWkd,KAAvB,GACM,CADN,GAEMmD,KAAK,CAACrgB,CAAD,CAAL,IAAYqgB,KAAK,CAACrgB,CAAD,CAAL,GAAWmd,KAAvB,GACA,CAAC,CADD,GAEA,CALV;IAMA4D,IAAAA,SAAS,CAAC/gB,CAAD,CAAT,GAAe4gB,UAAU,CAAC5gB,CAAD,CAAV,KAAkB,CAAlB,IAAuB6gB,UAAU,CAAC7gB,CAAD,CAAV,KAAkB,CAAxD;IACA8gB,IAAAA,SAAS,CAAC9gB,CAAD,CAAT,GACI+gB,SAAS,CAAC/gB,CAAD,CAAT,KAAiB,KAAjB,IAA0BiE,KAAK,CAACtC,EAAN,CAASof,SAAT,EAAoB/gB,CAAC,GAAG,CAAxB,EAA2B,KAA3B,MAAsC,IAAhE,GACM,CADN,GAEM,CAHV;IAKAghB,IAAAA,YAAY,CAAChhB,CAAD,CAAZ,GACI8gB,SAAS,CAAC9gB,CAAD,CAAT,KAAiB,CAAjB,IAAsB2gB,SAAS,CAAC3gB,CAAD,CAAT,KAAiB,CAAvC,GACM,CADN,GAEM8gB,SAAS,CAAC9gB,CAAD,CAAT,KAAiB,CAAjB,IAAsB2gB,SAAS,CAAC3gB,CAAD,CAAT,KAAiB,CAAvC,GACA,CADA,GAEA,CALV;IAMAihB,IAAAA,aAAa,CAACjhB,CAAD,CAAb,GACIyd,WAAW,CAACzd,CAAD,CAAX,IAAkBsc,SAAlB,IACA0E,YAAY,CAAChhB,CAAD,CAAZ,KAAoB,CADpB,IAEA8d,YAAY,CAAC9d,CAAD,CAAZ,IAAmB,CAFnB,IAGA0d,QAAQ,CAAC1d,CAAD,CAAR,IAAewc,aAHf,GAIM,CAJN,GAKM,CAAEiB,WAAW,CAACzd,CAAD,CAAX,IAAkBsc,SAAlB,IAA+B0E,YAAY,CAAChhB,CAAD,CAAZ,KAAoB,CAApD,IACG8d,YAAY,CAAC9d,CAAD,CAAZ,KAAoB,CADxB,KAEA0d,QAAQ,CAAC1d,CAAD,CAAR,IAAewc,aAFf,GAGA,CAHA,GAIA,CAVV;IAYA,QAAI2E,OAAO,GAAG/E,KAAK,GAAGmB,MAAM,CAACvd,CAAD,CAAT,GAAewd,MAAM,CAACxd,CAAD,CAAxC;IACAkhB,IAAAA,cAAc,CAAClhB,CAAD,CAAd,GAAoBsd,MAAM,CAACtd,CAAD,CAAN,KAAc,CAAd,IAAmBmhB,OAAO,GAAG5E,UAA7B,GAA0C,CAA1C,GAA8C,CAAlE;IACH;;IAED,MAAIva,GAAG,GAAGwP,SAAS,CAACvT,MAApB,CA9RF;IAgSE;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;;IAEA,SAAO,CACHgjB,aADG;IAEHC,EAAAA,cAFG;IAGHzD,EAAAA,WAHG;IAIHC,EAAAA,QAJG;IAKHI,EAAAA,YALG;IAMHC,EAAAA,aANG;IAOHiD,EAAAA,YAPG;IAQHF,EAAAA,SARG;IASHM,EAAAA,SATG;IAUHA,EAAAA,SAVG;IAWHA,EAAAA,SAXG;IAaH;IACA9D,EAAAA,MAdG;IAeHC,EAAAA,MAfG;IAgBHC,EAAAA,MAhBG;IAiBHiD,EAAAA,UAjBG;IAkBHC,EAAAA,UAlBG;IAmBHE,EAAAA,UAnBG;IAoBHC,EAAAA,UApBG;IAqBHO,EAAAA,SArBG;IAsBHA,EAAAA,SAtBG;IAuBHA,EAAAA,SAvBG;IAyBH;IACA/N,EAAAA,KA1BG;IA2BHK,EAAAA,KA3BG;IA4BHK,EAAAA,KA5BG;IA6BHK,EAAAA,KA7BG;IA8BHK,EAAAA,KA9BG;IA+BHG,EAAAA,KA/BG;IAgCHwM,EAAAA,SAhCG;IAiCHA,EAAAA,SAjCG;IAkCHA,EAAAA,SAlCG;IAmCHA,EAAAA,SAnCG;IAqCH;IACAxD,EAAAA,QAtCG;IAuCHC,EAAAA,QAvCG;IAwCHF,EAAAA,MAxCG;IAyCHyD,EAAAA,SAzCG;IA0CHA,EAAAA,SA1CG;IA2CHA,EAAAA,SA3CG;IA4CHA,EAAAA,SA5CG;IA6CHA,EAAAA,SA7CG;IA8CHA,EAAAA,SA9CG;IA+CHA,EAAAA,SA/CG;IAiDH;IACA9F,EAAAA,GAlDG;IAmDH2E,EAAAA,KAnDG;IAoDHM,EAAAA,KApDG;IAqDHC,EAAAA,OArDG;IAsDHJ,EAAAA,GAtDG;IAuDHC,EAAAA,KAvDG;IAAA,GAAP;IAyDH;;AAED,mBAAe;IACXxc,EAAAA,IAAI,EAAE,UADK;IAEX+G,EAAAA,KAAK,EAAE,IAFI;IAGX+E,EAAAA,WAAW,EAAE,MAHF;IAIX+B,EAAAA,SAAS,EAAEuK,QAJA;IAKX1F,EAAAA,MAAM,EAAE;IALG,CAAf;;IC5dA,MAAM9T,OAAK,GAAGC,4BAAQ,CAAC,gBAAD,CAAtB;IAEA,MAAM0M,WAAS,GAAG,UAAlB;IACA,MAAMiS,aAAa,GAAGjkB,MAAM,CAAC,eAAD,CAA5B;;IAEA,SAAS+P,OAAT,CAAezN,KAAf,EAAsBkD,SAAtB,EAAiCE,OAAjC,EAA0CsJ,MAA1C,EAAkD;IAC9C,MAAI8K,KAAK,GAAGoK,QAAQ,CAAC5P,SAAT,CAAmB9O,SAAnB,EAA8BE,OAAO,CAACmZ,QAAtC,CAAZ;;IAEA,MACIrZ,SAAS,IACTnF,qBAAC,CAACE,OAAF,CAAUiF,SAAV,CADA,IAEAlD,KAAK,GAAGkD,SAAS,CAAC3E,MAFlB,IAGAyB,KAAK,IAAI,CAJb,EAKE;IACE,QAAIsD,SAAS,GAAGJ,SAAS,CAAClD,KAAD,CAAT,CAAiBF,UAAjC;IACA,QAAI+hB,QAAQ,GAAGrK,KAAK,CAAC,CAAD,CAApB;IACA,QAAIsK,SAAS,GAAGtK,KAAK,CAAC,CAAD,CAArB,CAHF;IAME;IACA;IACA;IAEA;IACA;IACA;IACA;;IAEA,QAAIqK,QAAQ,CAAC7hB,KAAD,CAAR,IAAmB,CAAvB,EAA0B;IACtB;IACA,aAAO;IACH0M,QAAAA,MADG;IAEH+E,QAAAA,SAAS,EAAEzR,KAFR;IAGHwF,QAAAA,IAAI,EAAElC,SAHH;IAIHsK,QAAAA,SAAS,EAAE,KAJR;IAKHF,QAAAA,UAAU,EAAE,IALT;IAMHG,QAAAA,MAAM,EAAE,KANL;IAOH7M,QAAAA,IAAI,EAAE,UAPH;IAQHub,QAAAA,QAAQ,EAAE,EARP;IASH1X,QAAAA,IAAI,EAAG,WAAU3B,SAAS,CAAClD,KAAD,CAAT,CAAiBF,UAAW,IAAG+hB,QAAQ,CAAC7hB,KAAD,CAAQ;IAT7D,OAAP;IAWH,KAbD,MAaO,IAAI8hB,SAAS,CAAC9hB,KAAD,CAAT,IAAoB,CAAxB,EAA2B;IAC9B,aAAO;IACH0M,QAAAA,MADG;IAEH+E,QAAAA,SAAS,EAAEzR,KAFR;IAGHwF,QAAAA,IAAI,EAAElC,SAHH;IAIHoK,QAAAA,UAAU,EAAE,IAJT;IAKHE,QAAAA,SAAS,EAAE,MALR;IAMHC,QAAAA,MAAM,EAAE,MANL;IAOH7M,QAAAA,IAAI,EAAE,UAPH;IAQHub,QAAAA,QAAQ,EAAE,EARP;IASH1X,QAAAA,IAAI,EAAG,WAAU3B,SAAS,CAAClD,KAAD,CAAT,CAAiBF,UAAW,IAAGgiB,SAAS,CAAC9hB,KAAD,CAAQ;IAT9D,OAAP;IAWH;IACJ;IACJ;;IAED,SAASgb,eAAT,CAAuB9X,SAAvB,EAAkCE,OAAlC,EAA2C;IACvC,MAAIrF,qBAAC,CAACqE,KAAF,CAAQc,SAAR,CAAJ,EAAwB;IAExB,MAAIZ,GAAG,GACHY,SAAS,IACTA,SAAS,CAACye,aAAD,CADT,IAEAze,SAAS,CAACye,aAAD,CAAT,CAAyB,CAAzB,CAFA,IAGAze,SAAS,CAACye,aAAD,CAAT,CAAyB,CAAzB,EAA4BpjB,MAJhC;;IAKA,MAAIR,qBAAC,CAACqE,KAAF,CAAQc,SAAS,CAACye,aAAD,CAAjB,KAAqCze,SAAS,CAAC3E,MAAV,IAAoB+D,GAA7D,EAAkE;IAC9DY,IAAAA,SAAS,CAACye,aAAD,CAAT,GAA2BC,QAAQ,CAAC5P,SAAT,CACvB9O,SADuB,EAEvBE,OAAO,CAACqS,OAFe,CAA3B;IAIH;IACJ;;IAED,SAASvQ,qBAAT,CAA6B3B,SAA7B,EAAwCyB,OAAxC,EAAiDhF,KAAjD,EAAwDkD,SAAxD,EAAmEE,OAAnE,EAA4E;IACxEL,EAAAA,OAAK,CAAE,UAAS/C,KAAM,KAAIgF,OAAQ,EAA7B,CAAL;IACA,MAAIA,OAAO,IAAI,CAAf,EAAkB;IAClBgW,EAAAA,eAAa,CAAC9X,SAAD,EAAYE,OAAZ,CAAb;IAEA,MAAIpD,KAAK,GAAG,CAAZ,EAAe,OALyD;;IAOxE,MAAIwX,KAAK,GAAGtU,SAAS,CAACye,aAAD,CAArB;IACA,MAAIE,QAAQ,GAAGrK,KAAK,CAAC,CAAD,CAApB,CARwE;IAWxE;;IACA,MAAIqK,QAAQ,CAAC7hB,KAAD,CAAR,IAAmB,CAAvB,EAA0B;IACtB,QAAI2P,WAAW,GAAGzM,SAAS,CAAClD,KAAD,CAA3B;IACA,QAAIsD,SAAS,GAAGqM,WAAW,CAAC7P,UAA5B;IACA,QAAI8P,WAAW,GAAGD,WAAW,CAAC/Q,KAA9B;IACA,WAAO2K,KAAK,CAACrD,oBAAN,CACH3C,SADG,EAEHD,SAFG,EAGHtD,KAHG,EAIHgF,OAJG,EAKH4K,WALG,EAMHF,WANG,EAOF,UAASE,WAAW,CAAC3Q,OAAZ,CAAoB,CAApB,CAAuB,EAP9B,CAAP;IASH;IACJ;;IAED,SAASmF,sBAAT,CAA8Bb,SAA9B,EAAyCS,KAAzC,EAAgDhE,KAAhD,EAAuDkD,SAAvD,EAAkEE,OAAlE,EAA2E;IACvE,MAAIrF,qBAAC,CAACqE,KAAF,CAAQ4B,KAAR,KAAkBA,KAAK,CAACzD,KAAN,IAAe,CAArC,EAAwC;IACxCya,EAAAA,eAAa,CAAC9X,SAAD,EAAYE,OAAZ,CAAb;IAEA,MAAIpD,KAAK,GAAG,CAAZ,EAAe,OAJwD;;IAMvE,MAAIwX,KAAK,GAAGtU,SAAS,CAACye,aAAD,CAArB;IACA,MAAIG,SAAS,GAAGtK,KAAK,CAAC,CAAD,CAArB;;IACA,MAAIsK,SAAS,IAAIA,SAAS,CAAC9hB,KAAD,CAAT,IAAoB,CAArC,EAAwC;IACpC,QAAI2P,WAAW,GAAGzM,SAAS,CAAClD,KAAD,CAA3B;IACA,QAAIsD,SAAS,GAAGqM,WAAW,CAAC7P,UAA5B;IACA,QAAI8P,WAAW,GAAGD,WAAW,CAAC/Q,KAA9B;IACA,WAAO2K,KAAK,CAAC3D,qBAAN,CACHrC,SADG,EAEHD,SAFG,EAGHtD,KAHG,EAIHgE,KAAK,CAACzD,KAJH,EAKHqP,WALG,EAMHF,WANG,EAOF,UAASE,WAAW,CAAC3Q,OAAZ,CAAoB,CAApB,CAAuB,EAP9B,CAAP;IASH;IACJ;IAED;;;;;;IAIA,SAASoM,aAAT,CAAqBjI,OAArB,EAA8B;IAC1B,MAAImV,GAAG,GAAGnV,OAAO,IAAIA,OAAO,CAACmZ,QAA7B;IACA,SAAQ;KACPA,UAAQ,CAACpY,IAAK,IAAGoY,UAAQ,CAACrR,KAAM;;CADjC;IAIH;IAED;;;;;;;;IAMA,eAAegD,eAAf,CAA6BnF,OAA7B,EAAsC3F,OAAtC,EAA+C;IAC3C,MAAIrF,qBAAC,CAACqE,KAAF,CAAQ2G,OAAR,CAAJ,EAAsB;IAEtB,MAAIY,OAAO,GAAG,EAAd,CAH2C;IAK3C;;IACA,MAAI8O,OAAO,GAAG1P,OAAO,IAAIA,OAAO,CAAC,KAAD,CAAhC;IACA,MAAI0S,QAAQ,GAAG1S,OAAO,IAAIA,OAAO,CAAC,MAAD,CAAjC;IAEA,MAAIgZ,KAAK,GAAG,CAAC;IAAE7W,IAAAA,KAAK,EAAE,IAAT;IAAerN,IAAAA,IAAI,EAAE;IAArB,GAAD,CAAZ;;IACA,MAAI,CAACE,qBAAC,CAACC,OAAF,CAAUya,OAAV,CAAL,EAAyB;IACrB,SAAK,IAAIha,IAAT,IAAiBga,OAAjB,EAA0B;IACtBsJ,MAAAA,KAAK,CAAC,CAAD,CAAL,CAASlkB,IAAT,CAAcwH,IAAd,CAAmB5G,IAAI,CAACiO,MAAxB;IACH;;IACD/C,IAAAA,OAAO,CAACtE,IAAR,CAAa;IAAE6F,MAAAA,KAAK,EAAE,KAAT;IAAgBrN,MAAAA,IAAI,EAAEkkB;IAAtB,KAAb;IACH;;IAEDA,EAAAA,KAAK,GAAG,CAAC;IAAE7W,IAAAA,KAAK,EAAE,IAAT;IAAerN,IAAAA,IAAI,EAAE;IAArB,GAAD,CAAR;;IACA,MAAI,CAACE,qBAAC,CAACC,OAAF,CAAUyd,QAAV,CAAL,EAA0B;IACtB,SAAK,IAAIhd,IAAT,IAAiBgd,QAAjB,EAA2B;IACvBsG,MAAAA,KAAK,CAAC,CAAD,CAAL,CAASlkB,IAAT,CAAcwH,IAAd,CAAmB5G,IAAI,CAACiO,MAAxB;IACH;;IACD/C,IAAAA,OAAO,CAACtE,IAAR,CAAa;IAAE6F,MAAAA,KAAK,EAAE,MAAT;IAAiBrN,MAAAA,IAAI,EAAEkkB;IAAvB,KAAb;IACH;;IAED,SAAOpY,OAAP;IACH;;IAED,MAAM4S,UAAQ,GAAG;IACbpY,EAAAA,IAAI,EAAE,MADO;IAEb+G,EAAAA,KAAK,EAAEwE,WAFM;IAIbO,EAAAA,WAAW,EAAE,UAJA;IAKbC,EAAAA,WAAW,EAAE,EALA;IAMbhL,uBAAAA,qBANa;IAObd,wBAAAA,sBAPa;IAQbqJ,SAAAA,OARa;IASbpC,eAAAA,aATa;IAUb6C,iBAAAA;IAVa,CAAjB;;IChLA;;;;;;;;;IAYA,SAAS8T,EAAT,CAAYlQ,SAAZ,EAAuB1O,OAAvB,EAAgC;IAC5BmB,EAAAA,KAAK,CAAC3G,cAAN,CAAqBkU,SAArB;;IAEA,MACI,CAAC/T,qBAAC,CAACC,OAAF,CAAU8T,SAAV,CAAD,IACA/T,qBAAC,CAACE,OAAF,CAAU6T,SAAV,CADA,IAEAA,SAAS,CAACvT,MAAV,GAAmB,CAFnB,IAGA6E,OAHA,IAIAA,OAAO,CAACnD,CAAR,IAAa,CAJb,IAKAmD,OAAO,CAACmP,CAAR,IAAa,CANjB,EAOE;IACE,QAAIR,MAAM,GACN3O,OAAO,IAAIA,OAAO,CAAC2O,MAAR,KAAmB,MAA9B,GAAuCxN,KAAK,CAAChF,IAA7C,GAAoDgF,KAAK,CAAC/E,EAD9D;IAEA,QAAI1B,MAAM,GAAGsF,OAAO,CAACtF,MAAR,IAAkB,CAA/B;IAEA,QAAImb,GAAG,GAAG1U,KAAK,CAACxD,EAAN,CAAS+Q,SAAT,EAAoB1O,OAAO,CAACnD,CAA5B,EAA+B8R,MAA/B,EAAuC,IAAvC,EAA6CjU,MAA7C,CAAV;IACA,QAAIob,GAAG,GAAG3U,KAAK,CAACxD,EAAN,CAAS+Q,SAAT,EAAoB1O,OAAO,CAACmP,CAA5B,EAA+BR,MAA/B,EAAuC,IAAvC,EAA6CjU,MAA7C,CAAV;IAEA,QAAI2U,QAAQ,GAAGX,SAAS,CAACrF,GAAV,CAAc,CAAChO,IAAD,EAAO6B,CAAP,EAAUmP,GAAV,KAAkB;IAC3C,UAAInP,CAAC,IAAI8C,OAAO,CAACnD,CAAb,IAAkBK,CAAC,GAAG8C,OAAO,CAACmP,CAAlC,EAAqC;IACjC,eAAOhO,KAAK,CAACtF,OAAN,CAAcga,GAAG,CAAC3Y,CAAD,CAAH,GAAS4Y,GAAG,CAAC5Y,CAAD,CAA1B,EAA+BxC,MAA/B,CAAP;IACH,OAFD,MAEO;IACH,eAAO,CAAP;IACH;IACJ,KANc,CAAf;IAOA,WAAO2U,QAAP;IACH;IACJ;;AAED,aAAe;IACXtO,EAAAA,IAAI,EAAE,IADK;IAEX+G,EAAAA,KAAK,EAAE,QAFI;IAGX+E,EAAAA,WAAW,EAAE,eAHF;IAIX+B,EAAAA,SAAS,EAAEgQ;IAJA,CAAf;;ICzCA;;;;;;;;;;;;;IAgBA,MAAMC,MAAM,GAAGvkB,MAAM,CAAC,QAAD,CAArB;;IAGA,SAASwkB,WAAT,CAAqBpQ,SAArB,EAAgC;IAC5B,MAAI/T,qBAAC,CAACqE,KAAF,CAAQ0P,SAAR,CAAJ,EAAwB;;IACxB,MACI/T,qBAAC,CAACqE,KAAF,CAAQ0P,SAAS,CAACmQ,MAAD,CAAjB,KACCnQ,SAAS,IAAIA,SAAS,CAACvT,MAAV,IAAoBuT,SAAS,CAACmQ,MAAD,CAAT,CAAkB1jB,MAFxD,EAGE;IACE;IACA,QAAI4jB,MAAM,GAAG,EAAb;;IACA,SAAK,IAAI7hB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGwR,SAAS,CAACvT,MAA9B,EAAsC+B,CAAC,EAAvC,EAA2C;IACvC,UAAIA,CAAC,KAAK,CAAV,EAAa;IACT,YAAI8hB,EAAE,GAAGtQ,SAAS,CAACxR,CAAD,CAAT,CAAa3B,IAAtB;IACAwjB,QAAAA,MAAM,CAAC7hB,CAAD,CAAN,GAAY;IACR3B,UAAAA,IAAI,EAAEmT,SAAS,CAACxR,CAAD,CAAT,CAAa3B,IADX;IAERE,UAAAA,IAAI,EAAEiT,SAAS,CAACxR,CAAD,CAAT,CAAazB,IAFX;IAGRC,UAAAA,GAAG,EAAEgT,SAAS,CAACxR,CAAD,CAAT,CAAaxB,GAHV;IAIRF,UAAAA,KAAK,EAAEkT,SAAS,CAACxR,CAAD,CAAT,CAAa1B;IAJZ,SAAZ;IAMH,OARD,MAQO;IACHujB,QAAAA,MAAM,CAAC7hB,CAAD,CAAN,GAAY;IACR3B,UAAAA,IAAI,EAAE,CAACwjB,MAAM,CAAC7hB,CAAC,GAAG,CAAL,CAAN,CAAc3B,IAAd,GAAqBwjB,MAAM,CAAC7hB,CAAC,GAAG,CAAL,CAAN,CAAc1B,KAApC,IAA6C,CAD3C;IAERC,UAAAA,IAAI,EAAEiT,SAAS,CAACxR,CAAD,CAAT,CAAazB,IAFX;IAGRC,UAAAA,GAAG,EAAEgT,SAAS,CAACxR,CAAD,CAAT,CAAaxB,GAHV;IAIRF,UAAAA,KAAK,EACD,CAACkT,SAAS,CAACxR,CAAD,CAAT,CAAa3B,IAAb,GACGmT,SAAS,CAACxR,CAAD,CAAT,CAAazB,IADhB,GAEGiT,SAAS,CAACxR,CAAD,CAAT,CAAaxB,GAFhB,GAGGgT,SAAS,CAACxR,CAAD,CAAT,CAAa1B,KAHjB,IAIA;IATI,SAAZ;IAWAujB,QAAAA,MAAM,CAAC7hB,CAAD,CAAN,CAAUzB,IAAV,GAAiB8B,IAAI,CAACC,GAAL,CACbuhB,MAAM,CAAC7hB,CAAD,CAAN,CAAUzB,IADG,EAEbsjB,MAAM,CAAC7hB,CAAD,CAAN,CAAU3B,IAFG,EAGbwjB,MAAM,CAAC7hB,CAAD,CAAN,CAAU1B,KAHG,CAAjB;IAKAujB,QAAAA,MAAM,CAAC7hB,CAAD,CAAN,CAAUxB,GAAV,GAAgB6B,IAAI,CAACG,GAAL,CACZqhB,MAAM,CAAC7hB,CAAD,CAAN,CAAUxB,GADE,EAEZqjB,MAAM,CAAC7hB,CAAD,CAAN,CAAU3B,IAFE,EAGZwjB,MAAM,CAAC7hB,CAAD,CAAN,CAAU1B,KAHE,CAAhB;IAKH;IACJ;;IACDkT,IAAAA,SAAS,CAACmQ,MAAD,CAAT,GAAoBE,MAApB;IACH;IACJ;IAED;;;;;;;IAKA,SAASE,QAAT,CAAkBvQ,SAAlB,EAA6B;IAAE7R,EAAAA,CAAC,GAAG,CAAN;IAASe,EAAAA,IAAI,GAAG;IAAhB,IAA0B,EAAvD,EAA2D;IACvDuD,EAAAA,KAAK,CAAC3G,cAAN,CAAqBkU,SAArB;IACAoQ,EAAAA,WAAW,CAACpQ,SAAD,CAAX;IAEA,MAAIiG,MAAM,GAAG,EAAb,CAJuD;;IAMvD/W,EAAAA,IAAI,GAAG,IAAP;;IACA,MAAI,CAACjD,qBAAC,CAACqE,KAAF,CAAQ0P,SAAR,CAAD,IAAuB,CAAC/T,qBAAC,CAACC,OAAF,CAAU8T,SAAV,CAA5B,EAAkD;IAC9C,SAAK,IAAIxR,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGwR,SAAS,CAACvT,MAA9B,EAAsC+B,CAAC,EAAvC,EAA2C;IACvC,UAAIzC,IAAI,GAAGiU,SAAS,CAACxR,CAAD,CAApB;IACA,UAAIoB,EAAE,GAAG7D,IAAI,CAACe,KAAL,IAAcf,IAAI,CAACc,IAA5B;IAEA,UAAI2jB,KAAJ;;IACA,UAAIthB,IAAI,KAAK,KAAb,EAAoB;IAChB,YAAIV,CAAC,KAAK,CAAV,EAAa;IACTgiB,UAAAA,KAAK,GACD,CAACxQ,SAAS,CAAC,CAAD,CAAT,CAAanT,IAAb,GAAoBmT,SAAS,CAAC,CAAD,CAAT,CAAalT,KAAlC,IAA2C,CAA3C,IACA,CAACkT,SAAS,CAAC,CAAD,CAAT,CAAajT,IAAb,GAAoBiT,SAAS,CAAC,CAAD,CAAT,CAAahT,GAAlC,IAAyC,CADzC,GAEM,CAFN,GAGM,CAJV;IAKH,SAND,MAMO;IACH;IACA,cAAI+D,GAAG,GAAG,CAAV;IACA,cAAIhE,IAAI,GAAG,CAAX;IACA,cAAIC,GAAG,GAAGY,MAAM,CAAC6iB,SAAjB;IACA,cAAIjgB,GAAG,GAAG,CAAV;;IACA,eAAK,IAAIT,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG5B,CAApB,EAAuB4B,CAAC,EAAxB,EAA4B;IACxB,gBAAIvB,CAAC,GAAGuB,CAAJ,GAAQ,CAAR,IAAa,CAAjB,EAAoB;IAChB,kBAAI2gB,EAAE,GAAG1Q,SAAS,CAACxR,CAAC,GAAGuB,CAAJ,GAAQ,CAAT,CAAlB;IACAgB,cAAAA,GAAG,IAAI,CAAC2f,EAAE,CAAC7jB,IAAH,GAAU6jB,EAAE,CAAC5jB,KAAd,IAAuB,CAA9B;IACAC,cAAAA,IAAI,GAAG8B,IAAI,CAACC,GAAL,CAAS/B,IAAT,EAAe2jB,EAAE,CAAC3jB,IAAlB,CAAP;IACAC,cAAAA,GAAG,GAAG6B,IAAI,CAACG,GAAL,CAAShC,GAAT,EAAc0jB,EAAE,CAAC1jB,GAAjB,CAAN;IACAwD,cAAAA,GAAG;IACN,aAND,MAMO;IACH;IACH;IACJ;;IACDO,UAAAA,GAAG,GAAGA,GAAG,GAAGP,GAAN,GAAY,CAAlB;IACA,cAAI9C,EAAE,GAAG,CAACX,IAAI,GAAGC,GAAR,IAAe,CAAxB;IACAwjB,UAAAA,KAAK,GAAG9iB,EAAE,IAAIqD,GAAd;IACH;IACJ,OA5BD,MA4BO,IAAI7B,IAAI,KAAK,IAAb,EAAmB;IACtB;IACA,YAAIV,CAAC,GAAG,CAAR,EAAW;IACP;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA,cAAI6hB,MAAM,GAAGrQ,SAAS,CAACmQ,MAAD,CAAtB,CATO;IAWP;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;;IACA,cAAIQ,CAAC,GAAGN,MAAM,CAAC7hB,CAAD,CAAN,CAAU3B,IAAlB;IACA,cAAI+T,CAAC,GAAGyP,MAAM,CAAC7hB,CAAD,CAAN,CAAU1B,KAAlB,CAnCO;IAqCP;;IACA0jB,UAAAA,KAAK,GAAG5P,CAAC,IAAI+P,CAAb;IACH,SAzCqB;;IA2CzB;;IAED,UAAI/gB,EAAJ,EAAQ;IACJqW,QAAAA,MAAM,CAACzX,CAAD,CAAN,GAAYgiB,KAAK,GAAG,CAAH,GAAO,CAAxB;IACH,OAFD,MAEO;IACHvK,QAAAA,MAAM,CAACzX,CAAD,CAAN,GAAYgiB,KAAK,GAAG,CAAH,GAAO,CAAxB;IACH;IACJ;IACJ;;IAED,SAAOvK,MAAP;IACH;;AAED,mBAAe;IACX5T,EAAAA,IAAI,EAAE,OADK;IAEX+G,EAAAA,KAAK,EAAE,UAFI;IAGX+E,EAAAA,WAAW,EAAE,uBAHF;IAIX+B,EAAAA,SAAS,EAAEqQ;IAJA,CAAf;;ICtKA;;;IAMA,MAAM/M,MAAI,GAAG,IAAb;IACA,MAAMoN,SAAS,GAAG,WAAlB;IACA,MAAMC,UAAU,GAAG,YAAnB;IACA,MAAMpN,KAAG,GAAG,KAAZ;IACA,MAAMC,MAAI,GAAG,MAAb;;IAEA,SAASoN,OAAT,CAAiB9Q,SAAjB,EAA4B;IACxB,MAAIzC,OAAO,GAAG,EAAd;;IACA,MAAI,CAACtR,qBAAC,CAACqE,KAAF,CAAQ0P,SAAR,CAAD,IAAuB,CAAC/T,qBAAC,CAACC,OAAF,CAAU8T,SAAV,CAA5B,EAAkD;IAC9C,QAAI8E,YAAY,GAAGtB,MAAnB;;IACA,SAAK,IAAIhV,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGwR,SAAS,CAACvT,MAA9B,EAAsC+B,CAAC,EAAvC,EAA2C;IACvC,UAAIA,CAAC,GAAG,CAAR,EAAW;IACP+O,QAAAA,OAAO,CAAC/O,CAAD,CAAP,GAAa,CACTwR,SAAS,CAACxR,CAAD,CAAT,CAAaR,UADJ,EAETwV,MAFS,EAGTxD,SAAS,CAACxR,CAAD,CAAT,CAAa1B,KAHJ,CAAb;IAKH,OAND,MAMO;IACH,YAAIf,IAAI,GAAGiU,SAAS,CAACxR,CAAD,CAApB;IACA,YAAI+Q,KAAK,GAAGS,SAAS,CAACxR,CAAC,GAAG,CAAL,CAArB;IACA,YAAI8Q,KAAK,GAAGU,SAAS,CAACxR,CAAC,GAAG,CAAL,CAArB;;IACA,YACIsW,YAAY,KAAKrB,KAAjB,IACA1X,IAAI,CAACe,KAAL,GAAayS,KAAK,CAACzS,KADnB,IAEAyS,KAAK,CAACzS,KAAN,GAAcwS,KAAK,CAACxS,KAHxB,EAIE;IACE;IACAyQ,UAAAA,OAAO,CAAC/O,CAAC,GAAG,CAAL,CAAP,GAAiB,CAAC8Q,KAAK,CAACtR,UAAP,EAAmB4iB,SAAnB,EAA8BtR,KAAK,CAACtS,GAApC,CAAjB;IACAuQ,UAAAA,OAAO,CAAC/O,CAAC,GAAG,CAAL,CAAP,GAAiB,CAAC+Q,KAAK,CAACvR,UAAP,EAAmByV,KAAnB,EAAwBnE,KAAK,CAACxS,KAA9B,CAAjB;IACAyQ,UAAAA,OAAO,CAAC/O,CAAD,CAAP,GAAa,CAACzC,IAAI,CAACiC,UAAN,EAAkByV,KAAlB,EAAuB1X,IAAI,CAACe,KAA5B,CAAb;IACAgY,UAAAA,YAAY,GAAGrB,KAAf;IACH,SAVD,MAUO,IACHqB,YAAY,KAAKpB,MAAjB,IACA3X,IAAI,CAACe,KAAL,GAAayS,KAAK,CAACzS,KADnB,IAEAyS,KAAK,CAACzS,KAAN,GAAcwS,KAAK,CAACxS,KAHjB,EAIL;IACEyQ,UAAAA,OAAO,CAAC/O,CAAC,GAAG,CAAL,CAAP,GAAiB,CAAC8Q,KAAK,CAACtR,UAAP,EAAmB6iB,UAAnB,EAA+BvR,KAAK,CAACvS,IAArC,CAAjB;IACAwQ,UAAAA,OAAO,CAAC/O,CAAC,GAAG,CAAL,CAAP,GAAiB,CAAC+Q,KAAK,CAACvR,UAAP,EAAmB0V,MAAnB,EAAyBpE,KAAK,CAACxS,KAA/B,CAAjB;IACAyQ,UAAAA,OAAO,CAAC/O,CAAD,CAAP,GAAa,CAACzC,IAAI,CAACiC,UAAN,EAAkB0V,MAAlB,EAAwB3X,IAAI,CAACe,KAA7B,CAAb;IACAgY,UAAAA,YAAY,GAAGpB,MAAf;IACH,SATM,MASA;IACHnG,UAAAA,OAAO,CAAC/O,CAAD,CAAP,GAAa,CAACzC,IAAI,CAACiC,UAAN,EAAkB8W,YAAlB,EAAgC/Y,IAAI,CAACe,KAArC,CAAb;IACH;IACJ;IACJ;IACJ;;IAED,SAAOyQ,OAAP;IACH;;AAED,kBAAe;IACXlL,EAAAA,IAAI,EAAE,SADK;IAEX+G,EAAAA,KAAK,EAAE,KAFI;IAGX+E,EAAAA,WAAW,EAAE,OAHF;IAIX+B,EAAAA,SAAS,EAAE4Q,OAJA;IAKX/L,EAAAA,MAAM,EAAE;IACJvB,UAAAA,MADI;IAEJoN,IAAAA,SAFI;IAGJC,IAAAA,UAHI;IAIJpN,SAAAA,KAJI;IAKJC,UAAAA;IALI;IALG,CAAf;;ICxDA;;;IAGA,MAAM;IAAE7G,EAAAA;IAAF,IAAkB5B,OAAO,CAAC,oBAAD,CAA/B;;IACA,MAAMhP,CAAC,GAAGgP,OAAO,CAAC,QAAD,CAAjB;;IACA,MAAMvD,MAAM,GAAGuD,OAAO,CAAC,QAAD,CAAtB;;IAEA,MAAMD,MAAI,GAAGC,OAAO,CAAC,MAAD,CAApB;;IACA,MAAMC,IAAE,GAAGD,OAAO,CAAC,IAAD,CAAlB;;IACA,MAAME,IAAE,GAAGD,IAAE,CAACE,QAAd;;IAEA,eAAe2V,aAAf,GAA+B;IAC3B,MAAIxT,OAAO,GAAG;IACVrD,IAAAA,UAAU,EAAE,IADF;IAEV8W,IAAAA,SAAS,EAAE,EAFD;;IAAA,GAAd;;IAMA,MAAI;IACA,QAAIxT,QAAQ,GAAGyT,gBAAgB,EAA/B;;IACA,QAAI;IACA1T,MAAAA,OAAO,GAAGR,IAAI,CAACU,KAAL,CAAW,MAAMtC,IAAE,CAACuC,QAAH,CAAYF,QAAZ,EAAsB,OAAtB,CAAjB,CAAV;IACH,KAFD,CAEE,OAAOJ,KAAP,EAAc;IACZ;IACA,UAAI,EAAEA,KAAK,IAAIA,KAAK,CAACb,IAAN,KAAe,QAA1B,CAAJ,EAAyC;IACrCvD,QAAAA,OAAO,CAACoE,KAAR,CACK,SAAQI,QAAS,SAAQJ,KAAM,MADpC,EAEIA,KAFJ;IAIH,OALD,MAKO;IACHpE,QAAAA,OAAO,CAACoE,KAAR,CAAe,SAAQI,QAAS,QAAhC,EAAyCJ,KAAzC;IACH;IACJ;IACJ,GAfD,CAeE,OAAOA,KAAP,EAAc;IACZpE,IAAAA,OAAO,CAACoE,KAAR,CAAe,iBAAgBA,KAAM,EAArC;IACH;;IACD,SAAOG,OAAP;IACH;;IAED,SAAS0T,gBAAT,GAA4B;IACxB,SAAOjW,MAAI,CAAC4B,IAAL,CAAUC,WAAW,EAArB,EAAyB,gBAAzB,CAAP;IACH;;IAED,eAAeqU,eAAf,CAA+BC,OAA/B,EAAwC;IACpC,MAAI5T,OAAO,GAAG,MAAMwT,aAAa,EAAjC;IACA,MAAI9kB,CAAC,CAACC,OAAF,CAAUilB,OAAV,CAAJ,EAAwB,OAAO5T,OAAP;IAExB,MAAI6T,QAAQ,GAAG,EAAf;;IACA,MAAInlB,CAAC,CAACE,OAAF,CAAUglB,OAAV,CAAJ,EAAwB;IACpB,QAAIA,OAAO,CAAC1kB,MAAR,IAAkB,CAAtB,EAAyB,OAAO8Q,OAAP;IACzB6T,IAAAA,QAAQ,GAAGD,OAAX;IACH,GAHD,MAGO;IACHC,IAAAA,QAAQ,CAAC7d,IAAT,CAAc4d,OAAd;IACH;;IAED,MAAIllB,CAAC,CAACC,OAAF,CAAUqR,OAAV,CAAJ,EAAwB;IACpBA,IAAAA,OAAO,GAAG;IAAErD,MAAAA,UAAU,EAAE,IAAd;IAAoB8W,MAAAA,SAAS,EAAE;IAA/B,KAAV;IACH;;IAED,MAAI/kB,CAAC,CAACC,OAAF,CAAUqR,OAAO,CAACyT,SAAlB,KAAgC,CAAC/kB,CAAC,CAACE,OAAF,CAAUoR,OAAO,CAACyT,SAAlB,CAArC,EAAmE;IAC/DzT,IAAAA,OAAO,CAACyT,SAAR,GAAoB,EAApB;IACH;;IAED,OAAK,IAAIK,OAAT,IAAoBD,QAApB,EAA8B;IAC1B,SAAK,IAAI5iB,CAAT,IAAc+O,OAAO,CAACyT,SAAtB,EAAiC;IAC7B,UAAIzT,OAAO,CAACyT,SAAR,CAAkBxiB,CAAlB,MAAyB6iB,OAA7B,EAAsC;IAClC9T,QAAAA,OAAO,CAACyT,SAAR,CAAkBxd,MAAlB,CAAyBhF,CAAzB,EAA4B,CAA5B;IACA;IACH;IACJ;IACJ;;IAED+O,EAAAA,OAAO,CAACrD,UAAR,GAAqBxC,MAAM,GAAGsE,WAAT,EAArB;IACA,QAAMsV,aAAa,CAAC/T,OAAD,CAAnB;IACA,SAAOA,OAAP;IACH;;IAED,eAAegU,YAAf,CAA4BJ,OAA5B,EAAqC;IACjC,MAAI5T,OAAO,GAAG,MAAMwT,aAAa,EAAjC;IACA,MAAI9kB,CAAC,CAACC,OAAF,CAAUilB,OAAV,CAAJ,EAAwB,OAAO5T,OAAP;IAExB,MAAI6T,QAAQ,GAAG,EAAf;;IACA,MAAInlB,CAAC,CAACE,OAAF,CAAUglB,OAAV,CAAJ,EAAwB;IACpB,QAAIA,OAAO,CAAC1kB,MAAR,IAAkB,CAAtB,EAAyB,OAAO8Q,OAAP;IACzB6T,IAAAA,QAAQ,GAAGD,OAAX;IACH,GAHD,MAGO;IACHC,IAAAA,QAAQ,CAAC7d,IAAT,CAAc4d,OAAd;IACH;;IAED,MAAIllB,CAAC,CAACC,OAAF,CAAUqR,OAAV,CAAJ,EAAwB;IACpBA,IAAAA,OAAO,GAAG;IAAErD,MAAAA,UAAU,EAAE,IAAd;IAAoB8W,MAAAA,SAAS,EAAE;IAA/B,KAAV;IACH;;IAED,MAAI/kB,CAAC,CAACC,OAAF,CAAUqR,OAAO,CAACyT,SAAlB,KAAgC,CAAC/kB,CAAC,CAACE,OAAF,CAAUoR,OAAO,CAACyT,SAAlB,CAArC,EAAmE;IAC/DzT,IAAAA,OAAO,CAACyT,SAAR,GAAoB,EAApB;IACH;;IAED,OAAK,IAAIK,OAAT,IAAoBD,QAApB,EAA8B;IAC1B,QAAII,KAAK,GAAG,KAAZ;;IACA,SAAK,IAAIjV,IAAT,IAAiBgB,OAAO,CAACyT,SAAzB,EAAoC;IAChC,UAAIzU,IAAI,KAAK8U,OAAb,EAAsB;IAClBG,QAAAA,KAAK,GAAG,IAAR;IACA;IACH;IACJ;;IACD,QAAI,CAACA,KAAL,EAAYjU,OAAO,CAACyT,SAAR,CAAkBzd,IAAlB,CAAuB8d,OAAvB;IACf;;IAED9T,EAAAA,OAAO,CAACrD,UAAR,GAAqBxC,MAAM,GAAGsE,WAAT,EAArB;IACA,QAAMsV,aAAa,CAAC/T,OAAD,CAAnB;IACA,SAAOA,OAAP;IACH;;IAED,eAAe+T,aAAf,CAA6BvlB,IAA7B,EAAmC;IAC/B,MAAI;IACA,QAAI+Q,OAAO,GAAGC,IAAI,CAACC,SAAL,CAAejR,IAAf,CAAd;IACA,QAAI0lB,aAAa,GAAGR,gBAAgB,EAApC;IAEA,UAAM9V,IAAE,CAAC+B,SAAH,CAAauU,aAAb,EAA4B3U,OAA5B,EAAqC;IAAEK,MAAAA,QAAQ,EAAE;IAAZ,KAArC,CAAN;IACH,GALD,CAKE,OAAOC,KAAP,EAAc;IACZ,UAAM,IAAIC,KAAJ,CAAU,0BAA0BD,KAApC,CAAN;IACH;IACJ;;AAED,oBAAe;IAAEmU,EAAAA,YAAF;IAAgBL,EAAAA,eAAhB;IAAiCH,EAAAA;IAAjC,CAAf;;IC5HA;UAoCMW,UAAU,GAAG;IACfrR,EAAAA,EADe;IAEfE,EAAAA,GAFe;IAGf+D,EAAAA,EAHe;IAIfE,EAAAA,IAJe;IAKfE,EAAAA,GALe;IAMfiN,EAAAA,EANe;IAOfhM,EAAAA,OAPe;IAQff,EAAAA,OARe;IASfgN,EAAAA,QATe;IAUfC,EAAAA,OAVe;IAWf1I,EAAAA,GAXe;IAYfa,EAAAA,GAZe;IAaf8F,EAAAA;IAbe;UAgBble,KAAK,GAAG;IACVmN,EAAAA,GADU;IAEVM,EAAAA,QAFU;IAGVnB,EAAAA,SAHU;IAIVsB,EAAAA,UAJU;IAKVC,EAAAA,QALU;IAMVC,EAAAA,QANU;IAOViE,WAAAA,SAPU;IAQVoE,EAAAA,KARU;IASVS,EAAAA,IATU;IAUVC,OAAAA,SAVU;IAWVwB,UAAAA,SAXU;IAYVQ,YAAAA;IAZU;;;;;;;;;;;;;;;;;;;"}