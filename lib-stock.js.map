{"version":3,"file":"lib-stock.js","sources":["src/util.js","src/transaction-engine.js","src/transaction.js","src/reports.js","src/simulator.js","src/indicators/utils.js","src/search.js","src/momentum-breakthrough.js","src/stoploss.js","src/benchmark-basic.js","src/outsideday.js","src/opensell.js","src/smashday.js","src/indicators/ma.js","src/indicators/atr.js","src/indicators/keltner-channel.js","src/indicators/boll.js","src/indicators/mtm.js","src/indicators/ttmwave.js","src/indicators/squeeze.js","src/rules/squeeze.js","src/indicators/ao.js","src/indicators/scalper.js","src/favorites.js","src/index.js"],"sourcesContent":["function formatFxstr(num) {\n    return num.toLocaleString(\"zh-CN\"); //, { style: \"currency\", currency: \"CNY\" });\n}\n\nexport { formatFxstr };\n","import _ from \"lodash\";\nimport { formatFxstr } from \"./util\";\nimport debugpkg from \"debug\";\n\n// import trans from \"./transaction\";\n\nconst debug = debugpkg(\"engine\");\n\n/**\n * 主处理过程\n * 1. 查看设置中的卖出模型列表，按序执行，如果成交，则直接清算\n * 2. 如果执行完卖出，仍然有持仓，检查配置是否许可买入\n * 3. 如果需要买入，查看设置的买入模型列表，按序执行，如果成交，则直接清算\n *\n * 2020.8.26 目前已经支持按照规则，非固定头寸方式下，可以在持仓下仍然买入\n *           持仓卖出按照每笔单独进行，不合并进行\n *\n * @param {*} index 当前日股票数据索引\n * @param {*} stockData 股票数据信息\n * @param {*} capitalData 账户信息\n * @param {*} options 算法参数\n */\nasync function executeTransaction(index, stockData, capitalData, options) {\n    let translog = null;\n    // 首先检查卖出\n    // 所有算法首先检查并处理止损\n    // 检查是否需要止损\n    let tradeDate = stockData[index].trade_date;\n    let stockInfo = capitalData.info;\n\n    let sellRules = options.rules && options.rules.sell;\n    let buyRules = options.rules && options.rules.buy;\n\n    // 目前的持仓情况\n    let stocks = capitalData && capitalData.stocks;\n    if (sellRules) {\n        // 每个买入持股单独处理\n        let stockId = 0;\n        while (stockId < stocks.length) {\n            let stock = stocks[stockId];\n            debug(`卖出股票信息: %o`, stock);\n\n            let sold = false;\n            for (let rule of sellRules) {\n                if (rule) {\n                    debug(\n                        `${rule.name} 卖出检查：${tradeDate}, %o`,\n                        stockData[index]\n                    );\n                    translog = rule.checkSellTransaction(\n                        stockInfo,\n                        stock,\n                        index,\n                        stockData,\n                        options\n                    );\n                    if (translog) translog.transeq = stock.transeq;\n                    if (\n                        executeCapitalSettlement(\n                            stockInfo,\n                            translog,\n                            capitalData,\n                            options\n                        )\n                    ) {\n                        debug(\n                            `${\n                                rule.name\n                            } 卖出：${tradeDate}，价格：${formatFxstr(\n                                translog.price\n                            )}元，数量：${\n                                translog.count / 100\n                            }手，总价：${translog.total.toFixed(\n                                2\n                            )}元[佣金${translog.commission.toFixed(\n                                2\n                            )}元，过户费${translog.fee.toFixed(\n                                2\n                            )}，印花税${translog.duty.toFixed(2)}元], ${\n                                translog.memo\n                            }`\n                        );\n                        sold = true;\n                        break;\n                    }\n                }\n            }\n            if (!sold) {\n                // 没有卖出，需要查看下一条持股进行检查\n                stockId++;\n            }\n        }\n    }\n\n    // 如果非固定头寸，则检查是否有持仓，如果有不进行买入\n    if (!options.fixCash && capitalData.stocks.length > 0) return;\n    // if (capitalData && capitalData.stock && capitalData.stock.count > 0) return;\n\n    // 执行买入\n    // debug(\"执行买入检查\");\n    let cash = capitalData.balance;\n    if (options.fixCash) cash = options.initBalance;\n    if (buyRules) {\n        for (let rule of buyRules) {\n            translog = rule.checkBuyTransaction(\n                stockInfo,\n                cash,\n                index,\n                stockData,\n                options\n            );\n            if (translog) translog.transeq = capitalData._transeq++;\n            // debug(`买入结果：%o`, translog);\n            if (\n                executeCapitalSettlement(\n                    stockInfo,\n                    translog,\n                    capitalData,\n                    options\n                )\n            ) {\n                debug(\n                    `${\n                        rule.name\n                    } 买入交易：${tradeDate}，价格：${translog.price.toFixed(\n                        2\n                    )}元，数量：${\n                        translog.count / 100\n                    }手，总价：${translog.total.toFixed(\n                        2\n                    )}元[佣金${translog.commission.toFixed(\n                        2\n                    )}元，过户费${translog.fee.toFixed(\n                        2\n                    )}，印花税${translog.duty.toFixed(2)}元], ${translog.memo}`\n                );\n                // debug(`股票信息：%o`, stockInfo);\n                // debug(`账户信息：%o`, capitalData);\n                // return translog;\n            }\n        }\n    }\n}\n\n/**\n * 根据交易记录完成账户清算\n * @param {*} stockInfo 股票信息\n * @param {*} translog 交易记录\n * @param {*} capitalData 账户数据\n * @param {*} options 配置参数\n */\nfunction executeCapitalSettlement(stockInfo, translog, capitalData, options) {\n    // debug(`执行清算 %o`, translog);\n    if (_.isEmpty(translog)) return false;\n    // 如果非固定头寸，检查当前提供的交易余额是否可执行\n    if (!options.fixCash && translog.total + capitalData.balance < 0) {\n        debug(\n            `账户余额${capitalData.balance}不足(${\n                translog.total\n            })，无法完成清算，交易取消! 交易信息: ${\n                translog.type === \"buy\" ? \"买入\" : \"卖出\"\n            }${stockInfo.ts_code} ${translog.count}股，价格${\n                translog.price\n            }，共计${translog.total}元[含佣金${translog.commission}元，过户费${\n                translog.fee\n            }，印花税${translog.duty}元]`\n        );\n        return false;\n    }\n\n    // 处理交易信息\n    capitalData.balance += translog.total;\n    // 如果当前买入，stock中放置持股信息和买入交易日志，只有卖出发生时才合并生成一条交易记录，包含两个部分\n    if (translog.type === \"buy\") {\n        capitalData.stocks.push({\n            transeq: translog.transeq,\n            count: translog.count,\n            price: translog.price,\n            buy: translog,\n        });\n    } else {\n        let stock;\n        for (let i = 0; i < capitalData.stocks.length; i++) {\n            if (capitalData.stocks[i].transeq === translog.transeq) {\n                stock = capitalData.stocks[i];\n                capitalData.stocks.splice(i, 1);\n                break;\n            }\n        }\n        if (!stock) {\n            debug(\n                `没有找到要执行的交易序号：${translog.transeq}, %o`,\n                capitalData.stocks\n            );\n            return false;\n        }\n\n        let settledlog = {\n            transeq: stock.transeq,\n            tradeDate: translog.date,\n            profit: stock.buy.total + translog.total,\n            income: translog.count * translog.price - stock.count * stock.price,\n            buy: stock.buy,\n            sell: translog,\n        };\n        // capitalData.stock = {\n        //     //info: null,\n        //     count: 0,\n        //     price: 0,\n        // };\n        capitalData.transactions.push(settledlog);\n    }\n    // debug(\"完成清算！\");\n    return true;\n}\n\nexport default {\n    executeTransaction,\n    executeCapitalSettlement,\n};\n","import _ from \"lodash\";\nimport { formatFxstr } from \"./util\";\nimport debugpkg from \"debug\";\n\nconst debug = debugpkg(\"transaction\");\n\n/**\n * 创建指定日期和股票信息的卖出交易\n * @param {*} stockInfo\n * @param {*} tradeDate\n * @param {*} tradeDateIndex\n * @param {*} count\n * @param {*} price\n * @param {*} memo\n */\nfunction createSellTransaction(\n    stockInfo,\n    tradeDate,\n    tradeDateIndex,\n    count,\n    price,\n    methodType,\n    memo\n) {\n    // 计算费用\n    let total = calculateTransactionFee(false, stockInfo, count, price);\n    // 创建卖出交易记录\n    return {\n        date: tradeDate,\n        dateIndex: tradeDateIndex,\n        type: \"sell\",\n        count,\n        price,\n        total: total.total,\n        amount: total.amount,\n        fee: total.fee,\n        commission: total.commission,\n        duty: total.duty,\n        methodType,\n        memo,\n    };\n}\n\n/**\n * 构建买入交易信息\n * @param {*} stockInfo 股票信息\n * @param {*} tradeDate 交易日期\n * @param {*} tradeDateIndex 交易日期索引（方便用于计算交易日数）\n * @param {*} balance 可用余额\n * @param {*} price 买入价格\n * @param {*} memo 交易备注\n */\nfunction createBuyTransaction(\n    stockInfo,\n    tradeDate,\n    tradeDateIndex,\n    balance,\n    price,\n    methodType,\n    memo\n) {\n    // 计算费用\n    let count = parseInt(balance / price / 100) * 100;\n    // 最小交易单位为1手，资金不足放弃！\n    if (count < 100) return;\n    let total = calculateTransactionFee(true, stockInfo, count, price);\n    while (total.total + balance < 0) {\n        count -= 100;\n        if (count < 100) return;\n        total = calculateTransactionFee(true, stockInfo, count, price);\n    }\n    // 创建买入交易记录\n    return {\n        date: tradeDate,\n        dateIndex: tradeDateIndex,\n        type: \"buy\",\n        count: count,\n        price,\n        total: total.total,\n        amount: total.amount,\n        fee: total.fee,\n        commission: total.commission,\n        duty: total.duty,\n        methodType,\n        memo,\n    };\n}\n\n/**\n * 计算交易价格和费用\n * @param {boolean}} buy 买卖标记\n * @param {*} stockInfo 股票信息\n * @param {*} count 买卖数量\n * @param {*} price 买卖单价\n */\nfunction calculateTransactionFee(buy, stockInfo, count, price) {\n    let amount = count * price;\n    let commission = (amount * 0.25) / 1000;\n    let fee = 0.0;\n    let duty = 0.0;\n    if (stockInfo.exchange === \"SSE\") {\n        // 上海，过户费千分之0.2\n        fee += (amount * 0.02) / 1000;\n    } else if (stockInfo.exchange === \"SZSE\") {\n        // 深圳，无\n    }\n    // 印花税，仅对卖方收取\n    if (!buy) {\n        duty += (amount * 1) / 1000;\n    }\n\n    let total = 0.0;\n    if (buy) {\n        total = 0 - (amount + commission + fee + duty);\n    } else {\n        total = amount - commission - fee - duty;\n    }\n\n    return { total, amount, commission, fee, duty };\n}\n\nfunction parseCapitalReports(capitalData) {\n    if (_.isEmpty(capitalData)) return;\n    // 账户信息中主要需分析交易过程，正常都是为一次买入，一次卖出，这样作为一组交易，获得一次盈利结果\n    let count = capitalData.transactions.length;\n    let count_win = 0;\n    let total_win = 0;\n    let count_loss = 0;\n    let total_loss = 0;\n    let total_profit = 0;\n    let total_fee = 0;\n    let max_profit = 0;\n    let max_loss = 0;\n    let average_profit = 0;\n    let average_win = 0;\n    let average_loss = 0;\n    let max_wintimes = 0; // 连续盈利次数\n    let max_losstimes = 0; // 连续亏损次数\n    let max_windays = 0;\n    let max_lossdays = 0;\n    let average_windays = 0;\n    let average_lossdays = 0;\n    // {times: 总次数, win_times: 盈利次数, loss_times: 损失次数}\n    let selltypes = {};\n    //let selltype_times = {};\n\n    // 收益率：表示单位成本的收入比例\n    let ror_win = 0;\n    let ror_loss = 0;\n    let ror = 0;\n\n    let tmp_cost = 0;\n    let tmp_cost_win = 0;\n    let tmp_cost_loss = 0;\n\n    let currentType = 0;\n    let tmp_times = 0;\n    let tmp_windays = 0;\n    let tmp_lossdays = 0;\n    for (let log of capitalData.transactions) {\n        let days = log.sell.dateIndex - log.buy.dateIndex + 1;\n\n        let selltype = selltypes[log.sell.methodType];\n        if (!selltype) {\n            selltypes[log.sell.methodType] = {\n                times: 0,\n                win_times: 0,\n                loss_times: 0,\n            };\n        }\n        selltypes[log.sell.methodType].times += 1;\n\n        if (log.profit >= 0) {\n            count_win++;\n            total_win += log.profit;\n            tmp_cost_win += -log.buy.total;\n            if (max_profit < log.profit) max_profit = log.profit;\n\n            tmp_windays += days;\n            if (max_windays < days) max_windays = days;\n\n            // 连续计数\n            if (currentType === 1) {\n                tmp_times++;\n            } else {\n                if (currentType === -1) {\n                    if (max_losstimes < tmp_times) max_losstimes = tmp_times;\n                }\n                // 初始化\n                currentType = 1;\n                tmp_times = 1;\n            }\n\n            selltypes[log.sell.methodType].win_times += 1;\n        } else {\n            count_loss++;\n            total_loss += log.profit;\n            tmp_cost_loss += -log.buy.total;\n            if (max_loss > log.profit) max_loss = log.profit;\n\n            tmp_lossdays += days;\n            if (max_lossdays < days) max_lossdays = days;\n\n            // 连续计数\n            if (currentType === -1) {\n                tmp_times++;\n            } else {\n                if (currentType === 1) {\n                    if (max_wintimes < tmp_times) max_wintimes = tmp_times;\n                }\n                // 初始化\n                currentType = -1;\n                tmp_times = 1;\n            }\n\n            selltypes[log.sell.methodType].loss_times += 1;\n        }\n\n        total_profit += log.profit;\n        total_fee +=\n            log.buy.commission +\n            log.buy.fee +\n            log.buy.duty +\n            (log.sell.commission + log.sell.fee + log.sell.duty);\n        tmp_cost += -log.buy.total;\n    }\n\n    if (currentType === 1) {\n        if (max_wintimes < tmp_times) max_wintimes = tmp_times;\n    } else if (currentType === -1) {\n        if (max_losstimes < tmp_times) max_losstimes = tmp_times;\n    }\n\n    average_profit = total_profit / count;\n    average_win = total_win / count_win;\n    average_loss = -total_loss / count_loss;\n\n    average_windays = Number((tmp_windays / count_win).toFixed(1));\n    average_lossdays = Number((tmp_lossdays / count_loss).toFixed(1));\n\n    ror = total_profit / tmp_cost;\n    ror_win = total_win / tmp_cost_win;\n    ror_loss = total_loss / tmp_cost_loss;\n\n    return {\n        count,\n        total_profit,\n        total_fee,\n        count_win,\n        total_win,\n        count_loss,\n        total_loss,\n        max_profit,\n        max_loss,\n        average_profit,\n        average_win,\n        average_loss,\n        max_wintimes,\n        max_losstimes,\n        max_windays,\n        max_lossdays,\n        average_windays,\n        average_lossdays,\n        selltypes,\n\n        ror,\n        ror_win,\n        ror_loss,\n    };\n}\n\nfunction showCapitalReports(log, capitalData) {\n    log(\n        `******************************************************************************************`\n    );\n    // log(\n    //     \"*                                                                                                                      *\"\n    // );\n    if (capitalData.stocks && capitalData.stocks.length > 0) {\n        let stockvalue = 0;\n        for (let stock of capitalData.stocks) {\n            stockvalue += stock.count * stock.price;\n        }\n        log(\n            `  账户价值 ${formatFxstr(\n                capitalData.balance + stockvalue\n            )}元  【余额 ${formatFxstr(\n                capitalData.balance\n            )}元, 持股: ${formatFxstr(stockvalue)}元】`\n        );\n    } else {\n        log(`  账户余额 ${formatFxstr(capitalData.balance)}元`);\n    }\n\n    let capitalResult = parseCapitalReports(capitalData);\n    // log(``);\n    log(\n        `  总净利润：${formatFxstr(capitalResult.total_profit)},  收益率 ${(\n            capitalResult.ror * 100\n        ).toFixed(2)}%`\n    );\n    log(\n        `  毛利润： ${formatFxstr(\n            capitalResult.total_win\n        )},  总亏损：${formatFxstr(capitalResult.total_loss)}`\n    );\n    log(\n        `  盈利收益率： ${(capitalResult.ror_win * 100).toFixed(\n            2\n        )}%,  亏损收益率：${(capitalResult.ror_loss * 100).toFixed(2)}%`\n    );\n    log(\"\");\n    log(\n        `  总交易次数： ${capitalResult.count},  利润率：${(\n            (capitalResult.count_win * 100) /\n            capitalResult.count\n        ).toFixed(1)}%`\n    );\n    log(\n        `  总盈利次数： ${capitalResult.count_win},  总亏损次数：${capitalResult.count_loss}`\n    );\n    log(\"\");\n    log(\n        `  最大单笔盈利： ${formatFxstr(\n            capitalResult.max_profit\n        )},  最大单笔亏损：${formatFxstr(capitalResult.max_loss)}`\n    );\n    log(\n        `  平均盈利： ${formatFxstr(\n            capitalResult.average_win\n        )},  平均亏损：${formatFxstr(capitalResult.average_loss)}`\n    );\n    log(\n        `  平均盈利/平均亏损： ${(\n            capitalResult.average_win / capitalResult.average_loss\n        ).toFixed(2)},  平均每笔总盈利：${formatFxstr(\n            capitalResult.average_profit\n        )}`\n    );\n    log(\"\");\n    log(\n        `  最多连续盈利次数： ${capitalResult.max_wintimes},  最多连续亏损次数：${capitalResult.max_losstimes}`\n    );\n    log(\n        `  盈利最多持有天数： ${capitalResult.max_windays},  亏损最多持有天数：${capitalResult.max_lossdays}`\n    );\n    log(\n        `  盈利平均持有天数： ${capitalResult.average_windays},  亏损平均持有天数：${capitalResult.average_lossdays}`\n    );\n\n    log(\"\");\n    for (let methodType in capitalResult.selltypes) {\n        let selltype = capitalResult.selltypes[methodType];\n        log(\n            `  卖出类型${methodType} 共${selltype.times}次,  盈利${selltype.win_times}次， 损失${selltype.loss_times}次`\n        );\n    }\n    // log(\n    //     \"*                                                                                                                      *\"\n    // );\n    log(\n        `******************************************************************************************`\n    );\n    log(\"\");\n}\n\nfunction showTransactions(log, capitalData) {\n    log(`  交易日志分析\n******************************************************************************************`);\n    for (let translog of capitalData.transactions) {\n        log(logTransaction(translog));\n    }\n    if (capitalData.stock && capitalData.stock.count > 0) {\n        let holdlog = { buy: capitalData.stock.buy };\n        log(logTransaction(holdlog));\n    }\n    log(\n        `******************************************************************************************`\n    );\n}\n\n// settledlog = {\n//     transeq: 交易序号\n//     tradeDate: translog.tradeDate,\n//     profit: capitalData.stock.buy.total + translog.total,\n//     income:\n//         translog.count * translog.price -\n//         capitalData.stock.count * capitalData.stock.price,\n//     buy: capitalData.stock.buy,\n//     sell: translog,\n// };\n// trans: {\n// date: tradeDate.format(\"YYYYMMDD\"),\n// dateIndex: tradeDateIndex,\n// type: \"sell\",\n// count,\n// price,\n// total: total.total,\n// amount: total.amount,\n// fee: total.fee,\n// commission: total.commission,\n// duty: total.duty,\n// methodType,\n// memo,\n// }\nfunction logTransaction(translog) {\n    if (!translog) return \"\";\n    let buy = translog.buy;\n    let sell = translog.sell;\n    if (sell) {\n        return `收入：${formatFxstr(translog.profit)}, 持有 ${\n            sell.dateIndex - buy.dateIndex + 1\n        }天，盈利 ${(-(translog.profit * 100) / buy.total).toFixed(2)}%, ${\n            translog.transeq\n        }\n       [买入 ${buy.date}, ${formatFxstr(buy.price)}, ${\n            buy.count\n        }, ${formatFxstr(buy.total)}, ${buy.transeq}] \n       [卖出 ${sell.date}, ${formatFxstr(sell.price)}, ${\n            sell.count\n        }, ${formatFxstr(sell.total)}, ${sell.methodType}, ${sell.memo}, ${\n            sell.transeq\n        }]`;\n    } else {\n        // 持有未卖出\n        return `收入：---, 持有 ---天，盈利 ---\n       [买入 ${buy.date}, ${formatFxstr(buy.price)}, ${\n            buy.count\n        }, ${formatFxstr(buy.total)}]`;\n    }\n}\n\nexport default {\n    createSellTransaction,\n    createBuyTransaction,\n    calculateTransactionFee,\n    parseCapitalReports,\n    showCapitalReports,\n    showTransactions,\n};\n","import moment from \"moment\";\nimport CG from \"console-grid\";\nimport { formatFxstr } from \"./util\";\nimport debugpkg from \"debug\";\nconst debug = debugpkg(\"reports\");\n\nfunction parseWorkdayReports(transactions) {\n    if (!transactions || transactions.length <= 0) return;\n    // 报告包含5+1行信息，1-5对应周一到周五的信息，0表示汇总\n    // 每行信息包括：count(交易次数), win_ratio(盈利比例)，win(平均盈利金额)，\n    //      loss_ratio(亏损比例) ，loss（平均亏损金额），ratio_winloss(盈利亏损比),\n    //      average(平均交易规模), max_loss（最大亏损），profit(利润)\n    let results = [\n        {\n            day: \"\",\n            count: 0,\n            count_win: 0,\n            count_loss: 0,\n            win_ratio: 0,\n            win: 0,\n            loss_ratio: 0,\n            loss: 0,\n            ratio_winloss: 0,\n            average: 0,\n            max_win: 0,\n            max_loss: 0,\n            profit: 0,\n        },\n        {\n            day: \"周一\",\n            count: 0,\n            count_win: 0,\n            count_loss: 0,\n            win_ratio: 0,\n            win: 0,\n            loss_ratio: 0,\n            loss: 0,\n            ratio_winloss: 0,\n            average: 0,\n            max_win: 0,\n            max_loss: 0,\n            profit: 0,\n        },\n        {\n            day: \"周二\",\n            count: 0,\n            count_win: 0,\n            count_loss: 0,\n            win_ratio: 0,\n            win: 0,\n            loss_ratio: 0,\n            loss: 0,\n            ratio_winloss: 0,\n            average: 0,\n            max_win: 0,\n            max_loss: 0,\n            profit: 0,\n        },\n        {\n            day: \"周三\",\n            count: 0,\n            count_win: 0,\n            count_loss: 0,\n            win_ratio: 0,\n            win: 0,\n            loss_ratio: 0,\n            loss: 0,\n            ratio_winloss: 0,\n            average: 0,\n            max_win: 0,\n            max_loss: 0,\n            profit: 0,\n        },\n        {\n            day: \"周四\",\n            count: 0,\n            count_win: 0,\n            count_loss: 0,\n            win_ratio: 0,\n            win: 0,\n            loss_ratio: 0,\n            loss: 0,\n            ratio_winloss: 0,\n            average: 0,\n            max_win: 0,\n            max_loss: 0,\n            profit: 0,\n        },\n        {\n            day: \"周五\",\n            count: 0,\n            count_win: 0,\n            count_loss: 0,\n            win_ratio: 0,\n            win: 0,\n            loss_ratio: 0,\n            loss: 0,\n            ratio_winloss: 0,\n            average: 0,\n            max_win: 0,\n            max_loss: 0,\n            profit: 0,\n        },\n    ];\n\n    for (let trans of transactions) {\n        let buy = trans.buy;\n        // let sell = trans.sell;\n        let date = moment(buy.date, \"YYYYMMDD\");\n        let day = date.day();\n        if (day < 1 && day > 5) {\n            // 超出了周一～周五的范围，跳过这个日期\n            debug(`${buy.tradeDate}交易超出星期范围：${day}, %o`, trans);\n            continue;\n        }\n\n        let days = [0, day];\n        // console.log(`%o`, days);\n        // console.log(\n        //     `%o, ${buy.tradeDate}, ${date}, ${day}, %o %o`,\n        //     trans,\n        //     days,\n        //     results\n        // );\n        for (let index of days) {\n            let res = results[index];\n            res.count++;\n            res.profit += trans.profit;\n            if (trans.profit >= 0) {\n                res.count_win++;\n                res.win += trans.profit;\n                if (res.max_win < trans.profit) res.max_win = trans.profit;\n            } else {\n                res.count_loss++;\n                res.loss += trans.profit;\n                if (res.max_loss > trans.profit) res.max_loss = trans.profit;\n            }\n            // console.log(`${index}, %o`, res);\n        }\n    }\n    for (let res of results) {\n        res.win_ratio = res.count_win / res.count;\n        res.win = res.win / res.count_win;\n        res.loss_ratio = res.count_loss / res.count;\n        res.loss = res.loss / res.count_loss;\n        res.ratio_winloss = res.win / res.loss;\n        res.average = res.profit / res.count;\n    }\n    return results;\n}\n\nfunction showWorkdayReports(log, transactions) {\n    let reports = parseWorkdayReports(transactions);\n    // console.log(\"%o\", reports);\n\n    //     let days = [\"总计\", \"周一\", \"周二\", \"周三\", \"周四\", \"周五\"];\n    //     log(`\n    // 工作日    交易次数    盈利比例    平均盈利    亏损比例    平均亏损    盈亏比    平均利润    最大亏损    利润`);\n    //     for (let report of reports) {\n    //         log(\n    //             `${report.day}       ${report.count}          ${(\n    //                 report.win_ratio * 100\n    //             ).toFixed(1)}%    ${report.win.toFixed(2)}    ${(\n    //                 report.loss_ratio * 100\n    //             ).toFixed(1)}%    ${report.loss.toFixed(\n    //                 2\n    //             )}    ${report.ratio_winloss.toFixed(\n    //                 2\n    //             )}    ${report.average.toFixed(2)}    ${report.max_loss.toFixed(\n    //                 2\n    //             )}    ${report.profit.toFixed(2)}`\n    //         );\n    //     }\n\n    // 采用console-grid打印格式\n    let grid = new CG();\n    let CGS = CG.Style;\n    let columns = [\n        { id: \"workday\", name: \"日期\", type: \"string\", align: \"left\" },\n        { id: \"count\", name: \"交易次数\", type: \"number\", align: \"right\" },\n        { id: \"win_ratio\", name: \"盈利比例\", type: \"number\", align: \"right\" },\n        { id: \"win_average\", name: \"平均盈利\", type: \"number\", align: \"right\" },\n        { id: \"loss_ratio\", name: \"亏损比例\", type: \"number\", align: \"right\" },\n        {\n            id: \"loss_average\",\n            name: \"平均亏损\",\n            type: \"number\",\n            align: \"right\",\n        },\n        { id: \"ratio_winloss\", name: \"盈亏比\", type: \"number\", align: \"right\" },\n        {\n            id: \"profit_average\",\n            name: \"平均利润\",\n            type: \"number\",\n            align: \"right\",\n        },\n        { id: \"max_loss\", name: \"最大亏损\", type: \"number\", align: \"right\" },\n        { id: \"profit\", name: \"利润\", type: \"number\", align: \"right\" },\n    ];\n    let rows = [];\n    for (let report of reports) {\n        rows.push({\n            workday:\n                report.win_ratio > 0.5 && report.profit >= 0\n                    ? CGS.red(report.day)\n                    : report.day,\n            count: report.count,\n            win_ratio:\n                report.win_ratio >= 0.5\n                    ? CGS.red(`${(report.win_ratio * 100).toFixed(1)}%`)\n                    : `${(report.win_ratio * 100).toFixed(1)}%`, //CGS.green\n            win_average: `${formatFxstr(report.win)}`,\n            loss_ratio:\n                report.loss_ratio >= 0.5\n                    ? CGS.green(`${(report.loss_ratio * 100).toFixed(1)}%`)\n                    : `${(report.loss_ratio * 100).toFixed(1)}%`,\n            loss_average: `${formatFxstr(report.loss)}`,\n            ratio_winloss:\n                report.ratio_winloss < -1\n                    ? CGS.cyan(`${(-report.ratio_winloss).toFixed(2)}`)\n                    : `${(-report.ratio_winloss).toFixed(2)}`,\n            profit_average:\n                report.average >= 0\n                    ? CGS.red(`${formatFxstr(report.average)}`)\n                    : CGS.green(`${formatFxstr(report.average)}`),\n            max_loss: `${formatFxstr(report.max_loss)}`,\n            profit:\n                report.profit >= 0\n                    ? CGS.red(`${report.profit.toFixed(2)}`)\n                    : CGS.green(`${report.profit.toFixed(2)}`),\n        });\n    }\n    let data = {\n        option: {},\n        columns,\n        rows,\n    };\n    grid.render(data);\n\n    // 采用console-table-printer库打印格式\n    // const p = new Table({\n    //     columns: [\n    //         { name: \"workday\", alignment: \"center\" },\n    //         { name: \"count\", alignment: \"right\" },\n    //         { name: \"win ratio\", alignment: \"right\" },\n    //         { name: \"win/trade\", alignment: \"right\" },\n    //         { name: \"loss ratio\", alignment: \"right\" },\n    //         { name: \"loss/trade\", alignment: \"right\" },\n    //         { name: \"ratio win/loss\", alignment: \"right\" },\n    //         { name: \"profit/trade\", alignment: \"right\" },\n    //         { name: \"max loss\", alignment: \"right\" },\n    //         { name: \"profit\", alignment: \"right\" },\n    //     ],\n    // });\n    // for (let report of reports) {\n    //     p.addRow(\n    //         {\n    //             workday: report.day,\n    //             count: report.count,\n    //             \"win ratio\": `${(report.win_ratio * 100).toFixed(1)}%`,\n    //             \"win/trade\": `${report.win.toFixed(2)}`,\n    //             \"loss ratio\": `${(report.loss_ratio * 100).toFixed(1)}%`,\n    //             \"loss/trade\": `${report.loss.toFixed(2)}`,\n    //             \"ratio win/loss\": `${(-report.ratio_winloss).toFixed(2)}`,\n    //             \"profit/trade\": `${report.average.toFixed(2)}`,\n    //             \"max loss\": `${report.max_loss.toFixed(2)}`,\n    //             profit: `${report.profit.toFixed(2)}`,\n    //         },\n    //         { color: report.win_ratio > 0.5 ? \"red\" : \"green\" }\n    //     );\n    // }\n    // p.printTable();\n}\n\nexport { parseWorkdayReports, showWorkdayReports };\n\n//\n// {\n//     transeq: stock.transeq,\n//     tradeDate: translog.tradeDate,\n//     profit: stock.buy.total + translog.total,\n//     income: translog.count * translog.price - stock.count * stock.price,\n//     buy: stock.buy,\n//     sell: translog,\n// }\n// transaction\n// {\n//     date: tradeDate,\n//     dateIndex: tradeDateIndex,\n//     type: \"buy\",\n//     count: count,\n//     price,\n//     total: total.total,\n//     amount: total.amount,\n//     fee: total.fee,\n//     commission: total.commission,\n//     duty: total.duty,\n//     methodType,\n//     memo,\n// }\n","import {\n    readStockList,\n    readStockData,\n    stockDataNames,\n} from \"@wt/lib-wtda-query\";\n\nimport moment from \"moment\";\nimport _ from \"lodash\";\nimport debugpkg from \"debug\";\n\nimport { formatFxstr } from \"./util\";\n\n// import stoploss from \"./stoploss\";\n// import mmb from \"./momentum-breakthrough\";\nimport engine from \"./transaction-engine\";\nimport trans from \"./transaction\";\nimport * as reports from \"./reports\";\n\nconst log = console.log;\nconst debug = debugpkg(\"sim\");\n\nfunction showOptionsInfo(options) {\n    let buys = \"\";\n    let usedRules = {};\n    for (let rule of options.rules.buy) {\n        buys += `${rule.name}, `;\n        if (!(rule.label in usedRules)) {\n            usedRules[rule.label] = rule;\n        }\n    }\n\n    let sells = \"\";\n    for (let rule of options.rules.sell) {\n        sells += `${rule.name}, `;\n        if (!(rule.label in usedRules)) {\n            usedRules[rule.label] = rule;\n        }\n    }\n\n    let rules_desc = \"\";\n    for (let label in usedRules) {\n        rules_desc += usedRules[label].showOptions(options);\n    }\n\n    console.log(\n        `初始资金:        ${formatFxstr(options.initBalance)}元 \n测试交易资金模式:  ${options.fixCash ? \"固定头寸\" : \"累计账户\"}\n测试数据周期: ${options.startDate}\n\n规则：\n买入模型：${buys}\n卖出模型：${sells}\n\n${rules_desc}\n`\n    );\n}\n\nasync function simulate(options) {\n    // 显示目前的配置模拟信息\n    showOptionsInfo(options);\n\n    // 首先根据设置获得列表，列表内容为需要进行算法计算的各个股票\n    //  TODO: 这里先读取全部的列表\n    let stockListData = await readStockList();\n    if (!stockListData || !stockListData.data) {\n        log(`没有读取到股票列表，无法处理日线数据`);\n        return;\n    }\n    let stockList = stockListData.data;\n    // 重新过滤可用的\n    stockList = await filterStockList(stockList, options);\n    log(`算法执行 ${stockList && stockList.length} 条数据`);\n    // data存放股票列表的基本信息：\n    // {\n    //      ts_code: '000001.SZ', symbol: '000001', name: '平安银行',\n    //      market: '主板', exchange: 'SZSE',\n    //      area: '深圳', industry: '银行', fullname: '平安银行股份有限公司',\n    //      enname: 'Ping An Bank Co., Ltd.', curr_type: 'CNY',\n    //      list_status: 'L', list_date: '19910403', delist_date: null, is_hs: 'S'\n    // }\n    // this.log(`%o`, stockList[0]);\n    // 后续的执行为列表的循环计算，这里的算法因为主要是CPU计算类型，只有输入和输出部分有I/O运算，因此不考虑\n\n    log(\"\");\n    // 下一步开始按照给出的数据循环进行处理\n    for (let stockItem of stockList) {\n        // this.log(`处理数据：%o`, stockItem);\n\n        // 首先读取日线信息\n        let stockData = await readStockData(\n            stockDataNames.daily,\n            stockItem.ts_code\n        );\n        // 准备资金账户数据\n        let capitalData = {\n            info: stockItem,\n            balance: options.fixCash ? 0 : options.initBalance, // 初始资金\n            stocks: [], // 持有的股票信息，每次买入单独一笔记录，分别进行处理，结构{ count: 0, price: 0, buy: transaction }, // 持有股票信息\n            transactions: [], // 交易记录 {tradeDate: 完成日期, profit: 利润, income: 收入, buy: transaction, sell: transaction}\n            //transaction { date: , count: 交易数量, price: 交易价格, total: 总金额, amount: 总价, fee: 交易费用, memo: 备注信息 }\n            _transeq: 0, // 当前交易序号，获取后要自己增加，对应一次股票的买卖使用同一个序号\n        };\n        if (stockData) {\n            log(\n                `[${stockItem.ts_code}]${\n                    stockItem.name\n                } 【数据更新时间：${moment(stockData.updateTime).format(\n                    \"YYYY-MM-DD HH:mm\"\n                )}】`\n            );\n            // 日线数据条数 ${\n            //     stockData.data && stockData.data.length\n            // }, 从${stockData.startDate}到${\n            //     stockData.endDate\n            // }，\n\n            // 首先过滤历史数据，这里将日线数据调整为正常日期从历史到现在\n            stockData = await filterStockData(stockData);\n\n            // 全部数据调整为前复权后再执行计算\n            calculatePrevAdjPrice(stockData);\n\n            // 开始按照日期执行交易算法\n            let startDate = moment(options.startDate, \"YYYYMMDD\");\n            let currentDate = null;\n            for (let index = 0; index < stockData.data.length; index++) {\n                let daily = stockData.data[index];\n                let tradeDate = moment(daily.trade_date, \"YYYYMMDD\");\n                if (_.isEmpty(currentDate)) {\n                    if (startDate.isAfter(tradeDate)) {\n                        continue;\n                    }\n                    debug(\n                        `找到开始日期，开始执行算法！${index}, ${daily.trade_date}`\n                    );\n                } else {\n                    debug(`执行算法！${index}, ${daily.trade_date}`);\n                }\n                currentDate = tradeDate;\n                // this.log(`%o`, engine);\n                // let trans =\n                await engine.executeTransaction(\n                    index,\n                    stockData.data,\n                    capitalData,\n                    options\n                );\n            }\n\n            trans.showCapitalReports(log, capitalData);\n            if (options.showTrans) {\n                trans.showTransactions(log, capitalData);\n            }\n            if (options.showWorkdays) {\n                reports.showWorkdayReports(log, capitalData.transactions);\n            }\n        } else {\n            log(\n                `[${stockItem.ts_code}]${stockItem.name} 没有日线数据，请检查！`\n            );\n        }\n    }\n}\n\n/**\n * 将日线数据中的历史价位根据复权因子全部处理为前复权结果，方便后续计算\n *\n * @param {*} dailyData 日线数据\n * @param {int} digits 保留位数\n */\nfunction calculatePrevAdjPrice(dailyData, digits = 2) {\n    if (dailyData && dailyData.data && dailyData.data.length > 0) {\n        dailyData.data.forEach((item) => {\n            if (item.prevadj_factor) {\n                item.open = Number(\n                    (item.open * item.prevadj_factor).toFixed(digits)\n                );\n                item.close = Number(\n                    (item.close * item.prevadj_factor).toFixed(digits)\n                );\n                item.high = Number(\n                    (item.high * item.prevadj_factor).toFixed(digits)\n                );\n                item.low = Number(\n                    (item.low * item.prevadj_factor).toFixed(digits)\n                );\n                item.pre_close = Number(\n                    (item.pre_close * item.prevadj_factor).toFixed(digits)\n                );\n                item.change = Number(\n                    (item.change * item.prevadj_factor).toFixed(digits)\n                );\n            }\n        });\n    }\n}\n\n/**\n * 这里定义一个过滤列表的接口方法，利用options来过滤后续使用的股票\n * 返回为一个符合条件的列表\n * 这里后续考虑调整一下接口定义，目前暂时简化处理\n */\nasync function filterStockList(stockList, options) {\n    // let retStockList = [];\n    return options.selectedStocks.map((tsCode) => {\n        let tmp = stockList.filter((item) => {\n            return item.ts_code === tsCode;\n        });\n        // console.log(`${tmp && tmp.length}, %o`, tmp[0]);\n        return tmp[0];\n    });\n}\n\n/**\n * 这里提供对单个数据的调整，主要应当是一些额外的数据计算添加，周期过滤等\n *\n * @param {*} stockData 股票日线数据对象\n * @param {*} options 数据过滤条件\n */\nasync function filterStockData(stockData, options) {\n    stockData.data.reverse();\n    return stockData;\n}\n\nexport default simulate;\n","import _ from \"lodash\";\n\nconst ORGANIZED = Symbol(\"表示数据是否经过检查和整理\");\n\n/**\n * 对交易数据按照结构进行检查，检查后需要满足\n * 1. 数组结构\n * 2. 交易日期按照时间升序排列，0为最早的数据\n * 3. 如果提供了赋权因子，进行前复权计算\n * 4. 设置ORGANIZED标记为true\n *\n * @param {*} data 交易数据（日线）\n */\nfunction checkTradeData(data, digits = 3) {\n    if (_.isEmpty(data) || data[ORGANIZED]) return data;\n    if (!_.isArray(data)) return data;\n\n    // 检查数据排序，如果是降序，则反过来\n    if (checkOrder(data)) {\n        data.reverse();\n    }\n\n    if (data[0] && data[0].prevadj_factor) {\n        calculatePrevAdjPrice(data, digits);\n    }\n\n    data[ORGANIZED] = true;\n    return data;\n}\n\n/**\n * 将日线数据中的历史价位根据复权因子全部处理为前复权结果，方便后续计算\n *\n * @param {*} dailyData 日线数据\n * @param {int} digits 保留位数\n */\nfunction calculatePrevAdjPrice(dailyData, digits = 3) {\n    if (dailyData && dailyData.length > 0) {\n        dailyData.forEach((item) => {\n            if (item.prevadj_factor) {\n                item.open = toFixed(item.open * item.prevadj_factor, digits);\n                item.close = toFixed(item.close * item.prevadj_factor, digits);\n                item.high = toFixed(item.high * item.prevadj_factor, digits);\n                item.low = toFixed(item.low * item.prevadj_factor, digits);\n                item.pre_close = toFixed(\n                    item.pre_close * item.prevadj_factor,\n                    digits\n                );\n                item.change = toFixed(\n                    item.change * item.prevadj_factor,\n                    digits\n                );\n            }\n        });\n    }\n}\n\nfunction readData(item, prop) {\n    if (_.isFunction(prop)) {\n        return prop(item);\n    } else if (_.isString(prop)) {\n        return item && item[prop];\n    }\n    return item;\n}\n\nfunction toFixed(num, digits = 3) {\n    return Number(num.toFixed(digits));\n}\n\nfunction checkOrder(array) {\n    return (\n        array &&\n        _.isArray(array) &&\n        array.length > 1 &&\n        array[0].trade_date > array[array.length - 1].trade_date\n    );\n}\n\nfunction average(array, index, n, prop, digits = 3) {\n    if (\n        index >= 0 &&\n        array &&\n        Array.isArray(array) &&\n        array.length > index &&\n        n > 0\n    ) {\n        let desc = checkOrder(array);\n\n        let step = desc ? -1 : 1;\n        let lastIndex = index - step * n;\n        if (lastIndex < 0 || lastIndex >= array.length) {\n            return;\n        }\n\n        let i = index;\n        let count = 0;\n        let sum = 0;\n        while (i >= 0 && i < array.length && count < n) {\n            sum += readData(array[i], prop);\n            i -= step;\n            count++;\n        }\n        if (count === n) {\n            return toFixed(sum / n, digits);\n        }\n        // let calcArr = array.slice(index - n + 1, index + 1);\n        // return (\n        //     calcArr\n        //         .map((item, i, all) => {\n        //             return readData(item, prop);\n        //         })\n        //         .reduce((total, item) => {\n        //             return total + item;\n        //         }, 0) / n\n        // );\n    }\n}\n\nfunction ma(array, n, prop, type, digits = 3) {\n    if (type === \"ma\") {\n        return sma(array, n, prop, digits);\n    } else {\n        return ema(array, n, prop, digits);\n    }\n}\n\nfunction sma(array, n, prop, digits = 3) {\n    if (array && Array.isArray(array) && array.length > 0 && n > 0) {\n        let desc = checkOrder(array);\n        let step = desc ? -1 : 1;\n        let i = desc ? array.length - 1 : 0;\n        let index = 0;\n        let ret = [];\n        while (i >= 0 && i < array.length) {\n            ret[index] = average(array, i, n, prop, digits);\n            index++;\n            i += step;\n        }\n        return ret;\n    }\n}\n\nfunction ema(array, n, prop, digits = 3) {\n    if (array && Array.isArray(array) && array.length > 0 && n > 0) {\n        let desc = checkOrder(array);\n        let step = desc ? -1 : 1;\n        let i = desc ? array.length - 1 : 0;\n        let index = 0;\n        let ret = [];\n        let tmp = 0;\n        while (i >= 0 && i < array.length) {\n            if (index === 0) {\n                tmp = readData(array[i], prop);\n            } else {\n                tmp = (2 * readData(array[i], prop) + (n - 1) * tmp) / (n + 1);\n            }\n            ret[index] = toFixed(tmp, digits);\n            index++;\n            i += step;\n        }\n        return ret;\n    }\n}\n\n/**\n * 计算指定数据的TR值\n * @param {*} data 日线数据\n */\nfunction tr(data) {\n    if (data) {\n        return Math.max(\n            data.high - data.low,\n            Math.abs(data.high - data.pre_close),\n            Math.abs(data.pre_close - data.low)\n        );\n    }\n}\n\nfunction ohlc(data) {\n    if (data) {\n        return (data.open + data.high + data.low + data.close) / 4;\n    }\n}\n\nfunction hl(data) {\n    if (data) {\n        return (data.high + data.low) / 2;\n    }\n}\n\n/**\n *\n * @param {Array} array 数据数组\n * @param {number} n 平均天数\n * @param {*} prop 数据属性或转换方法\n * @param {string} type 偏差类型\n * @param {boolean} desc 数据数组是否降序\n * @param {number} digits 小数保留位数\n */\nfunction stdev(array, n, prop, digits = 3) {\n    if (array && Array.isArray(array) && array.length > 0 && n > 0) {\n        let desc = checkOrder(array);\n        let step = desc ? -1 : 1;\n        let i = desc ? array.length - 1 : 0;\n        let index = 0;\n        let ret = [];\n        while (i >= 0 && i < array.length) {\n            let ma = average(array, i, n, prop, digits);\n            let d;\n\n            if (ma) {\n                let sum = 0;\n                let j = i;\n                let count = 0;\n                while (j >= 0 && j < array.length && count < n) {\n                    sum += (readData(array[j], prop) - ma) ** 2;\n                    count++;\n                    j -= step;\n                }\n                d = toFixed(Math.sqrt(sum / (n - 1)), digits);\n            }\n\n            ret[index] = d;\n            index++;\n            i += step;\n        }\n        return ret;\n    }\n}\n\nexport default {\n    average,\n    ma,\n    sma,\n    ema,\n    stdev,\n    tr,\n    ohlc,\n    hl,\n    readData,\n    toFixed,\n    checkTradeData,\n};\n","import {\n    getDataRoot,\n    readStockList,\n    readStockData,\n    stockDataNames,\n} from \"@wt/lib-wtda-query\";\n\nimport moment from \"moment\";\nimport _ from \"lodash\";\nimport debugpkg from \"debug\";\n\nimport utils from \"./indicators/utils\";\n\nimport { formatFxstr } from \"./util\";\n\nimport engine from \"./transaction-engine\";\nimport trans from \"./transaction\";\n\nconst path = require(\"path\");\nconst fs = require(\"fs\");\nconst fp = fs.promises;\n\nconst log = console.log;\nconst debug = debugpkg(\"search\");\n\nfunction showOptionsInfo(options) {\n    console.log(\n        `测试数据周期: ${options.startDate}\n\n模型：${options.match.rule}\n\n${options.match.rule.showOptions(options)}\n`\n    );\n}\n\nasync function search(options) {\n    // 显示目前的配置模拟信息\n    showOptionsInfo(options);\n\n    // 首先根据设置获得列表，列表内容为需要进行算法计算的各个股票\n    let stockListData = await readStockList();\n    if (!stockListData || !stockListData.data) {\n        log(`没有读取到股票列表，无法处理日线数据`);\n        return;\n    }\n    let stockList = stockListData.data;\n    // 重新过滤可用的\n    stockList = await filterStockList(stockList, options);\n    log(`算法执行 ${stockList && stockList.length} 条数据`);\n\n    log(\"\");\n\n    let foundSignals = {};\n    // 下一步开始按照给出的数据循环进行处理\n    for (let stockItem of stockList) {\n        // this.log(`处理数据：%o`, stockItem);\n        if (stockItem.name.match(\"ST\")) {\n            continue;\n        }\n\n        // 首先读取日线信息\n        let stockData = await readStockData(\n            stockDataNames.daily,\n            stockItem.ts_code\n        );\n\n        if (stockData) {\n            debug(\n                `[${stockItem.ts_code}]${\n                    stockItem.name\n                } 【数据更新时间：${moment(stockData.updateTime).format(\n                    \"YYYY-MM-DD HH:mm\"\n                )}】`\n            );\n\n            // 首先过滤历史数据，这里将日线数据调整为正常日期从历史到现在\n            stockData = await prepareStockData(stockData, options);\n\n            // 全部数据调整为前复权后再执行计算\n            calculatePrevAdjPrice(stockData);\n\n            let rule = options && options.match && options.match.rule;\n            debug(`执行算法！${stockData.data.length - 1}`);\n            let matched = rule.check(\n                stockData.data.length - 1,\n                stockData.data,\n                options,\n                stockItem.ts_code\n            );\n            if (matched && matched.hasSignals) {\n                log(\n                    `**  [${stockItem.ts_code}]${stockItem.name} 信号:${matched.tradeType} ${matched.memo}, ${matched.days}`\n                );\n                let signal = matched.signal;\n                if (signal) {\n                    if (signal in foundSignals) {\n                        foundSignals[signal].push(matched);\n                    } else {\n                        foundSignals[signal] = [matched];\n                    }\n                }\n            }\n        }\n    }\n\n    let report = options && options.match && options.match.report;\n    let reports = await report.createReports(foundSignals, options);\n    await saveReports(reports);\n\n    for (let item in foundSignals) {\n        let list = foundSignals[item];\n        log(`*** 信号类型：${item}，共发现${list && list.length} ***`);\n        // for (let code of list) {\n        //     log(`  \"${code}\",`);\n        // }\n    }\n\n    let buyList = reports && reports.squeeze && reports.squeeze.buyList;\n    let readyList = reports && reports.squeeze && reports.squeeze.readyList;\n    let boundaries = [\n        \"1天\",\n        \"2天\",\n        \"3天\",\n        \"6天内\",\n        \"12天内\",\n        \"21天内\",\n        \"34天内\",\n        \"超过34天\",\n    ];\n    for (let i = 0; i < boundaries.length; i++) {\n        log(\n            `** 买入信号【${boundaries[i]}】： ${buyList && buyList[i].length}`\n        );\n    }\n    for (let i = 0; i < boundaries.length; i++) {\n        log(\n            `** 准备信号【${boundaries[i]}】： ${\n                readyList && readyList[i].length\n            }`\n        );\n    }\n}\n\nfunction getReportsFile() {\n    return path.join(getDataRoot(), \"reports.json\");\n}\n\nasync function saveReports(data) {\n    try {\n        let jsonStr = JSON.stringify(data);\n        let filePath = getReportsFile();\n\n        await fp.writeFile(filePath, jsonStr, { encoding: \"utf-8\" });\n    } catch (error) {\n        throw new Error(\"保存报告数据时出现错误，请检查后重新执行：\" + error);\n    }\n}\n\nasync function readReports() {\n    let retData = {\n        updateTime: null,\n    };\n\n    try {\n        let dataFile = getReportsFile();\n        try {\n            retData = JSON.parse(await fp.readFile(dataFile, \"utf-8\"));\n        } catch (error) {\n            // 文件不存在，不考虑其它错误\n            if (!(error && error.code === \"ENOENT\")) {\n                console.error(\n                    `读取报告文件${dataFile}时发生错误：${error}, %o`,\n                    error\n                );\n            } else {\n                console.error(`读取报告文件${dataFile}不存在，%o`, error);\n            }\n        }\n    } catch (error) {\n        console.error(`从本地读取报告数据发生错误 ${error}`);\n    }\n    return retData;\n}\n\n/**\n * 将日线数据中的历史价位根据复权因子全部处理为前复权结果，方便后续计算\n *\n * @param {*} dailyData 日线数据\n * @param {int} digits 保留位数\n */\nfunction calculatePrevAdjPrice(dailyData, digits = 2) {\n    if (dailyData && dailyData.data && dailyData.data.length > 0) {\n        dailyData.data.forEach((item) => {\n            if (item.prevadj_factor) {\n                item.open = Number(\n                    (item.open * item.prevadj_factor).toFixed(digits)\n                );\n                item.close = Number(\n                    (item.close * item.prevadj_factor).toFixed(digits)\n                );\n                item.high = Number(\n                    (item.high * item.prevadj_factor).toFixed(digits)\n                );\n                item.low = Number(\n                    (item.low * item.prevadj_factor).toFixed(digits)\n                );\n                item.pre_close = Number(\n                    (item.pre_close * item.prevadj_factor).toFixed(digits)\n                );\n                item.change = Number(\n                    (item.change * item.prevadj_factor).toFixed(digits)\n                );\n            }\n        });\n    }\n}\n\n/**\n * 这里定义一个过滤列表的接口方法，利用options来过滤后续使用的股票\n * 返回为一个符合条件的列表\n * 这里后续考虑调整一下接口定义，目前暂时简化处理\n */\nasync function filterStockList(stockList, options) {\n    if (options.all) return stockList;\n    // let retStockList = [];\n    return options.selectedStocks.map((tsCode) => {\n        let tmp = stockList.filter((item) => {\n            return item.ts_code === tsCode;\n        });\n        // console.log(`${tmp && tmp.length}, %o`, tmp[0]);\n        return tmp[0];\n    });\n}\n\n/**\n * 这里提供对单个数据的调整，主要应当是一些额外的数据计算添加，周期过滤等\n *\n * @param {*} stockData 股票日线数据对象\n * @param {*} options 数据过滤条件\n */\nasync function prepareStockData(stockData, options) {\n    utils.checkTradeData(stockData.data);\n\n    if (stockData && stockData.data && stockData.data.length > 0) {\n        if (stockData.data[0].trade_date < options.startDate) {\n            let index = stockData.data.findIndex((data, i) => {\n                return data.trade_date >= options.startDate;\n            });\n\n            if (index) {\n                stockData.data = stockData.data.slice(index);\n            } else {\n                stockData.data = [];\n            }\n        }\n    }\n    // stockData.data.reverse();\n    return stockData;\n}\n\nexport default { search, readReports };\n","import _ from \"lodash\";\nimport engine from \"./transaction-engine\";\nimport trans from \"./transaction\";\n\nimport debugpkg from \"debug\";\nconst debug = debugpkg(\"mmb\");\n\nconst OPTIONS_NAME = \"mmb\";\n\n/**\n * 检查买入条件\n * @param {*} stockInfo 股票信息\n * @param {double} balance 账户余额\n * @param {*} tradeDate 交易日期\n * @param {int} index 交易日数据索引位置\n * @param {*} stockData 数据\n * @param {*} options 算法参数\n */\nfunction checkMMBBuyTransaction(stockInfo, balance, index, stockData, options) {\n    if (balance <= 0) return;\n    // debug(`买入检查: ${balance}, ${tradeDate}, %o, ${index}`, stockData);\n\n    let mmboptions = options && options[OPTIONS_NAME];\n    // 平均波幅的计算日数\n    let N = mmboptions.N;\n    // 波幅突破的百分比\n    let P = mmboptions.P;\n\n    let moment = 0;\n    for (let i = 0; i < N; i++) {\n        if (index - i - 1 >= 0) {\n            let tmp = stockData[index - i - 1];\n            if (mmboptions.mmbType === \"hl\") {\n                moment += tmp.high - tmp.low;\n            } else {\n                moment += tmp.high - tmp.close;\n            }\n        }\n    }\n    moment = moment / N;\n\n    let currentData = stockData[index];\n    // console.log(`跟踪信息： ${stockData.length}, ${index}`, currentData);\n    let targetPrice = currentData.open + moment * P;\n    let tradeDate = stockData[index].trade_date;\n\n    debug(\n        `买入条件检查${tradeDate}: ${targetPrice.toFixed(2)}=${\n            currentData.open\n        }+${moment.toFixed(2)}*${P} [o: ${currentData.open}, h: ${\n            currentData.high\n        }, l: ${currentData.low}, c: ${currentData.close}, d: ${\n            currentData.trade_date\n        }]`\n    );\n    if (currentData.high >= targetPrice && currentData.open <= targetPrice) {\n        // 执行买入交易\n        debug(`符合条件：${tradeDate}`);\n        return trans.createBuyTransaction(\n            stockInfo,\n            tradeDate,\n            index,\n            balance,\n            targetPrice,\n            \"mmb\",\n            `动能突破买入 ${targetPrice.toFixed(2)} (=${\n                currentData.open\n            }+${moment.toFixed(2)}*${(P * 100).toFixed(2)}%)`\n        );\n    }\n}\n\n/**\n * 检查是否可以生成卖出交易，如果可以卖出，产生卖出交易记录\n *\n * @param {*} info 股票信息\n * @param {*} stock 持仓信息\n * @param {*} index 今日数据索引位置\n * @param {*} stockData 日线数据\n * @param {*} options 算法参数\n */\nfunction checkMMBSellTransaction(stockInfo, stock, index, stockData, options) {\n    if (_.isEmpty(stock) || stock.count <= 0) return;\n\n    // 检查是否符合动能突破买入条件\n    // if (\n    //     !options.nommbsell &&\n    //     !_.isEmpty(\n    //         checkMMBBuyTransaction(\n    //             stockInfo,\n    //             options.initBalance,\n    //             index,\n    //             stockData,\n    //             options\n    //         )\n    //     )\n    // ) {\n    //     // 可以买入，那么当日保持\n    //     return;\n    // }\n\n    let currentData = stockData[index];\n    let tradeDate = currentData.trade_date;\n    let mmboptions = options && options[OPTIONS_NAME];\n\n    // 目前有持仓，检查是否达到盈利卖出条件\n    if (!mmboptions.nommb1 && currentData.open > stock.price) {\n        // 采用第二天开盘价盈利就卖出的策略\n        debug(\n            `开盘盈利策略符合：${currentData.open.toFixed(\n                2\n            )} (> ${stock.price.toFixed(2)})`\n        );\n        return engine.createSellTransaction(\n            stockInfo,\n            tradeDate,\n            index,\n            stock.count,\n            currentData.open,\n            \"mmb1\",\n            `开盘盈利卖出 ${currentData.open} (> ${stock.price.toFixed(2)})`\n        );\n    }\n\n    if (!mmboptions.nommb2) {\n        // 平均波幅的计算日数\n        let N = mmboptions.N;\n        // 止损使用的波幅下降百分比\n        let L = mmboptions.L;\n        // 有持仓，检查是否达到卖出条件\n        // 第一个卖出条件是买入后按照买入价格及波动数据的反向百分比设置\n        let moment = 0;\n        for (let i = 0; i < N; i++) {\n            if (index - i - 1 >= 0) {\n                let tmp = stockData[index - i - 1];\n                if (mmboptions.mmbType === \"hl\") {\n                    moment += tmp.high - tmp.low;\n                } else {\n                    moment += tmp.high - tmp.close;\n                }\n            }\n        }\n        moment = moment / N;\n\n        let targetPrice = currentData.open - moment * L;\n        if (targetPrice <= currentData.open && targetPrice >= currentData.low) {\n            // 执行波动卖出\n            return trans.createSellTransaction(\n                stockInfo,\n                tradeDate,\n                index,\n                stock.count,\n                targetPrice,\n                \"mmb2\",\n                `动能突破卖出：${targetPrice.toFixed(2)} (= ${\n                    currentData.open\n                }-${moment.toFixed(2)}*${L * 100}%)`\n            );\n        }\n    }\n}\n\n/**\n * 返回参数配置的显示信息\n * @param {*}} opions 参数配置\n */\nfunction showOptions(options) {\n    return `\n模型 ${mmb.name}[${mmb.label}] 参数：\n波幅类型 [${options.mmb.mmbType === \"hc\" ? \"最高-收盘\" : \"最高-最低\"}]\n动能平均天数: ${options.mmb.N}\n动能突破买入比例: ${options.mmb.P * 100}%\n动能突破卖出比例: ${options.mmb.L * 100}%\n规则：\n  1. [${options.mmb.nommb1 ? \"🚫\" : \"✅\"}] 开盘盈利锁定\n  2. [${options.mmb.nommb2 ? \"🚫\" : \"✅\"}] 动能向下突破卖出\n`;\n}\n\nlet mmb = {\n    name: \"MMB(动能穿透)\",\n    label: \"mmb\",\n    description: \"动能穿透\",\n    methodTypes: {\n        mmb: \"动能突破买入\",\n        mmb1: \"开盘盈利卖出\",\n        mmb2: \"动能突破卖出\",\n    },\n    checkBuyTransaction: checkMMBBuyTransaction,\n    checkSellTransaction: checkMMBSellTransaction,\n    showOptions,\n};\n\nexport default mmb;\n","// const _ = require(\"lodash\");\nimport _ from \"lodash\";\n// const engine = require(\"./transaction-engine\");\nimport engine from \"./transaction-engine\";\nimport trans from \"./transaction\";\nimport debugpkg from \"debug\";\nconst debug = debugpkg(\"stoploss\");\n\nconst OPTIONS_NAME = \"stoploss\";\n\n/**\n * 检查是否需要执行止损\n * @param {*} stocks 持仓信息\n * @param {int} index 交易日索引位置\n * @param {*} stockData 日线数据\n */\nfunction checkStoplossTransaction(stockInfo, stock, index, stockData, options) {\n    if (_.isEmpty(stock) || stock.count <= 0) return;\n\n    let currentData = stockData[index];\n    // 止损最大损失比例\n    let S = options && options[OPTIONS_NAME].S;\n\n    // 这里检查纯粹的百分比止损\n    let tradeDate = currentData.trade_date;\n    let lossPrice = stock.price * (1 - S);\n    debug(\n        `止损检查${tradeDate}: ${currentData.low}] <= ${lossPrice.toFixed(\n            2\n        )} (=${stock.price.toFixed(2)}*(1-${(S * 100).toFixed(2)}%))`\n    );\n    if (currentData.low <= lossPrice) {\n        // 当日价格范围达到止损值\n        return trans.createSellTransaction(\n            stockInfo,\n            tradeDate,\n            index,\n            stock.count,\n            lossPrice,\n            \"stoploss\",\n            `止损 ${lossPrice.toFixed(2)} (=${stock.price.toFixed(2)}*(1-${\n                S * 100\n            }%))`\n        );\n    }\n}\n\n/**\n * 返回参数配置的显示信息\n * @param {*}} opions 参数配置\n */\nfunction showOptions(options) {\n    return `\n模型 ${stoploss.name}[${stoploss.label}] 参数：\n止损比例: ${options.stoploss.S * 100}%\n`;\n}\n\nlet stoploss = {\n    name: \"止损\",\n    label: \"stoploss\",\n    description: \"止损\",\n    methodTypes: {\n        stoploss: \"止损卖出\",\n    },\n    checkSellTransaction: checkStoplossTransaction,\n    showOptions,\n};\n\nexport default stoploss;\n","import _ from \"lodash\";\nimport engine from \"./transaction-engine\";\nimport trans from \"./transaction\";\n\nimport debugpkg from \"debug\";\nconst debug = debugpkg(\"benchmark\");\n\n/**\n * 基准参数，用于测量正常买入卖出情况下的基准效果\n * 采用的买入策略为开盘买入，第二天收盘卖出；或者止损平仓\n */\nconst RULE_NAME = \"benchmark\";\n\n/**\n * 检查买入条件\n * @param {*} stockInfo 股票信息\n * @param {double} balance 账户余额\n * @param {int} index 交易日数据索引位置\n * @param {*} stockData 数据\n * @param {*} options 算法参数\n */\nfunction checkBuyTransaction(stockInfo, balance, index, stockData, options) {\n    if (balance <= 0) return;\n    // debug(`买入检查: ${balance}, ${tradeDate}, %o, ${index}`, stockData);\n\n    // let bmOptions = options && options[RULE_NAME];\n    let currentData = stockData[index];\n    // console.log(`跟踪信息： ${stockData.length}, ${index}`, currentData);\n    let targetPrice = currentData.open;\n    let tradeDate = stockData[index].trade_date;\n\n    debug(\n        `基准买入：[${tradeDate} price=${targetPrice} open=${currentData.open} close=${currentData.close}]`\n    );\n    return trans.createBuyTransaction(\n        stockInfo,\n        tradeDate,\n        index,\n        balance,\n        targetPrice,\n        RULE_NAME,\n        `基准买入 ${targetPrice.toFixed(2)}`\n    );\n}\n\n/**\n * 检查是否可以生成卖出交易，如果可以卖出，产生卖出交易记录\n *\n * @param {*} info 股票信息\n * @param {*} stock 持仓信息\n * @param {*} index 今日数据索引位置\n * @param {*} stockData 日线数据\n * @param {*} options 算法参数\n */\nfunction checkSellTransaction(stockInfo, stock, index, stockData, options) {\n    if (_.isEmpty(stock) || stock.count <= 0) return;\n\n    let currentData = stockData[index];\n    let tradeDate = currentData.trade_date;\n    let bmoptions = options && options[RULE_NAME];\n    let priceType = bmoptions.sellPrice;\n\n    if (priceType === \"open\") {\n        debug(\n            `基准卖出：[${tradeDate} price=${currentData.open} open=${currentData.open} close=${currentData.close}]`\n        );\n        return trans.createSellTransaction(\n            stockInfo,\n            tradeDate,\n            index,\n            stock.count,\n            currentData.open,\n            priceType,\n            `开盘卖出 ${currentData.open})`\n        );\n    } else if (priceType === \"close\") {\n        debug(\n            `基准卖出：[${tradeDate} price=${currentData.close} open=${currentData.open} close=${currentData.close}]`\n        );\n        return trans.createSellTransaction(\n            stockInfo,\n            tradeDate,\n            index,\n            stock.count,\n            currentData.open,\n            priceType,\n            `收盘卖出 ${currentData.close}`\n        );\n    }\n}\n\n/**\n * 返回参数配置的显示信息\n * @param {*}} opions 参数配置\n */\nfunction showOptions(options) {\n    return `\n模型 ${benchmark.name}[${benchmark.label}] 参数：\n卖出类型: ${options.benchmark.sellPrice}\n`;\n}\n\nlet benchmark = {\n    name: \"基准\",\n    label: RULE_NAME,\n    description: \"基准测试\",\n    methodTypes: {\n        open: \"开盘卖出\",\n        close: \"收盘卖出\",\n    },\n    checkBuyTransaction,\n    checkSellTransaction,\n    showOptions,\n};\n\nexport default benchmark;\n","import _ from \"lodash\";\nimport engine from \"./transaction-engine\";\nimport trans from \"./transaction\";\n\nimport debugpkg from \"debug\";\nconst debug = debugpkg(\"outsideday\");\n\n/**\n * 外包日模式，主要针对买入定义\n */\nconst RULE_NAME = \"outsideday\";\n\n/**\n * 检查外包日买入条件\n * 1. 前一天为外包日结构，T-1， T-2两天的价格要求满足，T-1价格范围外包T-2，并且T-1收盘价低于T-2最低价\n * 2. 今日T日的开盘价低于T-1外包日收盘价以下\n *\n * 买入价格定为T-1日收盘价\n *\n * @param {*} stockInfo 股票信息\n * @param {double} balance 账户余额\n * @param {int} index 交易日数据索引位置\n * @param {*} stockData 数据\n * @param {*} options 算法参数\n */\nfunction checkBuyTransaction(stockInfo, balance, index, stockData, options) {\n    if (balance <= 0) return;\n    if (index < 2) return;\n    // debug(`外包日买入检查: ${balance}, ${tradeDate}, %o, ${index}`, stockData);\n\n    // let bmOptions = options && options[RULE_NAME];\n    let data2 = stockData[index - 2];\n    let data1 = stockData[index - 1];\n    let currentData = stockData[index];\n\n    // 外包日条件\n    if (data1.high < data2.high || data1.low > data2.low) return;\n    // 外包日收盘低于前一日最低\n    if (data1.close > data2.low) return;\n    // 今日开盘低于外包日收盘\n    if (currentData.open >= data1.close) return;\n\n    // console.log(`跟踪信息： ${stockData.length}, ${index}`, currentData);\n    let targetPrice = currentData.close; // data1.close;\n    let tradeDate = currentData.trade_date;\n\n    debug(`找到外包日模式：\n    [${tradeDate} open=${currentData.open}, close=${currentData.close}] \n    [${data1.trade_date}: high=${data1.high}, low=${data1.low}, close=${data1.close}]\n    [${data2.trade_date}: high=${data1.high}, low=${data1.low}]\n    `);\n    return trans.createBuyTransaction(\n        stockInfo,\n        tradeDate,\n        index,\n        balance,\n        targetPrice,\n        RULE_NAME,\n        `外包日买入 ${targetPrice.toFixed(2)}`\n    );\n}\n\n// /**\n//  * 检查是否可以生成卖出交易，如果可以卖出，产生卖出交易记录\n//  *\n//  * @param {*} info 股票信息\n//  * @param {*} stock 持仓信息\n//  * @param {*} index 今日数据索引位置\n//  * @param {*} stockData 日线数据\n//  * @param {*} options 算法参数\n//  */\n// function checkSellTransaction(stockInfo, stock, index, stockData, options) {\n//     if (_.isEmpty(stock) || stock.count <= 0) return;\n\n//     let currentData = stockData[index];\n//     let tradeDate = currentData.trade_date;\n//     let bmoptions = options && options[RULE_NAME];\n//     let priceType = bmoptions.sellPrice;\n\n//     if (priceType === \"open\") {\n//         return engine.createSellTransaction(\n//             stockInfo,\n//             tradeDate,\n//             index,\n//             stock.count,\n//             currentData.open,\n//             priceType,\n//             `开盘卖出 ${currentData.open})`\n//         );\n//     } else if (priceType === \"close\") {\n//         return engine.createSellTransaction(\n//             stockInfo,\n//             tradeDate,\n//             index,\n//             stock.count,\n//             currentData.open,\n//             priceType,\n//             `收盘卖出 ${currentData.close}`\n//         );\n//     }\n// }\n\n/**\n * 返回参数配置的显示信息\n * @param {*}} opions 参数配置\n */\nfunction showOptions(options) {\n    return `\n`;\n}\n\nlet outsideday = {\n    name: \"外包日\",\n    label: RULE_NAME,\n    description: \"外包日买入\",\n    methodTypes: {},\n    checkBuyTransaction,\n    // checkSellTransaction,\n    showOptions,\n};\n\nexport default outsideday;\n","import _ from \"lodash\";\nimport engine from \"./transaction-engine\";\nimport trans from \"./transaction\";\n\nimport debugpkg from \"debug\";\nconst debug = debugpkg(\"opensell\");\n\nconst OPTIONS_NAME = \"opensell\";\n\n/**\n * 开盘盈利卖出\n *\n * @param {*} info 股票信息\n * @param {*} stock 持仓信息\n * @param {*} index 今日数据索引位置\n * @param {*} stockData 日线数据\n * @param {*} options 算法参数\n */\nfunction checkSellTransaction(stockInfo, stock, index, stockData, options) {\n    if (_.isEmpty(stock) || stock.count <= 0) return;\n\n    let currentData = stockData[index];\n    let tradeDate = currentData.trade_date;\n\n    // 目前有持仓，检查是否达到开盘盈利卖出条件\n    if (currentData.open > stock.price) {\n        debug(\n            `开盘盈利策略符合：${currentData.open.toFixed(\n                2\n            )} (> ${stock.price.toFixed(2)})`\n        );\n        return trans.createSellTransaction(\n            stockInfo,\n            tradeDate,\n            index,\n            stock.count,\n            currentData.open,\n            OPTIONS_NAME,\n            `开盘盈利卖出 ${currentData.open} (> ${stock.price.toFixed(2)})`\n        );\n    }\n}\n\n/**\n * 返回参数配置的显示信息\n * @param {*}} opions 参数配置\n */\nfunction showOptions(options) {\n    return `\n`;\n}\n\nlet opensell = {\n    name: \"开盘盈利\",\n    label: OPTIONS_NAME,\n    description: \"开盘盈利卖出\",\n    methodTypes: {},\n    // checkBuyTransaction: checkMMBBuyTransaction,\n    checkSellTransaction,\n    showOptions,\n};\n\nexport default opensell;\n","import _ from \"lodash\";\nimport engine from \"./transaction-engine\";\nimport trans from \"./transaction\";\nimport debugpkg from \"debug\";\nconst debug = debugpkg(\"smashday\");\n\n/**\n * 攻击日模式\n */\nconst RULE_NAME = \"smashday\";\n\n/**\n * 检查指定序号的日期数据是否符合当前模型定义形态\n *\n * @param {int} index 日期序号\n * @param {*} stockData 数据\n * @param {*} options 参数配置\n */\nfunction check(index, stockData, options) {\n    if (index < 1) return;\n    let type = options && options.smashday.type;\n    let currentData = stockData[index];\n    let data1 = stockData[index - 1];\n    let tradeDate = currentData.trade_date;\n\n    if (type === \"smash1\" && currentData.close < data1.low) {\n        return {\n            dataIndex: index,\n            date: tradeDate,\n            tradeType: \"buy\",\n            type: \"smash1\",\n            targetPrice: currentData.high,\n            memo: `突出收盘买入 [${tradeDate} ${currentData.close} < ${data1.low}，小于前一日最低]，在达到今日最大为反转可买入 ${currentData.high}`,\n        };\n    } else if (type === \"smash1\" && currentData.close > data1.high) {\n        return {\n            dataIndex: index,\n            date: tradeDate,\n            tradeType: \"sell\",\n            type: \"smash1\",\n            targetPrice: currentData.low,\n            memo: `突出收盘卖出 [${tradeDate} ${currentData.close} > ${data1.high}，大于前一日最高]，在达到今日最低为反转可卖出 ${currentData.low}`,\n        };\n    } else if (\n        type === \"smash2\" &&\n        currentData.close > data1.close &&\n        (currentData.close - currentData.low) /\n            (currentData.high - currentData.low) <\n            0.25\n    ) {\n        return {\n            dataIndex: index,\n            date: tradeDate,\n            tradeType: \"buy\",\n            type: \"smash2\",\n            targetPrice: currentData.high,\n            memo: `隐藏攻击买入 [${tradeDate} ${currentData.close} > ${data1.close}，收盘上涨，且在今日价格下方25% (${currentData.high}, ${currentData.low})]，在达到今日最高可买入 ${currentData.high}`,\n        };\n    } else if (\n        type === \"smash2\" &&\n        currentData.close < data1.close &&\n        (currentData.close - currentData.low) /\n            (currentData.high - currentData.low) >\n            0.75\n    ) {\n        return {\n            dataIndex: index,\n            date: tradeDate,\n            tradeType: \"sell\",\n            type: \"smash2\",\n            targetPrice: currentData.low,\n            memo: `隐藏攻击卖出 [${tradeDate} ${currentData.close} < ${data1.close}，收盘下跌，且在今日价格上方25% (${currentData.high}, ${currentData.low})]，在达到今日最低可卖出 ${currentData.low}`,\n        };\n    }\n}\n\n/**\n * 检查买入条件\n * @param {*} stockInfo 股票信息\n * @param {double} balance 账户余额\n * @param {int} index 交易日数据索引位置\n * @param {*} stockData 数据\n * @param {*} options 算法参数\n */\nfunction checkBuyTransaction(stockInfo, balance, index, stockData, options) {\n    if (balance <= 0) return;\n    // debug(`买入检查: ${balance}, ${tradeDate}, %o, ${index}`, stockData);\n\n    let buy = options.smashday && options.smashday.buy;\n    let validDays = buy.validDays || 3;\n    for (let i = 0; i < validDays; i++) {\n        let matched = check(index - i, stockData, options);\n        let smashType = buy.type || \"smash1\";\n        let currentData = stockData[index];\n        let tradeDate = currentData.trade_date;\n        let targetPrice = matched.targetPrice;\n        if (matched && matched.trade_date === \"buy\") {\n            if (\n                matched.type === smashType &&\n                currentData.high >= matched.targetPrice\n            ) {\n                debug(\n                    `攻击日为[${matched.date}]，今日满足目标价位：${matched.targetPrice} [${currentData.low}, ${currentData.high}]`\n                );\n                return trans.createBuyTransaction(\n                    stockInfo,\n                    tradeDate,\n                    index,\n                    balance,\n                    targetPrice,\n                    RULE_NAME,\n                    `攻击日[${matched.type}]买入${targetPrice.toFixed(2)}`\n                );\n            }\n        }\n    }\n}\n\n/**\n * 检查是否可以生成卖出交易，如果可以卖出，产生卖出交易记录\n *\n * @param {*} info 股票信息\n * @param {*} stock 持仓信息\n * @param {*} index 今日数据索引位置\n * @param {*} stockData 日线数据\n * @param {*} options 算法参数\n */\nfunction checkSellTransaction(stockInfo, stock, index, stockData, options) {\n    if (_.isEmpty(stock) || stock.count <= 0) return;\n\n    let sell = options.smashday && options.smashday.sell;\n    let validDays = sell.validDays || 3;\n    for (let i = 0; i < validDays; i++) {\n        let matched = check(index - i, stockData, options);\n        let smashType = sell.type || \"smash1\";\n        let currentData = stockData[index];\n        let tradeDate = currentData.trade_date;\n        let targetPrice = matched.targetPrice;\n        if (matched && matched.trade_date === \"sell\") {\n            if (matched.type === smashType && currentData.low <= targetPrice) {\n                debug(\n                    `攻击日为[${matched.date}]，今日满足目标价位：${targetPrice} [${currentData.low}, ${currentData.high}]`\n                );\n                return trans.createSellTransaction(\n                    stockInfo,\n                    tradeDate,\n                    index,\n                    stock.count,\n                    targetPrice,\n                    RULE_NAME,\n                    `攻击日[${matched.type}]卖出${targetPrice.toFixed(2)}`\n                );\n            }\n        }\n    }\n}\n\n/**\n * 返回参数配置的显示信息\n * @param {*}} opions 参数配置\n */\nfunction showOptions(options) {\n    let buy = options && options.smashday && options.smashday.buy;\n    let sell = options && options.smashday && options.smashday.sell;\n    return `\n模型 ${smashday.name}[${smashday.label}] 参数：\n买入有效期: ${buy.validDays}\n买入类型: ${buy.type}, ${smashday.methodTypes[buy.type]}\n\n卖出有效期: ${sell.validDays}\n卖出类型: ${sell.type}, ${smashday.methodTypes[sell.type]}\n`;\n}\n\nlet smashday = {\n    name: \"攻击日\",\n    label: RULE_NAME,\n    description: \"攻击日模型\",\n    methodTypes: {\n        smash1: \"突出收盘价\",\n        smash2: \"隐藏攻击日\",\n    },\n    checkBuyTransaction,\n    checkSellTransaction,\n    check,\n    showOptions,\n};\n\nexport default smashday;\n","/**\n * 平均价\n *\n * 参数\n *  type：ma，算术平均； ema，指数移动平均\n *  source: close | ohlc\n */\nimport _ from \"lodash\";\nimport utils from \"./utils\";\n\n/**\n * 计算移动平均，返回ma数据\n * @param {*} tradeData 所有数据\n * @param {*} options 参数，n 平均周期, type 平均类型, digits 保留小数位数\n */\nfunction ma(tradeData, options) {\n    utils.checkTradeData(tradeData);\n\n    return utils.ma(\n        tradeData,\n        options && options.n,\n        (options && options.source) === \"ohlc\" ? utils.ohlc : \"close\",\n        options && options.type,\n        options && options.digits\n    );\n}\n\nexport default {\n    name: \"均值\",\n    label: \"MA\",\n    description: \"平均收盘价\",\n    calculate: ma,\n};\n","/**\n * ATR 指标，平均真实幅度\n *\n * 参数\n *  n: 表示平均天数\n *  type：表示均值类型，ma 算术平均，ema 指数移动平均\n *\n * TR = max[h-l, abs(h-cp), abs(l-cp)]\n * cp 表示昨日收盘\n *\n * ATR = Sum(TR, n)/n, 表示n天TR的算术平均\n */\n\nimport _ from \"lodash\";\nimport utils from \"./utils\";\n\n/**\n * 计算ATR指标\n * @param {Array} tradeData 数据数组\n * @param {*} options 参数配置，ATR包含n属性\n */\nfunction atr(tradeData, options) {\n    utils.checkTradeData(tradeData);\n\n    return utils.ma(\n        tradeData,\n        options.n,\n        utils.tr,\n        options && options.type,\n        options && options.digits\n    );\n}\n\nexport default {\n    name: \"ATR\",\n    label: \"平均真实波幅\",\n    description: \"表示在一定周期内价格的最大波动偏离幅度\",\n    calculate: atr,\n};\n","/**\n * Keltner Channel，肯特钠通道\n * 类似于布林带的带状指标，由上中下三条轨道组成\n *\n * 中轨：移动平均线，参数n\n * 上/下轨：移动平均线上下ATR*m距离\n *\n * 参数定义：\n *  n：移动平均天数，默认12，（Squeeze 为20）\n *  m：通道和中轨之间ATR值的倍数，默认1.5\n *  type1：价格移动平均类型，ma 简单移动平均，ema 指数移动平均，默认ema\n *  type2：atr移动平均类型，ma ｜ ema，默认 ma\n *  source: close | ohlc\n */\nimport _ from \"lodash\";\nimport MA from \"./ma\";\nimport ATR from \"./atr\";\nimport utils from \"./utils\";\n\nfunction keltner(tradeData, options) {\n    if (!tradeData || tradeData.length < 0) return;\n    utils.checkTradeData(tradeData);\n\n    let ma = MA.calculate(tradeData, {\n        n: options.n,\n        type: options.type1,\n        source: options.source,\n        digits: options.digits,\n    });\n    if (!ma) return;\n    let atr = ATR.calculate(tradeData, {\n        n: options.n,\n        type: options.type2,\n        digits: options.digits,\n    });\n    if (!atr) return;\n    let up = [];\n    let down = [];\n    for (let i = 0; i < ma.length; i++) {\n        up[i] = utils.toFixed(ma[i] + options.m * atr[i], options.digits);\n        down[i] = utils.toFixed(ma[i] - options.m * atr[i], options.digits);\n    }\n\n    return [ma, up, down, atr];\n}\n\nexport default {\n    name: \"科特钠通道\",\n    label: \"KC\",\n    description: \"科特钠通道\",\n    calculate: keltner,\n};\n","/**\n * 布林线指标\n *\n * 参数：\n *  n: 移动平均天数\n *  m: 上下轨到移动平均的标准差倍数\n *  source: close | ohlc\n *  ma: 移动平均类型，ma | ema\n *\n */\nimport utils from \"./utils\";\nimport MA from \"./ma\";\n\nfunction boll(tradeData, options) {\n    utils.checkTradeData(tradeData);\n\n    let ma = MA.calculate(tradeData, {\n        n: options.n,\n        type: options.ma,\n        source: options.source,\n        digits: options.digits,\n    });\n    if (!ma) return;\n    let stdev = utils.stdev(\n        tradeData,\n        options.n,\n        (options && options.source) === \"ohlc\" ? utils.ohlc : \"close\",\n        options.digits\n    );\n    if (!stdev) return;\n\n    let up = [];\n    let down = [];\n    for (let i = 0; i < ma.length; i++) {\n        up[i] = utils.toFixed(ma[i] + options.m * stdev[i], options.digits);\n        down[i] = utils.toFixed(ma[i] - options.m * stdev[i], options.digits);\n    }\n\n    return [ma, up, down, stdev];\n}\n\nexport default {\n    name: \"BOLL\",\n    label: \"布林线\",\n    description: \"布林线指标\",\n    calculate: boll,\n};\n","/**\n * 基本动量指标\n *\n * 参数：\n *  n: 动量周期\n *  m: 平均天数\n *  source: close, ohlc\n */\n\nimport _ from \"lodash\";\nimport utils from \"./utils\";\n\nfunction mtm(tradeData, options) {\n    utils.checkTradeData(tradeData);\n\n    if (\n        !_.isEmpty(tradeData) &&\n        _.isArray(tradeData) &&\n        tradeData.length > 0 &&\n        options &&\n        options.n > 1\n    ) {\n        let source =\n            options && options.source === \"ohlc\" ? utils.ohlc : \"close\";\n        let digits = options.digits || 3;\n        let ma;\n        if (options && options.m && options.m > 1) {\n            ma = utils.ma(tradeData, options.m, source, \"ma\", digits);\n        } else {\n            ma = utils.ma(tradeData, 1, source, \"ma\", digits);\n        }\n\n        let momentum = tradeData.map((item, i, all) => {\n            if (i > options.n) {\n                return utils.toFixed(\n                    ma[i] - ma[i - options.n],\n                    //utils.readData(item, source) - ma[i - options.n],\n                    //utils.readData(all[i - options.n], source),\n                    digits\n                );\n            } else {\n                return 0;\n            }\n        });\n        // momentum = utils.ma(momentum, 6, undefined, \"ma\");\n        return momentum;\n    }\n}\n\nexport default {\n    name: \"MTM\",\n    label: \"动量指标\",\n    description: \"动量振荡器指标\",\n    calculate: mtm,\n};\n","/**\n * TTM Wave A & B & C\n *\n * 参数：\n *  n: wave 短周期平均\n *  ma: wave a 周期平均1\n *  la: wave a 周期平均2\n *  mb: wave b 周期平均1\n *  lb: wave b 周期平均2\n *  mc: wave c 周期平均1\n *  lc: wave c 周期平均2\n *\n *  useb: true\n *  usec: true\n *  source: close, ohlc\n */\n\nimport _ from \"lodash\";\nimport utils from \"./utils\";\n\nfunction subtract(array1, array2, digits) {\n    if (\n        _.isEmpty(array1) ||\n        _.isEmpty(array2) ||\n        array1.length !== array2.length\n    ) {\n        return;\n    }\n\n    return array1.map((item, i, all) => {\n        if (digits) {\n            return utils.toFixed(item - array2[i], digits);\n        } else {\n            return item - array2[i];\n        }\n    });\n}\n\nfunction ttmwave(\n    tradeData,\n    {\n        n = 8, // 5\n        ma = 34, // 21\n        la = 55, // 34\n        useb = true,\n        mb = 89, // 55\n        lb = 144, // 89\n        usec = true,\n        mc = 233, // 144\n        lc = 377, // 233\n        source = \"close\",\n        digits = 3,\n    } = {}\n) {\n    utils.checkTradeData(tradeData);\n\n    if (\n        _.isEmpty(tradeData) ||\n        !_.isArray(tradeData) ||\n        tradeData.length <= 0\n    ) {\n        return;\n    }\n\n    if (source === \"ohlc\") {\n        source = utils.ohlc;\n    } else {\n        source = \"close\";\n    }\n    // let source = (options && options.source) == \"ohlc\" ? utils.ohlc : \"close\";\n    // let digits = (options && options.digits) || 3;\n    // let n = (options && options.n) || 8;\n\n    // let ma = (options && options.ma) || 34;\n    // let la = (options && options.la) || 55;\n    // let mb = (options && options.mb) || 89;\n    // let lb = (options && options.lb) || 144;\n    // let mc = (options && options.mb) || 233;\n    // let lc = (options && options.lb) || 377;\n\n    // wave A\n    let fastMA1 = utils.ma(tradeData, n, source, \"ema\", digits);\n    let slowMA1 = utils.ma(tradeData, ma, source, \"ema\", digits);\n    let macd1 = subtract(fastMA1, slowMA1);\n    let signal1 = utils.ma(macd1, ma, null, \"ema\", digits);\n    let hist1 = subtract(macd1, signal1, digits);\n\n    let fastMA2 = utils.ma(tradeData, n, source, \"ema\", digits);\n    let slowMA2 = utils.ma(tradeData, la, source, \"ema\", digits);\n    let macd2 = subtract(fastMA2, slowMA2);\n    let signal2 = utils.ma(macd2, la, null, \"ema\", digits);\n    let hist2 = subtract(macd2, signal2, digits);\n\n    // wave B\n    let fastMA3 = useb ? utils.ma(tradeData, n, source, \"ema\", digits) : null;\n    let slowMA3 = useb ? utils.ma(tradeData, mb, source, \"ema\", digits) : null;\n    let macd3 = useb ? subtract(fastMA3, slowMA3) : null;\n    let signal3 = useb ? utils.ma(macd3, mb, null, \"ema\", digits) : null;\n    let hist3 = useb ? subtract(macd3, signal3, digits) : null;\n\n    let fastMA4 = useb ? utils.ma(tradeData, n, source, \"ema\", digits) : null;\n    let slowMA4 = useb ? utils.ma(tradeData, lb, source, \"ema\", digits) : null;\n    let macd4 = useb ? subtract(fastMA4, slowMA4) : null;\n    let signal4 = useb ? utils.ma(macd4, lb, null, \"ema\", digits) : null;\n    let hist4 = useb ? subtract(macd4, signal4, digits) : null;\n\n    // wave C\n    let fastMA5 = usec ? utils.ma(tradeData, n, source, \"ema\", digits) : null;\n    let slowMA5 = usec ? utils.ma(tradeData, mc, source, \"ema\", digits) : null;\n    let macd5 = usec ? subtract(fastMA5, slowMA5) : null;\n    let signal5 = usec ? utils.ma(macd5, mc, null, \"ema\", digits) : null;\n    let hist5 = usec ? subtract(macd5, signal5, digits) : null;\n\n    let fastMA6 = usec ? utils.ma(tradeData, n, source, \"ema\", digits) : null;\n    let slowMA6 = usec ? utils.ma(tradeData, lc, source, \"ema\", digits) : null;\n    let macd6 = usec ? subtract(fastMA6, slowMA6, digits) : null;\n    let signal6 = usec ? utils.ma(macd6, mc, null, \"ema\", digits) : null;\n    let hist6 = usec ? subtract(macd6, signal6, digits) : null;\n\n    return [hist1, hist2, hist3, hist4, hist5, hist6, macd6];\n}\n\nexport default {\n    name: \"TTM Wave\",\n    label: \"TTMWave\",\n    description: \"TTM 波浪A B C\",\n    calculate: ttmwave,\n};\n\n// function ttmwave_ol(tradeData, options) {\n//     utils.checkTradeData(tradeData);\n\n//     if (\n//         _.isEmpty(tradeData) ||\n//         !_.isArray(tradeData) ||\n//         tradeData.length <= 0\n//     ) {\n//         return;\n//     }\n\n//     let source = (options && options.source) == \"ohlc\" ? utils.ohlc : \"close\";\n//     let digits = (options && options.digits) || 3;\n//     let n = (options && options.n) || 8;\n//     // wave A\n//     let ma = (options && options.ma) || 34;\n//     let la = (options && options.la) || 55;\n//     // wave B\n//     let mb = (options && options.mb) || 89;\n//     let lb = (options && options.lb) || 144;\n//     // wave C\n//     let mc = (options && options.mb) || 233;\n//     let lc = (options && options.lb) || 377;\n\n//     // 优化方式下，从头开始，每天的数据一次性完成\n//     let ttmwaves = [];\n//     let last = [];\n//     for (let i = 0; i < tradeData.length; i++) {\n//         let tmp = [];\n//         if (i === 0) {\n//             // 第一天的特殊数据\n\n//         } else {\n//             // wave a\n//             // let fastma1 =\n//         }\n//     }\n// }\n","/**\n * 鸡排指标，Squeeze，From Mastering the Trade (3rd Ed)\n *\n * 参数：\n *  source: close | ohlc\n *  ma: ma | ema\n *  n: 20\n *  bm: 2\n *  km: 1.5\n *  mt: \"MTM\" || \"WAVE\"\n *  mn: 5\n *  mm: 12\n *\n *  ditis: 3\n *\n */\nimport _ from \"lodash\";\nimport KC from \"./keltner-channel\";\nimport BOLL from \"./boll\";\nimport MTM from \"./mtm\";\n// import AO from \"./ao\";\nimport TTMWave from \"./ttmwave\";\nimport utils from \"./utils\";\n\nconst READY = \"READY\";\nconst REST = \"--\";\nconst BUY = \"BUY\";\nconst SELL = \"SELL\";\n\nfunction squeeze(\n    tradeData,\n    {\n        source = \"close\",\n        digits = 3,\n        ma = \"ema\",\n        n = 20,\n        km = 1.5,\n        bm = 2,\n        mt = \"MTM\",\n        mn = 12,\n        mm = 1,\n        tn = 5,\n        tm = 21,\n        tl = 34,\n    } = {}\n) {\n    utils.checkTradeData(tradeData);\n\n    if (source === \"ohlc\") {\n        source = utils.ohlc;\n    } else {\n        source = \"close\";\n    }\n    // let source = (options && options.source) || \"close\";\n    // let digits = (options && options.digits) || 3;\n    // let ma = (options && options.ma) || \"ema\";\n    // let n = (options && options.n) || 20;\n    // // kc边界倍数\n    // let km = (options && options.km) || 1.5;\n    // // boll边界倍数\n    // let bm = (options && options.bm) || 2;\n    // // 动量指标参数\n    // let mt = (options && options.mt) || \"MTM\";\n    // let mn = (options && options.mn) || 12;\n    // let mm = (options && options.mm) || 1;\n    // let mmsource = (options && options.mmsource) || \"hl\";\n\n    // // TTM Wave\n    // let tn = (options && options.tn) || 5;\n    // let tm = (options && options.tm) || 21;\n    // let tl = (options && options.tl) || 34;\n\n    let kcData = KC.calculate(tradeData, {\n        n,\n        m: km,\n        type1: ma,\n        type2: ma,\n        source,\n        digits,\n    });\n    let bollData = BOLL.calculate(tradeData, {\n        n,\n        m: bm,\n        ma,\n        source,\n        digits,\n    });\n\n    let mtmData = MTM.calculate(tradeData, {\n        n: mn,\n        m: mm,\n        source,\n        digits,\n    });\n\n    let waveData = TTMWave.calculate(tradeData, {\n        n: tn,\n        ma: tm,\n        la: tl,\n        source,\n        digits,\n        useb: false,\n        usec: false,\n    });\n\n    let mmData = mt === \"MTM\" ? mtmData : waveData && waveData[0];\n\n    // 下面根据轨道情况，判断状态，状态区分如下\n    // 1. boll进kc，启动警告状态：READY\n    // 2. boll出kc，进入交易状态：\n    //   2.1 mm>0，买入（多头）：BUY\n    //   2.2 mm<=0，卖出（空头）：SELL\n    // 3. mm 降低，交易结束：--\n    let currentState = REST;\n    let states = tradeData.map((item, i, all) => {\n        let ready =\n            bollData &&\n            kcData &&\n            bollData[1][i] &&\n            kcData[1][i] &&\n            bollData[1][i] <= kcData[1][i];\n\n        let mmUp = mmData && mmData[i] && mmData[i] >= 0;\n        // mt === \"MTM\"\n        //     ? mmData && mmData[i] && mmData[i] >= 0\n        //     : waveData && waveData[0] && waveData[0][i] >= 0;\n\n        let nextState = currentState;\n        if (currentState === REST) {\n            if (ready) {\n                nextState = READY;\n            }\n        } else if (currentState === READY) {\n            if (!ready) {\n                nextState = mmUp ? BUY : SELL;\n            }\n        } else if (currentState === BUY || currentState === SELL) {\n            if (ready) {\n                // 再次进入等待\n                nextState = READY;\n            } else {\n                // 检查是否出现动能减弱\n                if (\n                    mmData &&\n                    mmData[i] &&\n                    mmData[i - 1] &&\n                    ((currentState === BUY && mmData[i] < mmData[i - 1]) ||\n                        (currentState === SELL && mmData[i] > mmData[i - 1]))\n                ) {\n                    nextState = REST;\n                }\n            }\n        }\n        currentState = nextState;\n        return nextState;\n    });\n\n    return [\n        kcData && kcData[0],\n        bollData && bollData[1],\n        bollData && bollData[2],\n        kcData && kcData[1],\n        kcData && kcData[2],\n        mmData,\n        states,\n        mtmData,\n        waveData && waveData[0],\n        waveData && waveData[1],\n    ];\n}\n\nexport default {\n    name: \"SQUEEZE\",\n    label: \"鸡排\",\n    description: \"挤牌信号器指标\",\n    calculate: squeeze,\n    states: {\n        REST,\n        READY,\n        BUY,\n        SELL,\n    },\n};\n","import SQUEEZE from \"../indicators/squeeze\";\nimport TTMWave from \"../indicators/ttmwave\";\nimport _ from \"lodash\";\nimport moment from \"moment\";\nimport trans from \"../transaction\";\nimport debugpkg from \"debug\";\nimport { getDataRoot } from \"@wt/lib-wtda-query\";\n\nconst debug = debugpkg(\"engine\");\n\nconst RULE_NAME = \"squeeze\";\nconst SQUEEZE_DATA = Symbol(\"SQUEEZE_DATA\");\nconst TTMWAVE_DATA = Symbol(\"TTMWAVE_DATA\");\n\nfunction check(index, stockData, options, tsCode) {\n    let sdata = SQUEEZE.calculate(stockData, options.squeeze);\n\n    // 使用TTMWave同步进行检查\n    let ttmwave = TTMWave.calculate(stockData, options.ttmwave);\n\n    if (\n        stockData &&\n        _.isArray(stockData) &&\n        index < stockData.length &&\n        index >= 0\n    ) {\n        let tradeDate = stockData[index].trade_date;\n        let days = checkDays(index, sdata[6]);\n        if (sdata[6][index] === SQUEEZE.states.READY) {\n            // 有信号\n            // 检查TTM Wave ABC的趋势\n            let upTrend = 0;\n            let downTrend = 0;\n            if (index - 2 >= 0) {\n                for (let i = 0; i < 6; i++) {\n                    if (\n                        ttmwave[i][index] > ttmwave[i][index - 1] &&\n                        ttmwave[i][index - 1] > ttmwave[i][index - 2]\n                    ) {\n                        upTrend++;\n                    } else {\n                        downTrend++;\n                    }\n                }\n            }\n            return {\n                tsCode,\n                dataIndex: index,\n                date: tradeDate,\n                tradeType: \"signal\",\n                hasSignals: true,\n                signal: \"READY\",\n                type: \"squeeze\",\n                trends: [upTrend, downTrend],\n                days,\n                targetPrice: stockData[index].close,\n                memo: `挤牌信号，可考虑挤入 [${stockData[index].trade_date} ${sdata[6][index]}]`,\n            };\n        } else if (sdata[6][index] === SQUEEZE.states.BUY) {\n            // 检查Wave ABC的趋势变化\n            return {\n                tsCode,\n                dataIndex: index,\n                date: tradeDate,\n                tradeType: \"buy\",\n                hasSignals: true,\n                signal: \"BUY\",\n                type: \"squeeze\",\n                days,\n                targetPrice: stockData[index].close,\n                memo: `挤牌信号明确，买入 [${stockData[index].trade_date} ${sdata[6][index]}]`,\n            };\n        } else if (\n            sdata[6][index] === SQUEEZE.states.SELL &&\n            options.squeeze.needSell\n        ) {\n            return {\n                tsCode,\n                dataIndex: index,\n                date: tradeDate,\n                hasSignals: true,\n                tradeType: \"sell\",\n                signal: \"SELL\",\n                type: \"squeeze\",\n                days,\n                targetPrice: stockData[index].close,\n                memo: `挤牌信号明确，卖出 [${stockData[index].trade_date} ${sdata[6][index]}]`,\n            };\n        }\n    }\n}\n\nfunction checkDays(index, states) {\n    if (states[index] === SQUEEZE.states.REST) return [0, 0];\n    let trade_days = 0;\n    let state = states[index];\n    if (state === SQUEEZE.states.BUY || state === SQUEEZE.states.SELL) {\n        while (\n            index - trade_days >= 0 &&\n            states[index - trade_days] === state\n        ) {\n            trade_days++;\n        }\n    }\n    let ready_days = 0;\n    if (states[index - trade_days] === SQUEEZE.states.READY) {\n        while (\n            index - trade_days - ready_days >= 0 &&\n            states[index - trade_days - ready_days] === SQUEEZE.states.READY\n        ) {\n            ready_days++;\n        }\n    }\n    return [ready_days, trade_days];\n}\n\nfunction calculateSqueeze(stockData, options) {\n    if (_.isNil(stockData)) return;\n    // debug(\n    //     `squeeze? ${_.isNil(stockData[SQUEEZE_DATA])} ${_.isNil(\n    //         stockData[TTMWAVE_DATA]\n    //     )}`\n    // );\n    if (_.isNil(stockData[SQUEEZE_DATA])) {\n        stockData[SQUEEZE_DATA] = SQUEEZE.calculate(stockData, options.squeeze);\n    }\n    if (_.isNil(stockData[TTMWAVE_DATA])) {\n        stockData[TTMWAVE_DATA] = TTMWave.calculate(stockData, options.ttmwave);\n    }\n}\n\nfunction checkBuyTransaction(stockInfo, balance, index, stockData, options) {\n    debug(`检查挤牌买入：${index}, ${balance}`);\n    if (balance <= 0) return;\n    calculateSqueeze(stockData, options);\n\n    if (index < 1) return;\n    // 检查今天index的条件\n    let squeeze = stockData[SQUEEZE_DATA];\n    // debug(`%o`, squeeze);\n    let squeeze_today = squeeze && squeeze[6] && squeeze[6][index];\n    let squeeze_lday = squeeze && squeeze[6] && squeeze[6][index - 1];\n    // if (_.isNil(squeeze_today)) {\n    //     debug(`意外退出...`);\n    //     return;\n    // }\n    debug(`检查买入规则：${squeeze_today}, ${squeeze_lday}`);\n    if (\n        squeeze_today === SQUEEZE.states.BUY &&\n        squeeze_lday === SQUEEZE.states.READY\n    ) {\n        let currentData = stockData[index];\n        let tradeDate = currentData.trade_date;\n        let targetPrice = currentData.close;\n        return trans.createBuyTransaction(\n            stockInfo,\n            tradeDate,\n            index,\n            balance,\n            targetPrice,\n            RULE_NAME,\n            `挤牌买入 ${targetPrice.toFixed(2)}`\n        );\n    }\n}\n\nfunction checkSellTransaction(stockInfo, stock, index, stockData, options) {\n    if (_.isNil(stock) || stock.count <= 0) return;\n    calculateSqueeze(stockData, options);\n\n    if (index < 1) return;\n    // 检查今天index的条件\n    let squeeze = stockData[SQUEEZE_DATA];\n    let squeeze_today = squeeze && squeeze[6] && squeeze[6][index];\n    let squeeze_lday = squeeze && squeeze[6] && squeeze[6][index - 1];\n    // if (_.isNil(squeeze_today)) {\n    //     return;\n    // }\n    if (\n        squeeze_today === SQUEEZE.states.REST &&\n        squeeze_lday === SQUEEZE.states.BUY\n    ) {\n        let currentData = stockData[index];\n        let tradeDate = currentData.trade_date;\n        let targetPrice = currentData.close;\n        return trans.createSellTransaction(\n            stockInfo,\n            tradeDate,\n            index,\n            stock.count,\n            targetPrice,\n            RULE_NAME,\n            `挤牌卖出 ${targetPrice.toFixed(2)}`\n        );\n    }\n}\n\n/**\n * 返回参数配置的显示信息\n * @param {*}} opions 参数配置\n */\nfunction showOptions(options) {\n    let opt = options && options.squeeze;\n    // let buy = opt && options.squeeze.buy;\n    // let sell = opt && options.squeeze.sell;\n    return `\n模型 ${squeeze.name}[${squeeze.label}] 参数：\nsource: ${opt.source}\n均值类型: ${opt.ma},    平均天数: ${opt.n}\n布林线倍率: ${opt.bm}   Keltner通道倍率: ${opt.km}\n动量类型:  ${opt.mt}\n动量平均天数：  ${opt.mn},     动量天数：${opt.mm}\n价格类型: ${opt.source}\n\n`;\n}\n\n/**\n * 将搜索得到的列表生成分析报表\n *\n * @param {*} results 搜索的匹配列表\n * @param {*} options 匹配使用的参数\n */\nasync function createReports(results, options) {\n    if (_.isNil(results)) return;\n\n    // results 当中按照signal进行了分组\n    // 下面主要分析signal===\"READY\"情况下，时间的分布\n    let readyList = results && results[SQUEEZE.states.READY];\n    // 1, 2, 3, 6, 12, 21, 34\n    // let boundaries = [1, 2, 3, 6, 12, 21, 34];\n    let days = [[], [], [], [], [], [], [], []];\n    for (let item of readyList) {\n        let ready_days = item.days && item.days[0];\n        let i = 0;\n        if (ready_days === 1) i = 0;\n        else if (ready_days === 2) i = 1;\n        else if (ready_days === 3) i = 2;\n        else if (ready_days > 3 && ready_days <= 6) i = 3;\n        else if (ready_days > 6 && ready_days <= 12) i = 4;\n        else if (ready_days > 12 && ready_days <= 21) i = 5;\n        else if (ready_days > 21 && ready_days <= 34) i = 6;\n        else i = 7;\n\n        if (days[i]) {\n            days[i].push(item.tsCode);\n        } else {\n            days[i] = [item.tsCode];\n        }\n    }\n\n    let buyList = results && results[SQUEEZE.states.BUY];\n    let bdays = [[], [], [], [], [], [], [], []];\n    for (let item of buyList) {\n        let buy_days = item.days && item.days[1];\n        let i = 0;\n        if (buy_days === 1) i = 0;\n        else if (buy_days === 2) i = 1;\n        else if (buy_days === 3) i = 2;\n        else if (buy_days > 3 && buy_days <= 6) i = 3;\n        else if (buy_days > 6 && buy_days <= 12) i = 4;\n        else if (buy_days > 12 && buy_days <= 21) i = 5;\n        else if (buy_days > 21 && buy_days <= 34) i = 6;\n        else i = 7;\n\n        if (bdays[i]) {\n            bdays[i].push(item.tsCode);\n        } else {\n            bdays[i] = [item.tsCode];\n        }\n    }\n\n    let reports = {\n        updateTime: moment().toISOString(),\n        squeeze: {\n            readyList: days,\n            buyList: bdays,\n        },\n    };\n\n    return reports;\n}\n\nconst squeeze = {\n    name: \"挤牌\",\n    label: RULE_NAME,\n\n    description: \"挤牌模型\",\n    methodTypes: {},\n    checkBuyTransaction,\n    checkSellTransaction,\n    check,\n    showOptions,\n    createReports,\n};\n\nexport default squeeze;\n","/**\n * 基本动量指标\n *\n * 参数：\n *  n: 短期平均天数\n *  m: 长期平均天数\n *  source: hl, ohlc\n */\n\nimport _ from \"lodash\";\nimport utils from \"./utils\";\n\nfunction ao(tradeData, options) {\n    utils.checkTradeData(tradeData);\n\n    if (\n        !_.isEmpty(tradeData) &&\n        _.isArray(tradeData) &&\n        tradeData.length > 0 &&\n        options &&\n        options.n >= 1 &&\n        options.m >= 1\n    ) {\n        let source =\n            options && options.source === \"ohlc\" ? utils.ohlc : utils.hl;\n        let digits = options.digits || 3;\n\n        let ma1 = utils.ma(tradeData, options.n, source, \"ma\", digits);\n        let ma2 = utils.ma(tradeData, options.m, source, \"ma\", digits);\n\n        let momentum = tradeData.map((item, i, all) => {\n            if (i >= options.n && i > options.m) {\n                return utils.toFixed(ma1[i] - ma2[i], digits);\n            } else {\n                return 0;\n            }\n        });\n        return momentum;\n    }\n}\n\nexport default {\n    name: \"AO\",\n    label: \"动量震动指标\",\n    description: \"比尔威廉姆斯动量振荡器指标\",\n    calculate: ao,\n};\n","/**\n * 抢帽子警报，内容非常简单，连续三个收盘价涨/跌作为警报，警报放在第一根线（3个连续的第一个）\n */\n\nimport _ from \"lodash\";\n\nconst REST = \"--\";\nconst BUY_READY = \"BUY_READY\";\nconst SELL_READY = \"SELL_READY\";\nconst BUY = \"BUY\";\nconst SELL = \"SELL\";\n\nfunction scalper(tradeData) {\n    let retData = [];\n    if (!_.isNil(tradeData) && !_.isEmpty(tradeData)) {\n        let currentState = REST;\n        for (let i = 0; i < tradeData.length; i++) {\n            if (i < 2) {\n                retData[i] = [\n                    tradeData[i].trade_date,\n                    REST,\n                    tradeData[i].close,\n                ];\n            } else {\n                let data = tradeData[i];\n                let data1 = tradeData[i - 1];\n                let data2 = tradeData[i - 2];\n                if (\n                    currentState !== BUY &&\n                    data.close > data1.close &&\n                    data1.close > data2.close\n                ) {\n                    // UP\n                    retData[i - 2] = [data2.trade_date, BUY_READY, data2.low];\n                    retData[i - 1] = [data1.trade_date, BUY, data2.close];\n                    retData[i] = [data.trade_date, BUY, data.close];\n                    currentState = BUY;\n                } else if (\n                    currentState !== SELL &&\n                    data.close < data1.close &&\n                    data1.close < data2.close\n                ) {\n                    retData[i - 2] = [data2.trade_date, SELL_READY, data2.high];\n                    retData[i - 1] = [data1.trade_date, SELL, data2.close];\n                    retData[i] = [data.trade_date, SELL, data.close];\n                    currentState = SELL;\n                } else {\n                    retData[i] = [data.trade_date, currentState, data.close];\n                }\n            }\n        }\n    }\n\n    return retData;\n}\n\nexport default {\n    name: \"Scalper\",\n    label: \"抢帽子\",\n    description: \"抢帽子警报\",\n    calculate: scalper,\n    states: {\n        REST,\n        BUY_READY,\n        SELL_READY,\n        BUY,\n        SELL,\n    },\n};\n","/**\n * 自选列表\n */\nconst { getDataRoot } = require(\"@wt/lib-wtda-query\");\nconst _ = require(\"lodash\");\nconst moment = require(\"moment\");\n\nconst path = require(\"path\");\nconst fs = require(\"fs\");\nconst fp = fs.promises;\n\nasync function readFavorites() {\n    let retData = {\n        updateTime: null,\n        favorites: [],\n        // 下面考虑放个字段说明\n    };\n\n    try {\n        let dataFile = getFavoritesFile();\n        try {\n            retData = JSON.parse(await fp.readFile(dataFile, \"utf-8\"));\n        } catch (error) {\n            // 文件不存在，不考虑其它错误\n            if (!(error && error.code === \"ENOENT\")) {\n                console.error(\n                    `读取自选文件${dataFile}时发生错误：${error}, %o`,\n                    error\n                );\n            } else {\n                console.error(`读取自选文件${dataFile}不存在，%o`, error);\n            }\n        }\n    } catch (error) {\n        console.error(`从本地读取自选数据发生错误 ${error}`);\n    }\n    return retData;\n}\n\nfunction getFavoritesFile() {\n    return path.join(getDataRoot(), \"favorites.json\");\n}\n\nasync function removeFavorites(tsCodes) {\n    let retData = await readFavorites();\n    if (_.isEmpty(tsCodes)) return retData;\n\n    let newCodes = [];\n    if (_.isArray(tsCodes)) {\n        if (tsCodes.length <= 0) return retData;\n        newCodes = tsCodes;\n    } else {\n        newCodes.push(tsCodes);\n    }\n\n    if (_.isEmpty(retData)) {\n        retData = { updateTime: null, favorites: [] };\n    }\n\n    if (_.isEmpty(retData.favorites) || !_.isArray(retData.favorites)) {\n        retData.favorites = [];\n    }\n\n    for (let newCode of newCodes) {\n        for (let i in retData.favorites) {\n            if (retData.favorites[i] === newCode) {\n                retData.favorites.splice(i, 1);\n                break;\n            }\n        }\n    }\n\n    retData.updateTime = moment().toISOString();\n    await saveFavorites(retData);\n    return retData;\n}\n\nasync function addFavorites(tsCodes) {\n    let retData = await readFavorites();\n    if (_.isEmpty(tsCodes)) return retData;\n\n    let newCodes = [];\n    if (_.isArray(tsCodes)) {\n        if (tsCodes.length <= 0) return retData;\n        newCodes = tsCodes;\n    } else {\n        newCodes.push(tsCodes);\n    }\n\n    if (_.isEmpty(retData)) {\n        retData = { updateTime: null, favorites: [] };\n    }\n\n    if (_.isEmpty(retData.favorites) || !_.isArray(retData.favorites)) {\n        retData.favorites = [];\n    }\n\n    for (let newCode of newCodes) {\n        let found = false;\n        for (let code of retData.favorites) {\n            if (code === newCode) {\n                found = true;\n                break;\n            }\n        }\n        if (!found) retData.favorites.push(newCode);\n    }\n\n    retData.updateTime = moment().toISOString();\n    await saveFavorites(retData);\n    return retData;\n}\n\nasync function saveFavorites(data) {\n    try {\n        let jsonStr = JSON.stringify(data);\n        let favoritesPath = getFavoritesFile();\n\n        await fp.writeFile(favoritesPath, jsonStr, { encoding: \"utf-8\" });\n    } catch (error) {\n        throw new Error(\"保存列表数据时出现错误，请检查后重新执行：\" + error);\n    }\n}\n\nexport default { addFavorites, removeFavorites, readFavorites };\n","// const simulate = require(\"./simulator\");\nimport simulate from \"./simulator\";\nimport search from \"./search\";\nimport mmb from \"./momentum-breakthrough\";\nimport stoploss from \"./stoploss\";\nimport benchmark from \"./benchmark-basic\";\nimport outsideday from \"./outsideday\";\nimport opensell from \"./opensell\";\nimport smashday from \"./smashday\";\nimport engine from \"./transaction-engine\";\nimport * as reports from \"./reports\";\nimport { formatFxstr } from \"./util\";\n\nimport squeeze from \"./rules/squeeze\";\n\nimport MA from \"./indicators/ma\";\nimport ATR from \"./indicators/atr\";\nimport KC from \"./indicators/keltner-channel\";\nimport BOLL from \"./indicators/boll\";\nimport MTM from \"./indicators/mtm\";\nimport AO from \"./indicators/ao\";\nimport SQUEEZE from \"./indicators/squeeze\";\nimport TTMWave from \"./indicators/ttmwave\";\nimport Scalper from \"./indicators/scalper\";\nimport utils from \"./indicators/utils\";\n\nimport favorites from \"./favorites\";\n\nconst indicators = {\n    MA,\n    ATR,\n    KC,\n    BOLL,\n    MTM,\n    AO,\n    SQUEEZE,\n    TTMWave,\n    Scalper,\n};\n\nconst rules = {\n    mmb,\n    stoploss,\n    benchmark,\n    outsideday,\n    opensell,\n    smashday,\n    squeeze,\n};\n\nexport {\n    simulate,\n    search,\n    engine,\n    rules,\n    reports,\n    formatFxstr,\n    indicators,\n    utils,\n    favorites,\n};\n"],"names":["formatFxstr","num","toLocaleString","debug","debugpkg","executeTransaction","index","stockData","capitalData","options","translog","tradeDate","trade_date","stockInfo","info","sellRules","rules","sell","buyRules","buy","stocks","stockId","length","stock","sold","rule","name","checkSellTransaction","transeq","executeCapitalSettlement","price","count","total","toFixed","commission","fee","duty","memo","fixCash","cash","balance","initBalance","checkBuyTransaction","_transeq","_","isEmpty","type","ts_code","push","i","splice","settledlog","date","profit","income","transactions","createSellTransaction","tradeDateIndex","methodType","calculateTransactionFee","dateIndex","amount","createBuyTransaction","parseInt","exchange","parseCapitalReports","count_win","total_win","count_loss","total_loss","total_profit","total_fee","max_profit","max_loss","average_profit","average_win","average_loss","max_wintimes","max_losstimes","max_windays","max_lossdays","average_windays","average_lossdays","selltypes","ror_win","ror_loss","ror","tmp_cost","tmp_cost_win","tmp_cost_loss","currentType","tmp_times","tmp_windays","tmp_lossdays","log","days","selltype","times","win_times","loss_times","Number","showCapitalReports","stockvalue","capitalResult","showTransactions","logTransaction","holdlog","parseWorkdayReports","results","day","win_ratio","win","loss_ratio","loss","ratio_winloss","average","max_win","trans","moment","res","showWorkdayReports","reports","grid","CG","CGS","Style","columns","id","align","rows","report","workday","red","win_average","green","loss_average","cyan","profit_average","data","option","render","console","showOptionsInfo","buys","usedRules","label","sells","rules_desc","showOptions","startDate","simulate","stockListData","readStockList","stockList","filterStockList","stockItem","readStockData","stockDataNames","daily","updateTime","format","filterStockData","calculatePrevAdjPrice","currentDate","isAfter","engine","showTrans","showWorkdays","dailyData","digits","forEach","item","prevadj_factor","open","close","high","low","pre_close","change","selectedStocks","map","tsCode","tmp","filter","reverse","ORGANIZED","Symbol","checkTradeData","isArray","checkOrder","readData","prop","isFunction","isString","array","n","Array","desc","step","lastIndex","sum","ma","sma","ema","ret","tr","Math","max","abs","ohlc","hl","stdev","d","j","sqrt","path","require","fs","fp","promises","match","search","foundSignals","prepareStockData","matched","check","hasSignals","tradeType","signal","createReports","saveReports","list","buyList","squeeze","readyList","boundaries","getReportsFile","join","getDataRoot","jsonStr","JSON","stringify","filePath","writeFile","encoding","error","Error","readReports","retData","dataFile","parse","readFile","code","all","utils","findIndex","slice","OPTIONS_NAME","checkMMBBuyTransaction","mmboptions","N","P","mmbType","currentData","targetPrice","checkMMBSellTransaction","nommb1","nommb2","L","mmb","description","methodTypes","mmb1","mmb2","checkStoplossTransaction","S","lossPrice","stoploss","RULE_NAME","bmoptions","priceType","sellPrice","benchmark","data2","data1","outsideday","opensell","smashday","dataIndex","validDays","smashType","smash1","smash2","tradeData","source","calculate","atr","keltner","MA","type1","ATR","type2","up","down","m","boll","mtm","momentum","subtract","array1","array2","ttmwave","la","useb","mb","lb","usec","mc","lc","fastMA1","slowMA1","macd1","signal1","hist1","fastMA2","slowMA2","macd2","signal2","hist2","fastMA3","slowMA3","macd3","signal3","hist3","fastMA4","slowMA4","macd4","signal4","hist4","fastMA5","slowMA5","macd5","signal5","hist5","fastMA6","slowMA6","macd6","signal6","hist6","READY","REST","BUY","SELL","km","bm","mt","mn","mm","tn","tm","tl","kcData","KC","bollData","BOLL","mtmData","MTM","waveData","TTMWave","mmData","currentState","states","ready","mmUp","nextState","SQUEEZE_DATA","TTMWAVE_DATA","sdata","SQUEEZE","checkDays","upTrend","downTrend","trends","needSell","trade_days","state","ready_days","calculateSqueeze","isNil","squeeze_today","squeeze_lday","opt","bdays","buy_days","toISOString","ao","ma1","ma2","BUY_READY","SELL_READY","scalper","readFavorites","favorites","getFavoritesFile","removeFavorites","tsCodes","newCodes","newCode","saveFavorites","addFavorites","found","favoritesPath","indicators","AO","Scalper"],"mappings":"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"}